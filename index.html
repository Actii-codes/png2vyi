
				<!DOCTYPE html>
				<html>
					<head>
						<title>png2vyitool</title>
						<style>html, body, iframe, canvas, input, div {
	margin: 0;
	padding: 0;
	border: 0;
}
html, body {
	background-color: #252a37;
	font-family: Courier, monospace;
	-webkit-user-select: none;
	user-select: none;
	cursor: default;
}
canvas {

}
#fps_label {
	position: absolute;
	color: #FFF;
	top: 6px;
	left: 10px;
	z-index: 1000000;
	font-size: 10px;
	display: none;
}
#web_background {
	position: absolute;
	top: 0px;
	left: 0px;
	width: 100%;
	height: 100%;
	z-index: 1;
}
#game_body {
	position: relative;
	background-color: #000000;
	overflow: hidden;
}
.web_box {
	position: absolute;
	box-sizing: border-box;
	-webkit-user-select: initial;
	user-select: initial;
	overflow: hidden;
}
.web_box_inner {
	position: absolute;
	box-sizing: border-box;
	overflow-y: auto;
	word-wrap: break-word;
	font-size: 12px;
	color: #000;
}
.web_box_inner * {
	font: inherit;
	color: inherit;
}
.web_box_inner div.web_box_div {
	display: block;
}
#game_canvas, .game_canvas, #interface_canvas, .interface_canvas, #top_canvas, .top_canvas {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	z-index: 1;
	pointer-events: none;
}
#top_canvas, .top_canvas {
	z-index: 99999;
}
.text_input {
	background-color: transparent;
	position: absolute;
	top: 0;
	left: 0;
	box-sizing: border-box;
}
.text_input:focus {
	outline: none;
}
#error_message {
	position: absolute;
	color: #FFF;
	top: 30%;
	left: 0;
	text-align: center;
	z-index: 100000;
	pointer-events: none;
}

#load_screen {
	display: none;
	position: absolute;
	top: 0;
	width: 100%;
	height: 100%;
	background: #252a37;
	z-index: 2000000;
	pointer-events: none;
	-webkit-transition: opacity 0.6s;
	transition: opacity 0.6s;
}
#load_screen_logo {
	position: absolute;
	top: 50%;
	left: 50%;
	margin-left: -105px;
	margin-top: -62px;
	width: 210px;
	height: 90px;
	cursor: pointer;
	z-index: 2;
	pointer-events: auto;
	background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANIAAABaCAYAAADNegj3AAAFxUlEQVR4Xu2dTW7VQBCEkyUXi8RFYB/lDmxQNqzgFNkh5WIsQflDLy/2q66ZnvF4/LFCuNzTXV01fw5w/e3Hw98rfsEADFQxcP1kpMfH31VBeBkGjszAzc3nK4x0ZAVQewoDGCmFRoIcnQGMdHQFUH8KAxgphUaCHJ0BjHR0BVB/CgMYKYVGghydAYx0dAVQfwoDYSM9AUt/rX2jah0z8m3sNIet8nR5HTnPCOeReveijbdaMNLJBDGyQE/FN3KeGEn8ZEPrGSIyS7liijSVFemF1SxzRjiP9Lq13iJ5RrRRtSJlJeEk+pRwBB/BnDYygo9gIuJwx3Xxe8kzwpVbSwQfwbicY6RXBiLkRjARcZQ2qdUkEsnZrd3Fr+XgxongI5jSHhWdkY68IkXE525B9xIzq++Reltv7SI5RPpYtSJlJdFihliL6f752szUova9xMRI650qWpFaND6rSa5hImaOYFxOojGjuOj2r1WepzPz2+8jPe25tcsaaykORjKvv2vEUbL/xkjrN4olfK6ZoNb8RUZqISZ3psy6ro3sg1vv1y/xWWqkrfgcWRvDrUgjk9Va9C0EipE+stqijxhpgQFWpD7icwU98iQ7hJHcmRg8DByJgfAZ6UikUCsMuAxgJJcx8DCwwABGQhYwkMAARkogkRAwgJHQAAwkMICREkgkBAxgJDQAAwkMhI306/4uYThCwMA+Gfhy+/1i4hhpn30l684MYKTOhDPcnAxgpDn7SlWdGcBInQlnuDkZwEhz9pWqOjOQZqTOeTPcwRhQt8JKyFvTFb612zpRxp+bAYw0d3+prhMDGKkT0QwzNwOHMdLP208XO/n1/o/VaTeei1fJuPHcRiu8ys99fn6GGH18N99avOJT8aXOaOEzkis8lbgbz8Vnj+8SrfAqP/e5KzQ3vsK74/fGq/xVvzDSCoOuMV2iFV411n3uCtONr/Du+L3xKn/VL4yEkZSGUp73Nkat8M+Lro3H1m5FRudnPpdohU9R70kQV8hbj+/mW4tX9ap+sSKxIikNpTyvFborZBeviqyNx4q00YqkZrjarUetMGrHV8KtjT9afRgJI4U0ny1cjBQUnuqOe2vm4rPHd4Xk4lW+bjwXnz2+ioeRMNIiA7VnBCU81xguPnt8FQ8jYSSMtMBA7UTiGt/FK2PXxuOMFJwYXKJdfHaj9za+m6+Lz+b3PB5GwkhKY8/PXeGOhldFuvlipFcG3MsLl2gXn93ovY3v5uvis/nFSJMaSQnl/Ln7HcuN7wq9NV7l746PkTDSMwMY6b0VMNIrH63/PpRLtIuvnTHV+6xIlxmq7ReXDZNcNmCk9wy4Ky5GYkVa3KrVCuPcmG680fBqonHz5Yw06Rmp9oNottBcYbbGZ9eHkTBS0WVDa6G3jo+RCoWviOM70uX/poStnXfm4rJhkssGtnae8GsnCrZ2hSvc3rYebr5qBXfjjYbPrq/YSCqR1s/drZjKx43XWhgq39nH31t9GIkVicuGhVnLNXJzI7kzvZqJ356ruNE4URz/ilCUqRdc7RnNFbLCe9lrtPrAG75s0EO9IJTg3R/lwUgx5l0hx6LGUe74rfHxzGNIjBTj6QOKFckjrrUx3Phe9hqNkTRHiwiM5BHnCr013steozGS5ggjFXJ0+lprY7jxE0p6FwIjFTLKiuQR5wq9Nd7LXqO7G0mnNAbCvRRRt0SK6DGqJos1Bmr7m35rt5dWYaS9dKpPnhipkGeMVEjcpK9hpMLGYqRC4iZ9rZuRlPBm49e9bNi6fvfwvnW+extfnYHDZySMdDd07zFS2/ZgpEJ+WZEKiZv0NYxU2FiMVEjcpK9hpMLGYqRC4iZ9DSMVNhYjFRI36WtpRpqUH8qCgRQGwrd2KaMRBAYmZQAjTdpYyurLAEbqyzejTcoARpq0sZTVlwGM1JdvRpuUAYw0aWMpqy8DGKkv34w2KQP/jTRpfZQFA90Y+AfySHJ9oli5FAAAAABJRU5ErkJggg==);
}
#load_screen_loader_back {
	display: none;
	position: absolute;
	top: 50%;
	left: 50%;
	margin-left: -105px;
	margin-top: 27px;
	width: 210px;
	height: 28px;
	z-index: 4;
	background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANIAAAAcCAYAAAAUe+GGAAABCElEQVR4Xu3bsQ2CABQEUFiOxEUcwLiDjbGxcwo7E5bTztIQ4hVwj54c936uZLzcn+95fg0eAgTWCUzTYRiXDOlxO69L8BaBHQgcT9efLQxpB0dWIS9gSHljCQUChlRwZBXzAoaUN5ZQIGBIBUdWMS9gSHljCQUChlRwZBXzAoaUN5ZQIGBIBUdWMS9gSHljCQUChlRwZBXzAoaUN5ZQIGBIBUdWMS9gSHljCQUChlRwZBXzAoaUN5ZQIGBIBUdWMS/wtyHlP1UCge0KLP5DdrsVfTmBvIAh5Y0lFAgYUsGRVcwLGFLeWEKBgCEVHFnFvIAh5Y0lFAgYUsGRVcwLfIeUj5JAYN8CH0o31RkJeDwlAAAAAElFTkSuQmCC);
}
#load_screen_loader {
	display: none;
	position: absolute;
	top: 50%;
	left: 50%;
	margin-left: -96px;
	margin-top: 28px;
	width: 200px;
	height: 18px;
	background-color: #dabf70;
	z-index: 4;
	box-sizing: border-box;
}
#load_screen_loader_text {
	position: absolute;
	top: 50%;
	left: 50%;
	width: 80px;
	margin-top: 30px;
	margin-left: -40px;
	text-align: center;
	z-index: 1010;
	font-weight: bold;
	font-size: 12px;
	color: #000000;
	display: none;
}#wb_interface_canvas {overflow: hidden;border: 2px solid #f3f3f3;}#wb_interface_preview_canvas {overflow: hidden;border: 1px solid #f3f3f3;}#wb_interface_preview_canvas2 {overflow: hidden;border: 1px solid #f3f3f3;}.preview {font-size: 15px;font-family: Arial;}::-webkit-scrollbar {width: 8px;height: 8px;}::-webkit-scrollbar-track {border-radius: 10px;background: rgba(0, 0, 0, 0.1);}::-webkit-scrollbar-thumb {border-radius: 10px;background: rgba(0, 0, 0, 0.2);}::-webkit-scrollbar-thumb:hover {background: rgba(0, 0, 0, 0.4);}::-webkit-scrollbar-thumb:active {background: rgba(0, 0, 0, 0.9);}label {display: inline-block;width: 120px;height 50px;overflow: visible;}.fake-button {display:inline-block;border:0.1em solid #000;border-radius:0.12em;box-sizing: border-box;text-decoration:none;font-family:'Roboto',sans-serif;font-color: #f3f3f3;font-weight:300;color: #f3f3f3;background-color: rgb(51, 51, 51);text-align:center;transition: all 0.2s;}.fake-button:hover {color:#a9a9a9;background-color:#1c1e1f;}/*.container {position: absolute;top:0;bottom: 0;left: 0;right: 0;margin: auto;}*/.container {position: absolute;top: 50%;left: 50%;-moz-transform: translateX(-50%) translateY(-50%);-webkit-transform: translateX(-50%) translateY(-50%);transform: translateX(-50%) translateY(-50%);}</style>
						<style>
#logo_box {
	display: none;
	position: absolute;
	width: 106px;
	height: 45px;
	background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGoAAAAtCAYAAABGfP5DAAACPUlEQVR4Xu2aQU4DMQxF2yUXq8RFYF9xBzaoG1ZwCnZIvRhLUOiMNI3G8Xec6Yyb3yUkjv2fHXum3b++f/3u+Nm8AvsE6nz+3ryjPTt4ODzuCCpABhBUAEjJRYKKDioRLH2mPa20Nl831wvT/lp7S/g4ZxPt4VbdED2KFZWLN3V+TljkQMkmai8XsIWPqM3SWSVtWuimgrJkqxXUNPCtVRQSi6SNtaIkO7kPYo9CM2ikjQQnwWlZUWjVloRGYrHuL+mk/U+tqBb3cuveo/W8Eigke6WKaKFFOl+yoxUGp77oU18Q/7txkxUVBDVBRQf1eXoJEsJ9uvl0fLsKTKwoglo3AQhqXf3h02FQsEUu/Fcgv4Fyob0ycZjwKjjsXw3Ux/HhKoTn089sSNI6734p8NreOWZ46/2SXe3vuZgaaLGivEJ79xMUOPV5hfbuJ6g7AyU1bRS0db/U0pY+L/zVZxVa6wUjCHSdth61o60jqOwNQK3wrKhBuVZTlJa5BGUc71tnqNRbrA+mVr+8iTH63c3VR1DCg/GtxvNbDxOsqCHlxzcgVkHQJ33vVWT1y3ted1ff0sOIFSCaWCoo77tKXn2XNwuLV9QcKFT8tDdfi4K3Xn2o3a28lLX6W1VRBCVXCHr1EZSiQFcVhWaDZZ1Upejdbjlry2u1eFf/hpegLulTDap2GPBmrTRMeO16rz7v+db98I9bCMoqbdv1BBXkh6UwqLb5QWteBVYfJrwB9LKfoIKQJqhooIL427Wbf6sOFr+t1VWDAAAAAElFTkSuQmCC);
	bottom: 16px;
	right: 16px;
	z-index: 2000002;
	cursor: pointer;
	text-align: right;
	box-sizing: border-box;
	transition: opacity 0.4s;
	-webkit-transition: opacity 0.4s;
}
#games_list {
	position: absolute;
	width: 300px;
	height: 100%;
	min-height: 300px;
	max-height: 400px;
	top: 50%;
	left: 50%;
	margin-top: -200px;
	margin-left: -150px;
	z-index: 2000000;
	display: none;
	border-top: 0;
	box-sizing: border-box;
	transition: opacity 0.4s;
	-webkit-transition: opacity 0.4s;
}
#games_list .list_entry {
	font-size: 12px;
	padding: 4px;
	padding-left: 0px;
	cursor: pointer;
	min-height: 32px;
	color: #dabf70;
	background-color: #3f4b64;
	border: 1px solid #1f232e;
	transition: background 0.4s, border 0.4s;
}
#games_list .list_entry_div {
	border-top: 1px solid #1f232e;
}
#games_list .list_entry_ser {
	border-top: 0;
}
#games_list .list_entry span {
	padding-top: 1px;
}
#games_list .list_entry:hover {
	color: #000000;
	background-color: #dabf70;
}
#games_list .list_entry_img {
	width: 50px;
	height: 32px;
	margin-bottom: 1px;
	float: left;
}
#games_list .solo_span {
	display: inline-block;
	margin-top: 8px;
	font-weight: bold;
}
#games_list .server_name {
	display: block;
	font-weight: bold;
}
#games_list .player_count {
	display: inline-block;
	margin-right: 6px;
}
#games_list .server_list_mes {
	display: inline-block;
	width: 300px;
	color: #ffffff;
	margin-top: 50px;
	font-size: 12px;
	font-weight: bold;
	text-align: center;
}
.box {
	border: 1px solid #8793b0;
	background-color: #4a5876;
	box-shadow: 0px 1px 2px rgba(0, 0, 0, 0.2);
}
.box_title {
	padding: 6px 8px 8px 14px;
	background-color: #252a37;
	text-transform: uppercase;
	letter-spacing: 0.3px;
	display: block;
	height: 16px;
	border-top: 1px solid #8793b0;
	border-bottom: 1px solid #8793b0;
	-webkit-user-select: none;
	user-select: none;
}
.box_title_inner {
	color: #8793b0;
	font-weight: bold;
	font-size: 14px;
	box-sizing: border-box;
}</style>
						<script type="text/javascript">/*!
 * pixi.js-legacy - v5.2.2
 * Compiled Tue, 21 Apr 2020 03:53:51 UTC
 *
 * pixi.js-legacy is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
var PIXI=function(t){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(t,e){return t(e={exports:{}},e.exports),e.exports}var i=r(function(t,r){!function(t){var e=t.Promise,i=e&&"resolve"in e&&"reject"in e&&"all"in e&&"race"in e&&function(){var t;return new e(function(e){t=e}),"function"==typeof t}();r?(r.Promise=i?e:T,r.Polyfill=T):i||(t.Promise=T);var n="pending",o="sealed",s="fulfilled",a="rejected",h=function(){};function u(t){return"[object Array]"===Object.prototype.toString.call(t)}var l,c="undefined"!=typeof setImmediate?setImmediate:setTimeout,d=[];function p(){for(var t=0;t<d.length;t++)d[t][0](d[t][1]);d=[],l=!1}function f(t,e){d.push([t,e]),l||(l=!0,c(p,0))}function v(t){var e=t.owner,r=e.state_,i=e.data_,n=t[r],o=t.then;if("function"==typeof n){r=s;try{i=n(i)}catch(t){_(o,t)}}g(o,i)||(r===s&&m(o,i),r===a&&_(o,i))}function g(t,e){var r;try{if(t===e)throw new TypeError("A promises callback cannot return that same promise.");if(e&&("function"==typeof e||"object"==typeof e)){var i=e.then;if("function"==typeof i)return i.call(e,function(i){r||(r=!0,e!==i?m(t,i):y(t,i))},function(e){r||(r=!0,_(t,e))}),!0}}catch(e){return r||_(t,e),!0}return!1}function m(t,e){t!==e&&g(t,e)||y(t,e)}function y(t,e){t.state_===n&&(t.state_=o,t.data_=e,f(b,t))}function _(t,e){t.state_===n&&(t.state_=o,t.data_=e,f(E,t))}function x(t){var e=t.then_;t.then_=void 0;for(var r=0;r<e.length;r++)v(e[r])}function b(t){t.state_=s,x(t)}function E(t){t.state_=a,x(t)}function T(t){if("function"!=typeof t)throw new TypeError("Promise constructor takes a function argument");if(this instanceof T==!1)throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this.then_=[],function(t,e){function r(t){_(e,t)}try{t(function(t){m(e,t)},r)}catch(t){r(t)}}(t,this)}T.prototype={constructor:T,state_:n,then_:null,data_:void 0,then:function(t,e){var r={owner:this,then:new this.constructor(h),fulfilled:t,rejected:e};return this.state_===s||this.state_===a?f(v,r):this.then_.push(r),r.then},catch:function(t){return this.then(null,t)}},T.all=function(t){if(!u(t))throw new TypeError("You must pass an array to Promise.all().");return new this(function(e,r){var i=[],n=0;function o(t){return n++,function(r){i[t]=r,--n||e(i)}}for(var s,a=0;a<t.length;a++)(s=t[a])&&"function"==typeof s.then?s.then(o(a),r):i[a]=s;n||e(i)})},T.race=function(t){if(!u(t))throw new TypeError("You must pass an array to Promise.race().");return new this(function(e,r){for(var i,n=0;n<t.length;n++)(i=t[n])&&"function"==typeof i.then?i.then(e,r):e(i)})},T.resolve=function(t){return t&&"object"==typeof t&&t.constructor===this?t:new this(function(e){e(t)})},T.reject=function(t){return new this(function(e,r){r(t)})}}("undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:e)}),n=(i.Promise,i.Polyfill),o=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;var h=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(t){i[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var r,i,n=arguments,h=function(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),u=1;u<arguments.length;u++){for(var l in r=Object(n[u]))s.call(r,l)&&(h[l]=r[l]);if(o){i=o(r);for(var c=0;c<i.length;c++)a.call(r,i[c])&&(h[i[c]]=r[i[c]])}}return h};window.Promise||(window.Promise=n),Object.assign||(Object.assign=h);var u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};if(Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!u.performance||!u.performance.now){var l=Date.now();u.performance||(u.performance={}),u.performance.now=function(){return Date.now()-l}}for(var c=Date.now(),d=["ms","moz","webkit","o"],p=0;p<d.length&&!u.requestAnimationFrame;++p){var f=d[p];u.requestAnimationFrame=u[f+"RequestAnimationFrame"],u.cancelAnimationFrame=u[f+"CancelAnimationFrame"]||u[f+"CancelRequestAnimationFrame"]}u.requestAnimationFrame||(u.requestAnimationFrame=function(t){if("function"!=typeof t)throw new TypeError(t+"is not a function");var e=Date.now(),r=16+c-e;return r<0&&(r=0),c=e,setTimeout(function(){c=Date.now(),t(performance.now())},r)}),u.cancelAnimationFrame||(u.cancelAnimationFrame=function(t){return clearTimeout(t)}),Math.sign||(Math.sign=function(t){return 0===(t=Number(t))||isNaN(t)?t:t>0?1:-1}),Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),window.ArrayBuffer||(window.ArrayBuffer=Array),window.Float32Array||(window.Float32Array=Array),window.Uint32Array||(window.Uint32Array=Array),window.Uint16Array||(window.Uint16Array=Array),window.Uint8Array||(window.Uint8Array=Array),window.Int32Array||(window.Int32Array=Array);var v=/iPhone/i,g=/iPod/i,m=/iPad/i,y=/\biOS-universal(?:.+)Mac\b/i,_=/\bAndroid(?:.+)Mobile\b/i,x=/Android/i,b=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,E=/Silk/i,T=/Windows Phone/i,S=/\bWindows(?:.+)ARM\b/i,w=/BlackBerry/i,P=/BB10/i,I=/Opera Mini/i,A=/\b(CriOS|Chrome)(?:.+)Mobile/i,O=/Mobile(?:.+)Firefox\b/i,D=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};var M=function(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var r=e.userAgent,i=r.split("[FBAN");void 0!==i[1]&&(r=i[0]),void 0!==(i=r.split("Twitter"))[1]&&(r=i[0]);var n=function(t){return function(e){return e.test(t)}}(r),o={apple:{phone:n(v)&&!n(T),ipod:n(g),tablet:!n(v)&&(n(m)||D(e))&&!n(T),universal:n(y),device:(n(v)||n(g)||n(m)||n(y)||D(e))&&!n(T)},amazon:{phone:n(b),tablet:!n(b)&&n(E),device:n(b)||n(E)},android:{phone:!n(T)&&n(b)||!n(T)&&n(_),tablet:!n(T)&&!n(b)&&!n(_)&&(n(E)||n(x)),device:!n(T)&&(n(b)||n(E)||n(_)||n(x))||n(/\bokhttp\b/i)},windows:{phone:n(T),tablet:n(S),device:n(T)||n(S)},other:{blackberry:n(w),blackberry10:n(P),opera:n(I),firefox:n(O),chrome:n(A),device:n(w)||n(P)||n(I)||n(O)||n(A)},any:!1,phone:!1,tablet:!1};return o.any=o.apple.device||o.android.device||o.windows.device||o.other.device,o.phone=o.apple.phone||o.android.phone||o.windows.phone,o.tablet=o.apple.tablet||o.android.tablet||o.windows.tablet,o}(window.navigator);var C={MIPMAP_TEXTURES:1,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,SPRITE_MAX_TEXTURES:function(t){var e=!0;if(M.tablet||M.phone){if(e=!1,M.apple.device){var r=navigator.userAgent.match(/OS (\d+)_(\d+)?/);r&&parseInt(r[1],10)>=11&&(e=!0)}if(M.android.device){var i=navigator.userAgent.match(/Android\s([0-9.]*)/);i&&parseInt(i[1],10)>=7&&(e=!0)}}return e?t:4}(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,forceFXAA:!1,autoDensity:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1},GC_MODE:0,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:33071,SCALE_MODE:1,PRECISION_VERTEX:"highp",PRECISION_FRAGMENT:M.apple.device?"highp":"mediump",CAN_UPLOAD_SAME_BUFFER:!M.apple.device,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},R=r(function(t){var e=Object.prototype.hasOwnProperty,r="~";function i(){}function n(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function o(t,e,i,o,s){if("function"!=typeof i)throw new TypeError("The listener must be a function");var a=new n(i,o||t,s),h=r?r+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],a]:t._events[h].push(a):(t._events[h]=a,t._eventsCount++),t}function s(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function a(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),a.prototype.eventNames=function(){var t,i,n=[];if(0===this._eventsCount)return n;for(i in t=this._events)e.call(t,i)&&n.push(r?i.slice(1):i);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},a.prototype.listeners=function(t){var e=r?r+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,o=i.length,s=new Array(o);n<o;n++)s[n]=i[n].fn;return s},a.prototype.listenerCount=function(t){var e=r?r+t:t,i=this._events[e];return i?i.fn?1:i.length:0},a.prototype.emit=function(t,e,i,n,o,s){var a=arguments,h=r?r+t:t;if(!this._events[h])return!1;var u,l,c=this._events[h],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,i),!0;case 4:return c.fn.call(c.context,e,i,n),!0;case 5:return c.fn.call(c.context,e,i,n,o),!0;case 6:return c.fn.call(c.context,e,i,n,o,s),!0}for(l=1,u=new Array(d-1);l<d;l++)u[l-1]=a[l];c.fn.apply(c.context,u)}else{var p,f=c.length;for(l=0;l<f;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),d){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,i);break;case 4:c[l].fn.call(c[l].context,e,i,n);break;default:if(!u)for(p=1,u=new Array(d-1);p<d;p++)u[p-1]=a[p];c[l].fn.apply(c[l].context,u)}}return!0},a.prototype.on=function(t,e,r){return o(this,t,e,r,!1)},a.prototype.once=function(t,e,r){return o(this,t,e,r,!0)},a.prototype.removeListener=function(t,e,i,n){var o=r?r+t:t;if(!this._events[o])return this;if(!e)return s(this,o),this;var a=this._events[o];if(a.fn)a.fn!==e||n&&!a.once||i&&a.context!==i||s(this,o);else{for(var h=0,u=[],l=a.length;h<l;h++)(a[h].fn!==e||n&&!a[h].once||i&&a[h].context!==i)&&u.push(a[h]);u.length?this._events[o]=1===u.length?u[0]:u:s(this,o)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&s(this,e)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,t.exports=a}),L=F,N=F;function F(t,e,r){r=r||2;var i,n,o,s,a,h,u,l=e&&e.length,c=l?e[0]*r:t.length,d=B(t,0,c,r,!0),p=[];if(!d||d.next===d.prev)return p;if(l&&(d=function(t,e,r,i){var n,o,s,a,h,u=[];for(n=0,o=e.length;n<o;n++)s=e[n]*i,a=n<o-1?e[n+1]*i:t.length,(h=B(t,s,a,i,!1))===h.next&&(h.steiner=!0),u.push(q(h));for(u.sort(Y),n=0;n<u.length;n++)z(u[n],r),r=U(r,r.next);return r}(t,e,d,r)),t.length>80*r){i=o=t[0],n=s=t[1];for(var f=r;f<c;f+=r)(a=t[f])<i&&(i=a),(h=t[f+1])<n&&(n=h),a>o&&(o=a),h>s&&(s=h);u=0!==(u=Math.max(o-i,s-n))?1/u:0}return k(d,p,r,i,n,u),p}function B(t,e,r,i,n){var o,s;if(n===at(t,e,r,i)>0)for(o=e;o<r;o+=i)s=nt(o,t[o],t[o+1],s);else for(o=r-i;o>=e;o-=i)s=nt(o,t[o],t[o+1],s);return s&&Q(s,s.next)&&(ot(s),s=s.next),s}function U(t,e){if(!t)return t;e||(e=t);var r,i=t;do{if(r=!1,i.steiner||!Q(i,i.next)&&0!==J(i.prev,i,i.next))i=i.next;else{if(ot(i),(i=e=i.prev)===i.next)break;r=!0}}while(r||i!==e);return e}function k(t,e,r,i,n,o,s){if(t){!s&&o&&function(t,e,r,i){var n=t;do{null===n.z&&(n.z=W(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,r,i,n,o,s,a,h,u=1;do{for(r=t,t=null,o=null,s=0;r;){for(s++,i=r,a=0,e=0;e<u&&(a++,i=i.nextZ);e++);for(h=u;a>0||h>0&&i;)0!==a&&(0===h||!i||r.z<=i.z)?(n=r,r=r.nextZ,a--):(n=i,i=i.nextZ,h--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;r=i}o.nextZ=null,u*=2}while(s>1)}(n)}(t,i,n,o);for(var a,h,u=t;t.prev!==t.next;)if(a=t.prev,h=t.next,o?j(t,i,n,o):X(t))e.push(a.i/r),e.push(t.i/r),e.push(h.i/r),ot(t),t=h.next,u=h.next;else if((t=h)===u){s?1===s?k(t=H(U(t),e,r),e,r,i,n,o,2):2===s&&G(t,e,r,i,n,o):k(U(t),e,r,i,n,o,1);break}}}function X(t){var e=t.prev,r=t,i=t.next;if(J(e,r,i)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(K(e.x,e.y,r.x,r.y,i.x,i.y,n.x,n.y)&&J(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function j(t,e,r,i){var n=t.prev,o=t,s=t.next;if(J(n,o,s)>=0)return!1;for(var a=n.x<o.x?n.x<s.x?n.x:s.x:o.x<s.x?o.x:s.x,h=n.y<o.y?n.y<s.y?n.y:s.y:o.y<s.y?o.y:s.y,u=n.x>o.x?n.x>s.x?n.x:s.x:o.x>s.x?o.x:s.x,l=n.y>o.y?n.y>s.y?n.y:s.y:o.y>s.y?o.y:s.y,c=W(a,h,e,r,i),d=W(u,l,e,r,i),p=t.prevZ,f=t.nextZ;p&&p.z>=c&&f&&f.z<=d;){if(p!==t.prev&&p!==t.next&&K(n.x,n.y,o.x,o.y,s.x,s.y,p.x,p.y)&&J(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==t.prev&&f!==t.next&&K(n.x,n.y,o.x,o.y,s.x,s.y,f.x,f.y)&&J(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=c;){if(p!==t.prev&&p!==t.next&&K(n.x,n.y,o.x,o.y,s.x,s.y,p.x,p.y)&&J(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==t.prev&&f!==t.next&&K(n.x,n.y,o.x,o.y,s.x,s.y,f.x,f.y)&&J(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function H(t,e,r){var i=t;do{var n=i.prev,o=i.next.next;!Q(n,o)&&$(n,i,i.next,o)&&rt(n,o)&&rt(o,n)&&(e.push(n.i/r),e.push(i.i/r),e.push(o.i/r),ot(i),ot(i.next),i=t=o),i=i.next}while(i!==t);return U(i)}function G(t,e,r,i,n,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&Z(s,a)){var h=it(s,a);return s=U(s,s.next),h=U(h,h.next),k(s,e,r,i,n,o),void k(h,e,r,i,n,o)}a=a.next}s=s.next}while(s!==t)}function Y(t,e){return t.x-e.x}function z(t,e){if(e=function(t,e){var r,i=e,n=t.x,o=t.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var a=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=n&&a>s){if(s=a,a===n){if(o===i.y)return i;if(o===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!r)return null;if(n===s)return r;var h,u=r,l=r.x,c=r.y,d=1/0;i=r;do{n>=i.x&&i.x>=l&&n!==i.x&&K(o<c?n:s,o,l,c,o<c?s:n,o,i.x,i.y)&&(h=Math.abs(o-i.y)/(n-i.x),rt(i,t)&&(h<d||h===d&&(i.x>r.x||i.x===r.x&&V(r,i)))&&(r=i,d=h)),i=i.next}while(i!==u);return r}(t,e)){var r=it(e,t);U(e,e.next),U(r,r.next)}}function V(t,e){return J(t.prev,t,e.prev)<0&&J(e.next,t,t.next)<0}function W(t,e,r,i,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function q(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function K(t,e,r,i,n,o,s,a){return(n-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(i-a)-(r-s)*(e-a)>=0&&(r-s)*(o-a)-(n-s)*(i-a)>=0}function Z(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&$(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(rt(t,e)&&rt(e,t)&&function(t,e){var r=t,i=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&n<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==t);return i}(t,e)&&(J(t.prev,t,e.prev)||J(t,e.prev,e))||Q(t,e)&&J(t.prev,t,t.next)>0&&J(e.prev,e,e.next)>0)}function J(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Q(t,e){return t.x===e.x&&t.y===e.y}function $(t,e,r,i){var n=et(J(t,e,r)),o=et(J(t,e,i)),s=et(J(r,i,t)),a=et(J(r,i,e));return n!==o&&s!==a||(!(0!==n||!tt(t,r,e))||(!(0!==o||!tt(t,i,e))||(!(0!==s||!tt(r,t,i))||!(0!==a||!tt(r,e,i)))))}function tt(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function et(t){return t>0?1:t<0?-1:0}function rt(t,e){return J(t.prev,t,t.next)<0?J(t,e,t.next)>=0&&J(t,t.prev,e)>=0:J(t,e,t.prev)<0||J(t,t.next,e)<0}function it(t,e){var r=new st(t.i,t.x,t.y),i=new st(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,o.next=i,i.prev=o,i}function nt(t,e,r,i){var n=new st(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function ot(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function st(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function at(t,e,r,i){for(var n=0,o=e,s=r-i;o<r;o+=i)n+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return n}F.deviation=function(t,e,r,i){var n=e&&e.length,o=n?e[0]*r:t.length,s=Math.abs(at(t,0,o,r));if(n)for(var a=0,h=e.length;a<h;a++){var u=e[a]*r,l=a<h-1?e[a+1]*r:t.length;s-=Math.abs(at(t,u,l,r))}var c=0;for(a=0;a<i.length;a+=3){var d=i[a]*r,p=i[a+1]*r,f=i[a+2]*r;c+=Math.abs((t[d]-t[f])*(t[p+1]-t[d+1])-(t[d]-t[p])*(t[f+1]-t[d+1]))}return 0===s&&0===c?0:Math.abs((c-s)/s)},F.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},i=0,n=0;n<t.length;n++){for(var o=0;o<t[n].length;o++)for(var s=0;s<e;s++)r.vertices.push(t[n][o][s]);n>0&&(i+=t[n-1].length,r.holes.push(i))}return r},L.default=N;var ht=r(function(t,r){!function(i){var n=r&&!r.nodeType&&r,o=t&&!t.nodeType&&t,s="object"==typeof e&&e;s.global!==s&&s.window!==s&&s.self!==s||(i=s);var a,h,u=2147483647,l=36,c=1,d=26,p=38,f=700,v=72,g=128,m="-",y=/^xn--/,_=/[^\x20-\x7E]/,x=/[\x2E\u3002\uFF0E\uFF61]/g,b={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},E=l-c,T=Math.floor,S=String.fromCharCode;function w(t){throw RangeError(b[t])}function P(t,e){for(var r=t.length,i=[];r--;)i[r]=e(t[r]);return i}function I(t,e){var r=t.split("@"),i="";return r.length>1&&(i=r[0]+"@",t=r[1]),i+P((t=t.replace(x,".")).split("."),e).join(".")}function A(t){for(var e,r,i=[],n=0,o=t.length;n<o;)(e=t.charCodeAt(n++))>=55296&&e<=56319&&n<o?56320==(64512&(r=t.charCodeAt(n++)))?i.push(((1023&e)<<10)+(1023&r)+65536):(i.push(e),n--):i.push(e);return i}function O(t){return P(t,function(t){var e="";return t>65535&&(e+=S((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=S(t)}).join("")}function D(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function M(t,e,r){var i=0;for(t=r?T(t/f):t>>1,t+=T(t/e);t>E*d>>1;i+=l)t=T(t/E);return T(i+(E+1)*t/(t+p))}function C(t){var e,r,i,n,o,s,a,h,p,f,y,_=[],x=t.length,b=0,E=g,S=v;for((r=t.lastIndexOf(m))<0&&(r=0),i=0;i<r;++i)t.charCodeAt(i)>=128&&w("not-basic"),_.push(t.charCodeAt(i));for(n=r>0?r+1:0;n<x;){for(o=b,s=1,a=l;n>=x&&w("invalid-input"),((h=(y=t.charCodeAt(n++))-48<10?y-22:y-65<26?y-65:y-97<26?y-97:l)>=l||h>T((u-b)/s))&&w("overflow"),b+=h*s,!(h<(p=a<=S?c:a>=S+d?d:a-S));a+=l)s>T(u/(f=l-p))&&w("overflow"),s*=f;S=M(b-o,e=_.length+1,0==o),T(b/e)>u-E&&w("overflow"),E+=T(b/e),b%=e,_.splice(b++,0,E)}return O(_)}function R(t){var e,r,i,n,o,s,a,h,p,f,y,_,x,b,E,P=[];for(_=(t=A(t)).length,e=g,r=0,o=v,s=0;s<_;++s)(y=t[s])<128&&P.push(S(y));for(i=n=P.length,n&&P.push(m);i<_;){for(a=u,s=0;s<_;++s)(y=t[s])>=e&&y<a&&(a=y);for(a-e>T((u-r)/(x=i+1))&&w("overflow"),r+=(a-e)*x,e=a,s=0;s<_;++s)if((y=t[s])<e&&++r>u&&w("overflow"),y==e){for(h=r,p=l;!(h<(f=p<=o?c:p>=o+d?d:p-o));p+=l)E=h-f,b=l-f,P.push(S(D(f+E%b,0))),h=T(E/b);P.push(S(D(h,0))),o=M(r,x,i==n),r=0,++i}++r,++e}return P.join("")}if(a={version:"1.3.2",ucs2:{decode:A,encode:O},decode:C,encode:R,toASCII:function(t){return I(t,function(t){return _.test(t)?"xn--"+R(t):t})},toUnicode:function(t){return I(t,function(t){return y.test(t)?C(t.slice(4).toLowerCase()):t})}},n&&o)if(t.exports==n)o.exports=a;else for(h in a)a.hasOwnProperty(h)&&(n[h]=a[h]);else i.punycode=a}(e)}),ut={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}};ut.isString,ut.isObject,ut.isNull,ut.isNullOrUndefined;function lt(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var ct=function(t,e,r,i){e=e||"&",r=r||"=";var n={};if("string"!=typeof t||0===t.length)return n;var o=/\+/g;t=t.split(e);var s=1e3;i&&"number"==typeof i.maxKeys&&(s=i.maxKeys);var a=t.length;s>0&&a>s&&(a=s);for(var h=0;h<a;++h){var u,l,c,d,p=t[h].replace(o,"%20"),f=p.indexOf(r);f>=0?(u=p.substr(0,f),l=p.substr(f+1)):(u=p,l=""),c=decodeURIComponent(u),d=decodeURIComponent(l),lt(n,c)?Array.isArray(n[c])?n[c].push(d):n[c]=[n[c],d]:n[c]=d}return n},dt=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}},pt=function(t,e,r,i){return e=e||"&",r=r||"=",null===t&&(t=void 0),"object"==typeof t?Object.keys(t).map(function(i){var n=encodeURIComponent(dt(i))+r;return Array.isArray(t[i])?t[i].map(function(t){return n+encodeURIComponent(dt(t))}).join(e):n+encodeURIComponent(dt(t[i]))}).join(e):i?encodeURIComponent(dt(i))+r+encodeURIComponent(dt(t)):""},ft=r(function(t,e){e.decode=e.parse=ct,e.encode=e.stringify=pt}),vt=(ft.decode,ft.parse,ft.encode,ft.stringify,Rt),gt=function(t,e){return Rt(t,!1,!0).resolve(e)},mt=function(t,e){if(!t)return e;return Rt(t,!1,!0).resolveObject(e)},yt=function(t){ut.isString(t)&&(t=Rt(t));if(!(t instanceof xt))return xt.prototype.format.call(t);return t.format()},_t=xt;function xt(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var bt=/^([a-z0-9.+-]+:)/i,Et=/:[0-9]*$/,Tt=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,St=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),wt=["'"].concat(St),Pt=["%","/","?",";","#"].concat(wt),It=["/","?","#"],At=/^[+a-z0-9A-Z_-]{0,63}$/,Ot=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Dt={javascript:!0,"javascript:":!0},Mt={javascript:!0,"javascript:":!0},Ct={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function Rt(t,e,r){if(t&&ut.isObject(t)&&t instanceof xt)return t;var i=new xt;return i.parse(t,e,r),i}xt.prototype.parse=function(t,e,r){if(!ut.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var i=t.indexOf("?"),n=-1!==i&&i<t.indexOf("#")?"?":"#",o=t.split(n);o[0]=o[0].replace(/\\/g,"/");var s=t=o.join(n);if(s=s.trim(),!r&&1===t.split("#").length){var a=Tt.exec(s);if(a)return this.path=s,this.href=s,this.pathname=a[1],a[2]?(this.search=a[2],this.query=e?ft.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var h=bt.exec(s);if(h){var u=(h=h[0]).toLowerCase();this.protocol=u,s=s.substr(h.length)}if(r||h||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var l="//"===s.substr(0,2);!l||h&&Mt[h]||(s=s.substr(2),this.slashes=!0)}if(!Mt[h]&&(l||h&&!Ct[h])){for(var c,d,p=-1,f=0;f<It.length;f++){-1!==(v=s.indexOf(It[f]))&&(-1===p||v<p)&&(p=v)}-1!==(d=-1===p?s.lastIndexOf("@"):s.lastIndexOf("@",p))&&(c=s.slice(0,d),s=s.slice(d+1),this.auth=decodeURIComponent(c)),p=-1;for(f=0;f<Pt.length;f++){var v;-1!==(v=s.indexOf(Pt[f]))&&(-1===p||v<p)&&(p=v)}-1===p&&(p=s.length),this.host=s.slice(0,p),s=s.slice(p),this.parseHost(),this.hostname=this.hostname||"";var g="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!g)for(var m=this.hostname.split(/\./),y=(f=0,m.length);f<y;f++){var _=m[f];if(_&&!_.match(At)){for(var x="",b=0,E=_.length;b<E;b++)_.charCodeAt(b)>127?x+="x":x+=_[b];if(!x.match(At)){var T=m.slice(0,f),S=m.slice(f+1),w=_.match(Ot);w&&(T.push(w[1]),S.unshift(w[2])),S.length&&(s="/"+S.join(".")+s),this.hostname=T.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),g||(this.hostname=ht.toASCII(this.hostname));var P=this.port?":"+this.port:"",I=this.hostname||"";this.host=I+P,this.href+=this.host,g&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!Dt[u])for(f=0,y=wt.length;f<y;f++){var A=wt[f];if(-1!==s.indexOf(A)){var O=encodeURIComponent(A);O===A&&(O=escape(A)),s=s.split(A).join(O)}}var D=s.indexOf("#");-1!==D&&(this.hash=s.substr(D),s=s.slice(0,D));var M=s.indexOf("?");if(-1!==M?(this.search=s.substr(M),this.query=s.substr(M+1),e&&(this.query=ft.parse(this.query)),s=s.slice(0,M)):e&&(this.search="",this.query={}),s&&(this.pathname=s),Ct[u]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){P=this.pathname||"";var C=this.search||"";this.path=P+C}return this.href=this.format(),this},xt.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",r=this.pathname||"",i=this.hash||"",n=!1,o="";this.host?n=t+this.host:this.hostname&&(n=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&ut.isObject(this.query)&&Object.keys(this.query).length&&(o=ft.stringify(this.query));var s=this.search||o&&"?"+o||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||Ct[e])&&!1!==n?(n="//"+(n||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):n||(n=""),i&&"#"!==i.charAt(0)&&(i="#"+i),s&&"?"!==s.charAt(0)&&(s="?"+s),e+n+(r=r.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(s=s.replace("#","%23"))+i},xt.prototype.resolve=function(t){return this.resolveObject(Rt(t,!1,!0)).format()},xt.prototype.resolveObject=function(t){if(ut.isString(t)){var e=new xt;e.parse(t,!1,!0),t=e}for(var r=new xt,i=Object.keys(this),n=0;n<i.length;n++){var o=i[n];r[o]=this[o]}if(r.hash=t.hash,""===t.href)return r.href=r.format(),r;if(t.slashes&&!t.protocol){for(var s=Object.keys(t),a=0;a<s.length;a++){var h=s[a];"protocol"!==h&&(r[h]=t[h])}return Ct[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(t.protocol&&t.protocol!==r.protocol){if(!Ct[t.protocol]){for(var u=Object.keys(t),l=0;l<u.length;l++){var c=u[l];r[c]=t[c]}return r.href=r.format(),r}if(r.protocol=t.protocol,t.host||Mt[t.protocol])r.pathname=t.pathname;else{for(var d=(t.pathname||"").split("/");d.length&&!(t.host=d.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),r.pathname=d.join("/")}if(r.search=t.search,r.query=t.query,r.host=t.host||"",r.auth=t.auth,r.hostname=t.hostname||t.host,r.port=t.port,r.pathname||r.search){var p=r.pathname||"",f=r.search||"";r.path=p+f}return r.slashes=r.slashes||t.slashes,r.href=r.format(),r}var v=r.pathname&&"/"===r.pathname.charAt(0),g=t.host||t.pathname&&"/"===t.pathname.charAt(0),m=g||v||r.host&&t.pathname,y=m,_=r.pathname&&r.pathname.split("/")||[],x=(d=t.pathname&&t.pathname.split("/")||[],r.protocol&&!Ct[r.protocol]);if(x&&(r.hostname="",r.port=null,r.host&&(""===_[0]?_[0]=r.host:_.unshift(r.host)),r.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===d[0]?d[0]=t.host:d.unshift(t.host)),t.host=null),m=m&&(""===d[0]||""===_[0])),g)r.host=t.host||""===t.host?t.host:r.host,r.hostname=t.hostname||""===t.hostname?t.hostname:r.hostname,r.search=t.search,r.query=t.query,_=d;else if(d.length)_||(_=[]),_.pop(),_=_.concat(d),r.search=t.search,r.query=t.query;else if(!ut.isNullOrUndefined(t.search)){if(x)r.hostname=r.host=_.shift(),(w=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=w.shift(),r.host=r.hostname=w.shift());return r.search=t.search,r.query=t.query,ut.isNull(r.pathname)&&ut.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!_.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var b=_.slice(-1)[0],E=(r.host||t.host||_.length>1)&&("."===b||".."===b)||""===b,T=0,S=_.length;S>=0;S--)"."===(b=_[S])?_.splice(S,1):".."===b?(_.splice(S,1),T++):T&&(_.splice(S,1),T--);if(!m&&!y)for(;T--;T)_.unshift("..");!m||""===_[0]||_[0]&&"/"===_[0].charAt(0)||_.unshift(""),E&&"/"!==_.join("/").substr(-1)&&_.push("");var w,P=""===_[0]||_[0]&&"/"===_[0].charAt(0);x&&(r.hostname=r.host=P?"":_.length?_.shift():"",(w=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=w.shift(),r.host=r.hostname=w.shift()));return(m=m||r.host&&_.length)&&!P&&_.unshift(""),_.length?r.pathname=_.join("/"):(r.pathname=null,r.path=null),ut.isNull(r.pathname)&&ut.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=t.auth||r.auth,r.slashes=r.slashes||t.slashes,r.href=r.format(),r},xt.prototype.parseHost=function(){var t=this.host,e=Et.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)};var Lt,Nt,Ft,Bt,Ut,kt,Xt,jt,Ht,Gt,Yt,zt,Vt,Wt,qt={parse:vt,resolve:gt,resolveObject:mt,format:yt,Url:_t};(Lt=t.ENV||(t.ENV={}))[Lt.WEBGL_LEGACY=0]="WEBGL_LEGACY",Lt[Lt.WEBGL=1]="WEBGL",Lt[Lt.WEBGL2=2]="WEBGL2",(Nt=t.RENDERER_TYPE||(t.RENDERER_TYPE={}))[Nt.UNKNOWN=0]="UNKNOWN",Nt[Nt.WEBGL=1]="WEBGL",Nt[Nt.CANVAS=2]="CANVAS",(Ft=t.BLEND_MODES||(t.BLEND_MODES={}))[Ft.NORMAL=0]="NORMAL",Ft[Ft.ADD=1]="ADD",Ft[Ft.MULTIPLY=2]="MULTIPLY",Ft[Ft.SCREEN=3]="SCREEN",Ft[Ft.OVERLAY=4]="OVERLAY",Ft[Ft.DARKEN=5]="DARKEN",Ft[Ft.LIGHTEN=6]="LIGHTEN",Ft[Ft.COLOR_DODGE=7]="COLOR_DODGE",Ft[Ft.COLOR_BURN=8]="COLOR_BURN",Ft[Ft.HARD_LIGHT=9]="HARD_LIGHT",Ft[Ft.SOFT_LIGHT=10]="SOFT_LIGHT",Ft[Ft.DIFFERENCE=11]="DIFFERENCE",Ft[Ft.EXCLUSION=12]="EXCLUSION",Ft[Ft.HUE=13]="HUE",Ft[Ft.SATURATION=14]="SATURATION",Ft[Ft.COLOR=15]="COLOR",Ft[Ft.LUMINOSITY=16]="LUMINOSITY",Ft[Ft.NORMAL_NPM=17]="NORMAL_NPM",Ft[Ft.ADD_NPM=18]="ADD_NPM",Ft[Ft.SCREEN_NPM=19]="SCREEN_NPM",Ft[Ft.NONE=20]="NONE",Ft[Ft.SRC_OVER=0]="SRC_OVER",Ft[Ft.SRC_IN=21]="SRC_IN",Ft[Ft.SRC_OUT=22]="SRC_OUT",Ft[Ft.SRC_ATOP=23]="SRC_ATOP",Ft[Ft.DST_OVER=24]="DST_OVER",Ft[Ft.DST_IN=25]="DST_IN",Ft[Ft.DST_OUT=26]="DST_OUT",Ft[Ft.DST_ATOP=27]="DST_ATOP",Ft[Ft.ERASE=26]="ERASE",Ft[Ft.SUBTRACT=28]="SUBTRACT",Ft[Ft.XOR=29]="XOR",(Bt=t.DRAW_MODES||(t.DRAW_MODES={}))[Bt.POINTS=0]="POINTS",Bt[Bt.LINES=1]="LINES",Bt[Bt.LINE_LOOP=2]="LINE_LOOP",Bt[Bt.LINE_STRIP=3]="LINE_STRIP",Bt[Bt.TRIANGLES=4]="TRIANGLES",Bt[Bt.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",Bt[Bt.TRIANGLE_FAN=6]="TRIANGLE_FAN",(Ut=t.FORMATS||(t.FORMATS={}))[Ut.RGBA=6408]="RGBA",Ut[Ut.RGB=6407]="RGB",Ut[Ut.ALPHA=6406]="ALPHA",Ut[Ut.LUMINANCE=6409]="LUMINANCE",Ut[Ut.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",Ut[Ut.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",Ut[Ut.DEPTH_STENCIL=34041]="DEPTH_STENCIL",(kt=t.TARGETS||(t.TARGETS={}))[kt.TEXTURE_2D=3553]="TEXTURE_2D",kt[kt.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",kt[kt.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",kt[kt.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",kt[kt.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",kt[kt.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",kt[kt.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",kt[kt.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",kt[kt.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",(Xt=t.TYPES||(t.TYPES={}))[Xt.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",Xt[Xt.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",Xt[Xt.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",Xt[Xt.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",Xt[Xt.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",Xt[Xt.FLOAT=5126]="FLOAT",Xt[Xt.HALF_FLOAT=36193]="HALF_FLOAT",(jt=t.SCALE_MODES||(t.SCALE_MODES={}))[jt.NEAREST=0]="NEAREST",jt[jt.LINEAR=1]="LINEAR",(Ht=t.WRAP_MODES||(t.WRAP_MODES={}))[Ht.CLAMP=33071]="CLAMP",Ht[Ht.REPEAT=10497]="REPEAT",Ht[Ht.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",(Gt=t.MIPMAP_MODES||(t.MIPMAP_MODES={}))[Gt.OFF=0]="OFF",Gt[Gt.POW2=1]="POW2",Gt[Gt.ON=2]="ON",(Yt=t.ALPHA_MODES||(t.ALPHA_MODES={}))[Yt.NPM=0]="NPM",Yt[Yt.UNPACK=1]="UNPACK",Yt[Yt.PMA=2]="PMA",Yt[Yt.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",Yt[Yt.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",Yt[Yt.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",(zt=t.GC_MODES||(t.GC_MODES={}))[zt.AUTO=0]="AUTO",zt[zt.MANUAL=1]="MANUAL",(Vt=t.PRECISION||(t.PRECISION={})).LOW="lowp",Vt.MEDIUM="mediump",Vt.HIGH="highp",(Wt=t.MASK_TYPES||(t.MASK_TYPES={}))[Wt.NONE=0]="NONE",Wt[Wt.SCISSOR=1]="SCISSOR",Wt[Wt.STENCIL=2]="STENCIL",Wt[Wt.SPRITE=3]="SPRITE",C.RETINA_PREFIX=/@([0-9\.]+)x/,C.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!0;var Kt,Zt=!1,Jt="5.2.2";function Qt(t){var e;if(!Zt){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var r=[];(e=window.console).log.apply(e,r)};Zt=!0}}function $t(){return void 0===Kt&&(Kt=function(){var t={stencil:!0,failIfMajorPerformanceCaveat:C.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!window.WebGLRenderingContext)return!1;var e=document.createElement("canvas"),r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),i=!(!r||!r.getContextAttributes().stencil);if(r){var n=r.getExtension("WEBGL_lose_context");n&&n.loseContext()}return r=null,i}catch(t){return!1}}()),Kt}function te(t,e){return(e=e||[])[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(255&t)/255,e}function ee(t){var e=t.toString(16);return"#"+(e="000000".substr(0,6-e.length)+e)}function re(t){return"string"==typeof t&&"#"===t[0]&&(t=t.substr(1)),parseInt(t,16)}function ie(t){return(255*t[0]<<16)+(255*t[1]<<8)+(255*t[2]|0)}var ne=function(){for(var e=[],r=[],i=0;i<32;i++)e[i]=i,r[i]=i;e[t.BLEND_MODES.NORMAL_NPM]=t.BLEND_MODES.NORMAL,e[t.BLEND_MODES.ADD_NPM]=t.BLEND_MODES.ADD,e[t.BLEND_MODES.SCREEN_NPM]=t.BLEND_MODES.SCREEN,r[t.BLEND_MODES.NORMAL]=t.BLEND_MODES.NORMAL_NPM,r[t.BLEND_MODES.ADD]=t.BLEND_MODES.ADD_NPM,r[t.BLEND_MODES.SCREEN]=t.BLEND_MODES.SCREEN_NPM;var n=[];return n.push(r),n.push(e),n}();function oe(t,e){return ne[e?1:0][t]}function se(t,e,r,i){return r=r||new Float32Array(4),i||void 0===i?(r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e):(r[0]=t[0],r[1]=t[1],r[2]=t[2]),r[3]=e,r}function ae(t,e){if(1===e)return(255*e<<24)+t;if(0===e)return 0;var r=t>>16&255,i=t>>8&255,n=255&t;return(255*e<<24)+((r=r*e+.5|0)<<16)+((i=i*e+.5|0)<<8)+(n=n*e+.5|0)}function he(t,e,r,i){return(r=r||new Float32Array(4))[0]=(t>>16&255)/255,r[1]=(t>>8&255)/255,r[2]=(255&t)/255,(i||void 0===i)&&(r[0]*=e,r[1]*=e,r[2]*=e),r[3]=e,r}function ue(t,e){void 0===e&&(e=null);var r=6*t;if((e=e||new Uint16Array(r)).length!==r)throw new Error("Out buffer length is incorrect, got "+e.length+" and expected "+r);for(var i=0,n=0;i<r;i+=6,n+=4)e[i+0]=n+0,e[i+1]=n+1,e[i+2]=n+2,e[i+3]=n+0,e[i+4]=n+2,e[i+5]=n+3;return e}function le(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}var ce={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};function de(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1}function pe(t){return!(t&t-1||!t)}function fe(t){var e=(t>65535?1:0)<<4,r=((t>>>=e)>255?1:0)<<3;return e|=r,e|=r=((t>>>=r)>15?1:0)<<2,(e|=r=((t>>>=r)>3?1:0)<<1)|(t>>>=r)>>1}function ve(t,e,r){var i,n=t.length;if(!(e>=n||0===r)){var o=n-(r=e+r>n?n-e:r);for(i=e;i<o;++i)t[i]=t[i+r];t.length=o}}function ge(t){return 0===t?0:t<0?-1:1}var me=0;function ye(){return++me}var _e={};function xe(t,e,r){if(void 0===r&&(r=3),!_e[e]){var i=(new Error).stack;void 0===i?console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v"+t):(i=i.split("\n").splice(r).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",e+"\nDeprecated since v"+t),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v"+t),console.warn(i))),_e[e]=!0}}var be={},Ee=Object.create(null),Te=Object.create(null);var Se=function(){function t(t,e,r){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=r||C.RESOLUTION,this.resize(t,e)}return t.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.resize=function(t,e){this.canvas.width=t*this.resolution,this.canvas.height=e*this.resolution},t.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(t.prototype,"width",{get:function(){return this.canvas.width},set:function(t){this.canvas.width=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.canvas.height},set:function(t){this.canvas.height=t},enumerable:!0,configurable:!0}),t}();function we(t){var e,r,i,n=t.width,o=t.height,s=t.getContext("2d"),a=s.getImageData(0,0,n,o).data,h=a.length,u={top:null,left:null,right:null,bottom:null},l=null;for(e=0;e<h;e+=4)0!==a[e+3]&&(r=e/4%n,i=~~(e/4/n),null===u.top&&(u.top=i),null===u.left?u.left=r:r<u.left&&(u.left=r),null===u.right?u.right=r+1:u.right<r&&(u.right=r+1),null===u.bottom?u.bottom=i:u.bottom<i&&(u.bottom=i));return null!==u.top&&(n=u.right-u.left,o=u.bottom-u.top+1,l=s.getImageData(u.left,u.top,n,o)),{height:o,width:n,data:l}}var Pe,Ie=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function Ae(t,e){if(void 0===e&&(e=window.location),0===t.indexOf("data:"))return"";e=e||window.location,Pe||(Pe=document.createElement("a")),Pe.href=t;var r=vt(Pe.href),i=!r.port&&""===e.port||r.port===e.port;return r.hostname===e.hostname&&i&&r.protocol===e.protocol?"":"anonymous"}function Oe(t,e){var r=C.RETINA_PREFIX.exec(t);return r?parseFloat(r[1]):void 0!==e?e:1}var De,Me={BaseTextureCache:Te,CanvasRenderTarget:Se,DATA_URI:Ie,ProgramCache:be,TextureCache:Ee,clearTextureCache:function(){var t;for(t in Ee)delete Ee[t];for(t in Te)delete Te[t]},correctBlendMode:oe,createIndicesForQuads:ue,decomposeDataUri:function(t){var e=Ie.exec(t);if(e)return{mediaType:e[1]?e[1].toLowerCase():void 0,subType:e[2]?e[2].toLowerCase():void 0,charset:e[3]?e[3].toLowerCase():void 0,encoding:e[4]?e[4].toLowerCase():void 0,data:e[5]}},deprecation:xe,destroyTextureCache:function(){var t;for(t in Ee)Ee[t].destroy();for(t in Te)Te[t].destroy()},determineCrossOrigin:Ae,getBufferType:le,getResolutionOfUrl:Oe,hex2rgb:te,hex2string:ee,interleaveTypedArrays:function(t,e){for(var r=0,i=0,n={},o=0;o<t.length;o++)i+=e[o],r+=t[o].length;var s=new ArrayBuffer(4*r),a=null,h=0;for(o=0;o<t.length;o++){var u=e[o],l=t[o],c=le(l);n[c]||(n[c]=new ce[c](s)),a=n[c];for(var d=0;d<l.length;d++)a[(d/u|0)*i+h+d%u]=l[d];h+=u}return new Float32Array(s)},isPow2:pe,isWebGLSupported:$t,log2:fe,nextPow2:de,premultiplyBlendMode:ne,premultiplyRgba:se,premultiplyTint:ae,premultiplyTintToRgba:he,removeItems:ve,rgb2hex:ie,sayHello:Qt,sign:ge,skipHello:function(){Zt=!0},string2hex:re,trimCanvas:we,uid:ye,isMobile:M,EventEmitter:R,earcut:L,url:qt},Ce=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copyFrom=function(t){return this.set(t.x,t.y),this},t.prototype.copyTo=function(t){return t.set(this.x,this.y),t},t.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},t.prototype.set=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e,this},t}(),Re=function(){function t(t,e,r,i){void 0===r&&(r=0),void 0===i&&(i=0),this._x=r,this._y=i,this.cb=t,this.scope=e}return t.prototype.clone=function(e,r){return void 0===e&&(e=this.cb),void 0===r&&(r=this.scope),new t(e,r,this._x,this._y)},t.prototype.set=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this._x===t&&this._y===e||(this._x=t,this._y=e,this.cb.call(this.scope)),this},t.prototype.copyFrom=function(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this},t.prototype.copyTo=function(t){return t.set(this._x,this._y),t},t.prototype.equals=function(t){return t.x===this._x&&t.y===this._y},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))},enumerable:!0,configurable:!0}),t}(),Le=2*Math.PI,Ne=180/Math.PI,Fe=Math.PI/180;(De=t.SHAPES||(t.SHAPES={}))[De.POLY=0]="POLY",De[De.RECT=1]="RECT",De[De.CIRC=2]="CIRC",De[De.ELIP=3]="ELIP",De[De.RREC=4]="RREC";var Be=function(){function t(t,e,r,i,n,o){void 0===t&&(t=1),void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=1),void 0===n&&(n=0),void 0===o&&(o=0),this.array=null,this.a=t,this.b=e,this.c=r,this.d=i,this.tx=n,this.ty=o}return t.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},t.prototype.set=function(t,e,r,i,n,o){return this.a=t,this.b=e,this.c=r,this.d=i,this.tx=n,this.ty=o,this},t.prototype.toArray=function(t,e){this.array||(this.array=new Float32Array(9));var r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r},t.prototype.apply=function(t,e){e=e||new Ce;var r=t.x,i=t.y;return e.x=this.a*r+this.c*i+this.tx,e.y=this.b*r+this.d*i+this.ty,e},t.prototype.applyInverse=function(t,e){e=e||new Ce;var r=1/(this.a*this.d+this.c*-this.b),i=t.x,n=t.y;return e.x=this.d*r*i+-this.c*r*n+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*n+-this.b*r*i+(-this.ty*this.a+this.tx*this.b)*r,e},t.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},t.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},t.prototype.rotate=function(t){var e=Math.cos(t),r=Math.sin(t),i=this.a,n=this.c,o=this.tx;return this.a=i*e-this.b*r,this.b=i*r+this.b*e,this.c=n*e-this.d*r,this.d=n*r+this.d*e,this.tx=o*e-this.ty*r,this.ty=o*r+this.ty*e,this},t.prototype.append=function(t){var e=this.a,r=this.b,i=this.c,n=this.d;return this.a=t.a*e+t.b*i,this.b=t.a*r+t.b*n,this.c=t.c*e+t.d*i,this.d=t.c*r+t.d*n,this.tx=t.tx*e+t.ty*i+this.tx,this.ty=t.tx*r+t.ty*n+this.ty,this},t.prototype.setTransform=function(t,e,r,i,n,o,s,a,h){return this.a=Math.cos(s+h)*n,this.b=Math.sin(s+h)*n,this.c=-Math.sin(s-a)*o,this.d=Math.cos(s-a)*o,this.tx=t-(r*this.a+i*this.c),this.ty=e-(r*this.b+i*this.d),this},t.prototype.prepend=function(t){var e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var r=this.a,i=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},t.prototype.decompose=function(t){var e=this.a,r=this.b,i=this.c,n=this.d,o=-Math.atan2(-i,n),s=Math.atan2(r,e),a=Math.abs(o+s);return a<1e-5||Math.abs(Le-a)<1e-5?(t.rotation=s,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=s),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(i*i+n*n),t.position.x=this.tx,t.position.y=this.ty,t},t.prototype.invert=function(){var t=this.a,e=this.b,r=this.c,i=this.d,n=this.tx,o=t*i-e*r;return this.a=i/o,this.b=-e/o,this.c=-r/o,this.d=t/o,this.tx=(r*this.ty-i*n)/o,this.ty=-(t*this.ty-e*n)/o,this},t.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},t.prototype.clone=function(){var e=new t;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},t.prototype.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},t.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},Object.defineProperty(t,"IDENTITY",{get:function(){return new t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"TEMP_MATRIX",{get:function(){return new t},enumerable:!0,configurable:!0}),t}(),Ue=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],ke=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Xe=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],je=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],He=[],Ge=[],Ye=Math.sign;!function(){for(var t=0;t<16;t++){var e=[];He.push(e);for(var r=0;r<16;r++)for(var i=Ye(Ue[t]*Ue[r]+Xe[t]*ke[r]),n=Ye(ke[t]*Ue[r]+je[t]*ke[r]),o=Ye(Ue[t]*Xe[r]+Xe[t]*je[r]),s=Ye(ke[t]*Xe[r]+je[t]*je[r]),a=0;a<16;a++)if(Ue[a]===i&&ke[a]===n&&Xe[a]===o&&je[a]===s){e.push(a);break}}for(t=0;t<16;t++){var h=new Be;h.set(Ue[t],ke[t],Xe[t],je[t],0,0),Ge.push(h)}}();var ze={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(t){return Ue[t]},uY:function(t){return ke[t]},vX:function(t){return Xe[t]},vY:function(t){return je[t]},inv:function(t){return 8&t?15&t:7&-t},add:function(t,e){return He[t][e]},sub:function(t,e){return He[t][ze.inv(e)]},rotate180:function(t){return 4^t},isVertical:function(t){return 2==(3&t)},byDirection:function(t,e){return 2*Math.abs(t)<=Math.abs(e)?e>=0?ze.S:ze.N:2*Math.abs(e)<=Math.abs(t)?t>0?ze.E:ze.W:e>0?t>0?ze.SE:ze.SW:t>0?ze.NE:ze.NW},matrixAppendRotationInv:function(t,e,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var n=Ge[ze.inv(e)];n.tx=r,n.ty=i,t.append(n)}},Ve=function(){function t(){this.worldTransform=new Be,this.localTransform=new Be,this.position=new Re(this.onChange,this,0,0),this.scale=new Re(this.onChange,this,1,1),this.pivot=new Re(this.onChange,this,0,0),this.skew=new Re(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}return t.prototype.onChange=function(){this._localID++},t.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},t.prototype.updateLocalTransform=function(){var t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)},t.prototype.updateTransform=function(t){var e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){var r=t.worldTransform,i=this.worldTransform;i.a=e.a*r.a+e.b*r.c,i.b=e.a*r.b+e.b*r.d,i.c=e.c*r.a+e.d*r.c,i.d=e.c*r.b+e.d*r.d,i.tx=e.tx*r.a+e.ty*r.c+r.tx,i.ty=e.tx*r.b+e.ty*r.d+r.ty,this._parentID=t._worldID,this._worldID++}},t.prototype.setFromMatrix=function(t){t.decompose(this),this._localID++},Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())},enumerable:!0,configurable:!0}),t.IDENTITY=new t,t}(),We=function(){function e(e,r,i,n){void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=Number(e),this.y=Number(r),this.width=Number(i),this.height=Number(n),this.type=t.SHAPES.RECT}return Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e,"EMPTY",{get:function(){return new e(0,0,0,0)},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},e.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},e.prototype.contains=function(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)},e.prototype.pad=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this},e.prototype.fit=function(t){var e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),i=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=i,this.height=Math.max(n-i,0),this},e.prototype.ceil=function(t,e){void 0===t&&(t=1),void 0===e&&(e=.001);var r=Math.ceil((this.x+this.width-e)*t)/t,i=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=i-this.y,this},e.prototype.enlarge=function(t){var e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),i=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=i,this.height=n-i,this},e}(),qe=function(){function e(e,r,i){void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),this.x=e,this.y=r,this.radius=i,this.type=t.SHAPES.CIRC}return e.prototype.clone=function(){return new e(this.x,this.y,this.radius)},e.prototype.contains=function(t,e){if(this.radius<=0)return!1;var r=this.radius*this.radius,i=this.x-t,n=this.y-e;return(i*=i)+(n*=n)<=r},e.prototype.getBounds=function(){return new We(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},e}(),Ke=function(){function e(e,r,i,n){void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=e,this.y=r,this.width=i,this.height=n,this.type=t.SHAPES.ELIP}return e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var r=(t-this.x)/this.width,i=(e-this.y)/this.height;return(r*=r)+(i*=i)<=1},e.prototype.getBounds=function(){return new We(this.x-this.width,this.y-this.height,this.width,this.height)},e}(),Ze=function(){function e(){for(var e=arguments,r=[],i=0;i<arguments.length;i++)r[i]=e[i];if(Array.isArray(r[0])&&(r=r[0]),r[0]instanceof Ce){for(var n=[],o=0,s=(r=r).length;o<s;o++)n.push(r[o].x,r[o].y);r=n}this.points=r,this.type=t.SHAPES.POLY,this.closeStroke=!0}return e.prototype.clone=function(){var t=new e(this.points.slice());return t.closeStroke=this.closeStroke,t},e.prototype.contains=function(t,e){for(var r=!1,i=this.points.length/2,n=0,o=i-1;n<i;o=n++){var s=this.points[2*n],a=this.points[2*n+1],h=this.points[2*o],u=this.points[2*o+1];a>e!=u>e&&t<(e-a)/(u-a)*(h-s)+s&&(r=!r)}return r},e}(),Je=function(){function e(e,r,i,n,o){void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===o&&(o=20),this.x=e,this.y=r,this.width=i,this.height=n,this.radius=o,this.type=t.SHAPES.RREC}return e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height,this.radius)},e.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){if(e>=this.y+this.radius&&e<=this.y+this.height-this.radius||t>=this.x+this.radius&&t<=this.x+this.width-this.radius)return!0;var r=t-(this.x+this.radius),i=e-(this.y+this.radius),n=this.radius*this.radius;if(r*r+i*i<=n)return!0;if((r=t-(this.x+this.width-this.radius))*r+i*i<=n)return!0;if(r*r+(i=e-(this.y+this.height-this.radius))*i<=n)return!0;if((r=t-(this.x+this.radius))*r+i*i<=n)return!0}return!1},e}();C.SORTABLE_CHILDREN=!1;var Qe=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null};Qe.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},Qe.prototype.clear=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},Qe.prototype.getRectangle=function(t){return this.minX>this.maxX||this.minY>this.maxY?We.EMPTY:((t=t||new We(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)},Qe.prototype.addPoint=function(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)},Qe.prototype.addQuad=function(t){var e=this.minX,r=this.minY,i=this.maxX,n=this.maxY,o=t[0],s=t[1];e=o<e?o:e,r=s<r?s:r,i=o>i?o:i,n=s>n?s:n,e=(o=t[2])<e?o:e,r=(s=t[3])<r?s:r,i=o>i?o:i,n=s>n?s:n,e=(o=t[4])<e?o:e,r=(s=t[5])<r?s:r,i=o>i?o:i,n=s>n?s:n,e=(o=t[6])<e?o:e,r=(s=t[7])<r?s:r,i=o>i?o:i,n=s>n?s:n,this.minX=e,this.minY=r,this.maxX=i,this.maxY=n},Qe.prototype.addFrame=function(t,e,r,i,n){this.addFrameMatrix(t.worldTransform,e,r,i,n)},Qe.prototype.addFrameMatrix=function(t,e,r,i,n){var o=t.a,s=t.b,a=t.c,h=t.d,u=t.tx,l=t.ty,c=this.minX,d=this.minY,p=this.maxX,f=this.maxY,v=o*e+a*r+u,g=s*e+h*r+l;c=v<c?v:c,d=g<d?g:d,p=v>p?v:p,f=g>f?g:f,c=(v=o*i+a*r+u)<c?v:c,d=(g=s*i+h*r+l)<d?g:d,p=v>p?v:p,f=g>f?g:f,c=(v=o*e+a*n+u)<c?v:c,d=(g=s*e+h*n+l)<d?g:d,p=v>p?v:p,f=g>f?g:f,c=(v=o*i+a*n+u)<c?v:c,d=(g=s*i+h*n+l)<d?g:d,p=v>p?v:p,f=g>f?g:f,this.minX=c,this.minY=d,this.maxX=p,this.maxY=f},Qe.prototype.addVertexData=function(t,e,r){for(var i=this.minX,n=this.minY,o=this.maxX,s=this.maxY,a=e;a<r;a+=2){var h=t[a],u=t[a+1];i=h<i?h:i,n=u<n?u:n,o=h>o?h:o,s=u>s?u:s}this.minX=i,this.minY=n,this.maxX=o,this.maxY=s},Qe.prototype.addVertices=function(t,e,r,i){this.addVerticesMatrix(t.worldTransform,e,r,i)},Qe.prototype.addVerticesMatrix=function(t,e,r,i,n,o){var s=t.a,a=t.b,h=t.c,u=t.d,l=t.tx,c=t.ty;n=n||0,o=o||0;for(var d=this.minX,p=this.minY,f=this.maxX,v=this.maxY,g=r;g<i;g+=2){var m=e[g],y=e[g+1],_=s*m+h*y+l,x=u*y+a*m+c;d=Math.min(d,_-n),f=Math.max(f,_+n),p=Math.min(p,x-o),v=Math.max(v,x+o)}this.minX=d,this.minY=p,this.maxX=f,this.maxY=v},Qe.prototype.addBounds=function(t){var e=this.minX,r=this.minY,i=this.maxX,n=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>i?t.maxX:i,this.maxY=t.maxY>n?t.maxY:n},Qe.prototype.addBoundsMask=function(t,e){var r=t.minX>e.minX?t.minX:e.minX,i=t.minY>e.minY?t.minY:e.minY,n=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=n&&i<=o){var s=this.minX,a=this.minY,h=this.maxX,u=this.maxY;this.minX=r<s?r:s,this.minY=i<a?i:a,this.maxX=n>h?n:h,this.maxY=o>u?o:u}},Qe.prototype.addBoundsMatrix=function(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)},Qe.prototype.addBoundsArea=function(t,e){var r=t.minX>e.x?t.minX:e.x,i=t.minY>e.y?t.minY:e.y,n=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=n&&i<=o){var s=this.minX,a=this.minY,h=this.maxX,u=this.maxY;this.minX=r<s?r:s,this.minY=i<a?i:a,this.maxX=n>h?n:h,this.maxY=o>u?o:u}},Qe.prototype.pad=function(t,e){t=t||0,e=e||(0!==e?t:0),this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)},Qe.prototype.addFramePad=function(t,e,r,i,n,o){t-=n,e-=o,r+=n,i+=o,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>i?this.maxY:i};var $e=function(t){function e(){t.call(this),this.tempDisplayObjectParent=null,this.transform=new Ve,this.alpha=1,this.visible=!0,this.renderable=!0,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Qe,this._boundsID=0,this._lastBoundsID=-1,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={_tempDisplayObjectParent:{configurable:!0},x:{configurable:!0},y:{configurable:!0},worldTransform:{configurable:!0},localTransform:{configurable:!0},position:{configurable:!0},scale:{configurable:!0},pivot:{configurable:!0},skew:{configurable:!0},rotation:{configurable:!0},angle:{configurable:!0},zIndex:{configurable:!0},worldVisible:{configurable:!0},mask:{configurable:!0}};return e.mixin=function(t){for(var r=Object.keys(t),i=0;i<r.length;++i){var n=r[i];Object.defineProperty(e.prototype,n,Object.getOwnPropertyDescriptor(t,n))}},r._tempDisplayObjectParent.get=function(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new e),this.tempDisplayObjectParent},e.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha},e.prototype.calculateBounds=function(){},e.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},e.prototype.getBounds=function(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._boundsID!==this._lastBoundsID&&(this.calculateBounds(),this._lastBoundsID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new We),e=this._boundsRect),this._bounds.getRectangle(e)},e.prototype.getLocalBounds=function(t){var e=this.transform,r=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform,t||(this._localBoundsRect||(this._localBoundsRect=new We),t=this._localBoundsRect);var i=this.getBounds(!1,t);return this.parent=r,this.transform=e,i},e.prototype.toGlobal=function(t,e,r){return void 0===r&&(r=!1),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)},e.prototype.toLocal=function(t,e,r,i){return e&&(t=e.toGlobal(t,r,i)),i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)},e.prototype.render=function(t){},e.prototype.setParent=function(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t},e.prototype.setTransform=function(t,e,r,i,n,o,s,a,h){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=1),void 0===i&&(i=1),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===h&&(h=0),this.position.x=t,this.position.y=e,this.scale.x=r||1,this.scale.y=i||1,this.rotation=n,this.skew.x=o,this.skew.y=s,this.pivot.x=a,this.pivot.y=h,this},e.prototype.destroy=function(){this.parent&&this.parent.removeChild(this),this.removeAllListeners(),this.transform=null,this.parent=null,this._bounds=null,this._currentBounds=null,this._mask=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},r.x.get=function(){return this.position.x},r.x.set=function(t){this.transform.position.x=t},r.y.get=function(){return this.position.y},r.y.set=function(t){this.transform.position.y=t},r.worldTransform.get=function(){return this.transform.worldTransform},r.localTransform.get=function(){return this.transform.localTransform},r.position.get=function(){return this.transform.position},r.position.set=function(t){this.transform.position.copyFrom(t)},r.scale.get=function(){return this.transform.scale},r.scale.set=function(t){this.transform.scale.copyFrom(t)},r.pivot.get=function(){return this.transform.pivot},r.pivot.set=function(t){this.transform.pivot.copyFrom(t)},r.skew.get=function(){return this.transform.skew},r.skew.set=function(t){this.transform.skew.copyFrom(t)},r.rotation.get=function(){return this.transform.rotation},r.rotation.set=function(t){this.transform.rotation=t},r.angle.get=function(){return this.transform.rotation*Ne},r.angle.set=function(t){this.transform.rotation=t*Fe},r.zIndex.get=function(){return this._zIndex},r.zIndex.set=function(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)},r.worldVisible.get=function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0},r.mask.get=function(){return this._mask},r.mask.set=function(t){if(this._mask){var e=this._mask.maskObject||this._mask;e.renderable=!0,e.isMask=!1}if(this._mask=t,this._mask){var r=this._mask.maskObject||this._mask;r.renderable=!1,r.isMask=!0}},Object.defineProperties(e.prototype,r),e}(R);function tr(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}$e.prototype.displayObjectUpdateTransform=$e.prototype.updateTransform;var er=function(t){function e(){t.call(this),this.children=[],this.sortableChildren=C.SORTABLE_CHILDREN,this.sortDirty=!1}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={width:{configurable:!0},height:{configurable:!0}};return e.prototype.onChildrenChange=function(){},e.prototype.addChild=function(t){var e=arguments,r=arguments.length;if(r>1)for(var i=0;i<r;i++)this.addChild(e[i]);else t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this);return t},e.prototype.addChildAt=function(t,e){if(e<0||e>this.children.length)throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t},e.prototype.swapChildren=function(t,e){if(t!==e){var r=this.getChildIndex(t),i=this.getChildIndex(e);this.children[r]=e,this.children[i]=t,this.onChildrenChange(r<i?r:i)}},e.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},e.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The index "+e+" supplied is out of bounds "+this.children.length);var r=this.getChildIndex(t);ve(this.children,r,1),this.children.splice(e,0,t),this.onChildrenChange(e)},e.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Index ("+t+") does not exist.");return this.children[t]},e.prototype.removeChild=function(t){var e=arguments,r=arguments.length;if(r>1)for(var i=0;i<r;i++)this.removeChild(e[i]);else{var n=this.children.indexOf(t);if(-1===n)return null;t.parent=null,t.transform._parentID=-1,ve(this.children,n,1),this._boundsID++,this.onChildrenChange(n),t.emit("removed",this),this.emit("childRemoved",t,this,n)}return t},e.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,ve(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e},e.prototype.removeChildren=function(t,e){void 0===t&&(t=0);var r,i=t,n="number"==typeof e?e:this.children.length,o=n-i;if(o>0&&o<=n){r=this.children.splice(i,o);for(var s=0;s<r.length;++s)r[s].parent=null,r[s].transform&&(r[s].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(var a=0;a<r.length;++a)r[a].emit("removed",this),this.emit("childRemoved",r[a],this,a);return r}if(0===o&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},e.prototype.sortChildren=function(){for(var t=!1,e=0,r=this.children.length;e<r;++e){var i=this.children[e];i._lastSortedIndex=e,t||0===i.zIndex||(t=!0)}t&&this.children.length>1&&this.children.sort(tr),this.sortDirty=!1},e.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var t=0,e=this.children.length;t<e;++t){var r=this.children[t];r.visible&&r.updateTransform()}},e.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){var r=e._mask.maskObject||e._mask;r.calculateBounds(),this._bounds.addBoundsMask(e._bounds,r._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._lastBoundsID=this._boundsID},e.prototype._calculateBounds=function(){},e.prototype.render=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(t);else{this._render(t);for(var e=0,r=this.children.length;e<r;++e)this.children[e].render(t)}},e.prototype.renderAdvanced=function(t){t.batch.flush();var e=this.filters,r=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var i=0;i<e.length;i++)e[i].enabled&&this._enabledFilters.push(e[i]);this._enabledFilters.length&&t.filter.push(this,this._enabledFilters)}r&&t.mask.push(this,this._mask),this._render(t);for(var n=0,o=this.children.length;n<o;n++)this.children[n].render(t);t.batch.flush(),r&&t.mask.pop(this,this._mask),e&&this._enabledFilters&&this._enabledFilters.length&&t.filter.pop()},e.prototype._render=function(t){},e.prototype.destroy=function(e){t.prototype.destroy.call(this),this.sortDirty=!1;var r="boolean"==typeof e?e:e&&e.children,i=this.removeChildren(0,this.children.length);if(r)for(var n=0;n<i.length;++n)i[n].destroy(e)},r.width.get=function(){return this.scale.x*this.getLocalBounds().width},r.width.set=function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t},r.height.get=function(){return this.scale.y*this.getLocalBounds().height},r.height.set=function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t},Object.defineProperties(e.prototype,r),e}($e);er.prototype.containerUpdateTransform=er.prototype.updateTransform;var rr={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:!1,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0};$e.mixin(rr);var ir=function(t){this._hookDiv=null,(M.tablet||M.phone)&&this.createTouchHook();var e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2,this.div=e,this.pool=[],this.renderId=0,this.debug=!1,this.renderer=t,this.children=[],this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this.isActive=!1,this.isMobileAccessibility=!1,this.androidUpdateCount=0,this.androidUpdateFrequency=500,window.addEventListener("keydown",this._onKeyDown,!1)};ir.prototype.createTouchHook=function(){var t=this,e=document.createElement("button");e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.zIndex=2,e.style.backgroundColor="#FF0000",e.title="select to enable accessability for this content",e.addEventListener("focus",function(){t.isMobileAccessibility=!0,t.activate(),t.destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e},ir.prototype.destroyTouchHook=function(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)},ir.prototype.activate=function(){this.isActive||(this.isActive=!0,window.document.addEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode&&this.renderer.view.parentNode.appendChild(this.div))},ir.prototype.deactivate=function(){this.isActive&&!this.isMobileAccessibility&&(this.isActive=!1,window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode&&this.div.parentNode.removeChild(this.div))},ir.prototype.updateAccessibleObjects=function(t){if(t.visible&&t.accessibleChildren){t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);for(var e=t.children,r=0;r<e.length;r++)this.updateAccessibleObjects(e[r])}},ir.prototype.update=function(){var t=performance.now();if(!(M.android.device&&t<this.androidUpdateCount)&&(this.androidUpdateCount=t+this.androidUpdateFrequency,this.renderer.renderingToScreen)){this.updateAccessibleObjects(this.renderer._lastObjectRendered);var e=this.renderer.view.getBoundingClientRect(),r=this.renderer.resolution,i=e.width/this.renderer.width*r,n=e.height/this.renderer.height*r,o=this.div;o.style.left=e.left+"px",o.style.top=e.top+"px",o.style.width=this.renderer.width+"px",o.style.height=this.renderer.height+"px";for(var s=0;s<this.children.length;s++){var a=this.children[s];if(a.renderId!==this.renderId)a._accessibleActive=!1,ve(this.children,s,1),this.div.removeChild(a._accessibleDiv),this.pool.push(a._accessibleDiv),a._accessibleDiv=null,s--;else{o=a._accessibleDiv;var h=a.hitArea,u=a.worldTransform;a.hitArea?(o.style.left=(u.tx+h.x*u.a)*i+"px",o.style.top=(u.ty+h.y*u.d)*n+"px",o.style.width=h.width*u.a*i+"px",o.style.height=h.height*u.d*n+"px"):(h=a.getBounds(),this.capHitArea(h),o.style.left=h.x*i+"px",o.style.top=h.y*n+"px",o.style.width=h.width*i+"px",o.style.height=h.height*n+"px",o.title!==a.accessibleTitle&&null!==a.accessibleTitle&&(o.title=a.accessibleTitle),o.getAttribute("aria-label")!==a.accessibleHint&&null!==a.accessibleHint&&o.setAttribute("aria-label",a.accessibleHint)),a.accessibleTitle===o.title&&a.tabIndex===o.tabIndex||(o.title=a.accessibleTitle,o.tabIndex=a.tabIndex,this.debug&&this.updateDebugHTML(o))}}this.renderId++}},ir.prototype.updateDebugHTML=function(t){t.innerHTML="type: "+t.type+"</br> title : "+t.title+"</br> tabIndex: "+t.tabIndex},ir.prototype.capHitArea=function(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0),t.x+t.width>this.renderer.width&&(t.width=this.renderer.width-t.x),t.y+t.height>this.renderer.height&&(t.height=this.renderer.height-t.y)},ir.prototype.addChild=function(t){var e=this.pool.pop();e||((e=document.createElement("button")).style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2,e.style.borderStyle="none",navigator.userAgent.toLowerCase().indexOf("chrome")>-1?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(e.title="displayObject "+t.tabIndex),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex},ir.prototype._onClick=function(t){var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"click",e.eventData),e.dispatchEvent(t.target.displayObject,"pointertap",e.eventData),e.dispatchEvent(t.target.displayObject,"tap",e.eventData)},ir.prototype._onFocus=function(t){t.target.getAttribute("aria-live","off")||t.target.setAttribute("aria-live","assertive");var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseover",e.eventData)},ir.prototype._onFocusOut=function(t){t.target.getAttribute("aria-live","off")||t.target.setAttribute("aria-live","polite");var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseout",e.eventData)},ir.prototype._onKeyDown=function(t){9===t.keyCode&&this.activate()},ir.prototype._onMouseMove=function(t){0===t.movementX&&0===t.movementY||this.deactivate()},ir.prototype.destroy=function(){this.destroyTouchHook(),this.div=null;for(var t=0;t<this.children.length;t++)this.children[t].div=null;window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null};var nr,or={AccessibilityManager:ir,accessibleTarget:rr};C.TARGET_FPMS=.06,(nr=t.UPDATE_PRIORITY||(t.UPDATE_PRIORITY={}))[nr.INTERACTION=50]="INTERACTION",nr[nr.HIGH=25]="HIGH",nr[nr.NORMAL=0]="NORMAL",nr[nr.LOW=-25]="LOW",nr[nr.UTILITY=-50]="UTILITY";var sr=function(){function t(t,e,r,i){void 0===e&&(e=null),void 0===r&&(r=0),void 0===i&&(i=!1),this.fn=t,this.context=e,this.priority=r,this.once=i,this.next=null,this.previous=null,this._destroyed=!1}return t.prototype.match=function(t,e){return void 0===e&&(e=null),this.fn===t&&this.context===e},t.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e},t.prototype.connect=function(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this},t.prototype.destroy=function(t){void 0===t&&(t=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var e=this.next;return this.next=t?null:e,this.previous=null,e},t}(),ar=function(){function e(){var t=this;this._head=new sr(null,null,1/0),this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this.autoStart=!1,this.deltaTime=1,this.deltaMS=1/C.TARGET_FPMS,this.elapsedMS=1/C.TARGET_FPMS,this.lastTime=-1,this.speed=1,this.started=!1,this._protected=!1,this._lastFrame=-1,this._tick=function(e){t._requestId=null,t.started&&(t.update(e),t.started&&null===t._requestId&&t._head.next&&(t._requestId=requestAnimationFrame(t._tick)))}}return e.prototype._requestIfNeeded=function(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},e.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},e.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},e.prototype.add=function(e,r,i){return void 0===i&&(i=t.UPDATE_PRIORITY.NORMAL),this._addListener(new sr(e,r,i))},e.prototype.addOnce=function(e,r,i){return void 0===i&&(i=t.UPDATE_PRIORITY.NORMAL),this._addListener(new sr(e,r,i,!0))},e.prototype._addListener=function(t){var e=this._head.next,r=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}else t.connect(r);return this._startIfPossible(),this},e.prototype.remove=function(t,e){for(var r=this._head.next;r;)r=r.match(t,e)?r.destroy():r.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(e.prototype,"count",{get:function(){if(!this._head)return 0;for(var t=0,e=this._head;e=e.next;)t++;return t},enumerable:!0,configurable:!0}),e.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},e.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},e.prototype.destroy=function(){if(!this._protected){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}},e.prototype.update=function(t){var e;if(void 0===t&&(t=performance.now()),t>this.lastTime){if((e=this.elapsedMS=t-this.lastTime)>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){var r=t-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=t-r%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*C.TARGET_FPMS;for(var i=this._head,n=i.next;n;)n=n.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t},Object.defineProperty(e.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,e)/1e3,C.TARGET_FPMS);this._maxElapsedMS=1/r},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(t){if(0===t)this._minElapsedMS=0;else{var e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"shared",{get:function(){if(!e._shared){var t=e._shared=new e;t.autoStart=!0,t._protected=!0}return e._shared},enumerable:!0,configurable:!0}),Object.defineProperty(e,"system",{get:function(){if(!e._system){var t=e._system=new e;t.autoStart=!0,t._protected=!0}return e._system},enumerable:!0,configurable:!0}),e}(),hr=function(){function e(){}return e.init=function(e){var r=this;e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set:function(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,t.UPDATE_PRIORITY.LOW)},get:function(){return this._ticker}}),this.stop=function(){r._ticker.stop()},this.start=function(){r._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?ar.shared:new ar,e.autoStart&&this.start()},e.destroy=function(){if(this._ticker){var t=this._ticker;this.ticker=null,t.destroy()}},e}(),ur=function(){this.global=new Ce,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0},lr={pointerId:{configurable:!0}};lr.pointerId.get=function(){return this.identifier},ur.prototype.getLocalPosition=function(t,e,r){return t.worldTransform.applyInverse(r||this.global,e)},ur.prototype.copyEvent=function(t){t.isPrimary&&(this.isPrimary=!0),this.button=t.button,this.buttons=Number.isInteger(t.buttons)?t.buttons:t.which,this.width=t.width,this.height=t.height,this.tiltX=t.tiltX,this.tiltY=t.tiltY,this.pointerType=t.pointerType,this.pressure=t.pressure,this.rotationAngle=t.rotationAngle,this.twist=t.twist||0,this.tangentialPressure=t.tangentialPressure||0},ur.prototype.reset=function(){this.isPrimary=!1},Object.defineProperties(ur.prototype,lr);var cr=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null};cr.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},cr.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null};var dr=function t(e){this._pointerId=e,this._flags=t.FLAGS.NONE},pr={pointerId:{configurable:!0},flags:{configurable:!0},none:{configurable:!0},over:{configurable:!0},rightDown:{configurable:!0},leftDown:{configurable:!0}};dr.prototype._doSet=function(t,e){this._flags=e?this._flags|t:this._flags&~t},pr.pointerId.get=function(){return this._pointerId},pr.flags.get=function(){return this._flags},pr.flags.set=function(t){this._flags=t},pr.none.get=function(){return this._flags===this.constructor.FLAGS.NONE},pr.over.get=function(){return 0!=(this._flags&this.constructor.FLAGS.OVER)},pr.over.set=function(t){this._doSet(this.constructor.FLAGS.OVER,t)},pr.rightDown.get=function(){return 0!=(this._flags&this.constructor.FLAGS.RIGHT_DOWN)},pr.rightDown.set=function(t){this._doSet(this.constructor.FLAGS.RIGHT_DOWN,t)},pr.leftDown.get=function(){return 0!=(this._flags&this.constructor.FLAGS.LEFT_DOWN)},pr.leftDown.set=function(t){this._doSet(this.constructor.FLAGS.LEFT_DOWN,t)},Object.defineProperties(dr.prototype,pr),dr.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4});var fr=function(){this._tempPoint=new Ce};fr.prototype.recursiveFindHit=function(t,e,r,i,n){if(!e||!e.visible)return!1;var o=t.data.global,s=!1,a=n=e.interactive||n,h=!0;if(e.hitArea?(i&&(e.worldTransform.applyInverse(o,this._tempPoint),e.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?s=!0:(i=!1,h=!1)),a=!1):e._mask&&i&&(e._mask.containsPoint&&e._mask.containsPoint(o)||(i=!1)),h&&e.interactiveChildren&&e.children)for(var u=e.children,l=u.length-1;l>=0;l--){var c=u[l],d=this.recursiveFindHit(t,c,r,i,a);if(d){if(!c.parent)continue;a=!1,d&&(t.target&&(i=!1),s=!0)}}return n&&(i&&!t.target&&!e.hitArea&&e.containsPoint&&e.containsPoint(o)&&(s=!0),e.interactive&&(s&&!t.target&&(t.target=e),r&&r(t,e,!!s))),s},fr.prototype.findHit=function(t,e,r,i){this.recursiveFindHit(t,e,r,i,!1)};var vr={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return"pointer"===this.cursor},set buttonMode(t){t?this.cursor="pointer":"pointer"===this.cursor&&(this.cursor=null)},cursor:null,get trackedPointers(){return void 0===this._trackedPointers&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};$e.mixin(vr);var gr=1,mr={target:null,data:{global:null}},yr=function(e){function r(t,r){e.call(this),r=r||{},this.renderer=t,this.autoPreventDefault=void 0===r.autoPreventDefault||r.autoPreventDefault,this.interactionFrequency=r.interactionFrequency||10,this.mouse=new ur,this.mouse.identifier=gr,this.mouse.global.set(-999999),this.activeInteractionData={},this.activeInteractionData[gr]=this.mouse,this.interactionDataPool=[],this.eventData=new cr,this.interactionDOMElement=null,this.moveWhenInside=!1,this.eventsAdded=!1,this.tickerAdded=!1,this.mouseOverRenderer=!1,this.supportsTouchEvents="ontouchstart"in window,this.supportsPointerEvents=!!window.PointerEvent,this.onPointerUp=this.onPointerUp.bind(this),this.processPointerUp=this.processPointerUp.bind(this),this.onPointerCancel=this.onPointerCancel.bind(this),this.processPointerCancel=this.processPointerCancel.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.processPointerDown=this.processPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.processPointerMove=this.processPointerMove.bind(this),this.onPointerOut=this.onPointerOut.bind(this),this.processPointerOverOut=this.processPointerOverOut.bind(this),this.onPointerOver=this.onPointerOver.bind(this),this.cursorStyles={default:"inherit",pointer:"pointer"},this.currentCursorMode=null,this.cursor=null,this.resolution=1,this.delayedEvents=[],this.search=new fr,this._useSystemTicker=void 0===r.useSystemTicker||r.useSystemTicker,this.setTargetElement(this.renderer.view,this.renderer.resolution)}e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r;var i={useSystemTicker:{configurable:!0}};return i.useSystemTicker.get=function(){return this._useSystemTicker},i.useSystemTicker.set=function(t){this._useSystemTicker=t,t?this.addTickerListener():this.removeTickerListener()},r.prototype.hitTest=function(t,e){return mr.target=null,mr.data.global=t,e||(e=this.renderer._lastObjectRendered),this.processInteractive(mr,e,null,!0),mr.target},r.prototype.setTargetElement=function(t,e){void 0===e&&(e=1),this.removeTickerListener(),this.removeEvents(),this.interactionDOMElement=t,this.resolution=e,this.addEvents(),this.addTickerListener()},r.prototype.addTickerListener=function(){!this.tickerAdded&&this.interactionDOMElement&&this._useSystemTicker&&(ar.system.add(this.tickerUpdate,this,t.UPDATE_PRIORITY.INTERACTION),this.tickerAdded=!0)},r.prototype.removeTickerListener=function(){this.tickerAdded&&(ar.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)},r.prototype.addEvents=function(){!this.eventsAdded&&this.interactionDOMElement&&(window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="none",this.interactionDOMElement.style["-ms-touch-action"]="none"):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]="none"),this.supportsPointerEvents?(window.document.addEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,!0),window.addEventListener("pointercancel",this.onPointerCancel,!0),window.addEventListener("pointerup",this.onPointerUp,!0)):(window.document.addEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,!0),window.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,!0)),this.eventsAdded=!0)},r.prototype.removeEvents=function(){this.eventsAdded&&this.interactionDOMElement&&(window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]=""):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]=""),this.supportsPointerEvents?(window.document.removeEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,!0),window.removeEventListener("pointercancel",this.onPointerCancel,!0),window.removeEventListener("pointerup",this.onPointerUp,!0)):(window.document.removeEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,!0),window.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.interactionDOMElement=null,this.eventsAdded=!1)},r.prototype.tickerUpdate=function(t){this._deltaTime+=t,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this.update())},r.prototype.update=function(){if(this.interactionDOMElement)if(this.didMove)this.didMove=!1;else{for(var t in this.cursor=null,this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(t)){var e=this.activeInteractionData[t];if(e.originalEvent&&"touch"!==e.pointerType){var r=this.configureInteractionEventForDOMEvent(this.eventData,e.originalEvent,e);this.processInteractive(r,this.renderer._lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},r.prototype.setCursorMode=function(t){if(t=t||"default",this.currentCursorMode!==t){this.currentCursorMode=t;var e=this.cursorStyles[t];if(e)switch(typeof e){case"string":this.interactionDOMElement.style.cursor=e;break;case"function":e(t);break;case"object":Object.assign(this.interactionDOMElement.style,e)}else"string"!=typeof t||Object.prototype.hasOwnProperty.call(this.cursorStyles,t)||(this.interactionDOMElement.style.cursor=t)}},r.prototype.dispatchEvent=function(t,e,r){r.stopPropagationHint&&t!==r.stopsPropagatingAt||(r.currentTarget=t,r.type=e,t.emit(e,r),t[e]&&t[e](r))},r.prototype.delayDispatchEvent=function(t,e,r){this.delayedEvents.push({displayObject:t,eventString:e,eventData:r})},r.prototype.mapPositionToPoint=function(t,e,r){var i;i=this.interactionDOMElement.parentElement?this.interactionDOMElement.getBoundingClientRect():{x:0,y:0,width:0,height:0};var n=1/this.resolution;t.x=(e-i.left)*(this.interactionDOMElement.width/i.width)*n,t.y=(r-i.top)*(this.interactionDOMElement.height/i.height)*n},r.prototype.processInteractive=function(t,e,r,i){var n=this.search.findHit(t,e,r,i),o=this.delayedEvents;if(!o.length)return n;t.stopPropagationHint=!1;var s=o.length;this.delayedEvents=[];for(var a=0;a<s;a++){var h=o[a],u=h.displayObject,l=h.eventString,c=h.eventData;c.stopsPropagatingAt===u&&(c.stopPropagationHint=!0),this.dispatchEvent(u,l,c)}return n},r.prototype.onPointerDown=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);if(this.autoPreventDefault&&e[0].isNormalized)(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(var r=e.length,i=0;i<r;i++){var n=e[i],o=this.getInteractionDataForPointerId(n),s=this.configureInteractionEventForDOMEvent(this.eventData,n,o);if(s.data.originalEvent=t,this.processInteractive(s,this.renderer._lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",s),"touch"===n.pointerType)this.emit("touchstart",s);else if("mouse"===n.pointerType||"pen"===n.pointerType){var a=2===n.button;this.emit(a?"rightdown":"mousedown",this.eventData)}}}},r.prototype.processPointerDown=function(t,e,r){var i=t.data,n=t.data.identifier;if(r)if(e.trackedPointers[n]||(e.trackedPointers[n]=new dr(n)),this.dispatchEvent(e,"pointerdown",t),"touch"===i.pointerType)this.dispatchEvent(e,"touchstart",t);else if("mouse"===i.pointerType||"pen"===i.pointerType){var o=2===i.button;o?e.trackedPointers[n].rightDown=!0:e.trackedPointers[n].leftDown=!0,this.dispatchEvent(e,o?"rightdown":"mousedown",t)}},r.prototype.onPointerComplete=function(t,e,r){for(var i=this.normalizeToPointerData(t),n=i.length,o=t.target!==this.interactionDOMElement?"outside":"",s=0;s<n;s++){var a=i[s],h=this.getInteractionDataForPointerId(a),u=this.configureInteractionEventForDOMEvent(this.eventData,a,h);if(u.data.originalEvent=t,this.processInteractive(u,this.renderer._lastObjectRendered,r,e||!o),this.emit(e?"pointercancel":"pointerup"+o,u),"mouse"===a.pointerType||"pen"===a.pointerType){var l=2===a.button;this.emit(l?"rightup"+o:"mouseup"+o,u)}else"touch"===a.pointerType&&(this.emit(e?"touchcancel":"touchend"+o,u),this.releaseInteractionDataForPointerId(a.pointerId,h))}},r.prototype.onPointerCancel=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!0,this.processPointerCancel)},r.prototype.processPointerCancel=function(t,e){var r=t.data,i=t.data.identifier;void 0!==e.trackedPointers[i]&&(delete e.trackedPointers[i],this.dispatchEvent(e,"pointercancel",t),"touch"===r.pointerType&&this.dispatchEvent(e,"touchcancel",t))},r.prototype.onPointerUp=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!1,this.processPointerUp)},r.prototype.processPointerUp=function(t,e,r){var i=t.data,n=t.data.identifier,o=e.trackedPointers[n],s="touch"===i.pointerType,a="mouse"===i.pointerType||"pen"===i.pointerType,h=!1;if(a){var u=2===i.button,l=dr.FLAGS,c=u?l.RIGHT_DOWN:l.LEFT_DOWN,d=void 0!==o&&o.flags&c;r?(this.dispatchEvent(e,u?"rightup":"mouseup",t),d&&(this.dispatchEvent(e,u?"rightclick":"click",t),h=!0)):d&&this.dispatchEvent(e,u?"rightupoutside":"mouseupoutside",t),o&&(u?o.rightDown=!1:o.leftDown=!1)}r?(this.dispatchEvent(e,"pointerup",t),s&&this.dispatchEvent(e,"touchend",t),o&&(a&&!h||this.dispatchEvent(e,"pointertap",t),s&&(this.dispatchEvent(e,"tap",t),o.over=!1))):o&&(this.dispatchEvent(e,"pointerupoutside",t),s&&this.dispatchEvent(e,"touchendoutside",t)),o&&o.none&&delete e.trackedPointers[n]},r.prototype.onPointerMove=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);"mouse"!==e[0].pointerType&&"pen"!==e[0].pointerType||(this.didMove=!0,this.cursor=null);for(var r=e.length,i=0;i<r;i++){var n=e[i],o=this.getInteractionDataForPointerId(n),s=this.configureInteractionEventForDOMEvent(this.eventData,n,o);s.data.originalEvent=t,this.processInteractive(s,this.renderer._lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",s),"touch"===n.pointerType&&this.emit("touchmove",s),"mouse"!==n.pointerType&&"pen"!==n.pointerType||this.emit("mousemove",s)}"mouse"===e[0].pointerType&&this.setCursorMode(this.cursor)}},r.prototype.processPointerMove=function(t,e,r){var i=t.data,n="touch"===i.pointerType,o="mouse"===i.pointerType||"pen"===i.pointerType;o&&this.processPointerOverOut(t,e,r),this.moveWhenInside&&!r||(this.dispatchEvent(e,"pointermove",t),n&&this.dispatchEvent(e,"touchmove",t),o&&this.dispatchEvent(e,"mousemove",t))},r.prototype.onPointerOut=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t)[0];"mouse"===e.pointerType&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var r=this.getInteractionDataForPointerId(e),i=this.configureInteractionEventForDOMEvent(this.eventData,e,r);i.data.originalEvent=e,this.processInteractive(i,this.renderer._lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",i),"mouse"===e.pointerType||"pen"===e.pointerType?this.emit("mouseout",i):this.releaseInteractionDataForPointerId(r.identifier)}},r.prototype.processPointerOverOut=function(t,e,r){var i=t.data,n=t.data.identifier,o="mouse"===i.pointerType||"pen"===i.pointerType,s=e.trackedPointers[n];r&&!s&&(s=e.trackedPointers[n]=new dr(n)),void 0!==s&&(r&&this.mouseOverRenderer?(s.over||(s.over=!0,this.delayDispatchEvent(e,"pointerover",t),o&&this.delayDispatchEvent(e,"mouseover",t)),o&&null===this.cursor&&(this.cursor=e.cursor)):s.over&&(s.over=!1,this.dispatchEvent(e,"pointerout",this.eventData),o&&this.dispatchEvent(e,"mouseout",t),s.none&&delete e.trackedPointers[n]))},r.prototype.onPointerOver=function(t){var e=this.normalizeToPointerData(t)[0],r=this.getInteractionDataForPointerId(e),i=this.configureInteractionEventForDOMEvent(this.eventData,e,r);i.data.originalEvent=e,"mouse"===e.pointerType&&(this.mouseOverRenderer=!0),this.emit("pointerover",i),"mouse"!==e.pointerType&&"pen"!==e.pointerType||this.emit("mouseover",i)},r.prototype.getInteractionDataForPointerId=function(t){var e,r=t.pointerId;return r===gr||"mouse"===t.pointerType?e=this.mouse:this.activeInteractionData[r]?e=this.activeInteractionData[r]:((e=this.interactionDataPool.pop()||new ur).identifier=r,this.activeInteractionData[r]=e),e.copyEvent(t),e},r.prototype.releaseInteractionDataForPointerId=function(t){var e=this.activeInteractionData[t];e&&(delete this.activeInteractionData[t],e.reset(),this.interactionDataPool.push(e))},r.prototype.configureInteractionEventForDOMEvent=function(t,e,r){return t.data=r,this.mapPositionToPoint(r.global,e.clientX,e.clientY),"touch"===e.pointerType&&(e.globalX=r.global.x,e.globalY=r.global.y),r.originalEvent=e,t.reset(),t},r.prototype.normalizeToPointerData=function(t){var e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(var r=0,i=t.changedTouches.length;r<i;r++){var n=t.changedTouches[r];void 0===n.button&&(n.button=t.touches.length?1:0),void 0===n.buttons&&(n.buttons=t.touches.length?1:0),void 0===n.isPrimary&&(n.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===n.width&&(n.width=n.radiusX||1),void 0===n.height&&(n.height=n.radiusY||1),void 0===n.tiltX&&(n.tiltX=0),void 0===n.tiltY&&(n.tiltY=0),void 0===n.pointerType&&(n.pointerType="touch"),void 0===n.pointerId&&(n.pointerId=n.identifier||0),void 0===n.pressure&&(n.pressure=n.force||.5),void 0===n.twist&&(n.twist=0),void 0===n.tangentialPressure&&(n.tangentialPressure=0),void 0===n.layerX&&(n.layerX=n.offsetX=n.clientX),void 0===n.layerY&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,e.push(n)}else!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof window.PointerEvent?e.push(t):(void 0===t.isPrimary&&(t.isPrimary=!0),void 0===t.width&&(t.width=1),void 0===t.height&&(t.height=1),void 0===t.tiltX&&(t.tiltX=0),void 0===t.tiltY&&(t.tiltY=0),void 0===t.pointerType&&(t.pointerType="mouse"),void 0===t.pointerId&&(t.pointerId=gr),void 0===t.pressure&&(t.pressure=.5),void 0===t.twist&&(t.twist=0),void 0===t.tangentialPressure&&(t.tangentialPressure=0),t.isNormalized=!0,e.push(t));return e},r.prototype.destroy=function(){this.removeEvents(),this.removeTickerListener(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},Object.defineProperties(r.prototype,i),r}(R),_r={InteractionData:ur,InteractionEvent:cr,InteractionManager:yr,InteractionTrackingData:dr,interactiveTarget:vr},xr=function(){function t(t){this.items=[],this._name=t,this._aliasCount=0}return t.prototype.emit=function(t,e,r,i,n,o,s,a){if(arguments.length>8)throw new Error("max arguments reached");var h=this.name,u=this.items;this._aliasCount++;for(var l=0,c=u.length;l<c;l++)u[l][h](t,e,r,i,n,o,s,a);return u===this.items&&this._aliasCount--,this},t.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},t.prototype.add=function(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this},t.prototype.remove=function(t){var e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this},t.prototype.contains=function(t){return-1!==this.items.indexOf(t)},t.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},t.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.items.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),t}();Object.defineProperties(xr.prototype,{dispatch:{value:xr.prototype.emit},run:{value:xr.prototype.emit}});var br=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new xr("setRealSize",2),this.onUpdate=new xr("update"),this.onError=new xr("onError",1)},Er={valid:{configurable:!0},width:{configurable:!0},height:{configurable:!0}};br.prototype.bind=function(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.run(this._width,this._height)},br.prototype.unbind=function(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)},br.prototype.resize=function(t,e){t===this._width&&e===this._height||(this._width=t,this._height=e,this.onResize.run(t,e))},Er.valid.get=function(){return!!this._width&&!!this._height},br.prototype.update=function(){this.destroyed||this.onUpdate.run()},br.prototype.load=function(){return Promise.resolve()},Er.width.get=function(){return this._width},Er.height.get=function(){return this._height},br.prototype.upload=function(t,e,r){return!1},br.prototype.style=function(t,e,r){return!1},br.prototype.dispose=function(){},br.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},Object.defineProperties(br.prototype,Er);var Tr=function(e){function r(t){var r=t.naturalWidth||t.videoWidth||t.width,i=t.naturalHeight||t.videoHeight||t.height;e.call(this,r,i),this.source=t,this.noSubImage=!1}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.crossOrigin=function(t,e,r){void 0===r&&0!==e.indexOf("data:")?t.crossOrigin=Ae(e):!1!==r&&(t.crossOrigin="string"==typeof r?r:"anonymous")},r.prototype.upload=function(e,r,i,n){var o=e.gl,s=r.realWidth,a=r.realHeight;return n=n||this.source,o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===t.ALPHA_MODES.UNPACK),this.noSubImage||r.target!==o.TEXTURE_2D||i.width!==s||i.height!==a?(i.width=s,i.height=a,o.texImage2D(r.target,0,r.format,r.format,r.type,n)):o.texSubImage2D(o.TEXTURE_2D,0,0,0,r.format,r.type,n),!0},r.prototype.update=function(){if(!this.destroyed){var t=this.source.naturalWidth||this.source.videoWidth||this.source.width,r=this.source.naturalHeight||this.source.videoHeight||this.source.height;this.resize(t,r),e.prototype.update.call(this)}},r.prototype.dispose=function(){this.source=null},r}(br),Sr=function(e){function r(t,r){if(r=r||{},!(t instanceof HTMLImageElement)){var i=new Image;e.crossOrigin(i,t,r.crossorigin),i.src=t,t=i}e.call(this,t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(void 0!==r.createBitmap?r.createBitmap:C.CREATE_IMAGE_BITMAP)&&!!window.createImageBitmap,this.alphaMode="number"==typeof r.alphaMode?r.alphaMode:null,void 0!==r.premultiplyAlpha&&(this.premultiplyAlpha=r.premultiplyAlpha),this.bitmap=null,this._load=null,!1!==r.autoLoad&&this.load()}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.load=function(t){var e=this;return this._load?this._load:(void 0!==t&&(this.createBitmap=t),this._load=new Promise(function(t,r){e.url=e.source.src;var i=e.source,n=function(){e.destroyed||(i.onload=null,i.onerror=null,e.resize(i.width,i.height),e._load=null,e.createBitmap?t(e.process()):t(e))};i.complete&&i.src?n():(i.onload=n,i.onerror=function(t){r(t),e.onError.emit(t)})}),this._load)},r.prototype.process=function(){var e=this;return null!==this._process?this._process:null===this.bitmap&&window.createImageBitmap?(this._process=window.createImageBitmap(this.source,0,0,this.source.width,this.source.height,{premultiplyAlpha:this.premultiplyAlpha===t.ALPHA_MODES.UNPACK?"premultiply":"none"}).then(function(t){return e.destroyed?Promise.reject():(e.bitmap=t,e.update(),e._process=null,Promise.resolve(e))}),this._process):Promise.resolve(this)},r.prototype.upload=function(t,r,i){if("number"==typeof this.alphaMode&&(r.alphaMode=this.alphaMode),!this.createBitmap)return e.prototype.upload.call(this,t,r,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(e.prototype.upload.call(this,t,r,i,this.bitmap),!this.preserveBitmap){var n=!0;for(var o in r._glTextures){var s=r._glTextures[o];if(s!==i&&s.dirtyId!==r.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},r.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,e.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},r}(Tr),wr=[];function Pr(t,e){if(!t)return null;var r="";if("string"==typeof t){var i=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);i&&(r=i[1].toLowerCase())}for(var n=wr.length-1;n>=0;--n){var o=wr[n];if(o.test&&o.test(t,r))return new o(t,e)}return new Sr(t,e)}var Ir=function(e){function r(t,r){var i=r||{},n=i.width,o=i.height;if(!n||!o)throw new Error("BufferResource width or height invalid");e.call(this,n,o),this.data=t}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.upload=function(e,r,i){var n=e.gl;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===t.ALPHA_MODES.UNPACK),i.width===r.width&&i.height===r.height?n.texSubImage2D(r.target,0,0,0,r.width,r.height,r.format,r.type,this.data):(i.width=r.width,i.height=r.height,n.texImage2D(r.target,0,i.internalFormat,r.width,r.height,0,r.format,i.type,this.data)),!0},r.prototype.dispose=function(){this.data=null},r.test=function(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array},r}(br),Ar={scaleMode:t.SCALE_MODES.NEAREST,format:t.FORMATS.RGBA,alphaMode:t.ALPHA_MODES.NPM},Or=function(e){function r(r,i){void 0===r&&(r=null),void 0===i&&(i=null),e.call(this);var n=(i=i||{}).alphaMode,o=i.mipmap,s=i.anisotropicLevel,a=i.scaleMode,h=i.width,u=i.height,l=i.wrapMode,c=i.format,d=i.type,p=i.target,f=i.resolution,v=i.resourceOptions;!r||r instanceof br||((r=Pr(r,v)).internal=!0),this.width=h||0,this.height=u||0,this.resolution=f||C.RESOLUTION,this.mipmap=void 0!==o?o:C.MIPMAP_TEXTURES,this.anisotropicLevel=void 0!==s?s:C.ANISOTROPIC_LEVEL,this.wrapMode=l||C.WRAP_MODE,this.scaleMode=void 0!==a?a:C.SCALE_MODE,this.format=c||t.FORMATS.RGBA,this.type=d||t.TYPES.UNSIGNED_BYTE,this.target=p||t.TARGETS.TEXTURE_2D,this.alphaMode=void 0!==n?n:t.ALPHA_MODES.UNPACK,void 0!==i.premultiplyAlpha&&(this.premultiplyAlpha=i.premultiplyAlpha),this.uid=ye(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=h>0&&u>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.setResource(r)}e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r;var i={realWidth:{configurable:!0},realHeight:{configurable:!0}};return i.realWidth.get=function(){return Math.ceil(this.width*this.resolution-1e-4)},i.realHeight.get=function(){return Math.ceil(this.height*this.resolution-1e-4)},r.prototype.setStyle=function(t,e){var r;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,r=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,r=!0),r&&this.dirtyStyleId++,this},r.prototype.setSize=function(t,e,r){return this.resolution=r||this.resolution,this.width=t,this.height=e,this._refreshPOT(),this.update(),this},r.prototype.setRealSize=function(t,e,r){return this.resolution=r||this.resolution,this.width=t/this.resolution,this.height=e/this.resolution,this._refreshPOT(),this.update(),this},r.prototype._refreshPOT=function(){this.isPowerOfTwo=pe(this.realWidth)&&pe(this.realHeight)},r.prototype.setResolution=function(t){var e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=this.width*e/t,this.height=this.height*e/t,this.emit("update",this)),this._refreshPOT(),this)},r.prototype.setResource=function(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this},r.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},r.prototype.onError=function(t){this.emit("error",this,t)},r.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Te[this.cacheId],delete Ee[this.cacheId],this.cacheId=null),this.dispose(),r.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},r.prototype.dispose=function(){this.emit("dispose",this)},r.from=function(t,e,i){void 0===i&&(i=C.STRICT_TEXTURE_CACHE);var n="string"==typeof t,o=null;n?o=t:(t._pixiId||(t._pixiId="pixiid_"+ye()),o=t._pixiId);var s=Te[o];if(n&&i&&!s)throw new Error('The cacheId "'+o+'" does not exist in BaseTextureCache.');return s||((s=new r(t,e)).cacheId=o,r.addToCache(s,o)),s},r.fromBuffer=function(e,i,n,o){e=e||new Float32Array(i*n*4);var s=new Ir(e,{width:i,height:n}),a=e instanceof Float32Array?t.TYPES.FLOAT:t.TYPES.UNSIGNED_BYTE;return new r(s,Object.assign(Ar,o||{width:i,height:n,type:a}))},r.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),Te[e]&&console.warn("BaseTexture added to the cache with an id ["+e+"] that already had an entry"),Te[e]=t)},r.removeFromCache=function(t){if("string"==typeof t){var e=Te[t];if(e){var r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete Te[t],e}}else if(t&&t.textureCacheIds){for(var i=0;i<t.textureCacheIds.length;++i)delete Te[t.textureCacheIds[i]];return t.textureCacheIds.length=0,t}return null},Object.defineProperties(r.prototype,i),r}(R);Or._globalBatch=0;var Dr=function(e){function r(t,r){var i;r=r||{};var n=t;Array.isArray(t)&&(i=t,n=t.length),e.call(this,r.width,r.height),this.items=[],this.itemDirtyIds=[];for(var o=0;o<n;o++){var s=new Or;this.items.push(s),this.itemDirtyIds.push(-1)}if(this.length=n,this._load=null,i)for(var a=0;a<n;a++)this.addResourceAt(Pr(i[a],r),a)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.dispose=function(){for(var t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},r.prototype.addResourceAt=function(t,e){if(!this.items[e])throw new Error("Index "+e+" is out of bounds");return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this},r.prototype.bind=function(r){e.prototype.bind.call(this,r),r.target=t.TARGETS.TEXTURE_2D_ARRAY;for(var i=0;i<this.length;i++)this.items[i].on("update",r.update,r)},r.prototype.unbind=function(t){e.prototype.unbind.call(this,t);for(var r=0;r<this.length;r++)this.items[r].off("update",t.update,t)},r.prototype.load=function(){var t=this;if(this._load)return this._load;var e=this.items.map(function(t){return t.resource}),r=e.map(function(t){return t.load()});return this._load=Promise.all(r).then(function(){var r=e[0],i=r.width,n=r.height;return t.resize(i,n),Promise.resolve(t)}),this._load},r.prototype.upload=function(t,e,r){var i=this.length,n=this.itemDirtyIds,o=this.items,s=t.gl;r.dirtyId<0&&s.texImage3D(s.TEXTURE_2D_ARRAY,0,e.format,this._width,this._height,i,0,e.format,e.type,null);for(var a=0;a<i;a++){var h=o[a];n[a]<h.dirtyId&&(n[a]=h.dirtyId,h.valid&&s.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,a,h.resource.width,h.resource.height,1,e.format,e.type,h.resource.source))}return!0},r}(br),Mr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.test=function(t){var e=window.OffscreenCanvas;return!!(e&&t instanceof e)||t instanceof HTMLCanvasElement},e}(Tr),Cr=function(e){function r(i,n){if(n=n||{},e.call(this,i,n),this.length!==r.SIDES)throw new Error("Invalid length. Got "+this.length+", expected 6");for(var o=0;o<r.SIDES;o++)this.items[o].target=t.TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+o;!1!==n.autoLoad&&this.load()}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.bind=function(r){e.prototype.bind.call(this,r),r.target=t.TARGETS.TEXTURE_CUBE_MAP},r.prototype.upload=function(t,e,i){for(var n=this.itemDirtyIds,o=0;o<r.SIDES;o++){var s=this.items[o];n[o]<s.dirtyId&&(n[o]=s.dirtyId,s.valid&&s.resource.upload(t,s,i))}return!0},r}(Dr);Cr.SIDES=6;var Rr=function(t){function e(e,r){r=r||{},t.call(this,document.createElement("canvas")),this._width=0,this._height=0,this.svg=e,this.scale=r.scale||1,this._overrideWidth=r.width,this._overrideHeight=r.height,this._resolve=null,this._crossorigin=r.crossorigin,this._load=null,!1!==r.autoLoad&&this.load()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;return this._load?this._load:(this._load=new Promise(function(e){if(t._resolve=function(){t.resize(t.source.width,t.source.height),e(t)},/^\<svg/.test(t.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");t.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t.svg)))}t._loadSvg()}),this._load)},e.prototype._loadSvg=function(){var e=this,r=new Image;t.crossOrigin(r,this.svg,this._crossorigin),r.src=this.svg,r.onerror=function(t){e._resolve&&(r.onerror=null,e.onError.run(t))},r.onload=function(){if(e._resolve){var t=r.width,i=r.height;if(!t||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var n=t*e.scale,o=i*e.scale;(e._overrideWidth||e._overrideHeight)&&(n=e._overrideWidth||e._overrideHeight/i*t,o=e._overrideHeight||e._overrideWidth/t*i),n=Math.round(n),o=Math.round(o);var s=e.source;s.width=n,s.height=o,s._pixiId="canvas_"+ye(),s.getContext("2d").drawImage(r,0,0,t,i,0,0,n,o),e._resolve(),e._resolve=null}}},e.getSize=function(t){var r=e.SVG_SIZE.exec(t),i={};return r&&(i[r[1]]=Math.round(parseFloat(r[3])),i[r[5]]=Math.round(parseFloat(r[7]))),i},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},e.test=function(t,e){return"svg"===e||"string"==typeof t&&0===t.indexOf("data:image/svg+xml;base64")||"string"==typeof t&&0===t.indexOf("<svg")},e}(Tr);Rr.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;var Lr=function(t){function e(e,r){if(r=r||{},!(e instanceof HTMLVideoElement)){var i=document.createElement("video");i.setAttribute("preload","auto"),i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline",""),"string"==typeof e&&(e=[e]),t.crossOrigin(i,e[0].src||e[0],r.crossorigin);for(var n=0;n<e.length;++n){var o=document.createElement("source"),s=e[n],a=s.src,h=s.mime,u=(a=a||e[n]).split("?").shift().toLowerCase(),l=u.substr(u.lastIndexOf(".")+1);h=h||"video/"+l,o.src=a,o.type=h,i.appendChild(o)}e=i}t.call(this,e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=r.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==r.autoPlay,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),!1!==r.autoLoad&&this.load()}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={autoUpdate:{configurable:!0},updateFPS:{configurable:!0}};return e.prototype.update=function(e){if(void 0===e&&(e=0),!this.destroyed){var r=ar.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-r),(!this._updateFPS||this._msToNextUpdate<=0)&&(t.prototype.update.call(this,e),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},e.prototype.load=function(){var t=this;if(this._load)return this._load;var e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart.bind(this)),e.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise(function(r){t.valid?r(t):(t._resolve=r,e.load())}),this._load},e.prototype._onError=function(){this.source.removeEventListener("error",this._onError,!0),this.onError.run(event)},e.prototype._isSourcePlaying=function(){var t=this.source;return t.currentTime>0&&!1===t.paused&&!1===t.ended&&t.readyState>2},e.prototype._isSourceReady=function(){return 3===this.source.readyState||4===this.source.readyState},e.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(ar.shared.add(this.update,this),this._isConnectedToTicker=!0)},e.prototype._onPlayStop=function(){this._isConnectedToTicker&&(ar.shared.remove(this.update,this),this._isConnectedToTicker=!1)},e.prototype._onCanPlay=function(){var t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);var e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()},e.prototype.dispose=function(){this._isConnectedToTicker&&ar.shared.remove(this.update,this),this.source&&(this.source.removeEventListener("error",this._onError,!0),this.source.pause(),this.source.src="",this.source.load()),t.prototype.dispose.call(this)},r.autoUpdate.get=function(){return this._autoUpdate},r.autoUpdate.set=function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(ar.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(ar.shared.add(this.update,this),this._isConnectedToTicker=!0))},r.updateFPS.get=function(){return this._updateFPS},r.updateFPS.set=function(t){t!==this._updateFPS&&(this._updateFPS=t)},e.test=function(t,r){return t instanceof HTMLVideoElement||e.TYPES.indexOf(r)>-1},Object.defineProperties(e.prototype,r),e}(Tr);Lr.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];var Nr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.test=function(t){return!!window.createImageBitmap&&t instanceof ImageBitmap},e}(Tr);wr.push(Sr,Nr,Mr,Lr,Rr,Ir,Cr,Dr);var Fr={INSTALLED:wr,autoDetectResource:Pr,ArrayResource:Dr,BufferResource:Ir,CanvasResource:Mr,CubeResource:Cr,ImageResource:Sr,ImageBitmapResource:Nr,SVGResource:Rr,VideoResource:Lr,Resource:br,BaseImageResource:Tr},Br=function(t){this.renderer=t};Br.prototype.destroy=function(){this.renderer=null};var Ur=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.upload=function(e,r,i){var n=e.gl;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===t.ALPHA_MODES.UNPACK),i.width===r.width&&i.height===r.height?n.texSubImage2D(r.target,0,0,0,r.width,r.height,r.format,r.type,this.data):(i.width=r.width,i.height=r.height,n.texImage2D(r.target,0,1===e.context.webGLVersion?n.DEPTH_COMPONENT:n.DEPTH_COMPONENT16,r.width,r.height,0,r.format,r.type,this.data)),!0},r}(Ir),kr=function(t,e){this.width=Math.ceil(t||100),this.height=Math.ceil(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new xr("disposeFramebuffer",2)},Xr={colorTexture:{configurable:!0}};Xr.colorTexture.get=function(){return this.colorTextures[0]},kr.prototype.addColorTexture=function(e,r){return void 0===e&&(e=0),this.colorTextures[e]=r||new Or(null,{scaleMode:t.SCALE_MODES.NEAREST,resolution:1,mipmap:!1,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},kr.prototype.addDepthTexture=function(e){return this.depthTexture=e||new Or(new Ur(null,{width:this.width,height:this.height}),{scaleMode:t.SCALE_MODES.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:!1,format:t.FORMATS.DEPTH_COMPONENT,type:t.TYPES.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},kr.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},kr.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},kr.prototype.resize=function(t,e){if(t=Math.ceil(t),e=Math.ceil(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(var r=0;r<this.colorTextures.length;r++){var i=this.colorTextures[r],n=i.resolution;i.setSize(t/n,e/n)}if(this.depthTexture){var o=this.depthTexture.resolution;this.depthTexture.setSize(t/o,e/o)}}},kr.prototype.dispose=function(){this.disposeRunner.run(this,!1)},Object.defineProperties(kr.prototype,Xr);var jr=function(t){function e(e){"number"==typeof e&&(e={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]});t.call(this,null,e);var r=e||{},i=r.width,n=r.height;this.mipmap=!1,this.width=Math.ceil(i)||100,this.height=Math.ceil(n)||100,this.valid=!0,this._canvasRenderTarget=null,this.clearColor=[0,0,0,0],this.framebuffer=new kr(this.width*this.resolution,this.height*this.resolution).addColorTexture(0,this),this.maskStack=[],this.filterStack=[{}]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.resize=function(t,e){t=Math.ceil(t),e=Math.ceil(e),this.framebuffer.resize(t*this.resolution,e*this.resolution)},e.prototype.dispose=function(){this.framebuffer.dispose(),t.prototype.dispose.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this,!0),this.framebuffer=null},e}(Or),Hr=function(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)};Hr.prototype.set=function(t,e,r){var i=e.width,n=e.height;if(r){var o=t.width/2/i,s=t.height/2/n,a=t.x/i+o,h=t.y/n+s;r=ze.add(r,ze.NW),this.x0=a+o*ze.uX(r),this.y0=h+s*ze.uY(r),r=ze.add(r,2),this.x1=a+o*ze.uX(r),this.y1=h+s*ze.uY(r),r=ze.add(r,2),this.x2=a+o*ze.uX(r),this.y2=h+s*ze.uY(r),r=ze.add(r,2),this.x3=a+o*ze.uX(r),this.y3=h+s*ze.uY(r)}else this.x0=t.x/i,this.y0=t.y/n,this.x1=(t.x+t.width)/i,this.y1=t.y/n,this.x2=(t.x+t.width)/i,this.y2=(t.y+t.height)/n,this.x3=t.x/i,this.y3=(t.y+t.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3};var Gr=new Hr,Yr=function(t){function e(r,i,n,o,s,a){if(t.call(this),this.noFrame=!1,i||(this.noFrame=!0,i=new We(0,0,1,1)),r instanceof e&&(r=r.baseTexture),this.baseTexture=r,this._frame=i,this.trim=o,this.valid=!1,this.requiresUpdate=!1,this._uvs=Gr,this.uvMatrix=null,this.orig=n||i,this._rotate=Number(s||0),!0===s)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=a?new Ce(a.x,a.y):new Ce(0,0),this._updateID=0,this.textureCacheIds=[],r.valid?this.noFrame?r.valid&&this.onBaseTextureUpdated(r):this.frame=i:r.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&r.on("update",this.onBaseTextureUpdated,this)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={resolution:{configurable:!0},frame:{configurable:!0},rotate:{configurable:!0},width:{configurable:!0},height:{configurable:!0}};return e.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},e.prototype.onBaseTextureUpdated=function(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},e.prototype.destroy=function(t){if(this.baseTexture){if(t){var r=this.baseTexture.resource;r&&Ee[r.url]&&e.removeFromCache(r.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,e.removeFromCache(this),this.textureCacheIds=null},e.prototype.clone=function(){return new e(this.baseTexture,this.frame.clone(),this.orig.clone(),this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor)},e.prototype.updateUvs=function(){this._uvs===Gr&&(this._uvs=new Hr),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},e.from=function(t,r,i){void 0===r&&(r={}),void 0===i&&(i=C.STRICT_TEXTURE_CACHE);var n="string"==typeof t,o=null;n?o=t:(t._pixiId||(t._pixiId="pixiid_"+ye()),o=t._pixiId);var s=Ee[o];if(n&&i&&!s)throw new Error('The cacheId "'+o+'" does not exist in TextureCache.');return s||(r.resolution||(r.resolution=Oe(t)),(s=new e(new Or(t,r))).baseTexture.cacheId=o,Or.addToCache(s.baseTexture,o),e.addToCache(s,o)),s},e.fromBuffer=function(t,r,i,n){return new e(Or.fromBuffer(t,r,i,n))},e.fromLoader=function(t,r,i){var n=new Sr(t);n.url=r;var o=new e(new Or(n,{scaleMode:C.SCALE_MODE,resolution:Oe(r)}));return i||(i=r),Or.addToCache(o.baseTexture,i),e.addToCache(o,i),i!==r&&(Or.addToCache(o.baseTexture,r),e.addToCache(o,r)),o},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),Ee[e]&&console.warn("Texture added to the cache with an id ["+e+"] that already had an entry"),Ee[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=Ee[t];if(e){var r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete Ee[t],e}}else if(t&&t.textureCacheIds){for(var i=0;i<t.textureCacheIds.length;++i)Ee[t.textureCacheIds[i]]===t&&delete Ee[t.textureCacheIds[i]];return t.textureCacheIds.length=0,t}return null},r.resolution.get=function(){return this.baseTexture.resolution},r.frame.get=function(){return this._frame},r.frame.set=function(t){this._frame=t,this.noFrame=!1;var e=t.x,r=t.y,i=t.width,n=t.height,o=e+i>this.baseTexture.width,s=r+n>this.baseTexture.height;if(o||s){var a=o&&s?"and":"or",h="X: "+e+" + "+i+" = "+(e+i)+" > "+this.baseTexture.width,u="Y: "+r+" + "+n+" = "+(r+n)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+h+" "+a+" "+u)}this.valid=i&&n&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=t),this.valid&&this.updateUvs()},r.rotate.get=function(){return this._rotate},r.rotate.set=function(t){this._rotate=t,this.valid&&this.updateUvs()},r.width.get=function(){return this.orig.width},r.height.get=function(){return this.orig.height},Object.defineProperties(e.prototype,r),e}(R);function zr(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}Yr.EMPTY=new Yr(new Or),zr(Yr.EMPTY),zr(Yr.EMPTY.baseTexture),Yr.WHITE=function(){var t=document.createElement("canvas");t.width=16,t.height=16;var e=t.getContext("2d");return e.fillStyle="white",e.fillRect(0,0,16,16),new Yr(new Or(new Mr(t)))}(),zr(Yr.WHITE),zr(Yr.WHITE.baseTexture);var Vr=function(t){function e(e,r){var i=null;if(!(e instanceof jr)){var n=arguments[1],o=arguments[2],s=arguments[3],a=arguments[4];console.warn("Please use RenderTexture.create("+n+", "+o+") instead of the ctor directly."),i=arguments[0],r=null,e=new jr({width:n,height:o,scaleMode:s,resolution:a})}t.call(this,e,r),this.legacyRenderer=i,this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.resize=function(t,e,r){void 0===r&&(r=!0),t=Math.ceil(t),e=Math.ceil(e),this.valid=t>0&&e>0,this._frame.width=this.orig.width=t,this._frame.height=this.orig.height=e,r&&this.baseTexture.resize(t,e),this.updateUvs()},e.prototype.setResolution=function(t){var e=this.baseTexture;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))},e.create=function(t){return"number"==typeof t&&(t={width:t,height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),new e(new jr(t))},e}(Yr),Wr=function(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0};Wr.prototype.createTexture=function(t,e){var r=new jr(Object.assign({width:t,height:e,resolution:1},this.textureOptions));return new Vr(r)},Wr.prototype.getOptimalTexture=function(t,e,r){void 0===r&&(r=1);var i=Wr.SCREEN_KEY;t*=r,e*=r,this.enableFullScreen&&t===this._pixelsWidth&&e===this._pixelsHeight||(i=(65535&(t=de(t)))<<16|65535&(e=de(e))),this.texturePool[i]||(this.texturePool[i]=[]);var n=this.texturePool[i].pop();return n||(n=this.createTexture(t,e)),n.filterPoolKey=i,n.setResolution(r),n},Wr.prototype.getFilterTexture=function(t,e){var r=this.getOptimalTexture(t.width,t.height,e||t.resolution);return r.filterFrame=t.filterFrame,r},Wr.prototype.returnTexture=function(t){var e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)},Wr.prototype.returnFilterTexture=function(t){this.returnTexture(t)},Wr.prototype.clear=function(t){if(t=!1!==t)for(var e in this.texturePool){var r=this.texturePool[e];if(r)for(var i=0;i<r.length;i++)r[i].destroy(!0)}this.texturePool={}},Wr.prototype.setScreenSize=function(t){if(t.width!==this._pixelsWidth||t.height!==this._pixelsHeight){var e=Wr.SCREEN_KEY,r=this.texturePool[e];if(this.enableFullScreen=t.width>0&&t.height>0,r)for(var i=0;i<r.length;i++)r[i].destroy(!0);this.texturePool[e]=[],this._pixelsWidth=t.width,this._pixelsHeight=t.height}},Wr.SCREEN_KEY="screen";var qr=function(t,e,r,i,n,o,s){void 0===r&&(r=!1),void 0===i&&(i=5126),this.buffer=t,this.size=e,this.normalized=r,this.type=i,this.stride=n,this.start=o,this.instance=s};qr.prototype.destroy=function(){this.buffer=null},qr.from=function(t,e,r,i,n){return new qr(t,e,r,i,n)};var Kr=0,Zr=function(t,e,r){void 0===e&&(e=!0),void 0===r&&(r=!1),this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=e,this.id=Kr++,this.disposeRunner=new xr("disposeBuffer",2)};function Jr(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}Zr.prototype.update=function(t){this.data=t||this.data,this._updateID++},Zr.prototype.dispose=function(){this.disposeRunner.run(this,!1)},Zr.prototype.destroy=function(){this.dispose(),this.data=null},Zr.from=function(t){return t instanceof Array&&(t=new Float32Array(t)),new Zr(t)};var Qr={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};var $r={5126:4,5123:2,5121:1},ti=0,ei={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array},ri=function(t,e){void 0===t&&(t=[]),void 0===e&&(e={}),this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=ti++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new xr("disposeGeometry",2),this.refCount=0};ri.prototype.addAttribute=function(t,e,r,i,n,o,s,a){if(void 0===i&&(i=!1),void 0===a&&(a=!1),!e)throw new Error("You must pass a buffer when creating an attribute");e.data||(e instanceof Array&&(e=new Float32Array(e)),e=new Zr(e));var h=t.split("|");if(h.length>1){for(var u=0;u<h.length;u++)this.addAttribute(h[u],e,r,i,n);return this}var l=this.buffers.indexOf(e);return-1===l&&(this.buffers.push(e),l=this.buffers.length-1),this.attributes[t]=new qr(l,r,i,n,o,s,a),this.instanced=this.instanced||a,this},ri.prototype.getAttribute=function(t){return this.attributes[t]},ri.prototype.getBuffer=function(t){return this.buffers[this.getAttribute(t).buffer]},ri.prototype.addIndex=function(t){return t.data||(t instanceof Array&&(t=new Uint16Array(t)),t=new Zr(t)),t.index=!0,this.indexBuffer=t,-1===this.buffers.indexOf(t)&&this.buffers.push(t),this},ri.prototype.getIndex=function(){return this.indexBuffer},ri.prototype.interleave=function(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;var t,e=[],r=[],i=new Zr;for(t in this.attributes){var n=this.attributes[t],o=this.buffers[n.buffer];e.push(o.data),r.push(n.size*$r[n.type]/4),n.buffer=0}for(i.data=function(t,e){for(var r=0,i=0,n={},o=0;o<t.length;o++)i+=e[o],r+=t[o].length;for(var s=new ArrayBuffer(4*r),a=null,h=0,u=0;u<t.length;u++){var l=e[u],c=t[u],d=Jr(c);n[d]||(n[d]=new Qr[d](s)),a=n[d];for(var p=0;p<c.length;p++)a[(p/l|0)*i+h+p%l]=c[p];h+=l}return new Float32Array(s)}(e,r),t=0;t<this.buffers.length;t++)this.buffers[t]!==this.indexBuffer&&this.buffers[t].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},ri.prototype.getSize=function(){for(var t in this.attributes){var e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0},ri.prototype.dispose=function(){this.disposeRunner.run(this,!1)},ri.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},ri.prototype.clone=function(){for(var t=new ri,e=0;e<this.buffers.length;e++)t.buffers[e]=new Zr(this.buffers[e].data.slice());for(var r in this.attributes){var i=this.attributes[r];t.attributes[r]=new qr(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.index=!0),t},ri.merge=function(t){for(var e,r=new ri,i=[],n=[],o=[],s=0;s<t.length;s++){e=t[s];for(var a=0;a<e.buffers.length;a++)n[a]=n[a]||0,n[a]+=e.buffers[a].data.length,o[a]=0}for(var h=0;h<e.buffers.length;h++)i[h]=new(ei[Jr(e.buffers[h].data)])(n[h]),r.buffers[h]=new Zr(i[h]);for(var u=0;u<t.length;u++){e=t[u];for(var l=0;l<e.buffers.length;l++)i[l].set(e.buffers[l].data,o[l]),o[l]+=e.buffers[l].data.length}if(r.attributes=e.attributes,e.indexBuffer){r.indexBuffer=r.buffers[e.buffers.indexOf(e.indexBuffer)],r.indexBuffer.index=!0;for(var c=0,d=0,p=0,f=0,v=0;v<e.buffers.length;v++)if(e.buffers[v]!==e.indexBuffer){f=v;break}for(var g in e.attributes){var m=e.attributes[g];(0|m.buffer)===f&&(d+=m.size*$r[m.type]/4)}for(var y=0;y<t.length;y++){for(var _=t[y].indexBuffer.data,x=0;x<_.length;x++)r.indexBuffer.data[x+p]+=c;c+=e.buffers[f].data.length/d,p+=_.length}}return r};var ii=function(t){function e(){t.call(this),this.addAttribute("aVertexPosition",[0,0,1,0,1,1,0,1]).addIndex([0,1,3,2])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(ri),ni=function(t){function e(){t.call(this),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Zr(this.vertices),this.uvBuffer=new Zr(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.map=function(t,e){var r=0,i=0;return this.uvs[0]=r,this.uvs[1]=i,this.uvs[2]=r+e.width/t.width,this.uvs[3]=i,this.uvs[4]=r+e.width/t.width,this.uvs[5]=i+e.height/t.height,this.uvs[6]=r,this.uvs[7]=i+e.height/t.height,r=e.x,i=e.y,this.vertices[0]=r,this.vertices[1]=i,this.vertices[2]=r+e.width,this.vertices[3]=i,this.vertices[4]=r+e.width,this.vertices[5]=i+e.height,this.vertices[6]=r,this.vertices[7]=i+e.height,this.invalidate(),this},e.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},e}(ri),oi=0,si=function(t,e){this.uniforms=t,this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=oi++,this.static=!!e};si.prototype.update=function(){this.dirtyId++},si.prototype.add=function(t,e,r){this.uniforms[t]=new si(e,r)},si.from=function(t,e){return new si(t,e)};var ai=function(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.sourceFrame=new We,this.destinationFrame=new We,this.filters=[]};ai.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null};var hi=function(e){function r(t){e.call(this,t),this.defaultFilterStack=[{}],this.texturePool=new Wr,this.texturePool.setScreenSize(t.view),this.statePool=[],this.quad=new ii,this.quadUv=new ni,this.tempRect=new We,this.activeState={},this.globalUniforms=new si({outputFrame:this.tempRect,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.push=function(t,e){for(var r=this.renderer,i=this.defaultFilterStack,n=this.statePool.pop()||new ai,o=e[0].resolution,s=e[0].padding,a=e[0].autoFit,h=e[0].legacy,u=1;u<e.length;u++){var l=e[u];o=Math.min(o,l.resolution),s=this.useMaxPadding?Math.max(s,l.padding):s+l.padding,a=a||l.autoFit,h=h||l.legacy}1===i.length&&(this.defaultFilterStack[0].renderTexture=r.renderTexture.current),i.push(n),n.resolution=o,n.legacy=h,n.target=t,n.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),n.sourceFrame.pad(s),a&&n.sourceFrame.fit(this.renderer.renderTexture.sourceFrame),n.sourceFrame.ceil(o),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,o),n.filters=e,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height,n.renderTexture.filterFrame=n.sourceFrame,r.renderTexture.bind(n.renderTexture,n.sourceFrame),r.renderTexture.clear()},r.prototype.pop=function(){var t=this.defaultFilterStack,e=t.pop(),r=e.filters;this.activeState=e;var i=this.globalUniforms.uniforms;i.outputFrame=e.sourceFrame,i.resolution=e.resolution;var n=i.inputSize,o=i.inputPixel,s=i.inputClamp;if(n[0]=e.destinationFrame.width,n[1]=e.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],o[0]=n[0]*e.resolution,o[1]=n[1]*e.resolution,o[2]=1/o[0],o[3]=1/o[1],s[0]=.5*o[2],s[1]=.5*o[3],s[2]=e.sourceFrame.width*n[2]-.5*o[2],s[3]=e.sourceFrame.height*n[3]-.5*o[3],e.legacy){var a=i.filterArea;a[0]=e.destinationFrame.width,a[1]=e.destinationFrame.height,a[2]=e.sourceFrame.x,a[3]=e.sourceFrame.y,i.filterClamp=i.inputClamp}this.globalUniforms.update();var h=t[t.length-1];if(1===r.length)r[0].apply(this,e.renderTexture,h.renderTexture,!1,e),this.returnFilterTexture(e.renderTexture);else{var u=e.renderTexture,l=this.getOptimalFilterTexture(u.width,u.height,e.resolution);l.filterFrame=u.filterFrame;var c=0;for(c=0;c<r.length-1;++c){r[c].apply(this,u,l,!0,e);var d=u;u=l,l=d}r[c].apply(this,u,h.renderTexture,!1,e),this.returnFilterTexture(u),this.returnFilterTexture(l)}e.clear(),this.statePool.push(e)},r.prototype.applyFilter=function(e,r,i,n){var o=this.renderer;o.renderTexture.bind(i,i?i.filterFrame:null),n&&o.renderTexture.clear(),e.uniforms.uSampler=r,e.uniforms.filterGlobals=this.globalUniforms,o.state.set(e.state),o.shader.bind(e),e.legacy?(this.quadUv.map(r._frame,r.filterFrame),o.geometry.bind(this.quadUv),o.geometry.draw(t.DRAW_MODES.TRIANGLES)):(o.geometry.bind(this.quad),o.geometry.draw(t.DRAW_MODES.TRIANGLE_STRIP))},r.prototype.calculateSpriteMatrix=function(t,e){var r=this.activeState,i=r.sourceFrame,n=r.destinationFrame,o=e._texture.orig,s=t.set(n.width,0,0,n.height,i.x,i.y),a=e.worldTransform.copyTo(Be.TEMP_MATRIX);return a.invert(),s.prepend(a),s.scale(1/o.width,1/o.height),s.translate(e.anchor.x,e.anchor.y),s},r.prototype.destroy=function(){this.texturePool.clear(!1)},r.prototype.getOptimalFilterTexture=function(t,e,r){return void 0===r&&(r=1),this.texturePool.getOptimalTexture(t,e,r)},r.prototype.getFilterTexture=function(t,e){if("number"==typeof t){var r=t;t=e,e=r}t=t||this.activeState.renderTexture;var i=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution);return i.filterFrame=t.filterFrame,i},r.prototype.returnFilterTexture=function(t){this.texturePool.returnTexture(t)},r.prototype.emptyPool=function(){this.texturePool.clear(!0)},r.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},r}(Br),ui=function(t){this.renderer=t};ui.prototype.flush=function(){},ui.prototype.destroy=function(){this.renderer=null},ui.prototype.start=function(){},ui.prototype.stop=function(){this.flush()},ui.prototype.render=function(t){};var li=function(t){function e(e){t.call(this,e),this.emptyRenderer=new ui(e),this.currentRenderer=this.emptyRenderer}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setObjectRenderer=function(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},e.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},e.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},e.prototype.copyBoundTextures=function(t,e){for(var r=this.renderer.texture.boundTextures,i=e-1;i>=0;--i)t[i]=r[i]||null,t[i]&&(t[i]._batchLocation=i)},e.prototype.boundArray=function(t,e,r,i){for(var n=t.elements,o=t.ids,s=t.count,a=0,h=0;h<s;h++){var u=n[h],l=u._batchLocation;if(l>=0&&l<i&&e[l]===u)o[h]=l;else for(;a<i;){var c=e[a];if(!c||c._batchEnabled!==r||c._batchLocation!==a){o[h]=a,u._batchLocation=a,e[a]=u;break}a++}}},e}(Br);C.PREFER_ENV=M.any?t.ENV.WEBGL:t.ENV.WEBGL2,C.STRICT_TEXTURE_CACHE=!1;var ci=0,di=function(e){function r(t){e.call(this,t),this.webGLVersion=1,this.extensions={},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),t.view.addEventListener("webglcontextlost",this.handleContextLost,!1),t.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r;var i={isLost:{configurable:!0}};return i.isLost.get=function(){return!this.gl||this.gl.isContextLost()},r.prototype.contextChange=function(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=ci++,t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext()},r.prototype.initFromContext=function(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=ci++,this.renderer.runners.contextChange.run(t)},r.prototype.initFromOptions=function(t){var e=this.createContext(this.renderer.view,t);this.initFromContext(e)},r.prototype.createContext=function(e,r){var i;if(C.PREFER_ENV>=t.ENV.WEBGL2&&(i=e.getContext("webgl2",r)),i)this.webGLVersion=2;else if(this.webGLVersion=1,!(i=e.getContext("webgl",r)||e.getContext("experimental-webgl",r)))throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),i},r.prototype.getExtensions=function(){var t=this.gl;1===this.webGLVersion?Object.assign(this.extensions,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),loseContext:t.getExtension("WEBGL_lose_context"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,{anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),colorBufferFloat:t.getExtension("EXT_color_buffer_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear")})},r.prototype.handleContextLost=function(t){t.preventDefault()},r.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.run(this.gl)},r.prototype.destroy=function(){var t=this.renderer.view;t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},r.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},r.prototype.validateContext=function(t){t.getContextAttributes().stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly")},Object.defineProperties(r.prototype,i),r}(Br),pi=function(e){function r(t){e.call(this,t),this.managedFramebuffers=[],this.unknownFramebuffer=new kr(10,10)}e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r;var i={size:{configurable:!0}};return r.prototype.contextChange=function(){var e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new We,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),1===this.renderer.context.webGLVersion){var r=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;C.PREFER_ENV===t.ENV.WEBGL_LEGACY&&(r=null,i=null),r?e.drawBuffers=function(t){return r.drawBuffersWEBGL(t)}:(this.hasMRT=!1,e.drawBuffers=function(){}),i||(this.writeDepthTexture=!1)}},r.prototype.bind=function(t,e){var r=this.gl;if(t){var i=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,r.bindFramebuffer(r.FRAMEBUFFER,i.framebuffer)),i.dirtyId!==t.dirtyId&&(i.dirtyId=t.dirtyId,i.dirtyFormat!==t.dirtyFormat?(i.dirtyFormat=t.dirtyFormat,this.updateFramebuffer(t)):i.dirtySize!==t.dirtySize&&(i.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(var n=0;n<t.colorTextures.length;n++)t.colorTextures[n].texturePart?this.renderer.texture.unbind(t.colorTextures[n].texture):this.renderer.texture.unbind(t.colorTextures[n]);t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,t.width,t.height)}else this.current&&(this.current=null,r.bindFramebuffer(r.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},r.prototype.setViewport=function(t,e,r,i){var n=this.viewport;n.width===r&&n.height===i&&n.x===t&&n.y===e||(n.x=t,n.y=e,n.width=r,n.height=i,this.gl.viewport(t,e,r,i))},i.size.get=function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},r.prototype.clear=function(t,e,r,i){var n=this.gl;n.clearColor(t,e,r,i),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT)},r.prototype.initFramebuffer=function(t){var e={framebuffer:this.gl.createFramebuffer(),stencil:null,dirtyId:0,dirtyFormat:0,dirtySize:0};return t.glFramebuffers[this.CONTEXT_UID]=e,this.managedFramebuffers.push(t),t.disposeRunner.add(this),e},r.prototype.resizeFramebuffer=function(t){var e=this.gl,r=t.glFramebuffers[this.CONTEXT_UID];r.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,r.stencil),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));for(var i=t.colorTextures,n=0;n<i.length;n++)this.renderer.texture.bind(i[n],0);t.depthTexture&&this.renderer.texture.bind(t.depthTexture,0)},r.prototype.updateFramebuffer=function(t){var e=this.gl,r=t.glFramebuffers[this.CONTEXT_UID],i=t.colorTextures.length;e.drawBuffers||(i=Math.min(i,1));for(var n=[],o=0;o<i;o++){var s=t.colorTextures[o];s.texturePart?(this.renderer.texture.bind(s.texture,0),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+o,e.TEXTURE_CUBE_MAP_NEGATIVE_X+s.side,s.texture._glTextures[this.CONTEXT_UID].texture,0)):(this.renderer.texture.bind(s,0),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+o,e.TEXTURE_2D,s._glTextures[this.CONTEXT_UID].texture,0)),n.push(e.COLOR_ATTACHMENT0+o)}if((n.length>1&&e.drawBuffers(n),t.depthTexture)&&this.writeDepthTexture){var a=t.depthTexture;this.renderer.texture.bind(a,0),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a._glTextures[this.CONTEXT_UID].texture,0)}r.stencil||!t.stencil&&!t.depth||(r.stencil=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,r.stencil),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height),t.depthTexture||e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,r.stencil))},r.prototype.disposeFramebuffer=function(t,e){var r=t.glFramebuffers[this.CONTEXT_UID],i=this.gl;if(r){delete t.glFramebuffers[this.CONTEXT_UID];var n=this.managedFramebuffers.indexOf(t);n>=0&&this.managedFramebuffers.splice(n,1),t.disposeRunner.remove(this),e||(i.deleteFramebuffer(r.framebuffer),r.stencil&&i.deleteRenderbuffer(r.stencil))}},r.prototype.disposeAll=function(t){var e=this.managedFramebuffers;this.managedFramebuffers=[];for(var r=0;r<e.length;r++)this.disposeFramebuffer(e[r],t)},r.prototype.forceStencil=function(){var t=this.current;if(t){var e=t.glFramebuffers[this.CONTEXT_UID];if(e&&!e.stencil){t.enableStencil();var r=t.width,i=t.height,n=this.gl,o=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,o),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,r,i),e.stencil=o,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,o)}}},r.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new We},Object.defineProperties(r.prototype,i),r}(Br),fi=function(t){this.buffer=t,this.updateID=-1,this.byteLength=-1,this.refCount=0},vi={5126:4,5123:2,5121:1},gi=function(e){function r(t){e.call(this,t),this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.boundBuffers={},this.managedGeometries={},this.managedBuffers={}}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.contextChange=function(){this.disposeAll(!0);var e=this.gl=this.renderer.gl,r=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,!e.createVertexArray){var i=this.renderer.context.extensions.vertexArrayObject;C.PREFER_ENV===t.ENV.WEBGL_LEGACY&&(i=null),i?(e.createVertexArray=function(){return i.createVertexArrayOES()},e.bindVertexArray=function(t){return i.bindVertexArrayOES(t)},e.deleteVertexArray=function(t){return i.deleteVertexArrayOES(t)}):(this.hasVao=!1,e.createVertexArray=function(){},e.bindVertexArray=function(){},e.deleteVertexArray=function(){})}if(!e.vertexAttribDivisor){var n=e.getExtension("ANGLE_instanced_arrays");n?(e.vertexAttribDivisor=function(t,e){return n.vertexAttribDivisorANGLE(t,e)},e.drawElementsInstanced=function(t,e,r,i,o){return n.drawElementsInstancedANGLE(t,e,r,i,o)},e.drawArraysInstanced=function(t,e,r,i){return n.drawArraysInstancedANGLE(t,e,r,i)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===r.webGLVersion||!!r.extensions.uint32ElementIndex},r.prototype.bind=function(t,e){e=e||this.renderer.shader.shader;var r=this.gl,i=t.glVertexArrayObjects[this.CONTEXT_UID];i||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=i={});var n=i[e.program.id]||this.initGeometryVao(t,e.program);this._activeGeometry=t,this._activeVao!==n&&(this._activeVao=n,this.hasVao?r.bindVertexArray(n):this.activateVao(t,e.program)),this.updateBuffers()},r.prototype.reset=function(){this.unbind()},r.prototype.updateBuffers=function(){for(var t=this._activeGeometry,e=this.gl,r=0;r<t.buffers.length;r++){var i=t.buffers[r],n=i._glBuffers[this.CONTEXT_UID];if(i._updateID!==n.updateID){n.updateID=i._updateID;var o=i.index?e.ELEMENT_ARRAY_BUFFER:e.ARRAY_BUFFER;if(e.bindBuffer(o,n.buffer),this._boundBuffer=n,n.byteLength>=i.data.byteLength)e.bufferSubData(o,0,i.data);else{var s=i.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;n.byteLength=i.data.byteLength,e.bufferData(o,i.data,s)}}}},r.prototype.checkCompatibility=function(t,e){var r=t.attributes,i=e.attributeData;for(var n in i)if(!r[n])throw new Error('shader and geometry incompatible, geometry missing the "'+n+'" attribute')},r.prototype.getSignature=function(t,e){var r=t.attributes,i=e.attributeData,n=["g",t.id];for(var o in r)i[o]&&n.push(o);return n.join("-")},r.prototype.initGeometryVao=function(t,e){this.checkCompatibility(t,e);var r=this.gl,i=this.CONTEXT_UID,n=this.getSignature(t,e),o=t.glVertexArrayObjects[this.CONTEXT_UID],s=o[n];if(s)return o[e.id]=s,s;var a=t.buffers,h=t.attributes,u={},l={};for(var c in a)u[c]=0,l[c]=0;for(var d in h)!h[d].size&&e.attributeData[d]?h[d].size=e.attributeData[d].size:h[d].size||console.warn("PIXI Geometry attribute '"+d+"' size cannot be determined (likely the bound shader does not have the attribute)"),u[h[d].buffer]+=h[d].size*vi[h[d].type];for(var p in h){var f=h[p],v=f.size;void 0===f.stride&&(u[f.buffer]===v*vi[f.type]?f.stride=0:f.stride=u[f.buffer]),void 0===f.start&&(f.start=l[f.buffer],l[f.buffer]+=v*vi[f.type])}s=r.createVertexArray(),r.bindVertexArray(s);for(var g=0;g<a.length;g++){var m=a[g];m._glBuffers[i]||(m._glBuffers[i]=new fi(r.createBuffer()),this.managedBuffers[m.id]=m,m.disposeRunner.add(this)),m._glBuffers[i].refCount++}return this.activateVao(t,e),this._activeVao=s,o[e.id]=s,o[n]=s,s},r.prototype.disposeBuffer=function(t,e){if(this.managedBuffers[t.id]){delete this.managedBuffers[t.id];var r=t._glBuffers[this.CONTEXT_UID],i=this.gl;t.disposeRunner.remove(this),r&&(e||i.deleteBuffer(r.buffer),delete t._glBuffers[this.CONTEXT_UID])}},r.prototype.disposeGeometry=function(t,e){if(this.managedGeometries[t.id]){delete this.managedGeometries[t.id];var r=t.glVertexArrayObjects[this.CONTEXT_UID],i=this.gl,n=t.buffers;if(t.disposeRunner.remove(this),r){for(var o=0;o<n.length;o++){var s=n[o]._glBuffers[this.CONTEXT_UID];s.refCount--,0!==s.refCount||e||this.disposeBuffer(n[o],e)}if(!e)for(var a in r)if("g"===a[0]){var h=r[a];this._activeVao===h&&this.unbind(),i.deleteVertexArray(h)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}},r.prototype.disposeAll=function(t){for(var e=Object.keys(this.managedGeometries),r=0;r<e.length;r++)this.disposeGeometry(this.managedGeometries[e[r]],t);e=Object.keys(this.managedBuffers);for(var i=0;i<e.length;i++)this.disposeBuffer(this.managedBuffers[e[i]],t)},r.prototype.activateVao=function(t,e){var r=this.gl,i=this.CONTEXT_UID,n=t.buffers,o=t.attributes;t.indexBuffer&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.indexBuffer._glBuffers[i].buffer);var s=null;for(var a in o){var h=o[a],u=n[h.buffer]._glBuffers[i];if(e.attributeData[a]){s!==u&&(r.bindBuffer(r.ARRAY_BUFFER,u.buffer),s=u);var l=e.attributeData[a].location;if(r.enableVertexAttribArray(l),r.vertexAttribPointer(l,h.size,h.type||r.FLOAT,h.normalized,h.stride,h.start),h.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");r.vertexAttribDivisor(l,1)}}}},r.prototype.draw=function(t,e,r,i){var n=this.gl,o=this._activeGeometry;if(o.indexBuffer){var s=o.indexBuffer.data.BYTES_PER_ELEMENT,a=2===s?n.UNSIGNED_SHORT:n.UNSIGNED_INT;2===s||4===s&&this.canUseUInt32ElementIndex?o.instanced?n.drawElementsInstanced(t,e||o.indexBuffer.data.length,a,(r||0)*s,i||1):n.drawElements(t,e||o.indexBuffer.data.length,a,(r||0)*s):console.warn("unsupported index buffer type: uint32")}else o.instanced?n.drawArraysInstanced(t,r,e||o.getSize(),i||1):n.drawArrays(t,r,e||o.getSize());return this},r.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},r}(Br),mi=function(e){this.type=t.MASK_TYPES.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._target=null};function yi(t,e,r,i){var n=_i(t,t.VERTEX_SHADER,e),o=_i(t,t.FRAGMENT_SHADER,r),s=t.createProgram();if(t.attachShader(s,n),t.attachShader(s,o),i)for(var a in i)t.bindAttribLocation(s,i[a],a);return t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)||(t.getShaderParameter(n,t.COMPILE_STATUS)||(console.warn(e),console.error(t.getShaderInfoLog(n))),t.getShaderParameter(o,t.COMPILE_STATUS)||(console.warn(r),console.error(t.getShaderInfoLog(o))),console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",t.getProgramParameter(s,t.VALIDATE_STATUS)),console.error("gl.getError()",t.getError()),""!==t.getProgramInfoLog(s)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(s)),t.deleteProgram(s),s=null),t.deleteShader(n),t.deleteShader(o),s}function _i(t,e,r){var i=t.createShader(e);return t.shaderSource(i,r),t.compileShader(i),i}function xi(t,e){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"bool":return!1;case"bvec2":return bi(2*e);case"bvec3":return bi(3*e);case"bvec4":return bi(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function bi(t){for(var e=new Array(t),r=0;r<e.length;r++)e[r]=!1;return e}mi.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=t.MASK_TYPES.NONE,this.autoDetect=!0),this._target=null},mi.prototype.copyCountersOrReset=function(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)};var Ei,Ti={},Si=Ti;function wi(){if(Si===Ti||Si&&Si.isContextLost()){var e,r=document.createElement("canvas");C.PREFER_ENV>=t.ENV.WEBGL2&&(e=r.getContext("webgl2",{})),e||((e=r.getContext("webgl",{})||r.getContext("experimental-webgl",{}))?e.getExtension("WEBGL_draw_buffers"):e=null),Si=e}return Si}function Pi(e,r,i){if("precision"!==e.substring(0,9)){var n=r;return r===t.PRECISION.HIGH&&i!==t.PRECISION.HIGH&&(n=t.PRECISION.MEDIUM),"precision "+n+" float;\n"+e}return i!==t.PRECISION.HIGH&&"precision highp"===e.substring(0,15)?e.replace("precision highp","precision mediump"):e}var Ii={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Ai(t){return Ii[t]}var Oi=null,Di={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray"};function Mi(t,e){if(!Oi){var r=Object.keys(Di);Oi={};for(var i=0;i<r.length;++i){var n=r[i];Oi[t[n]]=Di[n]}}return Oi[e]}var Ci={float:"\n    if(cv !== v)\n    {\n        cv.v = v;\n        gl.uniform1f(location, v)\n    }",vec2:"\n    if(cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"gl.uniform4f(location, v[0], v[1], v[2], v[3])",int:"gl.uniform1i(location, v)",ivec2:"gl.uniform2i(location, v[0], v[1])",ivec3:"gl.uniform3i(location, v[0], v[1], v[2])",ivec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",bool:"gl.uniform1i(location, v)",bvec2:"gl.uniform2i(location, v[0], v[1])",bvec3:"gl.uniform3i(location, v[0], v[1], v[2])",bvec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},Ri={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};var Li,Ni=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function Fi(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var r=e.createShader(e.FRAGMENT_SHADER);;){var i=Ni.replace(/%forloop%/gi,Bi(t));if(e.shaderSource(r,i),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS))break;t=t/2|0}return t}function Bi(t){for(var e="",r=0;r<t;++r)r>0&&(e+="\nelse "),r<t-1&&(e+="if(test == "+r+".0){}");return e}var Ui=0,ki={},Xi=function e(r,i,n){void 0===n&&(n="pixi-shader"),this.id=Ui++,this.vertexSrc=r||e.defaultVertexSrc,this.fragmentSrc=i||e.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),"#version"!==this.vertexSrc.substring(0,8)&&(n=n.replace(/\s+/g,"-"),ki[n]?(ki[n]++,n+="-"+ki[n]):ki[n]=1,this.vertexSrc="#define SHADER_NAME "+n+"\n"+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+n+"\n"+this.fragmentSrc,this.vertexSrc=Pi(this.vertexSrc,C.PRECISION_VERTEX,t.PRECISION.HIGH),this.fragmentSrc=Pi(this.fragmentSrc,C.PRECISION_FRAGMENT,function(){if(!Ei){Ei=t.PRECISION.MEDIUM;var e=wi();if(e&&e.getShaderPrecisionFormat){var r=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);Ei=r.precision?t.PRECISION.HIGH:t.PRECISION.MEDIUM}}return Ei}())),this.extractData(this.vertexSrc,this.fragmentSrc),this.glPrograms={},this.syncUniforms=null},ji={defaultVertexSrc:{configurable:!0},defaultFragmentSrc:{configurable:!0}};Xi.prototype.extractData=function(t,e){var r=wi();if(r){var i=yi(r,t,e);this.attributeData=this.getAttributeData(i,r),this.uniformData=this.getUniformData(i,r),r.deleteProgram(i)}else this.uniformData={},this.attributeData={}},Xi.prototype.getAttributeData=function(t,e){for(var r={},i=[],n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),o=0;o<n;o++){var s=e.getActiveAttrib(t,o),a=Mi(e,s.type),h={type:a,name:s.name,size:Ai(a),location:0};r[s.name]=h,i.push(h)}i.sort(function(t,e){return t.name>e.name?1:-1});for(var u=0;u<i.length;u++)i[u].location=u;return r},Xi.prototype.getUniformData=function(t,e){for(var r={},i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),n=0;n<i;n++){var o=e.getActiveUniform(t,n),s=o.name.replace(/\[.*?\]/,""),a=o.name.match(/\[.*?\]/,""),h=Mi(e,o.type);r[s]={type:h,size:o.size,isArray:a,value:xi(h,o.size)}}return r},ji.defaultVertexSrc.get=function(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"},ji.defaultFragmentSrc.get=function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"},Xi.from=function(t,e,r){var i=t+e,n=be[i];return n||(be[i]=n=new Xi(t,e,r)),n},Object.defineProperties(Xi,ji);var Hi=function(t,e){for(var r in this.program=t,this.uniformGroup=e?e instanceof si?e:new si(e):new si({}),t.uniformData)this.uniformGroup.uniforms[r]instanceof Array&&(this.uniformGroup.uniforms[r]=new Float32Array(this.uniformGroup.uniforms[r]))},Gi={uniforms:{configurable:!0}};Hi.prototype.checkUniformExists=function(t,e){if(e.uniforms[t])return!0;for(var r in e.uniforms){var i=e.uniforms[r];if(i.group&&this.checkUniformExists(t,i))return!0}return!1},Hi.prototype.destroy=function(){this.uniformGroup=null},Gi.uniforms.get=function(){return this.uniformGroup.uniforms},Hi.from=function(t,e,r){var i=Xi.from(t,e);return new Hi(i,r)},Object.defineProperties(Hi.prototype,Gi);var Yi=function(){this.data=0,this.blendMode=t.BLEND_MODES.NORMAL,this.polygonOffset=0,this.blend=!0},zi={blend:{configurable:!0},offsets:{configurable:!0},culling:{configurable:!0},depthTest:{configurable:!0},clockwiseFrontFace:{configurable:!0},blendMode:{configurable:!0},polygonOffset:{configurable:!0}};zi.blend.get=function(){return!!(1&this.data)},zi.blend.set=function(t){!!(1&this.data)!==t&&(this.data^=1)},zi.offsets.get=function(){return!!(2&this.data)},zi.offsets.set=function(t){!!(2&this.data)!==t&&(this.data^=2)},zi.culling.get=function(){return!!(4&this.data)},zi.culling.set=function(t){!!(4&this.data)!==t&&(this.data^=4)},zi.depthTest.get=function(){return!!(8&this.data)},zi.depthTest.set=function(t){!!(8&this.data)!==t&&(this.data^=8)},zi.clockwiseFrontFace.get=function(){return!!(16&this.data)},zi.clockwiseFrontFace.set=function(t){!!(16&this.data)!==t&&(this.data^=16)},zi.blendMode.get=function(){return this._blendMode},zi.blendMode.set=function(e){this.blend=e!==t.BLEND_MODES.NONE,this._blendMode=e},zi.polygonOffset.get=function(){return this._polygonOffset},zi.polygonOffset.set=function(t){this.offsets=!!t,this._polygonOffset=t},Yi.for2d=function(){var t=new Yi;return t.depthTest=!1,t.blend=!0,t},Object.defineProperties(Yi.prototype,zi);var Vi=function(t){function e(r,i,n){var o=Xi.from(r||e.defaultVertexSrc,i||e.defaultFragmentSrc);t.call(this,o,n),this.padding=0,this.resolution=C.FILTER_RESOLUTION,this.enabled=!0,this.autoFit=!0,this.legacy=!!this.program.attributeData.aTextureCoord,this.state=new Yi}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={blendMode:{configurable:!0}},i={defaultVertexSrc:{configurable:!0},defaultFragmentSrc:{configurable:!0}};return e.prototype.apply=function(t,e,r,i,n){t.applyFilter(this,e,r,i,n)},r.blendMode.get=function(){return this.state.blendMode},r.blendMode.set=function(t){this.state.blendMode=t},i.defaultVertexSrc.get=function(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"},i.defaultFragmentSrc.get=function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"},Object.defineProperties(e.prototype,r),Object.defineProperties(e,i),e}(Hi);Vi.SOURCE_KEY_MAP={};var Wi="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",qi="varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",Ki=new Be,Zi=function(t,e){this._texture=t,this.mapCoord=new Be,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._updateID=-1,this.clampOffset=0,this.clampMargin=void 0===e?.5:e,this.isSimple=!1},Ji={texture:{configurable:!0}};Ji.texture.get=function(){return this._texture},Ji.texture.set=function(t){this._texture=t,this._updateID=-1},Zi.prototype.multiplyUvs=function(t,e){void 0===e&&(e=t);for(var r=this.mapCoord,i=0;i<t.length;i+=2){var n=t[i],o=t[i+1];e[i]=n*r.a+o*r.c+r.tx,e[i+1]=n*r.b+o*r.d+r.ty}return e},Zi.prototype.update=function(t){var e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._updateID===e._updateID)return!1;this._updateID=e._updateID;var r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);var i=e.orig,n=e.trim;n&&(Ki.set(i.width/n.width,0,0,i.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(Ki));var o=e.baseTexture,s=this.uClampFrame,a=this.clampMargin/o.resolution,h=this.clampOffset;return s[0]=(e._frame.x+a+h)/o.width,s[1]=(e._frame.y+a+h)/o.height,s[2]=(e._frame.x+e._frame.width-a+h)/o.width,s[3]=(e._frame.y+e._frame.height-a+h)/o.height,this.uClampOffset[0]=h/o.realWidth,this.uClampOffset[1]=h/o.realHeight,this.isSimple=e._frame.width===o.width&&e._frame.height===o.height&&0===e.rotate,!0},Object.defineProperties(Zi.prototype,Ji);var Qi=function(t){function e(e){var r=new Be;t.call(this,Wi,qi),e.renderable=!1,this.maskSprite=e,this.maskMatrix=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t,e,r,i){var n=this.maskSprite,o=this.maskSprite.texture;o.valid&&(o.transform||(o.transform=new Zi(o,0)),o.transform.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(o.transform.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=o.transform.uClampFrame,t.applyFilter(this,e,r,i))},e}(Vi),$i=function(e){function r(t){e.call(this,t),this.scissorRenderTarget=null,this.enableScissor=!1,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.setMaskStack=function(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)},r.prototype.push=function(e,r){if(!r.isMaskData){var i=this.maskDataPool.pop()||new mi;i.pooled=!0,i.maskObject=r,r=i}switch(r.autoDetect&&this.detect(r),r.copyCountersOrReset(this.maskStack[this.maskStack.length-1]),r._target=e,r.type){case t.MASK_TYPES.SCISSOR:this.maskStack.push(r),this.renderer.scissor.push(r);break;case t.MASK_TYPES.STENCIL:this.maskStack.push(r),this.renderer.stencil.push(r);break;case t.MASK_TYPES.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r),this.maskStack.push(r)}},r.prototype.pop=function(e){var r=this.maskStack.pop();if(r&&r._target===e){switch(r.type){case t.MASK_TYPES.SCISSOR:this.renderer.scissor.pop();break;case t.MASK_TYPES.STENCIL:this.renderer.stencil.pop(r.maskObject);break;case t.MASK_TYPES.SPRITE:this.popSpriteMask()}r.reset(),r.pooled&&this.maskDataPool.push(r)}},r.prototype.detect=function(e){var r=e.maskObject;if(r.isSprite)e.type=t.MASK_TYPES.SPRITE;else if(e.type=t.MASK_TYPES.STENCIL,this.enableScissor&&r.isFastRect&&r.isFastRect()){var i=r.worldTransform,n=Math.atan2(i.b,i.a),o=Math.atan2(i.d,i.c);n=Math.round(n*(180/Math.PI)*100),o=((o=Math.round(o*(180/Math.PI)*100)-n)%18e3+18e3)%18e3,0===(n=(n%9e3+9e3)%9e3)&&9e3===o&&(e.type=t.MASK_TYPES.SCISSOR)}},r.prototype.pushSpriteMask=function(t){var e=t.maskObject,r=t._target,i=this.alphaMaskPool[this.alphaMaskIndex];i||(i=this.alphaMaskPool[this.alphaMaskIndex]=[new Qi(e)]),i[0].resolution=this.renderer.resolution,i[0].maskSprite=e;var n=r.filterArea;r.filterArea=e.getBounds(!0),this.renderer.filter.push(r,i),r.filterArea=n,this.alphaMaskIndex++},r.prototype.popSpriteMask=function(){this.renderer.filter.pop(),this.alphaMaskIndex--},r}(Br),tn=function(t){function e(e){t.call(this,e),this.maskStack=[],this.glConst=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getStackLength=function(){return this.maskStack.length},e.prototype.setMaskStack=function(t){var e=this.renderer.gl,r=this.getStackLength();this.maskStack=t;var i=this.getStackLength();i!==r&&(0===i?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))},e.prototype._useCurrent=function(){},e.prototype.destroy=function(){t.prototype.destroy.call(this,this),this.maskStack=null},e}(Br),en=function(t){function e(e){t.call(this,e),this.glConst=WebGLRenderingContext.SCISSOR_TEST}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0},e.prototype.push=function(t){var e=t.maskObject;e.renderable=!0;var r=t._scissorRect,i=e.getBounds(!0),n=this.renderer.gl;e.renderable=!1,r?i.fit(r):n.enable(n.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=i,this._useCurrent()},e.prototype.pop=function(){var t=this.renderer.gl;this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)},e.prototype._useCurrent=function(){var t=this.maskStack[this.maskStack.length-1]._scissorRect,e=this.renderer.renderTexture.current,r=this.renderer.projection,i=r.transform,n=r.sourceFrame,o=r.destinationFrame,s=e?e.resolution:this.renderer.resolution,a=(t.x-n.x)*s+o.x,h=(t.y-n.y)*s+o.y,u=t.width*s,l=t.height*s;i&&(a+=i.tx*s,h+=i.ty*s),e||(h=this.renderer.height-l-h),this.renderer.gl.scissor(a,h,u,l)},e}(tn),rn=function(t){function e(e){t.call(this,e),this.glConst=WebGLRenderingContext.STENCIL_TEST}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0},e.prototype.push=function(t){var e=t.maskObject,r=this.renderer.gl,i=t._stencilCounter;0===i&&(this.renderer.framebuffer.forceStencil(),r.enable(r.STENCIL_TEST)),t._stencilCounter++,r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.EQUAL,i,this._getBitwiseMask()),r.stencilOp(r.KEEP,r.KEEP,r.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,this._useCurrent()},e.prototype.pop=function(t){var e=this.renderer.gl;0===this.getStackLength()?(e.disable(e.STENCIL_TEST),e.clear(e.STENCIL_BUFFER_BIT),e.clearStencil(0)):(e.colorMask(!1,!1,!1,!1),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,this._useCurrent())},e.prototype._useCurrent=function(){var t=this.renderer.gl;t.colorMask(!0,!0,!0,!0),t.stencilFunc(t.EQUAL,this.getStackLength(),this._getBitwiseMask()),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},e.prototype._getBitwiseMask=function(){return(1<<this.getStackLength())-1},e}(tn),nn=function(t){function e(e){t.call(this,e),this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Be,this.transform=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.update=function(t,e,r,i){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,i),this.transform&&this.projectionMatrix.append(this.transform);var n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)},e.prototype.calculateProjection=function(t,e,r,i){var n=this.projectionMatrix;i?(n.a=1/t.width*2*r,n.d=-1/t.height*2*r,n.tx=-1-e.x*n.a,n.ty=1-e.y*n.d):(n.a=1/t.width*2*r,n.d=1/t.height*2*r,n.tx=-1-e.x*n.a,n.ty=-1-e.y*n.d)},e.prototype.setTransform=function(){},e}(Br),on=new We,sn=function(t){function e(e){t.call(this,e),this.clearColor=e._backgroundColorRgba,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new We,this.destinationFrame=new We}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.bind=function(t,e,r){void 0===t&&(t=null),this.current=t;var i,n=this.renderer;if(t){var o=t.baseTexture;i=o.resolution,r||(on.width=o.realWidth,on.height=o.realHeight,r=on),e||(e=r),this.renderer.framebuffer.bind(o.framebuffer,r),this.renderer.projection.update(r,e,i,!1),this.renderer.mask.setMaskStack(o.maskStack)}else i=this.renderer.resolution,r||(on.width=n.width,on.height=n.height,r=on),e||(e=r),n.framebuffer.bind(null,r),this.renderer.projection.update(r,e,i,!0),this.renderer.mask.setMaskStack(this.defaultMaskStack);this.sourceFrame.copyFrom(e),this.destinationFrame.x=r.x/i,this.destinationFrame.y=r.y/i,this.destinationFrame.width=r.width/i,this.destinationFrame.height=r.height/i,e===r&&this.sourceFrame.copyFrom(this.destinationFrame)},e.prototype.clear=function(t){t=this.current?t||this.current.baseTexture.clearColor:t||this.clearColor,this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3])},e.prototype.resize=function(){this.bind(null)},e.prototype.reset=function(){this.bind(null)},e}(Br),an=function(t,e){this.program=t,this.uniformData=e,this.uniformGroups={}};an.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.program=null};var hn=0,un={textureCount:0},ln=function(t){function e(e){t.call(this,e),this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this.id=hn++}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.systemCheck=function(){if(!function(){if("boolean"==typeof Li)return Li;try{var t=new Function("param1","param2","param3","return param1[param2] === param3;");Li=!0===t({a:"b"},"a","b")}catch(t){Li=!1}return Li}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},e.prototype.contextChange=function(t){this.gl=t,this.reset()},e.prototype.bind=function(t,e){t.uniforms.globals=this.renderer.globalUniforms;var r=t.program,i=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateShader(t);return this.shader=t,this.program!==r&&(this.program=r,this.gl.useProgram(i.program)),e||(un.textureCount=0,this.syncUniformGroup(t.uniformGroup,un)),i},e.prototype.setUniforms=function(t){var e=this.shader.program,r=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(r.uniformData,t,this.renderer)},e.prototype.syncUniformGroup=function(t,e){var r=this.getglProgram();t.static&&t.dirtyId===r.uniformGroups[t.id]||(r.uniformGroups[t.id]=t.dirtyId,this.syncUniforms(t,r,e))},e.prototype.syncUniforms=function(t,e,r){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,r)},e.prototype.createSyncGroups=function(t){var e=this.getSignature(t,this.shader.program.uniformData);return this.cache[e]||(this.cache[e]=function(t,e){var r="var v = null;\n    var cv = null\n    var t = 0;\n    var gl = renderer.gl\n    ";for(var i in t.uniforms){var n=e[i];n?"float"===n.type&&1===n.size?r+="\n            if(uv."+i+" !== ud."+i+".value)\n            {\n                ud."+i+".value = uv."+i+"\n                gl.uniform1f(ud."+i+".location, uv."+i+")\n            }\n":"sampler2D"!==n.type&&"samplerCube"!==n.type&&"sampler2DArray"!==n.type||1!==n.size||n.isArray?"mat3"===n.type&&1===n.size?void 0!==t.uniforms[i].a?r+="\n                gl.uniformMatrix3fv(ud."+i+".location, false, uv."+i+".toArray(true));\n                \n":r+="\n                gl.uniformMatrix3fv(ud."+i+".location, false, uv."+i+");\n                \n":"vec2"===n.type&&1===n.size?void 0!==t.uniforms[i].x?r+="\n                cv = ud."+i+".value;\n                v = uv."+i+";\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud."+i+".location, v.x, v.y);\n                }\n":r+="\n                cv = ud."+i+".value;\n                v = uv."+i+";\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud."+i+".location, v[0], v[1]);\n                }\n                \n":"vec4"===n.type&&1===n.size?void 0!==t.uniforms[i].width?r+="\n                cv = ud."+i+".value;\n                v = uv."+i+";\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud."+i+".location, v.x, v.y, v.width, v.height)\n                }\n":r+="\n                cv = ud."+i+".value;\n                v = uv."+i+";\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud."+i+".location, v[0], v[1], v[2], v[3])\n                }\n                \n":r+="\n            cv = ud."+i+".value;\n            v = uv."+i+";\n            "+(1===n.size?Ci:Ri)[n.type].replace("location","ud."+i+".location")+";\n":r+="\n\n            t = syncData.textureCount++;\n\n            renderer.texture.bind(uv."+i+", t);\n            \n            if(ud."+i+".value !== t)\n            {\n                ud."+i+".value = t;\n                gl.uniform1i(ud."+i+".location, t);\n; // eslint-disable-line max-len\n            }\n":t.uniforms[i].group&&(r+="\n                    renderer.shader.syncUniformGroup(uv."+i+", syncData);\n                ")}return new Function("ud","uv","renderer","syncData",r)}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]},e.prototype.getSignature=function(t,e){var r=t.uniforms,i=[];for(var n in r)i.push(n),e[n]&&i.push(e[n].type);return i.join("-")},e.prototype.getglProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},e.prototype.generateShader=function(t){var e=this.gl,r=t.program,i={};for(var n in r.attributeData)i[n]=r.attributeData[n].location;var o=yi(e,r.vertexSrc,r.fragmentSrc,i),s={};for(var a in r.uniformData){var h=r.uniformData[a];s[a]={location:e.getUniformLocation(o,a),value:xi(h.type,h.size)}}var u=new an(o,s);return r.glPrograms[this.renderer.CONTEXT_UID]=u,u},e.prototype.reset=function(){this.program=null,this.shader=null},e.prototype.destroy=function(){this.destroyed=!0},e}(Br);var cn=0,dn=1,pn=2,fn=3,vn=4,gn=function(e){function r(r){e.call(this,r),this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=t.BLEND_MODES.NONE,this._blendEq=!1,this.map=[],this.map[cn]=this.setBlend,this.map[dn]=this.setOffset,this.map[pn]=this.setCullFace,this.map[fn]=this.setDepthTest,this.map[vn]=this.setFrontFace,this.checks=[],this.defaultState=new Yi,this.defaultState.blend=!0,this.defaultState.depth=!0}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.contextChange=function(e){this.gl=e,this.blendModes=function(e,r){return void 0===r&&(r=[]),r[t.BLEND_MODES.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.ADD]=[e.ONE,e.ONE],r[t.BLEND_MODES.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.NONE]=[0,0],r[t.BLEND_MODES.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],r[t.BLEND_MODES.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.SRC_IN]=[e.DST_ALPHA,e.ZERO],r[t.BLEND_MODES.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],r[t.BLEND_MODES.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],r[t.BLEND_MODES.DST_IN]=[e.ZERO,e.SRC_ALPHA],r[t.BLEND_MODES.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],r[t.BLEND_MODES.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],r}(e),this.set(this.defaultState),this.reset()},r.prototype.set=function(t){if(t=t||this.defaultState,this.stateId!==t.data){for(var e=this.stateId^t.data,r=0;e;)1&e&&this.map[r].call(this,!!(t.data&1<<r)),e>>=1,r++;this.stateId=t.data}for(var i=0;i<this.checks.length;i++)this.checks[i](this,t)},r.prototype.forceState=function(t){t=t||this.defaultState;for(var e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(var r=0;r<this.checks.length;r++)this.checks[r](this,t);this.stateId=t.data},r.prototype.setBlend=function(t){this.updateCheck(r.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)},r.prototype.setOffset=function(t){this.updateCheck(r.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},r.prototype.setDepthTest=function(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)},r.prototype.setCullFace=function(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)},r.prototype.setFrontFace=function(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])},r.prototype.setBlendMode=function(t){if(t!==this.blendMode){this.blendMode=t;var e=this.blendModes[t],r=this.gl;2===e.length?r.blendFunc(e[0],e[1]):r.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,r.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}},r.prototype.setPolygonOffset=function(t,e){this.gl.polygonOffset(t,e)},r.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(0),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},r.prototype.updateCheck=function(t,e){var r=this.checks.indexOf(t);e&&-1===r?this.checks.push(t):e||-1===r||this.checks.splice(r,1)},r.checkBlendMode=function(t,e){t.setBlendMode(e.blendMode)},r.checkPolygonOffset=function(t,e){t.setPolygonOffset(e.polygonOffset,0)},r}(Br),mn=function(e){function r(t){e.call(this,t),this.count=0,this.checkCount=0,this.maxIdle=C.GC_MAX_IDLE,this.checkCountMax=C.GC_MAX_CHECK_COUNT,this.mode=C.GC_MODE}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.postrender=function(){this.renderer.renderingToScreen&&(this.count++,this.mode!==t.GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},r.prototype.run=function(){for(var t=this.renderer.texture,e=t.managedTextures,r=!1,i=0;i<e.length;i++){var n=e[i];!n.framebuffer&&this.count-n.touched>this.maxIdle&&(t.destroyTexture(n,!0),e[i]=null,r=!0)}if(r){for(var o=0,s=0;s<e.length;s++)null!==e[s]&&(e[o++]=e[s]);e.length=o}},r.prototype.unload=function(t){var e=this.renderer.textureSystem;t._texture&&t._texture._glRenderTargets&&e.destroyTexture(t._texture);for(var r=t.children.length-1;r>=0;r--)this.unload(t.children[r])},r}(Br),yn=function(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=6408,this.internalFormat=5121},_n=function(e){function r(t){e.call(this,t),this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new Or}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion;var e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(var r=0;r<e;r++)this.boundTextures[r]=null;this.emptyTextures={};var i=new yn(t.createTexture());t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=i,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new yn(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(var n=0;n<6;n++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(var o=0;o<this.boundTextures.length;o++)this.bind(null,o)},r.prototype.bind=function(t,e){void 0===e&&(e=0);var r=this.gl;if(t){if((t=t.baseTexture||t).valid){t.touched=this.renderer.textureGC.count;var i=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(t.target,i.texture)),i.dirtyId!==t.dirtyId&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),this.updateTexture(t)),this.boundTextures[e]=t}}else this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[e]=null},r.prototype.reset=function(){this._unknownBoundTextures=!0,this.currentLocation=-1;for(var t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture},r.prototype.unbind=function(t){var e=this.gl,r=this.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var i=0;i<r.length;i++)r[i]===this.unknownTexture&&this.bind(null,i)}for(var n=0;n<r.length;n++)r[n]===t&&(this.currentLocation!==n&&(e.activeTexture(e.TEXTURE0+n),this.currentLocation=n),e.bindTexture(e.TEXTURE_2D,this.emptyTextures[t.target].texture),r[n]=null)},r.prototype.initTexture=function(t){var e=new yn(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e},r.prototype.initTextureType=function(e,r){if(r.internalFormat=e.format,r.type=e.type,2===this.webGLVersion){var i=this.renderer.gl;e.type===i.FLOAT&&e.format===i.RGBA&&(r.internalFormat=i.RGBA32F),e.type===t.TYPES.HALF_FLOAT&&(r.type=i.HALF_FLOAT),r.type===i.HALF_FLOAT&&e.format===i.RGBA&&(r.internalFormat=i.RGBA16F)}},r.prototype.updateTexture=function(t){var e=t._glTextures[this.CONTEXT_UID];if(e){var r=this.renderer;if(this.initTextureType(t,e),t.resource&&t.resource.upload(r,t,e));else{var i=t.realWidth,n=t.realHeight,o=r.gl;(e.width!==i||e.height!==n||e.dirtyId<0)&&(e.width=i,e.height=n,o.texImage2D(t.target,0,e.internalFormat,i,n,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}},r.prototype.destroyTexture=function(t,e){var r=this.gl;if((t=t.baseTexture||t)._glTextures[this.CONTEXT_UID]&&(this.unbind(t),r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){var i=this.managedTextures.indexOf(t);-1!==i&&ve(this.managedTextures,i,1)}},r.prototype.updateTextureStyle=function(e){var r=e._glTextures[this.CONTEXT_UID];r&&(e.mipmap!==t.MIPMAP_MODES.POW2&&2===this.webGLVersion||e.isPowerOfTwo?r.mipmap=e.mipmap>=1:r.mipmap=0,2===this.webGLVersion||e.isPowerOfTwo?r.wrapMode=e.wrapMode:r.wrapMode=t.WRAP_MODES.CLAMP,e.resource&&e.resource.style(this.renderer,e,r)||this.setStyle(e,r),r.dirtyStyleId=e.dirtyStyleId)},r.prototype.setStyle=function(e,r){var i=this.gl;if(r.mipmap&&i.generateMipmap(e.target),i.texParameteri(e.target,i.TEXTURE_WRAP_S,r.wrapMode),i.texParameteri(e.target,i.TEXTURE_WRAP_T,r.wrapMode),r.mipmap){i.texParameteri(e.target,i.TEXTURE_MIN_FILTER,e.scaleMode===t.SCALE_MODES.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);var n=this.renderer.context.extensions.anisotropicFiltering;if(n&&e.anisotropicLevel>0&&e.scaleMode===t.SCALE_MODES.LINEAR){var o=Math.min(e.anisotropicLevel,i.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(e.target,n.TEXTURE_MAX_ANISOTROPY_EXT,o)}}else i.texParameteri(e.target,i.TEXTURE_MIN_FILTER,e.scaleMode===t.SCALE_MODES.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(e.target,i.TEXTURE_MAG_FILTER,e.scaleMode===t.SCALE_MODES.LINEAR?i.LINEAR:i.NEAREST)},r}(Br),xn={FilterSystem:hi,BatchSystem:li,ContextSystem:di,FramebufferSystem:pi,GeometrySystem:gi,MaskSystem:$i,ScissorSystem:en,StencilSystem:rn,ProjectionSystem:nn,RenderTextureSystem:sn,ShaderSystem:ln,StateSystem:gn,TextureGCSystem:mn,TextureSystem:_n},bn=new Be,En=function(e){function r(r,i){e.call(this),(i=Object.assign({},C.RENDER_OPTIONS,i)).roundPixels&&(C.ROUND_PIXELS=i.roundPixels,xe("5.0.0","Renderer roundPixels option is deprecated, please use PIXI.settings.ROUND_PIXELS",2)),this.options=i,this.type=t.RENDERER_TYPE.UNKNOWN,this.screen=new We(0,0,i.width,i.height),this.view=i.view||document.createElement("canvas"),this.resolution=i.resolution||C.RESOLUTION,this.transparent=i.transparent,this.autoDensity=i.autoDensity||i.autoResize||!1,this.preserveDrawingBuffer=i.preserveDrawingBuffer,this.clearBeforeRender=i.clearBeforeRender,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,0],this._backgroundColorString="#000000",this.backgroundColor=i.backgroundColor||this._backgroundColor,this._tempDisplayObjectParent=new er,this._lastObjectRendered=this._tempDisplayObjectParent,this.plugins={}}e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r;var i={width:{configurable:!0},height:{configurable:!0},backgroundColor:{configurable:!0}};return r.prototype.initPlugins=function(t){for(var e in t)this.plugins[e]=new t[e](this)},i.width.get=function(){return this.view.width},i.height.get=function(){return this.view.height},r.prototype.resize=function(t,e){this.screen.width=t,this.screen.height=e,this.view.width=t*this.resolution,this.view.height=e*this.resolution,this.autoDensity&&(this.view.style.width=t+"px",this.view.style.height=e+"px")},r.prototype.generateTexture=function(t,e,r,i){0===(i=i||t.getLocalBounds()).width&&(i.width=1),0===i.height&&(i.height=1);var n=Vr.create({width:0|i.width,height:0|i.height,scaleMode:e,resolution:r});return bn.tx=-i.x,bn.ty=-i.y,this.render(t,n,!1,bn,!!t.parent),n},r.prototype.destroy=function(e){for(var r in this.plugins)this.plugins[r].destroy(),this.plugins[r]=null;e&&this.view.parentNode&&this.view.parentNode.removeChild(this.view),this.plugins=null,this.type=t.RENDERER_TYPE.UNKNOWN,this.view=null,this.screen=null,this.resolution=0,this.transparent=!1,this.autoDensity=!1,this.blendModes=null,this.options=null,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!1,this._backgroundColor=0,this._backgroundColorRgba=null,this._backgroundColorString=null,this._tempDisplayObjectParent=null,this._lastObjectRendered=null},i.backgroundColor.get=function(){return this._backgroundColor},i.backgroundColor.set=function(t){this._backgroundColor=t,this._backgroundColorString=ee(t),te(t,this._backgroundColorRgba)},Object.defineProperties(r.prototype,i),r}(R),Tn=function(e){function r(i){void 0===i&&(i={}),e.call(this,"WebGL",i),i=this.options,this.type=t.RENDERER_TYPE.WEBGL,this.gl=null,this.CONTEXT_UID=0,this.runners={destroy:new xr("destroy"),contextChange:new xr("contextChange",1),reset:new xr("reset"),update:new xr("update"),postrender:new xr("postrender"),prerender:new xr("prerender"),resize:new xr("resize",2)},this.globalUniforms=new si({projectionMatrix:new Be},!0),this.addSystem($i,"mask").addSystem(di,"context").addSystem(gn,"state").addSystem(ln,"shader").addSystem(_n,"texture").addSystem(gi,"geometry").addSystem(pi,"framebuffer").addSystem(en,"scissor").addSystem(rn,"stencil").addSystem(nn,"projection").addSystem(mn,"textureGC").addSystem(hi,"filter").addSystem(sn,"renderTexture").addSystem(li,"batch"),this.initPlugins(r.__plugins),i.context?this.context.initFromContext(i.context):this.context.initFromOptions({alpha:this.transparent,antialias:i.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:i.preserveDrawingBuffer,powerPreference:this.options.powerPreference}),this.renderingToScreen=!0,Qt(2===this.context.webGLVersion?"WebGL 2":"WebGL 1"),this.resize(this.options.width,this.options.height)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.create=function(t){if($t())return new r(t);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},r.prototype.addSystem=function(t,e){e||(e=t.name);var r=new t(this);if(this[e])throw new Error('Whoops! The name "'+e+'" is already in use');for(var i in this[e]=r,this.runners)this.runners[i].add(r);return this},r.prototype.render=function(t,e,r,i,n){if(this.renderingToScreen=!e,this.runners.prerender.run(),this.emit("prerender"),this.projection.transform=i,!this.context.isLost){if(e||(this._lastObjectRendered=t),!n){var o=t.parent;t.parent=this._tempDisplayObjectParent,t.updateTransform(),t.parent=o}this.renderTexture.bind(e),this.batch.currentRenderer.start(),(void 0!==r?r:this.clearBeforeRender)&&this.renderTexture.clear(),t.render(this),this.batch.currentRenderer.flush(),e&&e.baseTexture.update(),this.runners.postrender.run(),this.projection.transform=null,this.emit("postrender")}},r.prototype.resize=function(t,r){e.prototype.resize.call(this,t,r),this.runners.resize.run(t,r)},r.prototype.reset=function(){return this.runners.reset.run(),this},r.prototype.clear=function(){this.framebuffer.bind(),this.framebuffer.clear()},r.prototype.destroy=function(t){for(var r in this.runners.destroy.run(),this.runners)this.runners[r].destroy();e.prototype.destroy.call(this,t),this.gl=null},r.registerPlugin=function(t,e){r.__plugins=r.__plugins||{},r.__plugins[t]=e},r}(En);function Sn(t){return Tn.create(t)}var wn="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",Pn="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",In=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.from=function(t,r){return new e(new Cr(t,r))},e}(Or),An=function(){this.texArray=null,this.blend=0,this.type=t.DRAW_MODES.TRIANGLES,this.start=0,this.size=0,this.data=null},On=function(){this.elements=[],this.ids=[],this.count=0};On.prototype.clear=function(){for(var t=0;t<this.count;t++)this.elements[t]=null;this.count=0};var Dn=function(t){this.rawBinaryData=new ArrayBuffer(t),this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)},Mn={int8View:{configurable:!0},uint8View:{configurable:!0},int16View:{configurable:!0},uint16View:{configurable:!0},int32View:{configurable:!0}};Mn.int8View.get=function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},Mn.uint8View.get=function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},Mn.int16View.get=function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},Mn.uint16View.get=function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},Mn.int32View.get=function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},Dn.prototype.view=function(t){return this[t+"View"]},Dn.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},Dn.sizeOf=function(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(t+" isn't a valid view type")}},Object.defineProperties(Dn.prototype,Mn);var Cn=function(e){function r(t){e.call(this,t),this.shaderGenerator=null,this.geometryClass=null,this.vertexSize=null,this.state=Yi.for2d(),this.size=4*C.SPRITE_BATCH_SIZE,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.MAX_TEXTURES=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.contextChange=function(){var e=this.renderer.gl;C.PREFER_ENV===t.ENV.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),C.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=Fi(this.MAX_TEXTURES,e)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var r=0;r<this._packedGeometryPoolSize;r++)this._packedGeometries[r]=new this.geometryClass;this.initFlushBuffers()},r.prototype.initFlushBuffers=function(){for(var t=r._drawCallPool,e=r._textureArrayPool,i=this.size/4,n=Math.floor(i/this.MAX_TEXTURES)+1;t.length<i;)t.push(new An);for(;e.length<n;)e.push(new On);for(var o=0;o<this.MAX_TEXTURES;o++)this._tempBoundTextures[o]=null},r.prototype.onPrerender=function(){this._flushId=0},r.prototype.render=function(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)},r.prototype.buildTexturesAndDrawCalls=function(){var t=this._bufferedTextures,e=this.MAX_TEXTURES,i=r._textureArrayPool,n=this.renderer.batch,o=this._tempBoundTextures,s=this.renderer.textureGC.count,a=++Or._globalBatch,h=0,u=i[0],l=0;n.copyBoundTextures(o,e);for(var c=0;c<this._bufferSize;++c){var d=t[c];t[c]=null,d._batchEnabled!==a&&(u.count>=e&&(n.boundArray(u,o,a,e),this.buildDrawCalls(u,l,c),l=c,u=i[++h],++a),d._batchEnabled=a,d.touched=s,u.elements[u.count++]=d)}u.count>0&&(n.boundArray(u,o,a,e),this.buildDrawCalls(u,l,this._bufferSize),++h,++a);for(var p=0;p<o.length;p++)o[p]=null;Or._globalBatch=a},r.prototype.buildDrawCalls=function(t,e,i){var n=this._bufferedElements,o=this._attributeBuffer,s=this._indexBuffer,a=this.vertexSize,h=r._drawCallPool,u=this._dcIndex,l=this._aIndex,c=this._iIndex,d=h[u];d.start=this._iIndex,d.texArray=t;for(var p=e;p<i;++p){var f=n[p],v=f._texture.baseTexture,g=ne[v.alphaMode?1:0][f.blendMode];n[p]=null,e<p&&d.blend!==g&&(d.size=c-d.start,e=p,(d=h[++u]).texArray=t,d.start=c),this.packInterleavedGeometry(f,o,s,l,c),l+=f.vertexData.length/2*a,c+=f.indices.length,d.blend=g}e<i&&(d.size=c-d.start,++u),this._dcIndex=u,this._aIndex=l,this._iIndex=c},r.prototype.bindAndClearTexArray=function(t){for(var e=this.renderer.texture,r=0;r<t.count;r++)e.bind(t.elements[r],t.ids[r]),t.elements[r]=null;t.count=0},r.prototype.updateGeometry=function(){var t=this._packedGeometries,e=this._attributeBuffer,r=this._indexBuffer;C.CAN_UPLOAD_SAME_BUFFER?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},r.prototype.drawBatches=function(){for(var t=this._dcIndex,e=this.renderer,i=e.gl,n=e.state,o=r._drawCallPool,s=null,a=0;a<t;a++){var h=o[a],u=h.texArray,l=h.type,c=h.size,d=h.start,p=h.blend;s!==u&&(s=u,this.bindAndClearTexArray(u)),this.state.blendMode=p,n.set(this.state),i.drawElements(l,c,i.UNSIGNED_SHORT,2*d)}},r.prototype.flush=function(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},r.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.shader.bind(this._shader),C.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},r.prototype.stop=function(){this.flush()},r.prototype.destroy=function(){for(var t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),e.prototype.destroy.call(this)},r.prototype.getAttributeBuffer=function(t){var e=de(Math.ceil(t/8)),r=fe(e),i=8*e;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);var n=this._aBuffers[i];return n||(this._aBuffers[i]=n=new Dn(i*this.vertexSize*4)),n},r.prototype.getIndexBuffer=function(t){var e=de(Math.ceil(t/12)),r=fe(e),i=12*e;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);var n=this._iBuffers[r];return n||(this._iBuffers[r]=n=new Uint16Array(i)),n},r.prototype.packInterleavedGeometry=function(t,e,r,i,n){for(var o=e.uint32View,s=e.float32View,a=i/this.vertexSize,h=t.uvs,u=t.indices,l=t.vertexData,c=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),p=d<1&&t._texture.baseTexture.alphaMode?ae(t._tintRGB,d):t._tintRGB+(255*d<<24),f=0;f<l.length;f+=2)s[i++]=l[f],s[i++]=l[f+1],s[i++]=h[f],s[i++]=h[f+1],o[i++]=p,s[i++]=c;for(var v=0;v<u.length;v++)r[n++]=a+u[v]},r}(ui);Cn._drawCallPool=[],Cn._textureArrayPool=[];var Rn=function(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},e.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(e.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')};Rn.prototype.generateShader=function(t){if(!this.programCache[t]){for(var e=new Int32Array(t),r=0;r<t;r++)e[r]=r;this.defaultGroupCache[t]=si.from({uSamplers:e},!0);var i=this.fragTemplate;i=(i=i.replace(/%count%/gi,""+t)).replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Xi(this.vertexSrc,i)}var n={tint:new Float32Array([1,1,1,1]),translationMatrix:new Be,default:this.defaultGroupCache[t]};return new Hi(this.programCache[t],n)},Rn.prototype.generateSampleSrc=function(t){var e="";e+="\n",e+="\n";for(var r=0;r<t;r++)r>0&&(e+="\nelse "),r<t-1&&(e+="if(vTextureId < "+r+".5)"),e+="\n{",e+="\n\tcolor = texture2D(uSamplers["+r+"], vTextureCoord);",e+="\n}";return e+="\n",e+="\n"};var Ln=function(e){function r(r){void 0===r&&(r=!1),e.call(this),this._buffer=new Zr(null,r,!1),this._indexBuffer=new Zr(null,r,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,t.TYPES.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,t.TYPES.FLOAT).addAttribute("aColor",this._buffer,4,!0,t.TYPES.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,t.TYPES.FLOAT).addIndex(this._indexBuffer)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r}(ri),Nn="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n",Fn="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n",Bn=function(){},Un={defaultVertexSrc:{configurable:!0},defaultFragmentTemplate:{configurable:!0}};Bn.create=function(t){var e=Object.assign({vertex:Nn,fragment:Fn,geometryClass:Ln,vertexSize:6},t),r=e.vertex,i=e.fragment,n=e.vertexSize,o=e.geometryClass;return function(t){function e(e){t.call(this,e),this.shaderGenerator=new Rn(r,i),this.geometryClass=o,this.vertexSize=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Cn)},Un.defaultVertexSrc.get=function(){return Nn},Un.defaultFragmentTemplate.get=function(){return Fn},Object.defineProperties(Bn,Un);var kn=Bn.create(),Xn=function t(e){var r=this;e=Object.assign({forceCanvas:!1},e),this.renderer=Sn(e),this.stage=new er,t._plugins.forEach(function(t){t.init.call(r,e)})},jn={view:{configurable:!0},screen:{configurable:!0}};Xn.registerPlugin=function(t){Xn._plugins.push(t)},Xn.prototype.render=function(){this.renderer.render(this.stage)},jn.view.get=function(){return this.renderer.view},jn.screen.get=function(){return this.renderer.screen},Xn.prototype.destroy=function(t,e){var r=this,i=Xn._plugins.slice(0);i.reverse(),i.forEach(function(t){t.destroy.call(r)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null,this._options=null},Object.defineProperties(Xn.prototype,jn),Xn._plugins=[];var Hn=function(){};Hn.init=function(t){var e=this;Object.defineProperty(this,"resizeTo",{set:function(t){window.removeEventListener("resize",this.resize),this._resizeTo=t,t&&(window.addEventListener("resize",this.resize),this.resize())},get:function(){return this._resizeTo}}),this.resize=function(){e._resizeTo&&(e._resizeTo===window?e.renderer.resize(window.innerWidth,window.innerHeight):e.renderer.resize(e._resizeTo.clientWidth,e._resizeTo.clientHeight))},this._resizeTo=null,this.resizeTo=t.resizeTo||null},Hn.destroy=function(){this.resizeTo=null,this.resize=null},Xn.registerPlugin(Hn);var Gn=new We,Yn=function(t){this.renderer=t,t.extract=this};Yn.prototype.image=function(t,e,r){var i=new Image;return i.src=this.base64(t,e,r),i},Yn.prototype.base64=function(t,e,r){return this.canvas(t).toDataURL(e,r)},Yn.prototype.canvas=function(t){var e,r,i,n=this.renderer,o=!1,s=!1;t&&(t instanceof Vr?i=t:(i=this.renderer.generateTexture(t),s=!0)),i?(e=i.baseTexture.resolution,r=i.frame,o=!1,n.renderTexture.bind(i)):(e=this.renderer.resolution,o=!0,(r=Gn).width=this.renderer.width,r.height=this.renderer.height,n.renderTexture.bind(null));var a=Math.floor(r.width*e+1e-4),h=Math.floor(r.height*e+1e-4),u=new Se(a,h,1),l=new Uint8Array(4*a*h),c=n.gl;c.readPixels(r.x*e,r.y*e,a,h,c.RGBA,c.UNSIGNED_BYTE,l);var d=u.context.getImageData(0,0,a,h);if(Yn.arrayPostDivide(l,d.data),u.context.putImageData(d,0,0),o){var p=new Se(u.width,u.height,1);p.context.scale(1,-1),p.context.drawImage(u.canvas,0,-h),u.destroy(),u=p}return s&&i.destroy(!0),u.canvas},Yn.prototype.pixels=function(t){var e,r,i,n=this.renderer,o=!1;t&&(t instanceof Vr?i=t:(i=this.renderer.generateTexture(t),o=!0)),i?(e=i.baseTexture.resolution,r=i.frame,n.renderTexture.bind(i)):(e=n.resolution,(r=Gn).width=n.width,r.height=n.height,n.renderTexture.bind(null));var s=r.width*e,a=r.height*e,h=new Uint8Array(4*s*a),u=n.gl;return u.readPixels(r.x*e,r.y*e,s,a,u.RGBA,u.UNSIGNED_BYTE,h),o&&i.destroy(!0),Yn.arrayPostDivide(h,h),h},Yn.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null},Yn.arrayPostDivide=function(t,e){for(var r=0;r<t.length;r+=4){var i=e[r+3]=t[r+3];0!==i?(e[r]=Math.round(Math.min(255*t[r]/i,255)),e[r+1]=Math.round(Math.min(255*t[r+1]/i,255)),e[r+2]=Math.round(Math.min(255*t[r+2]/i,255))):(e[r]=t[r],e[r+1]=t[r+1],e[r+2]=t[r+2])}};var zn=function(t,e){e=e||{};for(var r={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},i=r.parser[e.strictMode?"strict":"loose"].exec(t),n={},o=14;o--;)n[r.key[o]]=i[o]||"";return n[r.q.name]={},n[r.key[12]].replace(r.q.parser,function(t,e,i){e&&(n[r.q.name][e]=i)}),n},Vn=function(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}(r(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}();function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=function(){function t(e,r,n){void 0===r&&(r=!1),i(this,t),this._fn=e,this._once=r,this._thisArg=n,this._next=this._prev=this._owner=null}return r(t,[{key:"detach",value:function(){return null!==this._owner&&(this._owner.detach(this),!0)}}]),t}();function o(t,e){return t._head?(t._tail._next=e,e._prev=t._tail,t._tail=e):(t._head=e,t._tail=e),e._owner=t,e}var s=function(){function t(){i(this,t),this._head=this._tail=void 0}return r(t,[{key:"handlers",value:function(){var t=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],e=this._head;if(t)return!!e;for(var r=[];e;)r.push(e),e=e._next;return r}},{key:"has",value:function(t){if(!(t instanceof n))throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.");return t._owner===this}},{key:"dispatch",value:function(){var t=arguments,e=this._head;if(!e)return!1;for(;e;)e._once&&this.detach(e),e._fn.apply(e._thisArg,t),e=e._next;return!0}},{key:"add",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#add(): First arg must be a Function.");return o(this,new n(t,!1,e))}},{key:"once",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#once(): First arg must be a Function.");return o(this,new n(t,!0,e))}},{key:"detach",value:function(t){if(!(t instanceof n))throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.");return t._owner!==this?this:(t._prev&&(t._prev._next=t._next),t._next&&(t._next._prev=t._prev),t===this._head?(this._head=t._next,null===t._next&&(this._tail=null)):t===this._tail&&(this._tail=t._prev,this._tail._next=null),t._owner=null,this)}},{key:"detachAll",value:function(){var t=this._head;if(!t)return this;for(this._head=this._tail=null;t;)t._owner=null,t=t._next;return this}}]),t}();s.MiniSignalBinding=n,e.default=s,t.exports=e.default}));function Wn(){}function qn(t,e,r,i){var n=0,o=t.length;!function s(a){a||n===o?r&&r(a):i?setTimeout(function(){e(t[n++],s)},1):e(t[n++],s)}()}function Kn(t){return function(){if(null===t)throw new Error("Callback was already called.");var e=t;t=null,e.apply(this,arguments)}}function Zn(t,e){if(null==e)e=1;else if(0===e)throw new Error("Concurrency must not be zero");var r=0,i={_tasks:[],concurrency:e,saturated:Wn,unsaturated:Wn,buffer:e/4,empty:Wn,drain:Wn,error:Wn,started:!1,paused:!1,push:function(t,e){n(t,!1,e)},kill:function(){r=0,i.drain=Wn,i.started=!1,i._tasks=[]},unshift:function(t,e){n(t,!0,e)},process:function(){for(;!i.paused&&r<i.concurrency&&i._tasks.length;){var e=i._tasks.shift();0===i._tasks.length&&i.empty(),(r+=1)===i.concurrency&&i.saturated(),t(e.data,Kn(o(e)))}},length:function(){return i._tasks.length},running:function(){return r},idle:function(){return i._tasks.length+r===0},pause:function(){!0!==i.paused&&(i.paused=!0)},resume:function(){if(!1!==i.paused){i.paused=!1;for(var t=1;t<=i.concurrency;t++)i.process()}}};function n(t,e,r){if(null!=r&&"function"!=typeof r)throw new Error("task callback must be a function");if(i.started=!0,null==t&&i.idle())setTimeout(function(){return i.drain()},1);else{var n={data:t,callback:"function"==typeof r?r:Wn};e?i._tasks.unshift(n):i._tasks.push(n),setTimeout(function(){return i.process()},1)}}function o(t){return function(){r-=1,t.callback.apply(t,arguments),null!=arguments[0]&&i.error(arguments[0],t.data),r<=i.concurrency-i.buffer&&i.unsaturated(),i.idle()&&i.drain(),i.process()}}return i}var Jn={};function Qn(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function $n(t,e,r){return e&&Qn(t.prototype,e),r&&Qn(t,r),t}var to=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),eo=null;function ro(){}var io=function(){function t(e,r,i){if("string"!=typeof e||"string"!=typeof r)throw new Error("Both name and url are required for constructing a resource.");i=i||{},this._flags=0,this._setFlag(t.STATUS_FLAGS.DATA_URL,0===r.indexOf("data:")),this.name=e,this.url=r,this.extension=this._getExtension(),this.data=null,this.crossOrigin=!0===i.crossOrigin?"anonymous":i.crossOrigin,this.timeout=i.timeout||0,this.loadType=i.loadType||this._determineLoadType(),this.xhrType=i.xhrType,this.metadata=i.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=t.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=ro,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new Vn,this.onProgress=new Vn,this.onComplete=new Vn,this.onAfterMiddleware=new Vn}t.setExtensionLoadType=function(e,r){no(t._loadTypeMap,e,r)},t.setExtensionXhrType=function(e,r){no(t._xhrTypeMap,e,r)};var e=t.prototype;return e.complete=function(){this._clearEvents(),this._finish()},e.abort=function(e){if(!this.error){if(this.error=new Error(e),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=t.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},e.load=function(e){var r=this;if(!this.isLoading)if(this.isComplete)e&&setTimeout(function(){return e(r)},1);else switch(e&&this.onComplete.once(e),this._setFlag(t.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),!1!==this.crossOrigin&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case t.LOAD_TYPE.IMAGE:this.type=t.TYPE.IMAGE,this._loadElement("image");break;case t.LOAD_TYPE.AUDIO:this.type=t.TYPE.AUDIO,this._loadSourceElement("audio");break;case t.LOAD_TYPE.VIDEO:this.type=t.TYPE.VIDEO,this._loadSourceElement("video");break;case t.LOAD_TYPE.XHR:default:to&&this.crossOrigin?this._loadXdr():this._loadXhr()}},e._hasFlag=function(t){return 0!=(this._flags&t)},e._setFlag=function(t,e){this._flags=e?this._flags|t:this._flags&~t},e._clearEvents=function(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},e._finish=function(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(t.STATUS_FLAGS.COMPLETE,!0),this._setFlag(t.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},e._loadElement=function(t){this.metadata.loadElement?this.data=this.metadata.loadElement:"image"===t&&void 0!==window.Image?this.data=new Image:this.data=document.createElement(t),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},e._loadSourceElement=function(t){if(this.metadata.loadElement?this.data=this.metadata.loadElement:"audio"===t&&void 0!==window.Audio?this.data=new Audio:this.data=document.createElement(t),null!==this.data){if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var e=this.metadata.mimeType,r=0;r<this.url.length;++r)this.data.appendChild(this._createSource(t,this.url[r],Array.isArray(e)?e[r]:e));else{var i=this.metadata.mimeType;this.data.appendChild(this._createSource(t,this.url,Array.isArray(i)?i[0]:i))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))}else this.abort("Unsupported element: "+t)},e._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XMLHttpRequest;e.open("GET",this.url,!0),e.timeout=this.timeout,this.xhrType===t.XHR_RESPONSE_TYPE.JSON||this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT?e.responseType=t.XHR_RESPONSE_TYPE.TEXT:e.responseType=this.xhrType,e.addEventListener("error",this._boundXhrOnError,!1),e.addEventListener("timeout",this._boundXhrOnTimeout,!1),e.addEventListener("abort",this._boundXhrOnAbort,!1),e.addEventListener("progress",this._boundOnProgress,!1),e.addEventListener("load",this._boundXhrOnLoad,!1),e.send()},e._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XDomainRequest;t.timeout=this.timeout||5e3,t.onerror=this._boundXhrOnError,t.ontimeout=this._boundXhrOnTimeout,t.onprogress=this._boundOnProgress,t.onload=this._boundXhrOnLoad,t.open("GET",this.url,!0),setTimeout(function(){return t.send()},1)},e._createSource=function(t,e,r){r||(r=t+"/"+this._getExtension(e));var i=document.createElement("source");return i.src=e,i.type=r,i},e._onError=function(t){this.abort("Failed to load element using: "+t.target.nodeName)},e._onProgress=function(t){t&&t.lengthComputable&&this.onProgress.dispatch(this,t.loaded/t.total)},e._onTimeout=function(){this.abort("Load timed out.")},e._xhrOnError=function(){var t=this.xhr;this.abort(oo(t)+" Request failed. Status: "+t.status+', text: "'+t.statusText+'"')},e._xhrOnTimeout=function(){var t=this.xhr;this.abort(oo(t)+" Request timed out.")},e._xhrOnAbort=function(){var t=this.xhr;this.abort(oo(t)+" Request was aborted by the user.")},e._xhrOnLoad=function(){var e=this.xhr,r="",i=void 0===e.status?200:e.status;if(""!==e.responseType&&"text"!==e.responseType&&void 0!==e.responseType||(r=e.responseText),0===i&&(r.length>0||e.responseType===t.XHR_RESPONSE_TYPE.BUFFER)?i=200:1223===i&&(i=204),2===(i/100|0)){if(this.xhrType===t.XHR_RESPONSE_TYPE.TEXT)this.data=r,this.type=t.TYPE.TEXT;else if(this.xhrType===t.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(r),this.type=t.TYPE.JSON}catch(t){return void this.abort("Error trying to parse loaded json: "+t)}else if(this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var n=new DOMParser;this.data=n.parseFromString(r,"text/xml")}else{var o=document.createElement("div");o.innerHTML=r,this.data=o}this.type=t.TYPE.XML}catch(t){return void this.abort("Error trying to parse loaded xml: "+t)}else this.data=e.response||r;this.complete()}else this.abort("["+e.status+"] "+e.statusText+": "+e.responseURL)},e._determineCrossOrigin=function(t,e){if(0===t.indexOf("data:"))return"";if(window.origin!==window.location.origin)return"anonymous";e=e||window.location,eo||(eo=document.createElement("a")),eo.href=t;var r=!(t=zn(eo.href,{strictMode:!0})).port&&""===e.port||t.port===e.port,i=t.protocol?t.protocol+":":"";return t.host===e.hostname&&r&&i===e.protocol?"":"anonymous"},e._determineXhrType=function(){return t._xhrTypeMap[this.extension]||t.XHR_RESPONSE_TYPE.TEXT},e._determineLoadType=function(){return t._loadTypeMap[this.extension]||t.LOAD_TYPE.XHR},e._getExtension=function(){var t=this.url,e="";if(this.isDataUrl){var r=t.indexOf("/");e=t.substring(r+1,t.indexOf(";",r))}else{var i=t.indexOf("?"),n=t.indexOf("#"),o=Math.min(i>-1?i:t.length,n>-1?n:t.length);e=(t=t.substring(0,o)).substring(t.lastIndexOf(".")+1)}return e.toLowerCase()},e._getMimeFromXhrType=function(e){switch(e){case t.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case t.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case t.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case t.XHR_RESPONSE_TYPE.JSON:return"application/json";case t.XHR_RESPONSE_TYPE.DEFAULT:case t.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},$n(t,[{key:"isDataUrl",get:function(){return this._hasFlag(t.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function(){return this._hasFlag(t.STATUS_FLAGS.COMPLETE)}},{key:"isLoading",get:function(){return this._hasFlag(t.STATUS_FLAGS.LOADING)}}]),t}();function no(t,e,r){e&&0===e.indexOf(".")&&(e=e.substring(1)),e&&(t[e]=r)}function oo(t){return t.toString().replace("object ","")}io.STATUS_FLAGS={NONE:0,DATA_URL:1,COMPLETE:2,LOADING:4},io.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6},io.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4},io.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"},io._loadTypeMap={gif:io.LOAD_TYPE.IMAGE,png:io.LOAD_TYPE.IMAGE,bmp:io.LOAD_TYPE.IMAGE,jpg:io.LOAD_TYPE.IMAGE,jpeg:io.LOAD_TYPE.IMAGE,tif:io.LOAD_TYPE.IMAGE,tiff:io.LOAD_TYPE.IMAGE,webp:io.LOAD_TYPE.IMAGE,tga:io.LOAD_TYPE.IMAGE,svg:io.LOAD_TYPE.IMAGE,"svg+xml":io.LOAD_TYPE.IMAGE,mp3:io.LOAD_TYPE.AUDIO,ogg:io.LOAD_TYPE.AUDIO,wav:io.LOAD_TYPE.AUDIO,mp4:io.LOAD_TYPE.VIDEO,webm:io.LOAD_TYPE.VIDEO},io._xhrTypeMap={xhtml:io.XHR_RESPONSE_TYPE.DOCUMENT,html:io.XHR_RESPONSE_TYPE.DOCUMENT,htm:io.XHR_RESPONSE_TYPE.DOCUMENT,xml:io.XHR_RESPONSE_TYPE.DOCUMENT,tmx:io.XHR_RESPONSE_TYPE.DOCUMENT,svg:io.XHR_RESPONSE_TYPE.DOCUMENT,tsx:io.XHR_RESPONSE_TYPE.DOCUMENT,gif:io.XHR_RESPONSE_TYPE.BLOB,png:io.XHR_RESPONSE_TYPE.BLOB,bmp:io.XHR_RESPONSE_TYPE.BLOB,jpg:io.XHR_RESPONSE_TYPE.BLOB,jpeg:io.XHR_RESPONSE_TYPE.BLOB,tif:io.XHR_RESPONSE_TYPE.BLOB,tiff:io.XHR_RESPONSE_TYPE.BLOB,webp:io.XHR_RESPONSE_TYPE.BLOB,tga:io.XHR_RESPONSE_TYPE.BLOB,json:io.XHR_RESPONSE_TYPE.JSON,text:io.XHR_RESPONSE_TYPE.TEXT,txt:io.XHR_RESPONSE_TYPE.TEXT,ttf:io.XHR_RESPONSE_TYPE.BUFFER,otf:io.XHR_RESPONSE_TYPE.BUFFER},io.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";var so="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var ao=window.URL||window.webkitURL;var ho={caching:function(t,e){var r=this;Jn[t.url]?(t.data=Jn[t.url],t.complete()):t.onComplete.once(function(){return Jn[r.url]=r.data}),e()},parsing:function(t,e){if(t.data){if(t.xhr&&t.xhrType===io.XHR_RESPONSE_TYPE.BLOB)if(window.Blob&&"string"!=typeof t.data){if(0===t.data.type.indexOf("image")){var r=ao.createObjectURL(t.data);return t.blob=t.data,t.data=new Image,t.data.src=r,t.type=io.TYPE.IMAGE,void(t.data.onload=function(){ao.revokeObjectURL(r),t.data.onload=null,e()})}}else{var i=t.xhr.getResponseHeader("content-type");if(i&&0===i.indexOf("image"))return t.data=new Image,t.data.src="data:"+i+";base64,"+function(t){for(var e="",r=0;r<t.length;){for(var i=[0,0,0],n=[0,0,0,0],o=0;o<i.length;++o)r<t.length?i[o]=255&t.charCodeAt(r++):i[o]=0;switch(n[0]=i[0]>>2,n[1]=(3&i[0])<<4|i[1]>>4,n[2]=(15&i[1])<<2|i[2]>>6,n[3]=63&i[2],r-(t.length-1)){case 2:n[3]=64,n[2]=64;break;case 1:n[3]=64}for(var s=0;s<n.length;++s)e+=so.charAt(n[s])}return e}(t.xhr.responseText),t.type=io.TYPE.IMAGE,void(t.data.onload=function(){t.data.onload=null,e()})}e()}else e()}},uo=/(#[\w-]+)?$/,lo=function(){function t(e,r){var i=this;void 0===e&&(e=""),void 0===r&&(r=10),this.baseUrl=e,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(t,e){return i._loadResource(t,e)},this._queue=Zn(this._boundLoadResource,r),this._queue.pause(),this.resources={},this.onProgress=new Vn,this.onError=new Vn,this.onLoad=new Vn,this.onStart=new Vn,this.onComplete=new Vn;for(var n=0;n<t._defaultBeforeMiddleware.length;++n)this.pre(t._defaultBeforeMiddleware[n]);for(var o=0;o<t._defaultAfterMiddleware.length;++o)this.use(t._defaultAfterMiddleware[o])}var e=t.prototype;return e.add=function(t,e,r,i){if(Array.isArray(t)){for(var n=0;n<t.length;++n)this.add(t[n]);return this}if("object"==typeof t&&(i=e||t.callback||t.onComplete,r=t,e=t.url,t=t.name||t.key||t.url),"string"!=typeof e&&(i=r,r=e,e=t),"string"!=typeof e)throw new Error("No url passed to add resource to loader.");if("function"==typeof r&&(i=r,r=null),this.loading&&(!r||!r.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[t])throw new Error('Resource named "'+t+'" already exists.');if(e=this._prepareUrl(e),this.resources[t]=new io(t,e,r),"function"==typeof i&&this.resources[t].onAfterMiddleware.once(i),this.loading){for(var o=r.parentResource,s=[],a=0;a<o.children.length;++a)o.children[a].isComplete||s.push(o.children[a]);var h=o.progressChunk*(s.length+1)/(s.length+2);o.children.push(this.resources[t]),o.progressChunk=h;for(var u=0;u<s.length;++u)s[u].progressChunk=h;this.resources[t].progressChunk=h}return this._queue.push(this.resources[t]),this},e.pre=function(t){return this._beforeMiddleware.push(t),this},e.use=function(t){return this._afterMiddleware.push(t),this},e.reset=function(){for(var t in this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause(),this.resources){var e=this.resources[t];e._onLoadBinding&&e._onLoadBinding.detach(),e.isLoading&&e.abort()}return this.resources={},this},e.load=function(t){if("function"==typeof t&&this.onComplete.once(t),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var e=100/this._queue._tasks.length,r=0;r<this._queue._tasks.length;++r)this._queue._tasks[r].data.progressChunk=e;this._onStart(),this._queue.resume()}return this},e._prepareUrl=function(t){var e,r=zn(t,{strictMode:!0});if(e=r.protocol||!r.path||0===t.indexOf("//")?t:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==t.charAt(0)?this.baseUrl+"/"+t:this.baseUrl+t,this.defaultQueryString){var i=uo.exec(e)[0];-1!==(e=e.substr(0,e.length-i.length)).indexOf("?")?e+="&"+this.defaultQueryString:e+="?"+this.defaultQueryString,e+=i}return e},e._loadResource=function(t,e){var r=this;t._dequeue=e,qn(this._beforeMiddleware,function(e,i){e.call(r,t,function(){i(t.isComplete?{}:null)})},function(){t.isComplete?r._onLoad(t):(t._onLoadBinding=t.onComplete.once(r._onLoad,r),t.load())},!0)},e._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},e._onComplete=function(){this.progress=100,this.loading=!1,this.onComplete.dispatch(this,this.resources)},e._onLoad=function(t){var e=this;t._onLoadBinding=null,this._resourcesParsing.push(t),t._dequeue(),qn(this._afterMiddleware,function(r,i){r.call(e,t,i)},function(){t.onAfterMiddleware.dispatch(t),e.progress=Math.min(100,e.progress+t.progressChunk),e.onProgress.dispatch(e,t),t.error?e.onError.dispatch(t.error,e,t):e.onLoad.dispatch(e,t),e._resourcesParsing.splice(e._resourcesParsing.indexOf(t),1),e._queue.idle()&&0===e._resourcesParsing.length&&e._onComplete()},!0)},$n(t,[{key:"concurrency",get:function(){return this._queue.concurrency},set:function(t){this._queue.concurrency=t}}]),t}();lo._defaultBeforeMiddleware=[],lo._defaultAfterMiddleware=[],lo.pre=function(t){return lo._defaultBeforeMiddleware.push(t),lo},lo.use=function(t){return lo._defaultAfterMiddleware.push(t),lo};var co=function(){};co.use=function(t,e){t.data&&t.type===io.TYPE.IMAGE&&(t.texture=Yr.fromLoader(t.data,t.url,t.name)),e()};var po=function(t){function e(r,i){var n=this;t.call(this,r,i),R.call(this);for(var o=0;o<e._plugins.length;++o){var s=e._plugins[o],a=s.pre,h=s.use;a&&this.pre(a),h&&this.use(h)}this.onStart.add(function(t){return n.emit("start",t)}),this.onProgress.add(function(t,e){return n.emit("progress",t,e)}),this.onError.add(function(t,e,r){return n.emit("error",t,e,r)}),this.onLoad.add(function(t,e){return n.emit("load",t,e)}),this.onComplete.add(function(t,e){return n.emit("complete",t,e)}),this._protected=!1}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={shared:{configurable:!0}};return e.prototype.destroy=function(){this._protected||(this.removeAllListeners(),this.reset())},r.shared.get=function(){var t=e._shared;return t||((t=new e)._protected=!0,e._shared=t),t},Object.defineProperties(e,r),e}(lo);Object.assign(po.prototype,R.prototype),po._plugins=[],po.registerPlugin=function(t){return po._plugins.push(t),t.add&&t.add(),po},po.registerPlugin({use:ho.parsing}),po.registerPlugin(co);var fo=function(){};fo.init=function(t){t=Object.assign({sharedLoader:!1},t),this.loader=t.sharedLoader?po.shared:new po},fo.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)};var vo=io,go=function(e){function r(r,i,n,o){void 0===r&&(r=1500),void 0===n&&(n=16384),void 0===o&&(o=!1),e.call(this);n>16384&&(n=16384),this._properties=[!1,!0,!1,!1,!1],this._maxSize=r,this._batchSize=n,this._buffers=null,this._bufferUpdateIDs=[],this._updateID=0,this.interactiveChildren=!1,this.blendMode=t.BLEND_MODES.NORMAL,this.autoResize=o,this.roundPixels=!0,this.baseTexture=null,this.setProperties(i),this._tint=0,this.tintRgb=new Float32Array(4),this.tint=16777215}e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r;var i={tint:{configurable:!0}};return r.prototype.setProperties=function(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])},r.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},i.tint.get=function(){return this._tint},i.tint.set=function(t){this._tint=t,te(t,this.tintRgb)},r.prototype.render=function(t){var e=this;this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",function(){return e.onChildrenChange(0)})),t.batch.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))},r.prototype.onChildrenChange=function(t){for(var e=Math.floor(t/this._batchSize);this._bufferUpdateIDs.length<e;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[e]=++this._updateID},r.prototype.dispose=function(){if(this._buffers){for(var t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._buffers=null}},r.prototype.destroy=function(t){e.prototype.destroy.call(this,t),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null},Object.defineProperties(r.prototype,i),r}(er),mo=function(e,r,i){this.geometry=new ri,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(var n=0;n<e.length;++n){var o=e[n];o={attributeName:o.attributeName,size:o.size,uploadFunction:o.uploadFunction,type:o.type||t.TYPES.FLOAT,offset:o.offset},r[n]?this.dynamicProperties.push(o):this.staticProperties.push(o)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()};mo.prototype.initBuffers=function(){var e=this.geometry,r=0;this.indexBuffer=new Zr(ue(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(var i=0;i<this.dynamicProperties.length;++i){var n=this.dynamicProperties[i];n.offset=r,r+=n.size,this.dynamicStride+=n.size}var o=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(o),this.dynamicDataUint32=new Uint32Array(o),this.dynamicBuffer=new Zr(this.dynamicData,!1,!1);var s=0;this.staticStride=0;for(var a=0;a<this.staticProperties.length;++a){var h=this.staticProperties[a];h.offset=s,s+=h.size,this.staticStride+=h.size}var u=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(u),this.staticDataUint32=new Uint32Array(u),this.staticBuffer=new Zr(this.staticData,!0,!1);for(var l=0;l<this.dynamicProperties.length;++l){var c=this.dynamicProperties[l];e.addAttribute(c.attributeName,this.dynamicBuffer,0,c.type===t.TYPES.UNSIGNED_BYTE,c.type,4*this.dynamicStride,4*c.offset)}for(var d=0;d<this.staticProperties.length;++d){var p=this.staticProperties[d];e.addAttribute(p.attributeName,this.staticBuffer,0,p.type===t.TYPES.UNSIGNED_BYTE,p.type,4*this.staticStride,4*p.offset)}},mo.prototype.uploadDynamic=function(e,r,i){for(var n=0;n<this.dynamicProperties.length;n++){var o=this.dynamicProperties[n];o.uploadFunction(e,r,i,o.type===t.TYPES.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,o.offset)}this.dynamicBuffer._updateID++},mo.prototype.uploadStatic=function(e,r,i){for(var n=0;n<this.staticProperties.length;n++){var o=this.staticProperties[n];o.uploadFunction(e,r,i,o.type===t.TYPES.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,o.offset)}this.staticBuffer._updateID++},mo.prototype.destroy=function(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()};var yo="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n",_o="varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",xo=function(e){function r(r){e.call(this,r),this.shader=null,this.properties=null,this.tempMatrix=new Be,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:t.TYPES.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Hi.from(yo,_o,{}),this.state=Yi.for2d()}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.render=function(t){var e=t.children,r=t._maxSize,i=t._batchSize,n=this.renderer,o=e.length;if(0!==o){o>r&&!t.autoResize&&(o=r);var s=t._buffers;s||(s=t._buffers=this.generateBuffers(t));var a=e[0]._texture.baseTexture;this.state.blendMode=oe(t.blendMode,a.alphaMode),n.state.set(this.state);var h=n.gl,u=t.worldTransform.copyTo(this.tempMatrix);u.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=u.toArray(!0),this.shader.uniforms.uColor=se(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,a.alphaMode),this.shader.uniforms.uSampler=a,this.renderer.shader.bind(this.shader);for(var l=!1,c=0,d=0;c<o;c+=i,d+=1){var p=o-c;p>i&&(p=i),d>=s.length&&s.push(this._generateOneMoreBuffer(t));var f=s[d];f.uploadDynamic(e,c,p);var v=t._bufferUpdateIDs[d]||0;(l=l||f._updateID<v)&&(f._updateID=t._updateID,f.uploadStatic(e,c,p)),n.geometry.bind(f.geometry),h.drawElements(h.TRIANGLES,6*p,h.UNSIGNED_SHORT,0)}}},r.prototype.generateBuffers=function(t){for(var e=[],r=t._maxSize,i=t._batchSize,n=t._properties,o=0;o<r;o+=i)e.push(new mo(this.properties,n,i));return e},r.prototype._generateOneMoreBuffer=function(t){var e=t._batchSize,r=t._properties;return new mo(this.properties,r,e)},r.prototype.uploadVertices=function(t,e,r,i,n,o){for(var s=0,a=0,h=0,u=0,l=0;l<r;++l){var c=t[e+l],d=c._texture,p=c.scale.x,f=c.scale.y,v=d.trim,g=d.orig;v?(s=(a=v.x-c.anchor.x*g.width)+v.width,h=(u=v.y-c.anchor.y*g.height)+v.height):(s=g.width*(1-c.anchor.x),a=g.width*-c.anchor.x,h=g.height*(1-c.anchor.y),u=g.height*-c.anchor.y),i[o]=a*p,i[o+1]=u*f,i[o+n]=s*p,i[o+n+1]=u*f,i[o+2*n]=s*p,i[o+2*n+1]=h*f,i[o+3*n]=a*p,i[o+3*n+1]=h*f,o+=4*n}},r.prototype.uploadPosition=function(t,e,r,i,n,o){for(var s=0;s<r;s++){var a=t[e+s].position;i[o]=a.x,i[o+1]=a.y,i[o+n]=a.x,i[o+n+1]=a.y,i[o+2*n]=a.x,i[o+2*n+1]=a.y,i[o+3*n]=a.x,i[o+3*n+1]=a.y,o+=4*n}},r.prototype.uploadRotation=function(t,e,r,i,n,o){for(var s=0;s<r;s++){var a=t[e+s].rotation;i[o]=a,i[o+n]=a,i[o+2*n]=a,i[o+3*n]=a,o+=4*n}},r.prototype.uploadUvs=function(t,e,r,i,n,o){for(var s=0;s<r;++s){var a=t[e+s]._texture._uvs;a?(i[o]=a.x0,i[o+1]=a.y0,i[o+n]=a.x1,i[o+n+1]=a.y1,i[o+2*n]=a.x2,i[o+2*n+1]=a.y2,i[o+3*n]=a.x3,i[o+3*n+1]=a.y3,o+=4*n):(i[o]=0,i[o+1]=0,i[o+n]=0,i[o+n+1]=0,i[o+2*n]=0,i[o+2*n+1]=0,i[o+3*n]=0,i[o+3*n+1]=0,o+=4*n)}},r.prototype.uploadTint=function(t,e,r,i,n,o){for(var s=0;s<r;++s){var a=t[e+s],h=a._texture.baseTexture.alphaMode>0,u=a.alpha,l=u<1&&h?ae(a._tintRGB,u):a._tintRGB+(255*u<<24);i[o]=l,i[o+n]=l,i[o+2*n]=l,i[o+3*n]=l,o+=4*n}},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null},r}(ui),bo={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,_segmentsCount:function(t,e){if(void 0===e&&(e=20),!this.adaptive||!t||isNaN(t))return e;var r=Math.ceil(t/this.maxLength);return r<this.minSegments?r=this.minSegments:r>this.maxSegments&&(r=this.maxSegments),r}},Eo=function(){this.reset()};Eo.prototype.clone=function(){var t=new Eo;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t},Eo.prototype.reset=function(){this.color=16777215,this.alpha=1,this.texture=Yr.WHITE,this.matrix=null,this.visible=!1},Eo.prototype.destroy=function(){this.texture=null,this.matrix=null};var To={build:function(t){t.points=t.shape.points.slice()},triangulate:function(t,e){var r=t.points,i=t.holes,n=e.points,o=e.indices;if(r.length>=6){for(var s=[],a=0;a<i.length;a++){var h=i[a];s.push(r.length/2),r=r.concat(h.points)}var u=L(r,s,2);if(!u)return;for(var l=n.length/2,c=0;c<u.length;c+=3)o.push(u[c]+l),o.push(u[c+1]+l),o.push(u[c+2]+l);for(var d=0;d<r.length;d++)n.push(r[d])}}},So={build:function(e){var r,i,n=e.shape,o=e.points,s=n.x,a=n.y;if(o.length=0,e.type===t.SHAPES.CIRC?(r=n.radius,i=n.radius):(r=n.width,i=n.height),0!==r&&0!==i){var h=Math.floor(30*Math.sqrt(n.radius))||Math.floor(15*Math.sqrt(n.width+n.height));h/=2.3;for(var u=2*Math.PI/h,l=0;l<h-.5;l++)o.push(s+Math.sin(-u*l)*r,a+Math.cos(-u*l)*i);o.push(o[0],o[1])}},triangulate:function(t,e){var r=t.points,i=e.points,n=e.indices,o=i.length/2,s=o,a=t.shape,h=t.matrix,u=a.x,l=a.y;i.push(t.matrix?h.a*u+h.c*l+h.tx:u,t.matrix?h.b*u+h.d*l+h.ty:l);for(var c=0;c<r.length;c+=2)i.push(r[c],r[c+1]),n.push(o++,s,o)}},wo={build:function(t){var e=t.shape,r=e.x,i=e.y,n=e.width,o=e.height,s=t.points;s.length=0,s.push(r,i,r+n,i,r+n,i+o,r,i+o)},triangulate:function(t,e){var r=t.points,i=e.points,n=i.length/2;i.push(r[0],r[1],r[2],r[3],r[6],r[7],r[4],r[5]),e.indices.push(n,n+1,n+2,n+1,n+2,n+3)}},Po={build:function(t){var e=t.shape,r=t.points,i=e.x,n=e.y,o=e.width,s=e.height,a=Math.max(0,Math.min(e.radius,Math.min(o,s)/2));r.length=0,a?(Ao(i,n+a,i,n,i+a,n,r),Ao(i+o-a,n,i+o,n,i+o,n+a,r),Ao(i+o,n+s-a,i+o,n+s,i+o-a,n+s,r),Ao(i+a,n+s,i,n+s,i,n+s-a,r)):r.push(i,n,i+o,n,i+o,n+s,i,n+s)},triangulate:function(t,e){for(var r=t.points,i=e.points,n=e.indices,o=i.length/2,s=L(r,null,2),a=0,h=s.length;a<h;a+=3)n.push(s[a]+o),n.push(s[a+1]+o),n.push(s[a+2]+o);for(var u=0,l=r.length;u<l;u++)i.push(r[u],r[++u])}};function Io(t,e,r){return t+(e-t)*r}function Ao(t,e,r,i,n,o,s){void 0===s&&(s=[]);for(var a=s,h=0,u=0,l=0,c=0,d=0,p=0,f=0,v=0;f<=20;++f)h=Io(t,r,v=f/20),u=Io(e,i,v),l=Io(r,n,v),c=Io(i,o,v),d=Io(h,l,v),p=Io(u,c,v),a.push(d,p);return a}function Oo(e,r){e.lineStyle.native?function(e,r){var i=0,n=e.shape,o=e.points||n.points,s=n.type!==t.SHAPES.POLY||n.closeStroke;if(0===o.length)return;var a=r.points,h=r.indices,u=o.length/2,l=a.length/2,c=l;for(a.push(o[0],o[1]),i=1;i<u;i++)a.push(o[2*i],o[2*i+1]),h.push(c,c+1),c++;s&&h.push(c,l)}(e,r):function(e,r){var i=e.shape,n=e.points||i.points.slice(),o=r.closePointEps;if(0===n.length)return;var s=e.lineStyle,a=new Ce(n[0],n[1]),h=new Ce(n[n.length-2],n[n.length-1]),u=i.type!==t.SHAPES.POLY||i.closeStroke,l=Math.abs(a.x-h.x)<o&&Math.abs(a.y-h.y)<o;if(u){n=n.slice(),l&&(n.pop(),n.pop(),h.set(n[n.length-2],n[n.length-1]));var c=h.x+.5*(a.x-h.x),d=h.y+.5*(a.y-h.y);n.unshift(c,d),n.push(c,d)}var p=r.points,f=n.length/2,v=n.length,g=p.length/2,m=s.width/2,y=n[0],_=n[1],x=n[2],b=n[3],E=0,T=0,S=-(_-b),w=y-x,P=0,I=0,A=0,O=0,D=Math.sqrt(S*S+w*w);S/=D,w/=D,S*=m,w*=m;var M=s.alignment,C=2*(1-M),R=2*M;p.push(y-S*C,_-w*C),p.push(y+S*R,_+w*R);for(var L=1;L<f-1;++L){y=n[2*(L-1)],_=n[2*(L-1)+1],x=n[2*L],b=n[2*L+1],E=n[2*(L+1)],T=n[2*(L+1)+1],S=-(_-b),w=y-x,D=Math.sqrt(S*S+w*w),S/=D,w/=D,S*=m,w*=m,P=-(b-T),I=x-E,D=Math.sqrt(P*P+I*I),P/=D,I/=D;var N=-w+_-(-w+b),F=-S+x-(-S+y),B=(-S+y)*(-w+b)-(-S+x)*(-w+_),U=-(I*=m)+T-(-I+b),k=-(P*=m)+x-(-P+E),X=(-P+E)*(-I+b)-(-P+x)*(-I+T),j=N*k-U*F;if(Math.abs(j)<.1)j+=10.1,p.push(x-S*C,b-w*C),p.push(x+S*R,b+w*R);else{var H=(F*X-k*B)/j,G=(U*B-N*X)/j,Y=(H-x)*(H-x)+(G-b)*(G-b);Y>196*m*m?(A=S-P,O=w-I,D=Math.sqrt(A*A+O*O),A/=D,O/=D,A*=m,O*=m,p.push(x-A*C,b-O*C),p.push(x+A*R,b+O*R),p.push(x-A*R*C,b-O*C),v++):(p.push(x+(H-x)*C,b+(G-b)*C),p.push(x-(H-x)*R,b-(G-b)*R))}}y=n[2*(f-2)],_=n[2*(f-2)+1],x=n[2*(f-1)],b=n[2*(f-1)+1],S=-(_-b),w=y-x,D=Math.sqrt(S*S+w*w),S/=D,w/=D,S*=m,w*=m,p.push(x-S*C,b-w*C),p.push(x+S*R,b+w*R);for(var z=r.indices,V=0;V<v-2;++V)z.push(g,g+1,g+2),g++}(e,r)}var Do=function(t){function e(e,r,i,n,o,s){o=o||n/2;for(var a=-1*Math.PI/2+s,h=2*i,u=Le/h,l=[],c=0;c<h;c++){var d=c%2?o:n,p=c*u+a;l.push(e+d*Math.cos(p),r+d*Math.sin(p))}t.call(this,l)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ze),Mo=function(){};Mo.curveTo=function(t,e,r,i,n,o){var s=o[o.length-2],a=o[o.length-1]-e,h=s-t,u=i-e,l=r-t,c=Math.abs(a*l-h*u);if(c<1e-8||0===n)return o[o.length-2]===t&&o[o.length-1]===e||o.push(t,e),null;var d=a*a+h*h,p=u*u+l*l,f=a*u+h*l,v=n*Math.sqrt(d)/c,g=n*Math.sqrt(p)/c,m=v*f/d,y=g*f/p,_=v*l+g*h,x=v*u+g*a,b=h*(g+m),E=a*(g+m),T=l*(v+y),S=u*(v+y);return{cx:_+t,cy:x+e,radius:n,startAngle:Math.atan2(E-x,b-_),endAngle:Math.atan2(S-x,T-_),anticlockwise:h*u>l*a}},Mo.arc=function(t,e,r,i,n,o,s,a,h){for(var u=s-o,l=bo._segmentsCount(Math.abs(u)*n,40*Math.ceil(Math.abs(u)/Le)),c=u/(2*l),d=2*c,p=Math.cos(c),f=Math.sin(c),v=l-1,g=v%1/v,m=0;m<=v;++m){var y=c+o+d*(m+g*m),_=Math.cos(y),x=-Math.sin(y);h.push((p*_+f*x)*n+r,(p*-x+f*_)*n+i)}};var Co=function(){};Co.curveLength=function(t,e,r,i,n,o,s,a){for(var h=0,u=0,l=0,c=0,d=0,p=0,f=0,v=0,g=0,m=0,y=0,_=t,x=e,b=1;b<=10;++b)m=_-(v=(f=(p=(d=1-(u=b/10))*d)*d)*t+3*p*u*r+3*d*(l=u*u)*n+(c=l*u)*s),y=x-(g=f*e+3*p*u*i+3*d*l*o+c*a),_=v,x=g,h+=Math.sqrt(m*m+y*y);return h},Co.curveTo=function(t,e,r,i,n,o,s){var a=s[s.length-2],h=s[s.length-1];s.length-=2;var u=bo._segmentsCount(Co.curveLength(a,h,t,e,r,i,n,o)),l=0,c=0,d=0,p=0,f=0;s.push(a,h);for(var v=1,g=0;v<=u;++v)d=(c=(l=1-(g=v/u))*l)*l,f=(p=g*g)*g,s.push(d*a+3*c*g*t+3*l*p*r+f*n,d*h+3*c*g*e+3*l*p*i+f*o)};var Ro=function(){};Ro.curveLength=function(t,e,r,i,n,o){var s=t-2*r+n,a=e-2*i+o,h=2*r-2*t,u=2*i-2*e,l=4*(s*s+a*a),c=4*(s*h+a*u),d=h*h+u*u,p=2*Math.sqrt(l+c+d),f=Math.sqrt(l),v=2*l*f,g=2*Math.sqrt(d),m=c/f;return(v*p+f*c*(p-g)+(4*d*l-c*c)*Math.log((2*f+m+p)/(m+g)))/(4*v)},Ro.curveTo=function(t,e,r,i,n){for(var o=n[n.length-2],s=n[n.length-1],a=bo._segmentsCount(Ro.curveLength(o,s,t,e,r,i)),h=0,u=0,l=1;l<=a;++l){var c=l/a;h=o+(t-o)*c,u=s+(e-s)*c,n.push(h+(t+(r-t)*c-h)*c,u+(e+(i-e)*c-u)*c)}};var Lo=function(){this.reset()};Lo.prototype.begin=function(t,e,r){this.reset(),this.style=t,this.start=e,this.attribStart=r},Lo.prototype.end=function(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start},Lo.prototype.reset=function(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0};var No={};No[t.SHAPES.POLY]=To,No[t.SHAPES.CIRC]=So,No[t.SHAPES.ELIP]=So,No[t.SHAPES.RECT]=wo,No[t.SHAPES.RREC]=Po;var Fo=[],Bo=[],Uo={buildPoly:To,buildCircle:So,buildRectangle:wo,buildRoundedRectangle:Po,FILL_COMMANDS:No,BATCH_POOL:Fo,DRAW_CALL_POOL:Bo,buildLine:Oo,buildComplexPoly:function(t,e){var r=t.points.slice();if(!(r.length<6)){var i=e.indices;e.points=r,e.alpha=t.fillAlpha,e.color=te(t.fillColor);for(var n=1/0,o=-1/0,s=1/0,a=-1/0,h=0,u=0,l=0;l<r.length;l+=2)n=(h=r[l])<n?h:n,o=h>o?h:o,s=(u=r[l+1])<s?u:s,a=u>a?u:a;r.push(n,s,o,s,o,a,n,a);for(var c=r.length/2,d=0;d<c;d++)i.push(d)}},bezierCurveTo:function(t,e,r,i,n,o,s,a,h,u){void 0===u&&(u=[]);var l=0,c=0,d=0,p=0,f=0;u.push(t,e);for(var v=1,g=0;v<=h;++v)d=(c=(l=1-(g=v/h))*l)*l,f=(p=g*g)*g,u.push(d*t+3*c*g*r+3*l*p*n+f*s,d*e+3*c*g*i+3*l*p*o+f*a);return u},Star:Do,ArcUtils:Mo,BezierUtils:Co,QuadraticUtils:Ro,BatchPart:Lo},ko=function(t,e,r,i){void 0===e&&(e=null),void 0===r&&(r=null),void 0===i&&(i=null),this.shape=t,this.lineStyle=r,this.fillStyle=e,this.matrix=i,this.type=t.type,this.points=[],this.holes=[]};ko.prototype.clone=function(){return new ko(this.shape,this.fillStyle,this.lineStyle,this.matrix)},ko.prototype.destroy=function(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null};var Xo=new Ce,jo=new Qe,Ho=function(e){function r(){e.call(this),this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.dirty=0,this.batchDirty=-1,this.cacheDirty=-1,this.clearDirty=0,this.drawCalls=[],this.batches=[],this.shapeIndex=0,this._bounds=new Qe,this.boundsDirty=-1,this.boundsPadding=0,this.batchable=!1,this.indicesUint16=null,this.uvsFloat32=null,this.closePointEps=1e-4}e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r;var i={bounds:{configurable:!0}};return i.bounds.get=function(){return this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds},r.prototype.invalidate=function(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(var t=0;t<this.drawCalls.length;t++)this.drawCalls[t].textures.length=0,Bo.push(this.drawCalls[t]);this.drawCalls.length=0;for(var e=0;e<this.batches.length;e++){var r=this.batches[e];r.reset(),Fo.push(r)}this.batches.length=0},r.prototype.clear=function(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this},r.prototype.drawShape=function(t,e,r,i){var n=new ko(t,e,r,i);return this.graphicsData.push(n),this.dirty++,this},r.prototype.drawHole=function(t,e){if(!this.graphicsData.length)return null;var r=new ko(t,null,null,e),i=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=i.lineStyle,i.holes.push(r),this.dirty++,this},r.prototype.destroy=function(t){e.prototype.destroy.call(this,t);for(var r=0;r<this.graphicsData.length;++r)this.graphicsData[r].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null},r.prototype.containsPoint=function(t){for(var e=this.graphicsData,r=0;r<e.length;++r){var i=e[r];if(i.fillStyle.visible&&(i.shape&&(i.matrix?i.matrix.applyInverse(t,Xo):Xo.copyFrom(t),i.shape.contains(Xo.x,Xo.y)))){var n=!1;if(i.holes)for(var o=0;o<i.holes.length;o++){if(i.holes[o].shape.contains(Xo.x,Xo.y)){n=!0;break}}if(!n)return!0}}return!1},r.prototype.updateBatches=function(){if(this.graphicsData.length){if(this.validateBatching()){this.cacheDirty=this.dirty;var e=this.uvs,r=this.graphicsData,i=null,n=null;this.batches.length>0&&(n=(i=this.batches[this.batches.length-1]).style);for(var o=this.shapeIndex;o<r.length;o++){this.shapeIndex++;var s=r[o],a=s.fillStyle,h=s.lineStyle;No[s.type].build(s),s.matrix&&this.transformPoints(s.points,s.matrix);for(var u=0;u<2;u++){var l=0===u?a:h;if(l.visible){var c=l.texture.baseTexture,d=this.indices.length,p=this.points.length/2;c.wrapMode=t.WRAP_MODES.REPEAT,0===u?this.processFill(s):this.processLine(s);var f=this.points.length/2-p;0!==f&&(i&&!this._compareStyles(n,l)&&(i.end(d,p),i=null),i||((i=Fo.pop()||new Lo).begin(l,d,p),this.batches.push(i),n=l),this.addUvs(this.points,e,l.texture,p,f,l.matrix))}}}if(i){var v=this.indices.length,g=this.points.length/2;i.end(v,g)}0!==this.batches.length?(this.indicesUint16=new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()):this.batchable=!0}}else this.batchable=!0},r.prototype._compareStyles=function(t,e){return!(!t||!e)&&(t.texture.baseTexture===e.texture.baseTexture&&(t.color+t.alpha===e.color+e.alpha&&!!t.native==!!e.native))},r.prototype.validateBatching=function(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(var t=0,e=this.graphicsData.length;t<e;t++){var r=this.graphicsData[t],i=r.fillStyle,n=r.lineStyle;if(i&&!i.texture.baseTexture.valid)return!1;if(n&&!n.texture.baseTexture.valid)return!1}return!0},r.prototype.packBatches=function(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);for(var t=this.batches,e=0,r=t.length;e<r;e++)for(var i=t[e],n=0;n<i.size;n++){var o=i.start+n;this.indicesUint16[o]=this.indicesUint16[o]-i.attribStart}},r.prototype.isBatchable=function(){for(var t=this.batches,e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<2*r.BATCHABLE_SIZE},r.prototype.buildDrawCalls=function(){for(var e=++Or._globalBatch,r=0;r<this.drawCalls.length;r++)this.drawCalls[r].textures.length=0,Bo.push(this.drawCalls[r]);this.drawCalls.length=0;var i=this.colors,n=this.textureIds,o=Bo.pop();o||((o=new An).textures=new On),o.textures.count=0,o.start=0,o.size=0,o.type=t.DRAW_MODES.TRIANGLES;var s=0,a=null,h=0,u=!1,l=t.DRAW_MODES.TRIANGLES,c=0;this.drawCalls.push(o);for(var d=0;d<this.batches.length;d++){var p=this.batches[d],f=p.style,v=f.texture.baseTexture;u!==!!f.native&&(l=(u=!!f.native)?t.DRAW_MODES.LINES:t.DRAW_MODES.TRIANGLES,a=null,s=8,e++),a!==v&&(a=v,v._batchEnabled!==e&&(8===s&&(e++,s=0,o.size>0&&((o=Bo.pop())||((o=new An).textures=new On),this.drawCalls.push(o)),o.start=c,o.size=0,o.textures.count=0,o.type=l),v.touched=1,v._batchEnabled=e,v._batchLocation=s,v.wrapMode=10497,o.textures.elements[o.textures.count++]=v,s++)),o.size+=p.size,c+=p.size,h=v._batchLocation,this.addColors(i,f.color,f.alpha,p.attribSize),this.addTextureIds(n,h,p.attribSize)}Or._globalBatch=e,this.packAttributes()},r.prototype.packAttributes=function(){for(var t=this.points,e=this.uvs,r=this.colors,i=this.textureIds,n=new ArrayBuffer(3*t.length*4),o=new Float32Array(n),s=new Uint32Array(n),a=0,h=0;h<t.length/2;h++)o[a++]=t[2*h],o[a++]=t[2*h+1],o[a++]=e[2*h],o[a++]=e[2*h+1],s[a++]=r[h],o[a++]=i[h];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)},r.prototype.processFill=function(t){t.holes.length?(this.processHoles(t.holes),To.triangulate(t,this)):No[t.type].triangulate(t,this)},r.prototype.processLine=function(t){Oo(t,this);for(var e=0;e<t.holes.length;e++)Oo(t.holes[e],this)},r.prototype.processHoles=function(t){for(var e=0;e<t.length;e++){var r=t[e];No[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}},r.prototype.calculateBounds=function(){var e=this._bounds,r=jo,i=Be.IDENTITY;this._bounds.clear(),r.clear();for(var n=0;n<this.graphicsData.length;n++){var o=this.graphicsData[n],s=o.shape,a=o.type,h=o.lineStyle,u=o.matrix||Be.IDENTITY,l=0;if(h&&h.visible){var c=h.alignment;l=h.width,a===t.SHAPES.POLY?l*=.5+Math.abs(.5-c):l*=Math.max(0,c)}i!==u&&(r.isEmpty()||(e.addBoundsMatrix(r,i),r.clear()),i=u),a===t.SHAPES.RECT||a===t.SHAPES.RREC?r.addFramePad(s.x,s.y,s.x+s.width,s.y+s.height,l,l):a===t.SHAPES.CIRC?r.addFramePad(s.x,s.y,s.x,s.y,s.radius+l,s.radius+l):a===t.SHAPES.ELIP?r.addFramePad(s.x,s.y,s.x,s.y,s.width+l,s.height+l):e.addVerticesMatrix(i,s.points,0,s.points.length,l,l)}r.isEmpty()||e.addBoundsMatrix(r,i),e.pad(this.boundsPadding,this.boundsPadding)},r.prototype.transformPoints=function(t,e){for(var r=0;r<t.length/2;r++){var i=t[2*r],n=t[2*r+1];t[2*r]=e.a*i+e.c*n+e.tx,t[2*r+1]=e.b*i+e.d*n+e.ty}},r.prototype.addColors=function(t,e,r,i){for(var n=ae((e>>16)+(65280&e)+((255&e)<<16),r);i-- >0;)t.push(n)},r.prototype.addTextureIds=function(t,e,r){for(;r-- >0;)t.push(e)},r.prototype.addUvs=function(t,e,r,i,n,o){for(var s=0,a=e.length,h=r.frame;s<n;){var u=t[2*(i+s)],l=t[2*(i+s)+1];if(o){var c=o.a*u+o.c*l+o.tx;l=o.b*u+o.d*l+o.ty,u=c}s++,e.push(u/h.width,l/h.height)}var d=r.baseTexture;(h.width<d.width||h.height<d.height)&&this.adjustUvs(e,r,a,n)},r.prototype.adjustUvs=function(t,e,r,i){for(var n=e.baseTexture,o=r+2*i,s=e.frame,a=s.width/n.width,h=s.height/n.height,u=s.x/s.width,l=s.y/s.height,c=Math.floor(t[r]+1e-6),d=Math.floor(t[r+1]+1e-6),p=r+2;p<o;p+=2)c=Math.min(c,Math.floor(t[p]+1e-6)),d=Math.min(d,Math.floor(t[p+1]+1e-6));u-=c,l-=d;for(var f=r;f<o;f+=2)t[f]=(t[f]+u)*a,t[f+1]=(t[f+1]+l)*h},Object.defineProperties(r.prototype,i),r}(Ln);Ho.BATCHABLE_SIZE=100;var Go=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){var t=new e;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t},e.prototype.reset=function(){t.prototype.reset.call(this),this.color=0,this.width=0,this.alignment=.5,this.native=!1},e}(Eo),Yo=new Float32Array(3),zo={},Vo=function(e){function r(r){void 0===r&&(r=null),e.call(this),this.geometry=r||new Ho,this.geometry.refCount++,this.shader=null,this.state=Yi.for2d(),this._fillStyle=new Eo,this._lineStyle=new Go,this._matrix=null,this._holeMode=!1,this.currentPath=null,this.batches=[],this.batchTint=-1,this.vertexData=null,this._transformID=-1,this.batchDirty=-1,this.pluginName="batch",this.tint=16777215,this.blendMode=t.BLEND_MODES.NORMAL}e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r;var i={blendMode:{configurable:!0},tint:{configurable:!0},fill:{configurable:!0},line:{configurable:!0}};return r.prototype.clone=function(){return this.finishPoly(),new r(this.geometry)},i.blendMode.set=function(t){this.state.blendMode=t},i.blendMode.get=function(){return this.state.blendMode},i.tint.get=function(){return this._tint},i.tint.set=function(t){this._tint=t},i.fill.get=function(){return this._fillStyle},i.line.get=function(){return this._lineStyle},r.prototype.lineStyle=function(t){if("number"==typeof t){var e=arguments;t={width:e[0]||0,color:e[1]||0,alpha:void 0!==e[2]?e[2]:1,alignment:void 0!==e[3]?e[3]:.5,native:!!e[4]}}return this.lineTextureStyle(t)},r.prototype.lineTextureStyle=function(t){if("number"==typeof t){xe("v5.2.0","Please use object-based options for Graphics#lineTextureStyle");var e=arguments[0],r=arguments[1],i=arguments[2],n=arguments[3],o=arguments[4],s=arguments[5],a=arguments[6];t={width:e,texture:r,color:i,alpha:n,matrix:o,alignment:s,native:a},Object.keys(t).forEach(function(e){return void 0===t[e]&&delete t[e]})}t=Object.assign({width:0,texture:Yr.WHITE,color:t&&t.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1},t),this.currentPath&&this.startPoly();var h=t.width>0&&t.alpha>0;return h?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:h},t)):this._lineStyle.reset(),this},r.prototype.startPoly=function(){if(this.currentPath){var t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Ze,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new Ze,this.currentPath.closeStroke=!1},r.prototype.finishPoly=function(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)},r.prototype.moveTo=function(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this},r.prototype.lineTo=function(t,e){this.currentPath||this.moveTo(0,0);var r=this.currentPath.points,i=r[r.length-2],n=r[r.length-1];return i===t&&n===e||r.push(t,e),this},r.prototype._initCurve=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)},r.prototype.quadraticCurveTo=function(t,e,r,i){this._initCurve();var n=this.currentPath.points;return 0===n.length&&this.moveTo(0,0),Ro.curveTo(t,e,r,i,n),this},r.prototype.bezierCurveTo=function(t,e,r,i,n,o){return this._initCurve(),Co.curveTo(t,e,r,i,n,o,this.currentPath.points),this},r.prototype.arcTo=function(t,e,r,i,n){this._initCurve(t,e);var o=this.currentPath.points,s=Mo.curveTo(t,e,r,i,n,o);if(s){var a=s.cx,h=s.cy,u=s.radius,l=s.startAngle,c=s.endAngle,d=s.anticlockwise;this.arc(a,h,u,l,c,d)}return this},r.prototype.arc=function(t,e,r,i,n,o){if(void 0===o&&(o=!1),i===n)return this;if(!o&&n<=i?n+=Le:o&&i<=n&&(i+=Le),0===n-i)return this;var s=t+Math.cos(i)*r,a=e+Math.sin(i)*r,h=this.geometry.closePointEps,u=this.currentPath?this.currentPath.points:null;if(u){var l=Math.abs(u[u.length-2]-s),c=Math.abs(u[u.length-1]-a);l<h&&c<h||u.push(s,a)}else this.moveTo(s,a),u=this.currentPath.points;return Mo.arc(s,a,t,e,r,i,n,o,u),this},r.prototype.beginFill=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=1),this.beginTextureFill({texture:Yr.WHITE,color:t,alpha:e})},r.prototype.beginTextureFill=function(t){if(t instanceof Yr){xe("v5.2.0","Please use object-based options for Graphics#beginTextureFill");var e=arguments[0],r=arguments[1],i=arguments[2],n=arguments[3];t={texture:e,color:r,alpha:i,matrix:n},Object.keys(t).forEach(function(e){return void 0===t[e]&&delete t[e]})}t=Object.assign({texture:Yr.WHITE,color:16777215,alpha:1,matrix:null},t),this.currentPath&&this.startPoly();var o=t.alpha>0;return o?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:o},t)):this._fillStyle.reset(),this},r.prototype.endFill=function(){return this.finishPoly(),this._fillStyle.reset(),this},r.prototype.drawRect=function(t,e,r,i){return this.drawShape(new We(t,e,r,i))},r.prototype.drawRoundedRect=function(t,e,r,i,n){return this.drawShape(new Je(t,e,r,i,n))},r.prototype.drawCircle=function(t,e,r){return this.drawShape(new qe(t,e,r))},r.prototype.drawEllipse=function(t,e,r,i){return this.drawShape(new Ke(t,e,r,i))},r.prototype.drawPolygon=function(t){var e=arguments,r=t,i=!0;if(r.points&&(i=r.closeStroke,r=r.points),!Array.isArray(r)){r=new Array(arguments.length);for(var n=0;n<r.length;++n)r[n]=e[n]}var o=new Ze(r);return o.closeStroke=i,this.drawShape(o),this},r.prototype.drawShape=function(t){return this._holeMode?this.geometry.drawHole(t,this._matrix):this.geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this},r.prototype.drawStar=function(t,e,r,i,n,o){return void 0===o&&(o=0),this.drawPolygon(new Do(t,e,r,i,n,o))},r.prototype.clear=function(){return this.geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._matrix=null,this._holeMode=!1,this.currentPath=null,this},r.prototype.isFastRect=function(){return 1===this.geometry.graphicsData.length&&this.geometry.graphicsData[0].shape.type===t.SHAPES.RECT&&!this.geometry.graphicsData[0].lineWidth},r.prototype._render=function(t){this.finishPoly();var e=this.geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))},r.prototype._populateBatches=function(){var t=this.geometry,e=this.blendMode;this.batches=[],this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.vertexData=new Float32Array(t.points);for(var r=0,i=t.batches.length;r<i;r++){var n=t.batches[r],o=n.style.color,s=new Float32Array(this.vertexData.buffer,4*n.attribStart*2,2*n.attribSize),a=new Float32Array(t.uvsFloat32.buffer,4*n.attribStart*2,2*n.attribSize),h={vertexData:s,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*n.start,n.size),uvs:a,_batchRGB:te(o),_tintRGB:o,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[r]=h}},r.prototype._renderBatched=function(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var e=0,r=this.batches.length;e<r;e++){var i=this.batches[e];i.worldAlpha=this.worldAlpha*i.alpha,t.plugins[this.pluginName].render(i)}}},r.prototype._renderDirect=function(t){var e=this._resolveDirectShader(t),r=this.geometry,i=this.tint,n=this.worldAlpha,o=e.uniforms,s=r.drawCalls;o.translationMatrix=this.transform.worldTransform,o.tint[0]=(i>>16&255)/255*n,o.tint[1]=(i>>8&255)/255*n,o.tint[2]=(255&i)/255*n,o.tint[3]=n,t.shader.bind(e),t.geometry.bind(r,e),t.state.set(this.state);for(var a=0,h=s.length;a<h;a++)this._renderDrawCallDirect(t,r.drawCalls[a])},r.prototype._renderDrawCallDirect=function(t,e){for(var r=e.textures,i=e.type,n=e.size,o=e.start,s=r.count,a=0;a<s;a++)t.texture.bind(r.elements[a],a);t.geometry.draw(i,n,o)},r.prototype._resolveDirectShader=function(t){var e=this.shader,r=this.pluginName;if(!e){if(!zo[r]){for(var i=new Int32Array(16),n=0;n<16;n++)i[n]=n;var o={tint:new Float32Array([1,1,1,1]),translationMatrix:new Be,default:si.from({uSamplers:i},!0)},s=t.plugins[r]._shader.program;zo[r]=new Hi(s,o)}e=zo[r]}return e},r.prototype._calculateBounds=function(){this.finishPoly();var t=this.geometry;if(t.graphicsData.length){var e=t.bounds,r=e.minX,i=e.minY,n=e.maxX,o=e.maxY;this._bounds.addFrame(this.transform,r,i,n,o)}},r.prototype.containsPoint=function(t){return this.worldTransform.applyInverse(t,r._TEMP_POINT),this.geometry.containsPoint(r._TEMP_POINT)},r.prototype.calculateTints=function(){if(this.batchTint!==this.tint){this.batchTint=this.tint;for(var t=te(this.tint,Yo),e=0;e<this.batches.length;e++){var r=this.batches[e],i=r._batchRGB,n=(t[0]*i[0]*255<<16)+(t[1]*i[1]*255<<8)+(0|t[2]*i[2]*255);r._tintRGB=(n>>16)+(65280&n)+((255&n)<<16)}}},r.prototype.calculateVertices=function(){if(this._transformID!==this.transform._worldID){this._transformID=this.transform._worldID;for(var t=this.transform.worldTransform,e=t.a,r=t.b,i=t.c,n=t.d,o=t.tx,s=t.ty,a=this.geometry.points,h=this.vertexData,u=0,l=0;l<a.length;l+=2){var c=a[l],d=a[l+1];h[u++]=e*c+i*d+o,h[u++]=n*d+r*c+s}}},r.prototype.closePath=function(){var t=this.currentPath;return t&&(t.closeStroke=!0),this},r.prototype.setMatrix=function(t){return this._matrix=t,this},r.prototype.beginHole=function(){return this.finishPoly(),this._holeMode=!0,this},r.prototype.endHole=function(){return this.finishPoly(),this._holeMode=!1,this},r.prototype.destroy=function(t){e.prototype.destroy.call(this,t),this.geometry.refCount--,0===this.geometry.refCount&&this.geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this.geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,e.prototype.destroy.call(this,t)},Object.defineProperties(r.prototype,i),r}(er);Vo._TEMP_POINT=new Ce;var Wo=new Ce,qo=new Uint16Array([0,1,2,0,2,3]),Ko=function(e){function r(r){e.call(this),this._anchor=new Re(this._onAnchorUpdate,this,r?r.defaultAnchor.x:0,r?r.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=t.BLEND_MODES.NORMAL,this.shader=null,this._cachedTint=16777215,this.uvs=null,this.texture=r||Yr.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=qo,this.pluginName="batch",this.isSprite=!0,this._roundPixels=C.ROUND_PIXELS}e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r;var i={roundPixels:{configurable:!0},width:{configurable:!0},height:{configurable:!0},anchor:{configurable:!0},tint:{configurable:!0},texture:{configurable:!0}};return r.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=ge(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=ge(this.scale.y)*this._height/this._texture.orig.height)},r.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},r.prototype.calculateVertices=function(){var t=this._texture;if(this._transformID!==this.transform._worldID||this._textureID!==t._updateID){this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;var e=this.transform.worldTransform,r=e.a,i=e.b,n=e.c,o=e.d,s=e.tx,a=e.ty,h=this.vertexData,u=t.trim,l=t.orig,c=this._anchor,d=0,p=0,f=0,v=0;if(u?(d=(p=u.x-c._x*l.width)+u.width,f=(v=u.y-c._y*l.height)+u.height):(d=(p=-c._x*l.width)+l.width,f=(v=-c._y*l.height)+l.height),h[0]=r*p+n*v+s,h[1]=o*v+i*p+a,h[2]=r*d+n*v+s,h[3]=o*v+i*d+a,h[4]=r*d+n*f+s,h[5]=o*f+i*d+a,h[6]=r*p+n*f+s,h[7]=o*f+i*p+a,this._roundPixels)for(var g=C.RESOLUTION,m=0;m<h.length;++m)h[m]=Math.round((h[m]*g|0)/g)}},r.prototype.calculateTrimmedVertices=function(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var t=this._texture,e=this.vertexTrimmedData,r=t.orig,i=this._anchor,n=this.transform.worldTransform,o=n.a,s=n.b,a=n.c,h=n.d,u=n.tx,l=n.ty,c=-i._x*r.width,d=c+r.width,p=-i._y*r.height,f=p+r.height;e[0]=o*c+a*p+u,e[1]=h*p+s*c+l,e[2]=o*d+a*p+u,e[3]=h*p+s*d+l,e[4]=o*d+a*f+u,e[5]=h*f+s*d+l,e[6]=o*c+a*f+u,e[7]=h*f+s*c+l},r.prototype._render=function(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)},r.prototype._calculateBounds=function(){var t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},r.prototype.getLocalBounds=function(t){return 0===this.children.length?(this._bounds.minX=this._texture.orig.width*-this._anchor._x,this._bounds.minY=this._texture.orig.height*-this._anchor._y,this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new We),t=this._localBoundsRect),this._bounds.getRectangle(t)):e.prototype.getLocalBounds.call(this,t)},r.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,Wo);var e=this._texture.orig.width,r=this._texture.orig.height,i=-e*this.anchor.x,n=0;return Wo.x>=i&&Wo.x<i+e&&(n=-r*this.anchor.y,Wo.y>=n&&Wo.y<n+r)},r.prototype.destroy=function(t){if(e.prototype.destroy.call(this,t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof t?t:t&&t.texture){var r="boolean"==typeof t?t:t&&t.baseTexture;this._texture.destroy(!!r)}this._texture=null,this.shader=null},r.from=function(t,e){return new r(t instanceof Yr?t:Yr.from(t,e))},i.roundPixels.set=function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},i.roundPixels.get=function(){return this._roundPixels},i.width.get=function(){return Math.abs(this.scale.x)*this._texture.orig.width},i.width.set=function(t){var e=ge(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t},i.height.get=function(){return Math.abs(this.scale.y)*this._texture.orig.height},i.height.set=function(t){var e=ge(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t},i.anchor.get=function(){return this._anchor},i.anchor.set=function(t){this._anchor.copyFrom(t)},i.tint.get=function(){return this._tint},i.tint.set=function(t){this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16)},i.texture.get=function(){return this._texture},i.texture.set=function(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Yr.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))},Object.defineProperties(r.prototype,i),r}(er),Zo={LINEAR_VERTICAL:0,LINEAR_HORIZONTAL:1},Jo={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Zo.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},Qo=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],$o=function(t){this.styleID=0,this.reset(),is(this,t,t)},ts={align:{configurable:!0},breakWords:{configurable:!0},dropShadow:{configurable:!0},dropShadowAlpha:{configurable:!0},dropShadowAngle:{configurable:!0},dropShadowBlur:{configurable:!0},dropShadowColor:{configurable:!0},dropShadowDistance:{configurable:!0},fill:{configurable:!0},fillGradientType:{configurable:!0},fillGradientStops:{configurable:!0},fontFamily:{configurable:!0},fontSize:{configurable:!0},fontStyle:{configurable:!0},fontVariant:{configurable:!0},fontWeight:{configurable:!0},letterSpacing:{configurable:!0},lineHeight:{configurable:!0},leading:{configurable:!0},lineJoin:{configurable:!0},miterLimit:{configurable:!0},padding:{configurable:!0},stroke:{configurable:!0},strokeThickness:{configurable:!0},textBaseline:{configurable:!0},trim:{configurable:!0},whiteSpace:{configurable:!0},wordWrap:{configurable:!0},wordWrapWidth:{configurable:!0}};function es(t){return"number"==typeof t?ee(t):("string"==typeof t&&0===t.indexOf("0x")&&(t=t.replace("0x","#")),t)}function rs(t){if(Array.isArray(t)){for(var e=0;e<t.length;++e)t[e]=es(t[e]);return t}return es(t)}function is(t,e,r){for(var i in r)Array.isArray(e[i])?t[i]=e[i].slice():t[i]=e[i]}$o.prototype.clone=function(){var t={};return is(t,this,Jo),new $o(t)},$o.prototype.reset=function(){is(this,Jo,Jo)},ts.align.get=function(){return this._align},ts.align.set=function(t){this._align!==t&&(this._align=t,this.styleID++)},ts.breakWords.get=function(){return this._breakWords},ts.breakWords.set=function(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)},ts.dropShadow.get=function(){return this._dropShadow},ts.dropShadow.set=function(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)},ts.dropShadowAlpha.get=function(){return this._dropShadowAlpha},ts.dropShadowAlpha.set=function(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)},ts.dropShadowAngle.get=function(){return this._dropShadowAngle},ts.dropShadowAngle.set=function(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)},ts.dropShadowBlur.get=function(){return this._dropShadowBlur},ts.dropShadowBlur.set=function(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)},ts.dropShadowColor.get=function(){return this._dropShadowColor},ts.dropShadowColor.set=function(t){var e=rs(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)},ts.dropShadowDistance.get=function(){return this._dropShadowDistance},ts.dropShadowDistance.set=function(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)},ts.fill.get=function(){return this._fill},ts.fill.set=function(t){var e=rs(t);this._fill!==e&&(this._fill=e,this.styleID++)},ts.fillGradientType.get=function(){return this._fillGradientType},ts.fillGradientType.set=function(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)},ts.fillGradientStops.get=function(){return this._fillGradientStops},ts.fillGradientStops.set=function(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(var r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)},ts.fontFamily.get=function(){return this._fontFamily},ts.fontFamily.set=function(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)},ts.fontSize.get=function(){return this._fontSize},ts.fontSize.set=function(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)},ts.fontStyle.get=function(){return this._fontStyle},ts.fontStyle.set=function(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)},ts.fontVariant.get=function(){return this._fontVariant},ts.fontVariant.set=function(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)},ts.fontWeight.get=function(){return this._fontWeight},ts.fontWeight.set=function(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)},ts.letterSpacing.get=function(){return this._letterSpacing},ts.letterSpacing.set=function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)},ts.lineHeight.get=function(){return this._lineHeight},ts.lineHeight.set=function(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)},ts.leading.get=function(){return this._leading},ts.leading.set=function(t){this._leading!==t&&(this._leading=t,this.styleID++)},ts.lineJoin.get=function(){return this._lineJoin},ts.lineJoin.set=function(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)},ts.miterLimit.get=function(){return this._miterLimit},ts.miterLimit.set=function(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)},ts.padding.get=function(){return this._padding},ts.padding.set=function(t){this._padding!==t&&(this._padding=t,this.styleID++)},ts.stroke.get=function(){return this._stroke},ts.stroke.set=function(t){var e=rs(t);this._stroke!==e&&(this._stroke=e,this.styleID++)},ts.strokeThickness.get=function(){return this._strokeThickness},ts.strokeThickness.set=function(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)},ts.textBaseline.get=function(){return this._textBaseline},ts.textBaseline.set=function(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)},ts.trim.get=function(){return this._trim},ts.trim.set=function(t){this._trim!==t&&(this._trim=t,this.styleID++)},ts.whiteSpace.get=function(){return this._whiteSpace},ts.whiteSpace.set=function(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)},ts.wordWrap.get=function(){return this._wordWrap},ts.wordWrap.set=function(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)},ts.wordWrapWidth.get=function(){return this._wordWrapWidth},ts.wordWrapWidth.set=function(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)},$o.prototype.toFontString=function(){var t="number"==typeof this.fontSize?this.fontSize+"px":this.fontSize,e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(var r=e.length-1;r>=0;r--){var i=e[r].trim();!/([\"\'])[^\'\"]+\1/.test(i)&&Qo.indexOf(i)<0&&(i='"'+i+'"'),e[r]=i}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+t+" "+e.join(",")},Object.defineProperties($o.prototype,ts);var ns=function(t,e,r,i,n,o,s,a,h){this.text=t,this.style=e,this.width=r,this.height=i,this.lines=n,this.lineWidths=o,this.lineHeight=s,this.maxLineWidth=a,this.fontProperties=h};ns.measureText=function(t,e,r,i){void 0===i&&(i=ns._canvas),r=null==r?e.wordWrap:r;var n=e.toFontString(),o=ns.measureFont(n);0===o.fontSize&&(o.fontSize=e.fontSize,o.ascent=e.fontSize);var s=i.getContext("2d");s.font=n;for(var a=(r?ns.wordWrap(t,e,i):t).split(/(?:\r\n|\r|\n)/),h=new Array(a.length),u=0,l=0;l<a.length;l++){var c=s.measureText(a[l]).width+(a[l].length-1)*e.letterSpacing;h[l]=c,u=Math.max(u,c)}var d=u+e.strokeThickness;e.dropShadow&&(d+=e.dropShadowDistance);var p=e.lineHeight||o.fontSize+e.strokeThickness,f=Math.max(p,o.fontSize+e.strokeThickness)+(a.length-1)*(p+e.leading);return e.dropShadow&&(f+=e.dropShadowDistance),new ns(t,e,d,f,a,h,p+e.leading,u,o)},ns.wordWrap=function(t,e,r){void 0===r&&(r=ns._canvas);for(var i=r.getContext("2d"),n=0,o="",s="",a={},h=e.letterSpacing,u=e.whiteSpace,l=ns.collapseSpaces(u),c=ns.collapseNewlines(u),d=!l,p=e.wordWrapWidth+h,f=ns.tokenize(t),v=0;v<f.length;v++){var g=f[v];if(ns.isNewline(g)){if(!c){s+=ns.addLine(o),d=!l,o="",n=0;continue}g=" "}if(l){var m=ns.isBreakingSpace(g),y=ns.isBreakingSpace(o[o.length-1]);if(m&&y)continue}var _=ns.getFromCache(g,h,a,i);if(_>p)if(""!==o&&(s+=ns.addLine(o),o="",n=0),ns.canBreakWords(g,e.breakWords))for(var x=ns.wordWrapSplit(g),b=0;b<x.length;b++){for(var E=x[b],T=1;x[b+T];){var S=x[b+T],w=E[E.length-1];if(ns.canBreakChars(w,S,g,b,e.breakWords))break;E+=S,T++}b+=E.length-1;var P=ns.getFromCache(E,h,a,i);P+n>p&&(s+=ns.addLine(o),d=!1,o="",n=0),o+=E,n+=P}else{o.length>0&&(s+=ns.addLine(o),o="",n=0);var I=v===f.length-1;s+=ns.addLine(g,!I),d=!1,o="",n=0}else _+n>p&&(d=!1,s+=ns.addLine(o),o="",n=0),(o.length>0||!ns.isBreakingSpace(g)||d)&&(o+=g,n+=_)}return s+=ns.addLine(o,!1)},ns.addLine=function(t,e){return void 0===e&&(e=!0),t=ns.trimRight(t),t=e?t+"\n":t},ns.getFromCache=function(t,e,r,i){var n=r[t];if(void 0===n){var o=t.length*e;n=i.measureText(t).width+o,r[t]=n}return n},ns.collapseSpaces=function(t){return"normal"===t||"pre-line"===t},ns.collapseNewlines=function(t){return"normal"===t},ns.trimRight=function(t){if("string"!=typeof t)return"";for(var e=t.length-1;e>=0;e--){var r=t[e];if(!ns.isBreakingSpace(r))break;t=t.slice(0,-1)}return t},ns.isNewline=function(t){return"string"==typeof t&&ns._newlines.indexOf(t.charCodeAt(0))>=0},ns.isBreakingSpace=function(t){return"string"==typeof t&&ns._breakingSpaces.indexOf(t.charCodeAt(0))>=0},ns.tokenize=function(t){var e=[],r="";if("string"!=typeof t)return e;for(var i=0;i<t.length;i++){var n=t[i];ns.isBreakingSpace(n)||ns.isNewline(n)?(""!==r&&(e.push(r),r=""),e.push(n)):r+=n}return""!==r&&e.push(r),e},ns.canBreakWords=function(t,e){return e},ns.canBreakChars=function(t,e,r,i,n){return!0},ns.wordWrapSplit=function(t){return t.split("")},ns.measureFont=function(t){if(ns._fonts[t])return ns._fonts[t];var e={},r=ns._canvas,i=ns._context;i.font=t;var n=ns.METRICS_STRING+ns.BASELINE_SYMBOL,o=Math.ceil(i.measureText(n).width),s=Math.ceil(i.measureText(ns.BASELINE_SYMBOL).width),a=2*s;s=s*ns.BASELINE_MULTIPLIER|0,r.width=o,r.height=a,i.fillStyle="#f00",i.fillRect(0,0,o,a),i.font=t,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(n,0,s);var h=i.getImageData(0,0,o,a).data,u=h.length,l=4*o,c=0,d=0,p=!1;for(c=0;c<s;++c){for(var f=0;f<l;f+=4)if(255!==h[d+f]){p=!0;break}if(p)break;d+=l}for(e.ascent=s-c,d=u-l,p=!1,c=a;c>s;--c){for(var v=0;v<l;v+=4)if(255!==h[d+v]){p=!0;break}if(p)break;d-=l}return e.descent=c-s,e.fontSize=e.ascent+e.descent,ns._fonts[t]=e,e},ns.clearMetrics=function(t){void 0===t&&(t=""),t?delete ns._fonts[t]:ns._fonts={}};var os=function(){try{var t=new OffscreenCanvas(0,0),e=t.getContext("2d");return e&&e.measureText?t:document.createElement("canvas")}catch(t){return document.createElement("canvas")}}();os.width=os.height=10,ns._canvas=os,ns._context=os.getContext("2d"),ns._fonts={},ns.METRICS_STRING="|ÉqÅ",ns.BASELINE_SYMBOL="M",ns.BASELINE_MULTIPLIER=1.4,ns._newlines=[10,13],ns._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var ss={texture:!0,children:!1,baseTexture:!0},as=function(t){function e(e,r,i){var n=!1;i||(i=document.createElement("canvas"),n=!0),i.width=3,i.height=3;var o=Yr.from(i);o.orig=new We,o.trim=new We,t.call(this,o),this._ownCanvas=n,this.canvas=i,this.context=this.canvas.getContext("2d"),this._resolution=C.RESOLUTION,this._autoResolution=!0,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=r,this.localStyleID=-1}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={width:{configurable:!0},height:{configurable:!0},style:{configurable:!0},text:{configurable:!0},resolution:{configurable:!0}};return e.prototype.updateText=function(t){var e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),this.dirty||!t){this._font=this._style.toFontString();var r,i,n=this.context,o=ns.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),s=o.width,a=o.height,h=o.lines,u=o.lineHeight,l=o.lineWidths,c=o.maxLineWidth,d=o.fontProperties;this.canvas.width=Math.ceil((Math.max(1,s)+2*e.padding)*this._resolution),this.canvas.height=Math.ceil((Math.max(1,a)+2*e.padding)*this._resolution),n.scale(this._resolution,this._resolution),n.clearRect(0,0,this.canvas.width,this.canvas.height),n.font=this._font,n.lineWidth=e.strokeThickness,n.textBaseline=e.textBaseline,n.lineJoin=e.lineJoin,n.miterLimit=e.miterLimit;for(var p=e.dropShadow?2:1,f=0;f<p;++f){var v=e.dropShadow&&0===f,g=v?2*a:0,m=g*this.resolution;if(v){n.fillStyle="black",n.strokeStyle="black";var y=e.dropShadowColor,_=te("number"==typeof y?y:re(y));n.shadowColor="rgba("+255*_[0]+","+255*_[1]+","+255*_[2]+","+e.dropShadowAlpha+")",n.shadowBlur=e.dropShadowBlur,n.shadowOffsetX=Math.cos(e.dropShadowAngle)*e.dropShadowDistance,n.shadowOffsetY=Math.sin(e.dropShadowAngle)*e.dropShadowDistance+m}else n.fillStyle=this._generateFillStyle(e,h,o),n.strokeStyle=e.stroke,n.shadowColor=0,n.shadowBlur=0,n.shadowOffsetX=0,n.shadowOffsetY=0;for(var x=0;x<h.length;x++)r=e.strokeThickness/2,i=e.strokeThickness/2+x*u+d.ascent,"right"===e.align?r+=c-l[x]:"center"===e.align&&(r+=(c-l[x])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(h[x],r+e.padding,i+e.padding-g,!0),e.fill&&this.drawLetterSpacing(h[x],r+e.padding,i+e.padding-g)}this.updateTexture()}},e.prototype.drawLetterSpacing=function(t,e,r,i){void 0===i&&(i=!1);var n=this._style.letterSpacing;if(0!==n)for(var o=e,s=Array.from?Array.from(t):t.split(""),a=this.context.measureText(t).width,h=0,u=0;u<s.length;++u){var l=s[u];i?this.context.strokeText(l,o,r):this.context.fillText(l,o,r),o+=a-(h=this.context.measureText(t.substring(u+1)).width)+n,a=h}else i?this.context.strokeText(t,e,r):this.context.fillText(t,e,r)},e.prototype.updateTexture=function(){var t=this.canvas;if(this._style.trim){var e=we(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}var r=this._texture,i=this._style,n=i.trim?0:i.padding,o=r.baseTexture;r.trim.width=r._frame.width=Math.ceil(t.width/this._resolution),r.trim.height=r._frame.height=Math.ceil(t.height/this._resolution),r.trim.x=-n,r.trim.y=-n,r.orig.width=r._frame.width-2*n,r.orig.height=r._frame.height-2*n,this._onTextureUpdate(),o.setRealSize(t.width,t.height,this._resolution),this.dirty=!1},e.prototype._render=function(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),t.prototype._render.call(this,e)},e.prototype.getLocalBounds=function(e){return this.updateText(!0),t.prototype.getLocalBounds.call(this,e)},e.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},e.prototype._onStyleChange=function(){this.dirty=!0},e.prototype._generateFillStyle=function(t,e,r){if(!Array.isArray(t.fill))return t.fill;if(1===t.fill.length)return t.fill[0];var i,n=t.dropShadow?t.dropShadowDistance:0,o=t.padding||0,s=Math.ceil(this.canvas.width/this._resolution)-n-2*o,a=Math.ceil(this.canvas.height/this._resolution)-n-2*o,h=t.fill.slice(),u=t.fillGradientStops.slice();if(!u.length)for(var l=h.length+1,c=1;c<l;++c)u.push(c/l);if(h.unshift(t.fill[0]),u.unshift(0),h.push(t.fill[t.fill.length-1]),u.push(1),t.fillGradientType===Zo.LINEAR_VERTICAL){i=this.context.createLinearGradient(s/2,o,s/2,a+o);for(var d=0,p=(r.fontProperties.fontSize+t.strokeThickness)/a,f=0;f<e.length;f++)for(var v=r.lineHeight*f,g=0;g<h.length;g++){var m=v/a+("number"==typeof u[g]?u[g]:g/h.length)*p,y=Math.max(d,m);y=Math.min(y,1),i.addColorStop(y,h[g]),d=y}}else{i=this.context.createLinearGradient(o,a/2,s+o,a/2);for(var _=h.length+1,x=1,b=0;b<h.length;b++){var E=void 0;E="number"==typeof u[b]?u[b]:x/_,i.addColorStop(E,h[b]),x++}}return i},e.prototype.destroy=function(e){"boolean"==typeof e&&(e={children:e}),e=Object.assign({},ss,e),t.prototype.destroy.call(this,e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null},r.width.get=function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},r.width.set=function(t){this.updateText(!0);var e=ge(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t},r.height.get=function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},r.height.set=function(t){this.updateText(!0);var e=ge(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t},r.style.get=function(){return this._style},r.style.set=function(t){t=t||{},this._style=t instanceof $o?t:new $o(t),this.localStyleID=-1,this.dirty=!0},r.text.get=function(){return this._text},r.text.set=function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},r.resolution.get=function(){return this._resolution},r.resolution.set=function(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)},Object.defineProperties(e.prototype,r),e}(Ko);C.UPLOADS_PER_FRAME=4;var hs=function(t){this.maxItemsPerFrame=t,this.itemsLeft=0};hs.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},hs.prototype.allowedToUpload=function(){return this.itemsLeft-- >0};var us=function(t){var e=this;this.limiter=new hs(C.UPLOADS_PER_FRAME),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){e.queue&&e.prepareItems()},this.registerFindHook(vs),this.registerFindHook(gs),this.registerFindHook(ls),this.registerFindHook(cs),this.registerFindHook(ds),this.registerUploadHook(ps),this.registerUploadHook(fs)};function ls(t,e){var r=!1;if(t&&t._textures&&t._textures.length)for(var i=0;i<t._textures.length;i++)if(t._textures[i]instanceof Yr){var n=t._textures[i].baseTexture;-1===e.indexOf(n)&&(e.push(n),r=!0)}return r}function cs(t,e){if(t.baseTexture instanceof Or){var r=t.baseTexture;return-1===e.indexOf(r)&&e.push(r),!0}return!1}function ds(t,e){if(t._texture&&t._texture instanceof Yr){var r=t._texture.baseTexture;return-1===e.indexOf(r)&&e.push(r),!0}return!1}function ps(t,e){return e instanceof as&&(e.updateText(!0),!0)}function fs(t,e){if(e instanceof $o){var r=e.toFontString();return ns.measureFont(r),!0}return!1}function vs(t,e){if(t instanceof as){-1===e.indexOf(t.style)&&e.push(t.style),-1===e.indexOf(t)&&e.push(t);var r=t._texture.baseTexture;return-1===e.indexOf(r)&&e.push(r),!0}return!1}function gs(t,e){return t instanceof $o&&(-1===e.indexOf(t)&&e.push(t),!0)}us.prototype.upload=function(e,r){"function"==typeof e&&(r=e,e=null),e&&this.add(e),this.queue.length?(r&&this.completes.push(r),this.ticking||(this.ticking=!0,ar.system.addOnce(this.tick,this,t.UPDATE_PRIORITY.UTILITY))):r&&r()},us.prototype.tick=function(){setTimeout(this.delayedTick,0)},us.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var e=this.queue[0],r=!1;if(e&&!e._destroyed)for(var i=0,n=this.uploadHooks.length;i<n;i++)if(this.uploadHooks[i](this.uploadHookHelper,e)){this.queue.shift(),r=!0;break}r||this.queue.shift()}if(this.queue.length)ar.system.addOnce(this.tick,this,t.UPDATE_PRIORITY.UTILITY);else{this.ticking=!1;var o=this.completes.slice(0);this.completes.length=0;for(var s=0,a=o.length;s<a;s++)o[s]()}},us.prototype.registerFindHook=function(t){return t&&this.addHooks.push(t),this},us.prototype.registerUploadHook=function(t){return t&&this.uploadHooks.push(t),this},us.prototype.add=function(t){for(var e=0,r=this.addHooks.length;e<r&&!this.addHooks[e](t,this.queue);e++);if(t instanceof er)for(var i=t.children.length-1;i>=0;i--)this.add(t.children[i]);return this},us.prototype.destroy=function(){this.ticking&&ar.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null};var ms=function(t){function e(e){t.call(this,e),this.uploadHookHelper=this.renderer,this.registerFindHook(xs),this.registerUploadHook(ys),this.registerUploadHook(_s)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(us);function ys(t,e){return e instanceof Or&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function _s(t,e){if(!(e instanceof Vo))return!1;var r=e.geometry;e.finishPoly(),r.updateBatches();for(var i=r.batches,n=0;n<i.length;n++){var o=i[n].style.texture;o&&ys(t,o.baseTexture)}return r.batchable||t.geometry.bind(r,e._resolveDirectShader(t)),!0}function xs(t,e){return t instanceof Vo&&(e.push(t),!0)}var bs=function(t){this.maxMilliseconds=t,this.frameStart=0};bs.prototype.beginFrame=function(){this.frameStart=Date.now()},bs.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds};var Es=function(t,e,r){void 0===r&&(r=null),this.baseTexture=t,this.textures={},this.animations={},this.data=e,this.resolution=this._updateResolution(r||(this.baseTexture.resource?this.baseTexture.resource.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null},Ts={BATCH_SIZE:{configurable:!0}};Ts.BATCH_SIZE.get=function(){return 1e3},Es.prototype._updateResolution=function(t){var e=this.data.meta.scale,r=Oe(t,null);return null===r&&(r=void 0!==e?parseFloat(e):1),1!==r&&this.baseTexture.setResolution(r),r},Es.prototype.parse=function(t){this._batchIndex=0,this._callback=t,this._frameKeys.length<=Es.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()},Es.prototype._processFrames=function(t){for(var e=t,r=Es.BATCH_SIZE;e-t<r&&e<this._frameKeys.length;){var i=this._frameKeys[e],n=this._frames[i],o=n.frame;if(o){var s=null,a=null,h=!1!==n.trimmed&&n.sourceSize?n.sourceSize:n.frame,u=new We(0,0,Math.floor(h.w)/this.resolution,Math.floor(h.h)/this.resolution);s=n.rotated?new We(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):new We(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),!1!==n.trimmed&&n.spriteSourceSize&&(a=new We(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[i]=new Yr(this.baseTexture,s,u,a,n.rotated?2:0,n.anchor),Yr.addToCache(this.textures[i],i)}e++}},Es.prototype._processAnimations=function(){var t=this.data.animations||{};for(var e in t){this.animations[e]=[];for(var r=0;r<t[e].length;r++){var i=t[e][r];this.animations[e].push(this.textures[i])}}},Es.prototype._parseComplete=function(){var t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)},Es.prototype._nextBatch=function(){var t=this;this._processFrames(this._batchIndex*Es.BATCH_SIZE),this._batchIndex++,setTimeout(function(){t._batchIndex*Es.BATCH_SIZE<t._frameKeys.length?t._nextBatch():(t._processAnimations(),t._parseComplete())},0)},Es.prototype.destroy=function(t){for(var e in void 0===t&&(t=!1),this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&this.baseTexture.destroy(),this.baseTexture=null},Object.defineProperties(Es,Ts);var Ss=function(){};Ss.use=function(t,e){var r=t.name+"_image";if(t.data&&t.type===vo.TYPE.JSON&&t.data.frames&&!this.resources[r]){var i={crossOrigin:t.crossOrigin,metadata:t.metadata.imageMetadata,parentResource:t},n=Ss.getResourcePath(t,this.baseUrl);this.add(r,n,i,function(r){if(r.error)e(r.error);else{var i=r.texture.baseTexture;r.texture.destroy();var n=new Es(i,t.data,t.url);n.parse(function(){t.spritesheet=n,t.textures=n.textures,e()})}})}else e()},Ss.getResourcePath=function(t,e){return t.isDataUrl?t.data.meta.image:qt.resolve(t.url.replace(e,""),t.data.meta.image)};var ws=new Ce,Ps=function(t){function e(e,r,i){void 0===r&&(r=100),void 0===i&&(i=100),t.call(this,e),this.tileTransform=new Ve,this._width=r,this._height=i,this._canvasPattern=null,this.uvMatrix=e.uvMatrix||new Zi(e),this.pluginName="tilingSprite",this.uvRespectAnchor=!1}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={clampMargin:{configurable:!0},tileScale:{configurable:!0},tilePosition:{configurable:!0},width:{configurable:!0},height:{configurable:!0}};return r.clampMargin.get=function(){return this.uvMatrix.clampMargin},r.clampMargin.set=function(t){this.uvMatrix.clampMargin=t,this.uvMatrix.update(!0)},r.tileScale.get=function(){return this.tileTransform.scale},r.tileScale.set=function(t){this.tileTransform.scale.copyFrom(t)},r.tilePosition.get=function(){return this.tileTransform.position},r.tilePosition.set=function(t){this.tileTransform.position.copyFrom(t)},e.prototype._onTextureUpdate=function(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215},e.prototype._render=function(t){var e=this._texture;e&&e.valid&&(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))},e.prototype._calculateBounds=function(){var t=this._width*-this._anchor._x,e=this._height*-this._anchor._y,r=this._width*(1-this._anchor._x),i=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,e,r,i)},e.prototype.getLocalBounds=function(e){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new We),e=this._localBoundsRect),this._bounds.getRectangle(e)):t.prototype.getLocalBounds.call(this,e)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,ws);var e=this._width,r=this._height,i=-e*this.anchor._x;if(ws.x>=i&&ws.x<i+e){var n=-r*this.anchor._y;if(ws.y>=n&&ws.y<n+r)return!0}return!1},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.tileTransform=null,this.uvMatrix=null},e.from=function(t,r,i){return new e(Yr.from(t),r,i)},e.fromFrame=function(t,r,i){var n=Ee[t];if(!n)throw new Error('The frameId "'+t+'" does not exist in the texture cache '+this);return new e(n,r,i)},e.fromImage=function(t,r,i,n){return n&&"object"!=typeof n&&(n={scaleMode:arguments[4],resourceOptions:{crossorigin:arguments[3]}}),new e(Yr.from(t,n),r,i)},r.width.get=function(){return this._width},r.width.set=function(t){this._width=t},r.height.get=function(){return this._height},r.height.set=function(t){this._height=t},Object.defineProperties(e.prototype,r),e}(Ko),Is="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n",As="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord - floor(vTextureCoord - uClampOffset);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture2D(uSampler, coord);\n    gl_FragColor = texSample * uColor;\n}\n",Os="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 sample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = sample * uColor;\n}\n",Ds=new Be,Ms=function(e){function r(t){e.call(this,t);var r={globals:this.renderer.globalUniforms};this.shader=Hi.from(Is,As,r),this.simpleShader=Hi.from(Is,Os,r),this.quad=new ni,this.state=Yi.for2d()}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.render=function(e){var r=this.renderer,i=this.quad,n=i.vertices;n[0]=n[6]=e._width*-e.anchor.x,n[1]=n[3]=e._height*-e.anchor.y,n[2]=n[4]=e._width*(1-e.anchor.x),n[5]=n[7]=e._height*(1-e.anchor.y),e.uvRespectAnchor&&((n=i.uvs)[0]=n[6]=-e.anchor.x,n[1]=n[3]=-e.anchor.y,n[2]=n[4]=1-e.anchor.x,n[5]=n[7]=1-e.anchor.y),i.invalidate();var o=e._texture,s=o.baseTexture,a=e.tileTransform.localTransform,h=e.uvMatrix,u=s.isPowerOfTwo&&o.frame.width===s.width&&o.frame.height===s.height;u&&(s._glTextures[r.CONTEXT_UID]?u=s.wrapMode!==t.WRAP_MODES.CLAMP:s.wrapMode===t.WRAP_MODES.CLAMP&&(s.wrapMode=t.WRAP_MODES.REPEAT));var l=u?this.simpleShader:this.shader,c=o.width,d=o.height,p=e._width,f=e._height;Ds.set(a.a*c/p,a.b*c/f,a.c*d/p,a.d*d/f,a.tx/p,a.ty/f),Ds.invert(),u?Ds.prepend(h.mapCoord):(l.uniforms.uMapCoord=h.mapCoord.toArray(!0),l.uniforms.uClampFrame=h.uClampFrame,l.uniforms.uClampOffset=h.uClampOffset),l.uniforms.uTransform=Ds.toArray(!0),l.uniforms.uColor=he(e.tint,e.worldAlpha,l.uniforms.uColor,s.alphaMode),l.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),l.uniforms.uSampler=o,r.shader.bind(l),r.geometry.bind(i),this.state.blendMode=oe(e.blendMode,s.alphaMode),r.state.set(this.state),r.geometry.draw(this.renderer.gl.TRIANGLES,6,0)},r}(ui),Cs=function(t){function e(e,r){var i=this;void 0===r&&(r={}),t.call(this),this._textWidth=0,this._textHeight=0,this._glyphs=[],this._font={tint:void 0!==r.tint?r.tint:16777215,align:r.align||"left",name:null,size:0},this.font=r.font,this._text=e,this._maxWidth=0,this._maxLineHeight=0,this._letterSpacing=0,this._anchor=new Re(function(){i.dirty=!0},this,0,0),this.dirty=!1,this.roundPixels=C.ROUND_PIXELS,this.updateText()}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={tint:{configurable:!0},align:{configurable:!0},anchor:{configurable:!0},font:{configurable:!0},text:{configurable:!0},maxWidth:{configurable:!0},maxLineHeight:{configurable:!0},textWidth:{configurable:!0},letterSpacing:{configurable:!0},textHeight:{configurable:!0}};return e.prototype.updateText=function(){for(var t=e.fonts[this._font.name],r=this._font.size/t.size,i=new Ce,n=[],o=[],s=this._text.replace(/(?:\r\n|\r)/g,"\n")||" ",a=s.length,h=this._maxWidth*t.size/this._font.size,u=null,l=0,c=0,d=0,p=-1,f=0,v=0,g=0,m=0;m<a;m++){var y=s.charCodeAt(m),_=s.charAt(m);if(/(?:\s)/.test(_)&&(p=m,f=l),"\r"!==_&&"\n"!==_){var x=t.chars[y];x&&(u&&x.kerning[u]&&(i.x+=x.kerning[u]),n.push({texture:x.texture,line:d,charCode:y,position:new Ce(i.x+x.xOffset+this._letterSpacing/2,i.y+x.yOffset)}),i.x+=x.xAdvance+this._letterSpacing,l=i.x,g=Math.max(g,x.yOffset+x.texture.height),u=y,-1!==p&&h>0&&i.x>h&&(ve(n,1+p-++v,1+m-p),m=p,p=-1,o.push(f),c=Math.max(c,f),d++,i.x=0,i.y+=t.lineHeight,u=null))}else o.push(l),c=Math.max(c,l),++d,++v,i.x=0,i.y+=t.lineHeight,u=null}var b=s.charAt(s.length-1);"\r"!==b&&"\n"!==b&&(/(?:\s)/.test(b)&&(l=f),o.push(l),c=Math.max(c,l));for(var E=[],T=0;T<=d;T++){var S=0;"right"===this._font.align?S=c-o[T]:"center"===this._font.align&&(S=(c-o[T])/2),E.push(S)}for(var w=n.length,P=this.tint,I=0;I<w;I++){var A=this._glyphs[I];A?A.texture=n[I].texture:((A=new Ko(n[I].texture)).roundPixels=this.roundPixels,this._glyphs.push(A)),A.position.x=(n[I].position.x+E[n[I].line])*r,A.position.y=n[I].position.y*r,A.scale.x=A.scale.y=r,A.tint=P,A.parent||this.addChild(A)}for(var O=w;O<this._glyphs.length;++O)this.removeChild(this._glyphs[O]);if(this._textWidth=c*r,this._textHeight=(i.y+t.lineHeight)*r,0!==this.anchor.x||0!==this.anchor.y)for(var D=0;D<w;D++)this._glyphs[D].x-=this._textWidth*this.anchor.x,this._glyphs[D].y-=this._textHeight*this.anchor.y;this._maxLineHeight=g*r},e.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},e.prototype.getLocalBounds=function(){return this.validate(),t.prototype.getLocalBounds.call(this)},e.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},r.tint.get=function(){return this._font.tint},r.tint.set=function(t){this._font.tint="number"==typeof t&&t>=0?t:16777215,this.dirty=!0},r.align.get=function(){return this._font.align},r.align.set=function(t){this._font.align=t||"left",this.dirty=!0},r.anchor.get=function(){return this._anchor},r.anchor.set=function(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)},r.font.get=function(){return this._font},r.font.set=function(t){t&&("string"==typeof t?(t=t.split(" "),this._font.name=1===t.length?t[0]:t.slice(1).join(" "),this._font.size=t.length>=2?parseInt(t[0],10):e.fonts[this._font.name].size):(this._font.name=t.name,this._font.size="number"==typeof t.size?t.size:parseInt(t.size,10)),this.dirty=!0)},r.text.get=function(){return this._text},r.text.set=function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},r.maxWidth.get=function(){return this._maxWidth},r.maxWidth.set=function(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)},r.maxLineHeight.get=function(){return this.validate(),this._maxLineHeight},r.textWidth.get=function(){return this.validate(),this._textWidth},r.letterSpacing.get=function(){return this._letterSpacing},r.letterSpacing.set=function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)},r.textHeight.get=function(){return this.validate(),this._textHeight},e.registerFont=function(t,r){var i={},n=t.getElementsByTagName("info")[0],o=t.getElementsByTagName("common")[0],s=t.getElementsByTagName("page"),a=Oe(s[0].getAttribute("file")),h={};i.font=n.getAttribute("face"),i.size=parseInt(n.getAttribute("size"),10),i.lineHeight=parseInt(o.getAttribute("lineHeight"),10)/a,i.chars={},r instanceof Yr&&(r=[r]);for(var u=0;u<s.length;u++){var l=s[u].getAttribute("id"),c=s[u].getAttribute("file");h[l]=r instanceof Array?r[u]:r[c]}for(var d=t.getElementsByTagName("char"),p=0;p<d.length;p++){var f=d[p],v=parseInt(f.getAttribute("id"),10),g=f.getAttribute("page")||0,m=new We(parseInt(f.getAttribute("x"),10)/a+h[g].frame.x/a,parseInt(f.getAttribute("y"),10)/a+h[g].frame.y/a,parseInt(f.getAttribute("width"),10)/a,parseInt(f.getAttribute("height"),10)/a);i.chars[v]={xOffset:parseInt(f.getAttribute("xoffset"),10)/a,yOffset:parseInt(f.getAttribute("yoffset"),10)/a,xAdvance:parseInt(f.getAttribute("xadvance"),10)/a,kerning:{},texture:new Yr(h[g].baseTexture,m),page:g}}for(var y=t.getElementsByTagName("kerning"),_=0;_<y.length;_++){var x=y[_],b=parseInt(x.getAttribute("first"),10)/a,E=parseInt(x.getAttribute("second"),10)/a,T=parseInt(x.getAttribute("amount"),10)/a;i.chars[E]&&(i.chars[E].kerning[b]=T)}return e.fonts[i.font]=i,i},Object.defineProperties(e.prototype,r),e}(er);Cs.fonts={};var Rs=function(){};Rs.parse=function(t,e){t.bitmapFont=Cs.registerFont(t.data,e)},Rs.add=function(){vo.setExtensionXhrType("fnt",vo.XHR_RESPONSE_TYPE.DOCUMENT)},Rs.dirname=function(t){var e=t.replace(/\\/g,"/").replace(/\/$/,"").replace(/\/[^\/]*$/,"");return e===t?".":""===e?"/":e},Rs.use=function(t,e){if(t.data&&t.type===vo.TYPE.XML)if(0!==t.data.getElementsByTagName("page").length&&0!==t.data.getElementsByTagName("info").length&&null!==t.data.getElementsByTagName("info")[0].getAttribute("face")){var r=t.isDataUrl?"":Rs.dirname(t.url);t.isDataUrl&&("."===r&&(r=""),this.baseUrl&&r&&"/"===this.baseUrl.charAt(this.baseUrl.length-1)&&(r+="/")),(r=r.replace(this.baseUrl,""))&&"/"!==r.charAt(r.length-1)&&(r+="/");for(var i=t.data.getElementsByTagName("page"),n={},o=function(r){n[r.metadata.pageFile]=r.texture,Object.keys(n).length===i.length&&(Rs.parse(t,n),e())},s=0;s<i.length;++s){var a=i[s].getAttribute("file"),h=r+a,u=!1;for(var l in this.resources){var c=this.resources[l];if(c.url===h){c.metadata.pageFile=a,c.texture?o(c):c.onAfterMiddleware.add(o),u=!0;break}}if(!u){var d={crossOrigin:t.crossOrigin,loadType:vo.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:a},t.metadata.imageMetadata),parentResource:t};this.add(h,d,o)}}}else e();else e()};var Ls="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",Ns=function(t){function e(e){void 0===e&&(e=1),t.call(this,wn,Ls,{uAlpha:1}),this.alpha=e}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={alpha:{configurable:!0}};return r.alpha.get=function(){return this.uniforms.uAlpha},r.alpha.set=function(t){this.uniforms.uAlpha=t},Object.defineProperties(e.prototype,r),e}(Vi),Fs="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }";var Bs={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},Us=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");var ks=function(t){function e(e,r,i,n,o){var s=function(t,e){var r,i=Math.ceil(t/2),n=Fs,o="";r=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(var s=0;s<t;s++){var a=r.replace("%index%",s);o+=a=a.replace("%sampleIndex%",s-(i-1)+".0"),o+="\n"}return n=(n=n.replace("%blur%",o)).replace("%size%",t)}(o=o||5,e),a=function(t){for(var e,r=Bs[t],i=r.length,n=Us,o="",s=0;s<t;s++){var a="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",s);e=s,s>=i&&(e=t-s-1),o+=a=a.replace("%value%",r[e]),o+="\n"}return n=(n=n.replace("%blur%",o)).replace("%size%",t)}(o);t.call(this,s,a),this.horizontal=e,this.resolution=n||C.RESOLUTION,this._quality=0,this.quality=i||4,this.blur=r||8}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={blur:{configurable:!0},quality:{configurable:!0}};return e.prototype.apply=function(t,e,r,i){if(r?this.horizontal?this.uniforms.strength=1/r.width*(r.width/e.width):this.uniforms.strength=1/r.height*(r.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,r,i);else{var n=t.getFilterTexture(),o=t.renderer,s=e,a=n;this.state.blend=!1,t.applyFilter(this,s,a,!0);for(var h=1;h<this.passes-1;h++){o.renderTexture.bind(s,s.filterFrame),this.uniforms.uSampler=a;var u=a;a=s,s=u,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,a,r,i),t.returnFilterTexture(n)}},r.blur.get=function(){return this.strength},r.blur.set=function(t){this.padding=1+2*Math.abs(t),this.strength=t},r.quality.get=function(){return this._quality},r.quality.set=function(t){this._quality=t,this.passes=t},Object.defineProperties(e.prototype,r),e}(Vi),Xs=function(t){function e(e,r,i,n){t.call(this),this.blurXFilter=new ks(!0,e,r,i,n),this.blurYFilter=new ks(!1,e,r,i,n),this.resolution=i||C.RESOLUTION,this.quality=r||4,this.blur=e||8,this.repeatEdgePixels=!1}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={blur:{configurable:!0},quality:{configurable:!0},blurX:{configurable:!0},blurY:{configurable:!0},blendMode:{configurable:!0},repeatEdgePixels:{configurable:!0}};return e.prototype.apply=function(t,e,r,i){var n=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(n&&o){var s=t.getFilterTexture();this.blurXFilter.apply(t,e,s,!0),this.blurYFilter.apply(t,s,r,i),t.returnFilterTexture(s)}else o?this.blurYFilter.apply(t,e,r,i):this.blurXFilter.apply(t,e,r,i)},e.prototype.updatePadding=function(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))},r.blur.get=function(){return this.blurXFilter.blur},r.blur.set=function(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()},r.quality.get=function(){return this.blurXFilter.quality},r.quality.set=function(t){this.blurXFilter.quality=this.blurYFilter.quality=t},r.blurX.get=function(){return this.blurXFilter.blur},r.blurX.set=function(t){this.blurXFilter.blur=t,this.updatePadding()},r.blurY.get=function(){return this.blurYFilter.blur},r.blurY.set=function(t){this.blurYFilter.blur=t,this.updatePadding()},r.blendMode.get=function(){return this.blurYFilter.blendMode},r.blendMode.set=function(t){this.blurYFilter.blendMode=t},r.repeatEdgePixels.get=function(){return this._repeatEdgePixels},r.repeatEdgePixels.set=function(t){this._repeatEdgePixels=t,this.updatePadding()},Object.defineProperties(e.prototype,r),e}(Vi),js="varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",Hs=function(t){function e(){var e={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};t.call(this,Pn,js,e),this.alpha=1}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={matrix:{configurable:!0},alpha:{configurable:!0}};return e.prototype._loadMatrix=function(t,e){void 0===e&&(e=!1);var r=t;e&&(this._multiply(r,this.uniforms.m,t),r=this._colorMatrix(r)),this.uniforms.m=r},e.prototype._multiply=function(t,e,r){return t[0]=e[0]*r[0]+e[1]*r[5]+e[2]*r[10]+e[3]*r[15],t[1]=e[0]*r[1]+e[1]*r[6]+e[2]*r[11]+e[3]*r[16],t[2]=e[0]*r[2]+e[1]*r[7]+e[2]*r[12]+e[3]*r[17],t[3]=e[0]*r[3]+e[1]*r[8]+e[2]*r[13]+e[3]*r[18],t[4]=e[0]*r[4]+e[1]*r[9]+e[2]*r[14]+e[3]*r[19]+e[4],t[5]=e[5]*r[0]+e[6]*r[5]+e[7]*r[10]+e[8]*r[15],t[6]=e[5]*r[1]+e[6]*r[6]+e[7]*r[11]+e[8]*r[16],t[7]=e[5]*r[2]+e[6]*r[7]+e[7]*r[12]+e[8]*r[17],t[8]=e[5]*r[3]+e[6]*r[8]+e[7]*r[13]+e[8]*r[18],t[9]=e[5]*r[4]+e[6]*r[9]+e[7]*r[14]+e[8]*r[19]+e[9],t[10]=e[10]*r[0]+e[11]*r[5]+e[12]*r[10]+e[13]*r[15],t[11]=e[10]*r[1]+e[11]*r[6]+e[12]*r[11]+e[13]*r[16],t[12]=e[10]*r[2]+e[11]*r[7]+e[12]*r[12]+e[13]*r[17],t[13]=e[10]*r[3]+e[11]*r[8]+e[12]*r[13]+e[13]*r[18],t[14]=e[10]*r[4]+e[11]*r[9]+e[12]*r[14]+e[13]*r[19]+e[14],t[15]=e[15]*r[0]+e[16]*r[5]+e[17]*r[10]+e[18]*r[15],t[16]=e[15]*r[1]+e[16]*r[6]+e[17]*r[11]+e[18]*r[16],t[17]=e[15]*r[2]+e[16]*r[7]+e[17]*r[12]+e[18]*r[17],t[18]=e[15]*r[3]+e[16]*r[8]+e[17]*r[13]+e[18]*r[18],t[19]=e[15]*r[4]+e[16]*r[9]+e[17]*r[14]+e[18]*r[19]+e[19],t},e.prototype._colorMatrix=function(t){var e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e},e.prototype.brightness=function(t,e){var r=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)},e.prototype.greyscale=function(t,e){var r=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)},e.prototype.blackAndWhite=function(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)},e.prototype.hue=function(t,e){t=(t||0)/180*Math.PI;var r=Math.cos(t),i=Math.sin(t),n=1/3,o=(0,Math.sqrt)(n),s=[r+(1-r)*n,n*(1-r)-o*i,n*(1-r)+o*i,0,0,n*(1-r)+o*i,r+n*(1-r),n*(1-r)-o*i,0,0,n*(1-r)-o*i,n*(1-r)+o*i,r+n*(1-r),0,0,0,0,0,1,0];this._loadMatrix(s,e)},e.prototype.contrast=function(t,e){var r=(t||0)+1,i=-.5*(r-1),n=[r,0,0,0,i,0,r,0,0,i,0,0,r,0,i,0,0,0,1,0];this._loadMatrix(n,e)},e.prototype.saturate=function(t,e){void 0===t&&(t=0);var r=2*t/3+1,i=-.5*(r-1),n=[r,i,i,0,0,i,r,i,0,0,i,i,r,0,0,0,0,0,1,0];this._loadMatrix(n,e)},e.prototype.desaturate=function(){this.saturate(-1)},e.prototype.negative=function(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)},e.prototype.sepia=function(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)},e.prototype.technicolor=function(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)},e.prototype.polaroid=function(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)},e.prototype.toBGR=function(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)},e.prototype.kodachrome=function(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)},e.prototype.browni=function(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)},e.prototype.vintage=function(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)},e.prototype.colorTone=function(t,e,r,i,n){var o=((r=r||16770432)>>16&255)/255,s=(r>>8&255)/255,a=(255&r)/255,h=((i=i||3375104)>>16&255)/255,u=(i>>8&255)/255,l=(255&i)/255,c=[.3,.59,.11,0,0,o,s,a,t=t||.2,0,h,u,l,e=e||.15,0,o-h,s-u,a-l,0,0];this._loadMatrix(c,n)},e.prototype.night=function(t,e){var r=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(r,e)},e.prototype.predator=function(t,e){var r=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(r,e)},e.prototype.lsd=function(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)},e.prototype.reset=function(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)},r.matrix.get=function(){return this.uniforms.m},r.matrix.set=function(t){this.uniforms.m=t},r.alpha.get=function(){return this.uniforms.uAlpha},r.alpha.set=function(t){this.uniforms.uAlpha=t},Object.defineProperties(e.prototype,r),e}(Vi);Hs.prototype.grayscale=Hs.prototype.greyscale;var Gs="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n",Ys="varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",zs=function(t){function e(e,r){var i=new Be;e.renderable=!1,t.call(this,Gs,Ys,{mapSampler:e._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=e,this.maskMatrix=i,null==r&&(r=20),this.scale=new Ce(r,r)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={map:{configurable:!0}};return e.prototype.apply=function(t,e,r,i){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;var n=this.maskSprite.transform.worldTransform,o=Math.sqrt(n.a*n.a+n.b*n.b),s=Math.sqrt(n.c*n.c+n.d*n.d);0!==o&&0!==s&&(this.uniforms.rotation[0]=n.a/o,this.uniforms.rotation[1]=n.b/o,this.uniforms.rotation[2]=n.c/s,this.uniforms.rotation[3]=n.d/s),t.applyFilter(this,e,r,i)},r.map.get=function(){return this.uniforms.mapSampler},r.map.set=function(t){this.uniforms.mapSampler=t},Object.defineProperties(e.prototype,r),e}(Vi),Vs="\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputPixel;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputPixel.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",Ws='varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputPixel;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputPixel.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n',qs=function(t){function e(){t.call(this,Vs,Ws)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Vi),Ks="precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",Zs=function(t){function e(e,r){void 0===e&&(e=.5),void 0===r&&(r=Math.random()),t.call(this,Pn,Ks,{uNoise:0,uSeed:0}),this.noise=e,this.seed=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={noise:{configurable:!0},seed:{configurable:!0}};return r.noise.get=function(){return this.uniforms.uNoise},r.noise.set=function(t){this.uniforms.uNoise=t},r.seed.get=function(){return this.uniforms.uSeed},r.seed.set=function(t){this.uniforms.uSeed=t},Object.defineProperties(e.prototype,r),e}(Vi),Js=new Be;$e.prototype._cacheAsBitmap=!1,$e.prototype._cacheData=!1;var Qs=function(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalHitTest=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.sprite=null};Object.defineProperties($e.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){var e;this._cacheAsBitmap!==t&&(this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new Qs),(e=this._cacheData).originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((e=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea))}}}),$e.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},$e.prototype._initCachedDisplayObject=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.alpha;this.alpha=1,t.batch.flush();var r=this.getLocalBounds().clone();if(this.filters){var i=this.filters[0].padding;r.pad(i)}r.ceil(C.RESOLUTION);var n=t.renderTexture.current,o=t.renderTexture.sourceFrame.clone(),s=t.projection.transform,a=Vr.create(r.width,r.height),h="cacheAsBitmap_"+ye();this._cacheData.textureCacheId=h,Or.addToCache(a.baseTexture,h),Yr.addToCache(a,h);var u=Js;u.tx=-r.x,u.ty=-r.y,this.transform.worldTransform.identity(),this.render=this._cacheData.originalRender,t.render(this,a,!0,u,!0),t.projection.transform=s,t.renderTexture.bind(n,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var l=new Ko(a);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-r.x/r.width,l.anchor.y=-r.y/r.height,l.alpha=e,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)}},$e.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},$e.prototype._initCachedDisplayObjectCanvas=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.getLocalBounds(),r=this.alpha;this.alpha=1;var i=t.context,n=t._projTransform;e.ceil(C.RESOLUTION);var o=Vr.create(e.width,e.height),s="cacheAsBitmap_"+ye();this._cacheData.textureCacheId=s,Or.addToCache(o.baseTexture,s),Yr.addToCache(o,s);var a=Js;this.transform.localTransform.copyTo(a),a.invert(),a.tx-=e.x,a.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,o,!0,a,!1),t.context=i,t._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var h=new Ko(o);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-e.x/e.width,h.anchor.y=-e.y/e.height,h.alpha=r,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=h.containsPoint.bind(h)}},$e.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._lastBoundsID=this._boundsID},$e.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds()},$e.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,Or.removeFromCache(this._cacheData.textureCacheId),Yr.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},$e.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},$e.prototype.name=null,er.prototype.getChildByName=function(t){for(var e=0;e<this.children.length;e++)if(this.children[e].name===t)return this.children[e];return null},$e.prototype.getGlobalPosition=function(t,e){return void 0===t&&(t=new Ce),void 0===e&&(e=!1),this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};var $s=function(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0};$s.prototype.update=function(t){if(t||this._bufferUpdateId!==this.uvBuffer._updateID||this._textureUpdateId!==this.uvMatrix._updateID){this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;var e=this.uvBuffer.data;this.data&&this.data.length===e.length||(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}};var ta=new Ce,ea=new Ze,ra=function(e){function r(r,i,n,o){void 0===o&&(o=t.DRAW_MODES.TRIANGLES),e.call(this),this.geometry=r,r.refCount++,this.shader=i,this.state=n||Yi.for2d(),this.drawMode=o,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=0,this._transformID=-1,this.tint=16777215,this.blendMode=t.BLEND_MODES.NORMAL,this._roundPixels=C.ROUND_PIXELS,this.batchUvs=null}e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r;var i={uvBuffer:{configurable:!0},verticesBuffer:{configurable:!0},material:{configurable:!0},blendMode:{configurable:!0},roundPixels:{configurable:!0},tint:{configurable:!0},texture:{configurable:!0}};return i.uvBuffer.get=function(){return this.geometry.buffers[1]},i.verticesBuffer.get=function(){return this.geometry.buffers[0]},i.material.set=function(t){this.shader=t},i.material.get=function(){return this.shader},i.blendMode.set=function(t){this.state.blendMode=t},i.blendMode.get=function(){return this.state.blendMode},i.roundPixels.set=function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},i.roundPixels.get=function(){return this._roundPixels},i.tint.get=function(){return this.shader.tint},i.tint.set=function(t){this.shader.tint=t},i.texture.get=function(){return this.shader.texture},i.texture.set=function(t){this.shader.texture=t},r.prototype._render=function(e){var i=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===t.DRAW_MODES.TRIANGLES&&i.length<2*r.BATCHABLE_SIZE?this._renderToBatch(e):this._renderDefault(e)},r.prototype._renderDefault=function(t){var e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.program.uniformData.translationMatrix&&(e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0)),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},r.prototype._renderToBatch=function(t){var e=this.geometry;this.shader.uvMatrix&&(this.shader.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=this.shader._tintRGB,this._texture=this.shader.texture;var r=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[r]),t.plugins[r].render(this)},r.prototype.calculateVertices=function(){var t=this.geometry,e=t.buffers[0].data;if(t.vertexDirtyId!==this.vertexDirty||this._transformID!==this.transform._worldID){this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));for(var r=this.transform.worldTransform,i=r.a,n=r.b,o=r.c,s=r.d,a=r.tx,h=r.ty,u=this.vertexData,l=0;l<u.length/2;l++){var c=e[2*l],d=e[2*l+1];u[2*l]=i*c+o*d+a,u[2*l+1]=n*c+s*d+h}if(this._roundPixels)for(var p=C.RESOLUTION,f=0;f<u.length;++f)u[f]=Math.round((u[f]*p|0)/p);this.vertexDirty=t.vertexDirtyId}},r.prototype.calculateUvs=function(){var t=this.geometry.buffers[1];this.shader.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new $s(t,this.shader.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)},r.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)},r.prototype.containsPoint=function(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,ta);for(var e=this.geometry.getBuffer("aVertexPosition").data,r=ea.points,i=this.geometry.getIndex().data,n=i.length,o=4===this.drawMode?3:1,s=0;s+2<n;s+=o){var a=2*i[s],h=2*i[s+1],u=2*i[s+2];if(r[0]=e[a],r[1]=e[a+1],r[2]=e[h],r[3]=e[h+1],r[4]=e[u],r[5]=e[u+1],ea.contains(ta.x,ta.y))return!0}return!1},r.prototype.destroy=function(t){e.prototype.destroy.call(this,t),this.geometry.refCount--,0===this.geometry.refCount&&this.geometry.dispose(),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null},Object.defineProperties(r.prototype,i),r}(er);ra.BATCHABLE_SIZE=100;var ia="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n",na="varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n",oa=function(t){function e(e,r){var i={uSampler:e,alpha:1,uTextureMatrix:Be.IDENTITY,uColor:new Float32Array([1,1,1,1])};(r=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},r)).uniforms&&Object.assign(i,r.uniforms),t.call(this,r.program||Xi.from(ia,na),i),this._colorDirty=!1,this.uvMatrix=new Zi(e),this.batchable=void 0===r.program,this.pluginName=r.pluginName,this.tint=r.tint,this.alpha=r.alpha}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={texture:{configurable:!0},alpha:{configurable:!0},tint:{configurable:!0}};return r.texture.get=function(){return this.uniforms.uSampler},r.texture.set=function(t){this.uniforms.uSampler!==t&&(this.uniforms.uSampler=t,this.uvMatrix.texture=t)},r.alpha.set=function(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)},r.alpha.get=function(){return this._alpha},r.tint.set=function(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16),this._colorDirty=!0)},r.tint.get=function(){return this._tint},e.prototype.update=function(){if(this._colorDirty){this._colorDirty=!1;var t=this.texture.baseTexture;he(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)},Object.defineProperties(e.prototype,r),e}(Hi),sa=function(e){function r(r,i,n){e.call(this);var o=new Zr(r),s=new Zr(i,!0),a=new Zr(n,!0,!0);this.addAttribute("aVertexPosition",o,2,!1,t.TYPES.FLOAT).addAttribute("aTextureCoord",s,2,!1,t.TYPES.FLOAT).addIndex(a),this._updateId=-1}e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r;var i={vertexDirtyId:{configurable:!0}};return i.vertexDirtyId.get=function(){return this.buffers[0]._updateID},Object.defineProperties(r.prototype,i),r}(ri),aa=function(t){function e(e,r,i,n){void 0===e&&(e=100),void 0===r&&(r=100),void 0===i&&(i=10),void 0===n&&(n=10),t.call(this),this.segWidth=i,this.segHeight=n,this.width=e,this.height=r,this.build()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.build=function(){for(var t=this.segWidth*this.segHeight,e=[],r=[],i=[],n=this.segWidth-1,o=this.segHeight-1,s=this.width/n,a=this.height/o,h=0;h<t;h++){var u=h%this.segWidth,l=h/this.segWidth|0;e.push(u*s,l*a),r.push(u/n,l/o)}for(var c=n*o,d=0;d<c;d++){var p=d%n,f=d/n|0,v=f*this.segWidth+p,g=f*this.segWidth+p+1,m=(f+1)*this.segWidth+p,y=(f+1)*this.segWidth+p+1;i.push(v,g,m,g,y,m)}this.buffers[0].data=new Float32Array(e),this.buffers[1].data=new Float32Array(r),this.indexBuffer.data=new Uint16Array(i),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()},e}(sa),ha=function(t){function e(e,r,i){void 0===e&&(e=200),void 0===i&&(i=0),t.call(this,new Float32Array(4*r.length),new Float32Array(4*r.length),new Uint16Array(6*(r.length-1))),this.points=r,this.width=e,this.textureScale=i,this.build()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.build=function(){var t=this.points;if(t){var e=this.getBuffer("aVertexPosition"),r=this.getBuffer("aTextureCoord"),i=this.getIndex();if(!(t.length<1)){e.data.length/4!==t.length&&(e.data=new Float32Array(4*t.length),r.data=new Float32Array(4*t.length),i.data=new Uint16Array(6*(t.length-1)));var n=r.data,o=i.data;n[0]=0,n[1]=0,n[2]=0,n[3]=1;for(var s=0,a=t[0],h=this.width*this.textureScale,u=t.length,l=0;l<u;l++){var c=4*l;if(this.textureScale>0){var d=a.x-t[l].x,p=a.y-t[l].y,f=Math.sqrt(d*d+p*p);a=t[l],s+=f/h}else s=l/(u-1);n[c]=s,n[c+1]=0,n[c+2]=s,n[c+3]=1}for(var v=0,g=0;g<u-1;g++){var m=2*g;o[v++]=m,o[v++]=m+1,o[v++]=m+2,o[v++]=m+2,o[v++]=m+1,o[v++]=m+3}r.update(),i.update(),this.updateVertices()}}},e.prototype.updateVertices=function(){var t=this.points;if(!(t.length<1)){for(var e,r=t[0],i=0,n=0,o=this.buffers[0].data,s=t.length,a=0;a<s;a++){var h=t[a],u=4*a;n=-((e=a<t.length-1?t[a+1]:h).x-r.x),i=e.y-r.y;var l=Math.sqrt(i*i+n*n),c=this.textureScale>0?this.textureScale*this.width/2:this.width/2;i/=l,n/=l,i*=c,n*=c,o[u]=h.x+i,o[u+1]=h.y+n,o[u+2]=h.x-i,o[u+3]=h.y-n,r=h}this.buffers[0].update()}},e.prototype.update=function(){this.textureScale>0?this.build():this.updateVertices()},e}(sa),ua=function(e){function r(r,i,n){void 0===n&&(n=0);var o=new ha(r.height,i,n),s=new oa(r);n>0&&(r.baseTexture.wrapMode=t.WRAP_MODES.REPEAT),e.call(this,o,s),this.autoUpdate=!0}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype._render=function(t){(this.autoUpdate||this.geometry.width!==this.shader.texture.height)&&(this.geometry.width=this.shader.texture.height,this.geometry.update()),e.prototype._render.call(this,t)},r}(ra),la=function(t){function e(e,r,i){var n=new aa(e.width,e.height,r,i),o=new oa(Yr.WHITE);t.call(this,n,o),this.texture=e}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={texture:{configurable:!0}};return e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID,this.geometry.width=this.shader.texture.width,this.geometry.height=this.shader.texture.height,this.geometry.build()},r.texture.set=function(t){this.shader.texture!==t&&(this.shader.texture=t,this._textureID=-1,t.baseTexture.valid?this.textureUpdated():t.once("update",this.textureUpdated,this))},r.texture.get=function(){return this.shader.texture},e.prototype._render=function(e){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),t.prototype._render.call(this,e)},Object.defineProperties(e.prototype,r),e}(ra),ca=function(t){function e(e,r,i,n,o){void 0===e&&(e=Yr.EMPTY);var s=new sa(r,i,n);s.getBuffer("aVertexPosition").static=!1;var a=new oa(e);t.call(this,s,a,null,o),this.autoUpdate=!0}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={vertices:{configurable:!0}};return r.vertices.get=function(){return this.geometry.getBuffer("aVertexPosition").data},r.vertices.set=function(t){this.geometry.getBuffer("aVertexPosition").data=t},e.prototype._render=function(e){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),t.prototype._render.call(this,e)},Object.defineProperties(e.prototype,r),e}(ra),da=10,pa=function(t){function e(e,r,i,n,o){t.call(this,Yr.WHITE,4,4),this._origWidth=e.orig.width,this._origHeight=e.orig.height,this._width=this._origWidth,this._height=this._origHeight,this._leftWidth=void 0!==r?r:da,this._rightWidth=void 0!==n?n:da,this._topHeight=void 0!==i?i:da,this._bottomHeight=void 0!==o?o:da,this.texture=e}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={vertices:{configurable:!0},width:{configurable:!0},height:{configurable:!0},leftWidth:{configurable:!0},rightWidth:{configurable:!0},topHeight:{configurable:!0},bottomHeight:{configurable:!0}};return e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID,this._refresh()},r.vertices.get=function(){return this.geometry.getBuffer("aVertexPosition").data},r.vertices.set=function(t){this.geometry.getBuffer("aVertexPosition").data=t},e.prototype.updateHorizontalVertices=function(){var t=this.vertices,e=this._getMinScale();t[9]=t[11]=t[13]=t[15]=this._topHeight*e,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight*e,t[25]=t[27]=t[29]=t[31]=this._height},e.prototype.updateVerticalVertices=function(){var t=this.vertices,e=this._getMinScale();t[2]=t[10]=t[18]=t[26]=this._leftWidth*e,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth*e,t[6]=t[14]=t[22]=t[30]=this._width},e.prototype._getMinScale=function(){var t=this._leftWidth+this._rightWidth,e=this._width>t?1:this._width/t,r=this._topHeight+this._bottomHeight,i=this._height>r?1:this._height/r;return Math.min(e,i)},r.width.get=function(){return this._width},r.width.set=function(t){this._width=t,this._refresh()},r.height.get=function(){return this._height},r.height.set=function(t){this._height=t,this._refresh()},r.leftWidth.get=function(){return this._leftWidth},r.leftWidth.set=function(t){this._leftWidth=t,this._refresh()},r.rightWidth.get=function(){return this._rightWidth},r.rightWidth.set=function(t){this._rightWidth=t,this._refresh()},r.topHeight.get=function(){return this._topHeight},r.topHeight.set=function(t){this._topHeight=t,this._refresh()},r.bottomHeight.get=function(){return this._bottomHeight},r.bottomHeight.set=function(t){this._bottomHeight=t,this._refresh()},e.prototype._refresh=function(){var t=this.texture,e=this.geometry.buffers[1].data;this._origWidth=t.orig.width,this._origHeight=t.orig.height;var r=1/this._origWidth,i=1/this._origHeight;e[0]=e[8]=e[16]=e[24]=0,e[1]=e[3]=e[5]=e[7]=0,e[6]=e[14]=e[22]=e[30]=1,e[25]=e[27]=e[29]=e[31]=1,e[2]=e[10]=e[18]=e[26]=r*this._leftWidth,e[4]=e[12]=e[20]=e[28]=1-r*this._rightWidth,e[9]=e[11]=e[13]=e[15]=i*this._topHeight,e[17]=e[19]=e[21]=e[23]=1-i*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()},Object.defineProperties(e.prototype,r),e}(la),fa=function(e){function r(t,r){e.call(this,t[0]instanceof Yr?t[0]:t[0].texture),this._textures=null,this._durations=null,this._autoUpdate=!1!==r,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=t}e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r;var i={totalFrames:{configurable:!0},textures:{configurable:!0},currentFrame:{configurable:!0},playing:{configurable:!0},autoUpdate:{configurable:!0}};return r.prototype.stop=function(){this.playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(ar.shared.remove(this.update,this),this._isConnectedToTicker=!1))},r.prototype.play=function(){this.playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(ar.shared.add(this.update,this,t.UPDATE_PRIORITY.HIGH),this._isConnectedToTicker=!0))},r.prototype.gotoAndStop=function(t){this.stop();var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()},r.prototype.gotoAndPlay=function(t){var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture(),this.play()},r.prototype.update=function(t){var e=this.animationSpeed*t,r=this.currentFrame;if(null!==this._durations){var i=this._currentTime%1*this._durations[this.currentFrame];for(i+=e/60*1e3;i<0;)this._currentTime--,i+=this._durations[this.currentFrame];var n=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);i>=this._durations[this.currentFrame];)i-=this._durations[this.currentFrame]*n,this._currentTime+=n;this._currentTime+=i/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):r!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<r?this.onLoop():this.animationSpeed<0&&this.currentFrame>r&&this.onLoop()),this.updateTexture())},r.prototype.updateTexture=function(){var t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))},r.prototype.destroy=function(t){this.stop(),e.prototype.destroy.call(this,t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null},r.fromFrames=function(t){for(var e=[],i=0;i<t.length;++i)e.push(Yr.from(t[i]));return new r(e)},r.fromImages=function(t){for(var e=[],i=0;i<t.length;++i)e.push(Yr.from(t[i]));return new r(e)},i.totalFrames.get=function(){return this._textures.length},i.textures.get=function(){return this._textures},i.textures.set=function(t){if(t[0]instanceof Yr)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(var e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()},i.currentFrame.get=function(){var t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t},i.playing.get=function(){return this._playing},i.autoUpdate.get=function(){return this._autoUpdate},i.autoUpdate.set=function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(ar.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(ar.shared.add(this.update,this),this._isConnectedToTicker=!0))},Object.defineProperties(r.prototype,i),r}(Ko),va="5.0.0";Tn.registerPlugin("accessibility",ir),Tn.registerPlugin("extract",Yn),Tn.registerPlugin("interaction",yr),Tn.registerPlugin("particle",xo),Tn.registerPlugin("prepare",ms),Tn.registerPlugin("batch",kn),Tn.registerPlugin("tilingSprite",Ms),po.registerPlugin(Rs),po.registerPlugin(Ss),Xn.registerPlugin(hr),Xn.registerPlugin(fo);var ga={AlphaFilter:Ns,BlurFilter:Xs,BlurFilterPass:ks,ColorMatrixFilter:Hs,DisplacementFilter:zs,FXAAFilter:qs,NoiseFilter:Zs},ma=function(t){this.renderer=t,this._foundShapes=[]};function ya(t){var e=document.createElement("canvas");e.width=6,e.height=1;var r=e.getContext("2d");return r.fillStyle=t,r.fillRect(0,0,6,1),e}function _a(){if("undefined"==typeof document)return!1;var t=ya("#ff00ff"),e=ya("#ffff00"),r=document.createElement("canvas");r.width=6,r.height=1;var i=r.getContext("2d");i.globalCompositeOperation="multiply",i.drawImage(t,0,0),i.drawImage(e,2,0);var n=i.getImageData(2,0,1,1);if(!n)return!1;var o=n.data;return 255===o[0]&&0===o[1]&&0===o[2]}ma.prototype.pushMask=function(t){var e=this.renderer,r=t.isMaskData?t.maskObject:t;e.context.save();var i=this._foundShapes;if(this.recursiveFindShapes(r,i),i.length>0){var n=e.context;n.beginPath();for(var o=0;o<i.length;o++){var s=i[o],a=s.transform.worldTransform;this.renderer.setContextTransform(a),this.renderGraphicsShape(s)}i.length=0,n.clip()}},ma.prototype.recursiveFindShapes=function(t,e){t.geometry&&t.geometry.graphicsData&&e.push(t);var r=t.children;if(r)for(var i=0;i<r.length;i++)this.recursiveFindShapes(r[i],e)},ma.prototype.renderGraphicsShape=function(e){e.finishPoly();var r=this.renderer.context,i=e.geometry.graphicsData,n=i.length;if(0!==n)for(var o=0;o<n;o++){var s=i[o],a=s.shape;if(s.type===t.SHAPES.POLY){var h=a.points;r.moveTo(h[0],h[1]);for(var u=1;u<h.length/2;u++)r.lineTo(h[2*u],h[2*u+1]);h[0]===h[h.length-2]&&h[1]===h[h.length-1]&&r.closePath()}else if(s.type===t.SHAPES.RECT)r.rect(a.x,a.y,a.width,a.height),r.closePath();else if(s.type===t.SHAPES.CIRC)r.arc(a.x,a.y,a.radius,0,2*Math.PI),r.closePath();else if(s.type===t.SHAPES.ELIP){var l=2*a.width,c=2*a.height,d=a.x-l/2,p=a.y-c/2,f=l/2*.5522848,v=c/2*.5522848,g=d+l,m=p+c,y=d+l/2,_=p+c/2;r.moveTo(d,_),r.bezierCurveTo(d,_-v,y-f,p,y,p),r.bezierCurveTo(y+f,p,g,_-v,g,_),r.bezierCurveTo(g,_+v,y+f,m,y,m),r.bezierCurveTo(y-f,m,d,_+v,d,_),r.closePath()}else if(s.type===t.SHAPES.RREC){var x=a.x,b=a.y,E=a.width,T=a.height,S=a.radius,w=Math.min(E,T)/2|0;S=S>w?w:S,r.moveTo(x,b+S),r.lineTo(x,b+T-S),r.quadraticCurveTo(x,b+T,x+S,b+T),r.lineTo(x+E-S,b+T),r.quadraticCurveTo(x+E,b+T,x+E,b+T-S),r.lineTo(x+E,b+S),r.quadraticCurveTo(x+E,b,x+E-S,b),r.lineTo(x+S,b),r.quadraticCurveTo(x,b,x,b+S),r.closePath()}}},ma.prototype.popMask=function(t){t.context.restore(),t.invalidateBlendMode()},ma.prototype.destroy=function(){};var xa=new Be,ba=function(e){function r(i,n,o){var s;e.call(this,"Canvas",i,n,o),this.type=t.RENDERER_TYPE.CANVAS,this.rootContext=this.view.getContext("2d",{alpha:this.transparent}),this.context=this.rootContext,this.refresh=!0,this.maskManager=new ma(this),this.smoothProperty="imageSmoothingEnabled",this.rootContext.imageSmoothingEnabled||(this.rootContext.webkitImageSmoothingEnabled?this.smoothProperty="webkitImageSmoothingEnabled":this.rootContext.mozImageSmoothingEnabled?this.smoothProperty="mozImageSmoothingEnabled":this.rootContext.oImageSmoothingEnabled?this.smoothProperty="oImageSmoothingEnabled":this.rootContext.msImageSmoothingEnabled&&(this.smoothProperty="msImageSmoothingEnabled")),this.initPlugins(r.__plugins),this.blendModes=(void 0===s&&(s=[]),_a()?(s[t.BLEND_MODES.NORMAL]="source-over",s[t.BLEND_MODES.ADD]="lighter",s[t.BLEND_MODES.MULTIPLY]="multiply",s[t.BLEND_MODES.SCREEN]="screen",s[t.BLEND_MODES.OVERLAY]="overlay",s[t.BLEND_MODES.DARKEN]="darken",s[t.BLEND_MODES.LIGHTEN]="lighten",s[t.BLEND_MODES.COLOR_DODGE]="color-dodge",s[t.BLEND_MODES.COLOR_BURN]="color-burn",s[t.BLEND_MODES.HARD_LIGHT]="hard-light",s[t.BLEND_MODES.SOFT_LIGHT]="soft-light",s[t.BLEND_MODES.DIFFERENCE]="difference",s[t.BLEND_MODES.EXCLUSION]="exclusion",s[t.BLEND_MODES.HUE]="hue",s[t.BLEND_MODES.SATURATION]="saturate",s[t.BLEND_MODES.COLOR]="color",s[t.BLEND_MODES.LUMINOSITY]="luminosity"):(s[t.BLEND_MODES.NORMAL]="source-over",s[t.BLEND_MODES.ADD]="lighter",s[t.BLEND_MODES.MULTIPLY]="source-over",s[t.BLEND_MODES.SCREEN]="source-over",s[t.BLEND_MODES.OVERLAY]="source-over",s[t.BLEND_MODES.DARKEN]="source-over",s[t.BLEND_MODES.LIGHTEN]="source-over",s[t.BLEND_MODES.COLOR_DODGE]="source-over",s[t.BLEND_MODES.COLOR_BURN]="source-over",s[t.BLEND_MODES.HARD_LIGHT]="source-over",s[t.BLEND_MODES.SOFT_LIGHT]="source-over",s[t.BLEND_MODES.DIFFERENCE]="source-over",s[t.BLEND_MODES.EXCLUSION]="source-over",s[t.BLEND_MODES.HUE]="source-over",s[t.BLEND_MODES.SATURATION]="source-over",s[t.BLEND_MODES.COLOR]="source-over",s[t.BLEND_MODES.LUMINOSITY]="source-over"),s[t.BLEND_MODES.NORMAL_NPM]=s[t.BLEND_MODES.NORMAL],s[t.BLEND_MODES.ADD_NPM]=s[t.BLEND_MODES.ADD],s[t.BLEND_MODES.SCREEN_NPM]=s[t.BLEND_MODES.SCREEN],s[t.BLEND_MODES.SRC_IN]="source-in",s[t.BLEND_MODES.SRC_OUT]="source-out",s[t.BLEND_MODES.SRC_ATOP]="source-atop",s[t.BLEND_MODES.DST_OVER]="destination-over",s[t.BLEND_MODES.DST_IN]="destination-in",s[t.BLEND_MODES.DST_OUT]="destination-out",s[t.BLEND_MODES.DST_ATOP]="destination-atop",s[t.BLEND_MODES.XOR]="xor",s[t.BLEND_MODES.SUBTRACT]="source-over",s),this._activeBlendMode=null,this._outerBlend=!1,this._projTransform=null,this.renderingToScreen=!1,Qt("Canvas"),this.resize(this.options.width,this.options.height)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.render=function(e,r,i,n,o){if(this.view){this.renderingToScreen=!r,this.emit("prerender");var s=this.resolution;r?((r=r.baseTexture||r)._canvasRenderTarget||(r._canvasRenderTarget=new Se(r.width,r.height,r.resolution),r.resource=new Fr.CanvasResource(r._canvasRenderTarget.canvas),r.valid=!0),this.context=r._canvasRenderTarget.context,this.resolution=r._canvasRenderTarget.resolution):this.context=this.rootContext;var a=this.context;if(this._projTransform=n||null,r||(this._lastObjectRendered=e),!o){var h=e.parent;e.parent=this._tempDisplayObjectParent,e.updateTransform(),e.parent=h}a.save(),a.setTransform(1,0,0,1,0,0),a.globalAlpha=1,this._activeBlendMode=t.BLEND_MODES.NORMAL,this._outerBlend=!1,a.globalCompositeOperation=this.blendModes[t.BLEND_MODES.NORMAL],(void 0!==i?i:this.clearBeforeRender)&&this.renderingToScreen&&(this.transparent?a.clearRect(0,0,this.width,this.height):(a.fillStyle=this._backgroundColorString,a.fillRect(0,0,this.width,this.height)));var u=this.context;this.context=a,e.renderCanvas(this),this.context=u,a.restore(),this.resolution=s,this._projTransform=null,this.emit("postrender")}},r.prototype.setContextTransform=function(t,e,r){var i=t,n=this._projTransform,o=this.resolution;r=r||o,n&&((i=xa).copyFrom(t),i.prepend(n)),e?this.context.setTransform(i.a*r,i.b*r,i.c*r,i.d*r,i.tx*o|0,i.ty*o|0):this.context.setTransform(i.a*r,i.b*r,i.c*r,i.d*r,i.tx*o,i.ty*o)},r.prototype.clear=function(t){var e=this.context;t=t||this._backgroundColorString,!this.transparent&&t?(e.fillStyle=t,e.fillRect(0,0,this.width,this.height)):e.clearRect(0,0,this.width,this.height)},r.prototype.setBlendMode=function(e,r){var i=e===t.BLEND_MODES.SRC_IN||e===t.BLEND_MODES.SRC_OUT||e===t.BLEND_MODES.DST_IN||e===t.BLEND_MODES.DST_ATOP;!r&&i&&(e=t.BLEND_MODES.NORMAL),this._activeBlendMode!==e&&(this._activeBlendMode=e,this._outerBlend=i,this.context.globalCompositeOperation=this.blendModes[e])},r.prototype.destroy=function(t){e.prototype.destroy.call(this,t),this.context=null,this.refresh=!0,this.maskManager.destroy(),this.maskManager=null,this.smoothProperty=null},r.prototype.resize=function(r,i){e.prototype.resize.call(this,r,i),this.smoothProperty&&(this.rootContext[this.smoothProperty]=C.SCALE_MODE===t.SCALE_MODES.LINEAR)},r.prototype.invalidateBlendMode=function(){this._activeBlendMode=this.blendModes.indexOf(this.context.globalCompositeOperation)},r.registerPlugin=function(t,e){r.__plugins=r.__plugins||{},r.__plugins[t]=e},r}(En),Ea={getTintedCanvas:function(t,e){var r=t.texture,i="#"+("00000"+(0|(e=Ea.roundColor(e))).toString(16)).substr(-6);r.tintCache=r.tintCache||{};var n,o=r.tintCache[i];if(o){if(o.tintId===r._updateID)return r.tintCache[i];n=r.tintCache[i]}else n=document.createElement("canvas");if(Ea.tintMethod(r,e,n),n.tintId=r._updateID,Ea.convertTintToImage){var s=new Image;s.src=n.toDataURL(),r.tintCache[i]=s}else r.tintCache[i]=n;return n},getTintedPattern:function(t,e){var r="#"+("00000"+(0|(e=Ea.roundColor(e))).toString(16)).substr(-6);t.patternCache=t.patternCache||{};var i=t.patternCache[r];return i&&i.tintId===t._updateID?i:(Ea.canvas||(Ea.canvas=document.createElement("canvas")),Ea.tintMethod(t,e,Ea.canvas),(i=Ea.canvas.getContext("2d").createPattern(Ea.canvas,"repeat")).tintId=t._updateID,t.patternCache[r]=i,i)},tintWithMultiply:function(t,e,r){var i=r.getContext("2d"),n=t._frame.clone(),o=t.baseTexture.resolution;n.x*=o,n.y*=o,n.width*=o,n.height*=o,r.width=Math.ceil(n.width),r.height=Math.ceil(n.height),i.save(),i.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),i.fillRect(0,0,n.width,n.height),i.globalCompositeOperation="multiply";var s=t.baseTexture.getDrawableSource();i.drawImage(s,n.x,n.y,n.width,n.height,0,0,n.width,n.height),i.globalCompositeOperation="destination-atop",i.drawImage(s,n.x,n.y,n.width,n.height,0,0,n.width,n.height),i.restore()},tintWithOverlay:function(t,e,r){var i=r.getContext("2d"),n=t._frame.clone(),o=t.baseTexture.resolution;n.x*=o,n.y*=o,n.width*=o,n.height*=o,r.width=Math.ceil(n.width),r.height=Math.ceil(n.height),i.save(),i.globalCompositeOperation="copy",i.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),i.fillRect(0,0,n.width,n.height),i.globalCompositeOperation="destination-atop",i.drawImage(t.baseTexture.getDrawableSource(),n.x,n.y,n.width,n.height,0,0,n.width,n.height),i.restore()},tintWithPerPixel:function(t,e,r){var i=r.getContext("2d"),n=t._frame.clone(),o=t.baseTexture.resolution;n.x*=o,n.y*=o,n.width*=o,n.height*=o,r.width=Math.ceil(n.width),r.height=Math.ceil(n.height),i.save(),i.globalCompositeOperation="copy",i.drawImage(t.baseTexture.getDrawableSource(),n.x,n.y,n.width,n.height,0,0,n.width,n.height),i.restore();for(var s=te(e),a=s[0],h=s[1],u=s[2],l=i.getImageData(0,0,n.width,n.height),c=l.data,d=0;d<c.length;d+=4)c[d+0]*=a,c[d+1]*=h,c[d+2]*=u;i.putImageData(l,0,0)},roundColor:function(t){var e=Ea.cacheStepsPerColorChannel,r=te(t);return r[0]=Math.min(255,r[0]/e*e),r[1]=Math.min(255,r[1]/e*e),r[2]=Math.min(255,r[2]/e*e),ie(r)},cacheStepsPerColorChannel:8,convertTintToImage:!1,canUseMultiply:_a(),tintMethod:function(){}};Ea.tintMethod=Ea.canUseMultiply?Ea.tintWithMultiply:Ea.tintWithPerPixel;var Ta=Tn.create;Tn.create=function(t){if(!(t&&t.forceCanvas))try{return Ta(t)}catch(t){}return new ba(t)},Or.prototype.getDrawableSource=function(){var t=this.resource;return t?t.bitmap||t.source:null};var Sa=function(t){this.renderer=t};Sa.prototype.render=function(e){var r=this.renderer,i=e.worldTransform;r.context.globalAlpha=e.worldAlpha,r.setBlendMode(e.blendMode),r.setContextTransform(i,e.roundPixels),e.drawMode!==t.DRAW_MODES.TRIANGLES?this._renderTriangleMesh(e):this._renderTriangles(e)},Sa.prototype._renderTriangleMesh=function(t){for(var e=t.geometry.buffers[0].data.length,r=0;r<e-2;r++){var i=2*r;this._renderDrawTriangle(t,i,i+2,i+4)}},Sa.prototype._renderTriangles=function(t){for(var e=t.geometry.getIndex().data,r=e.length,i=0;i<r;i+=3){var n=2*e[i],o=2*e[i+1],s=2*e[i+2];this._renderDrawTriangle(t,n,o,s)}},Sa.prototype._renderDrawTriangle=function(t,e,r,i){var n=this.renderer.context,o=t.geometry.buffers[0].data,s=t.uvs,a=t.texture;if(a.valid){var h=a.baseTexture,u=h.getDrawableSource(),l=h.width,c=h.height,d=s[e]*h.width,p=s[r]*h.width,f=s[i]*h.width,v=s[e+1]*h.height,g=s[r+1]*h.height,m=s[i+1]*h.height,y=o[e],_=o[r],x=o[i],b=o[e+1],E=o[r+1],T=o[i+1],S=t.canvasPadding/this.renderer.resolution;if(S>0){var w=S/Math.abs(t.worldTransform.a),P=S/Math.abs(t.worldTransform.d),I=(y+_+x)/3,A=(b+E+T)/3,O=y-I,D=b-A,M=Math.sqrt(O*O+D*D);y=I+O/M*(M+w),b=A+D/M*(M+P),D=E-A,_=I+(O=_-I)/(M=Math.sqrt(O*O+D*D))*(M+w),E=A+D/M*(M+P),D=T-A,x=I+(O=x-I)/(M=Math.sqrt(O*O+D*D))*(M+w),T=A+D/M*(M+P)}n.save(),n.beginPath(),n.moveTo(y,b),n.lineTo(_,E),n.lineTo(x,T),n.closePath(),n.clip();var C=d*g+v*f+p*m-g*f-v*p-d*m,R=y*g+v*x+_*m-g*x-v*_-y*m,L=d*_+y*f+p*x-_*f-y*p-d*x,N=d*g*x+v*_*f+y*p*m-y*g*f-v*p*x-d*_*m,F=b*g+v*T+E*m-g*T-v*E-b*m,B=d*E+b*f+p*T-E*f-b*p-d*T,U=d*g*T+v*E*f+b*p*m-b*g*f-v*p*T-d*E*m;n.transform(R/C,F/C,L/C,B/C,N/C,U/C),n.drawImage(u,0,0,l*h.resolution,c*h.resolution,0,0,l,c),n.restore(),this.renderer.invalidateBlendMode()}},Sa.prototype.renderMeshFlat=function(t){var e=this.renderer.context,r=t.geometry.getBuffer("aVertexPosition").data,i=r.length/2;e.beginPath();for(var n=1;n<i-2;++n){var o=2*n,s=r[o],a=r[o+1],h=r[o+2],u=r[o+3],l=r[o+4],c=r[o+5];e.moveTo(s,a),e.lineTo(h,u),e.lineTo(l,c)}e.fillStyle="#FF0000",e.fill(),e.closePath()},Sa.prototype.destroy=function(){this.renderer=null},C.MESH_CANVAS_PADDING=0,oa.prototype._renderCanvas=function(t,e){t.plugins.mesh.render(e)},pa.prototype._cachedTint=16777215,pa.prototype._tintedCanvas=null,pa.prototype._canvasUvs=null,pa.prototype._renderCanvas=function(t){var e=t.context,r=this.worldTransform,i=16777215!==this.tint,n=this.texture;if(n.valid){i&&this._cachedTint!==this.tint&&(this._cachedTint=this.tint,this._tintedCanvas=Ea.getTintedCanvas(this,this.tint));var o=i?this._tintedCanvas:n.baseTexture.getDrawableSource();this._canvasUvs||(this._canvasUvs=[0,0,0,0,0,0,0,0]);var s=this.vertices,a=this._canvasUvs,h=i?0:n.frame.x,u=i?0:n.frame.y,l=h+n.frame.width,c=u+n.frame.height;a[0]=h,a[1]=h+this._leftWidth,a[2]=l-this._rightWidth,a[3]=l,a[4]=u,a[5]=u+this._topHeight,a[6]=c-this._bottomHeight,a[7]=c;for(var d=0;d<8;d++)a[d]*=n.baseTexture.resolution;e.globalAlpha=this.worldAlpha,t.setBlendMode(this.blendMode),t.setContextTransform(r,this.roundPixels);for(var p=0;p<3;p++)for(var f=0;f<3;f++){var v=2*f+8*p,g=Math.max(1,a[f+1]-a[f]),m=Math.max(1,a[p+5]-a[p+4]),y=Math.max(1,s[v+10]-s[v]),_=Math.max(1,s[v+11]-s[v+1]);e.drawImage(o,a[f],a[p+4],g,m,s[v],s[v+1],y,_)}}},ra.prototype._renderCanvas=function(t){this.shader.uvMatrix&&(this.shader.uvMatrix.update(),this.calculateUvs()),this.material._renderCanvas(t,this)},ra.prototype._canvasPadding=null,Object.defineProperty(ra.prototype,"canvasPadding",{get:function(){return null!==this._canvasPadding?this._canvasPadding:C.MESH_CANVAS_PADDING},set:function(t){this._canvasPadding=t}}),ca.prototype._renderCanvas=function(t){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),this.shader.update&&this.shader.update(),this.calculateUvs(),this.material._renderCanvas(t,this)},ua.prototype._renderCanvas=function(t){(this.autoUpdate||this.geometry._width!==this.shader.texture.height)&&(this.geometry._width=this.shader.texture.height,this.geometry.update()),this.shader.update&&this.shader.update(),this.calculateUvs(),this.material._renderCanvas(t,this)};var wa,Pa=function(t){this.renderer=t,this._svgMatrix=null};Pa.prototype._calcCanvasStyle=function(t,e){var r;return t.texture?t.texture.valid?(r=Ea.getTintedPattern(t.texture,e),this.setPatternTransform(r,t.matrix||Be.IDENTITY)):r="#808080":r="#"+("00000"+(0|e).toString(16)).substr(-6),r},Pa.prototype.render=function(e){var r=this.renderer,i=r.context,n=e.worldAlpha,o=e.transform.worldTransform;r.setContextTransform(o),e.canvasTintDirty===e.geometry.dirty&&e._prevTint===e.tint||this.updateGraphicsTint(e),r.setBlendMode(e.blendMode);for(var s,a,h=e.geometry.graphicsData,u=0;u<h.length;u++){var l=h[u],c=l.shape,d=l.fillStyle,p=l.lineStyle;if(d.visible&&(s=this._calcCanvasStyle(d,l._fillTint)),p.visible&&(a=this._calcCanvasStyle(p,l._lineTint)),i.lineWidth=p.width,l.type===t.SHAPES.POLY){i.beginPath();var f=c.points,v=l.holes,g=void 0,m=void 0,y=void 0,_=void 0;i.moveTo(f[0],f[1]);for(var x=2;x<f.length;x+=2)i.lineTo(f[x],f[x+1]);if(c.closeStroke&&i.closePath(),v.length>0){g=0,y=f[0],_=f[1];for(var b=2;b+2<f.length;b+=2)g+=(f[b]-y)*(f[b+3]-_)-(f[b+2]-y)*(f[b+1]-_);for(var E=0;E<v.length;E++)if(f=v[E].shape.points){m=0,y=f[0],_=f[1];for(var T=2;T+2<f.length;T+=2)m+=(f[T]-y)*(f[T+3]-_)-(f[T+2]-y)*(f[T+1]-_);if(m*g<0){i.moveTo(f[0],f[1]);for(var S=2;S<f.length;S+=2)i.lineTo(f[S],f[S+1])}else{i.moveTo(f[f.length-2],f[f.length-1]);for(var w=f.length-4;w>=0;w-=2)i.lineTo(f[w],f[w+1])}v[E].shape.closeStroke&&i.closePath()}}d.visible&&(i.globalAlpha=d.alpha*n,i.fillStyle=s,i.fill()),p.visible&&(i.globalAlpha=p.alpha*n,i.strokeStyle=a,i.stroke())}else if(l.type===t.SHAPES.RECT)d.visible&&(i.globalAlpha=d.alpha*n,i.fillStyle=s,i.fillRect(c.x,c.y,c.width,c.height)),p.visible&&(i.globalAlpha=p.alpha*n,i.strokeStyle=a,i.strokeRect(c.x,c.y,c.width,c.height));else if(l.type===t.SHAPES.CIRC)i.beginPath(),i.arc(c.x,c.y,c.radius,0,2*Math.PI),i.closePath(),d.visible&&(i.globalAlpha=d.alpha*n,i.fillStyle=s,i.fill()),p.visible&&(i.globalAlpha=p.alpha*n,i.strokeStyle=a,i.stroke());else if(l.type===t.SHAPES.ELIP){var P=2*c.width,I=2*c.height,A=c.x-P/2,O=c.y-I/2;i.beginPath();var D=P/2*.5522848,M=I/2*.5522848,C=A+P,R=O+I,L=A+P/2,N=O+I/2;i.moveTo(A,N),i.bezierCurveTo(A,N-M,L-D,O,L,O),i.bezierCurveTo(L+D,O,C,N-M,C,N),i.bezierCurveTo(C,N+M,L+D,R,L,R),i.bezierCurveTo(L-D,R,A,N+M,A,N),i.closePath(),d.visible&&(i.globalAlpha=d.alpha*n,i.fillStyle=s,i.fill()),p.visible&&(i.globalAlpha=p.alpha*n,i.strokeStyle=a,i.stroke())}else if(l.type===t.SHAPES.RREC){var F=c.x,B=c.y,U=c.width,k=c.height,X=c.radius,j=Math.min(U,k)/2|0;X=X>j?j:X,i.beginPath(),i.moveTo(F,B+X),i.lineTo(F,B+k-X),i.quadraticCurveTo(F,B+k,F+X,B+k),i.lineTo(F+U-X,B+k),i.quadraticCurveTo(F+U,B+k,F+U,B+k-X),i.lineTo(F+U,B+X),i.quadraticCurveTo(F+U,B,F+U-X,B),i.lineTo(F+X,B),i.quadraticCurveTo(F,B,F,B+X),i.closePath(),d.visible&&(i.globalAlpha=d.alpha*n,i.fillStyle=s,i.fill()),p.visible&&(i.globalAlpha=p.alpha*n,i.strokeStyle=a,i.stroke())}}},Pa.prototype.updateGraphicsTint=function(t){t._prevTint=t.tint,t.canvasTintDirty=t.geometry.dirty;for(var e=(t.tint>>16&255)/255,r=(t.tint>>8&255)/255,i=(255&t.tint)/255,n=t.geometry.graphicsData,o=0;o<n.length;++o){var s=n[o],a=0|s.fillStyle.color,h=0|s.lineStyle.color;s._fillTint=((a>>16&255)/255*e*255<<16)+((a>>8&255)/255*r*255<<8)+(255&a)/255*i*255,s._lineTint=((h>>16&255)/255*e*255<<16)+((h>>8&255)/255*r*255<<8)+(255&h)/255*i*255}},Pa.prototype.setPatternTransform=function(t,e){if(!1!==this._svgMatrix){if(!this._svgMatrix){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r&&(this._svgMatrix=r.createSVGMatrix()),this._svgMatrix||(this._svgMatrix=!1)}this._svgMatrix.a=e.a,this._svgMatrix.b=e.b,this._svgMatrix.c=e.c,this._svgMatrix.d=e.d,this._svgMatrix.e=e.tx,this._svgMatrix.f=e.ty,t.setTransform(this._svgMatrix.inverse())}},Pa.prototype.destroy=function(){this.renderer=null};var Ia=new Be;Vo.prototype.generateCanvasTexture=function(t,e){void 0===e&&(e=1);var r=this.getLocalBounds(),i=Vr.create(r.width,r.height,t,e);wa||(wa=new ba),this.transform.updateLocalTransform(),this.transform.localTransform.copyTo(Ia),Ia.invert(),Ia.tx-=r.x,Ia.ty-=r.y,wa.render(this,i,!0,Ia);var n=Yr.from(i.baseTexture._canvasRenderTarget.canvas,{scaleMode:t});return n.baseTexture.resolution=e,n.baseTexture.update(),n},Vo.prototype.cachedGraphicsData=[],Vo.prototype._renderCanvas=function(t){!0!==this.isMask&&(this.finishPoly(),t.plugins.graphics.render(this))};var Aa=new Be,Oa=function(t){this.renderer=t};Oa.prototype.render=function(e){var r=e._texture,i=this.renderer,n=i.context,o=r._frame.width,s=r._frame.height,a=e.transform.worldTransform,h=0,u=0,l=r.baseTexture.getDrawableSource();if(!(r.orig.width<=0||r.orig.height<=0)&&r.valid&&l&&r.valid){i.setBlendMode(e.blendMode,!0),i.context.globalAlpha=e.worldAlpha;var c=r.baseTexture.scaleMode===t.SCALE_MODES.LINEAR;i.smoothProperty&&i.context[i.smoothProperty]!==c&&(n[i.smoothProperty]=c),r.trim?(h=r.trim.width/2+r.trim.x-e.anchor.x*r.orig.width,u=r.trim.height/2+r.trim.y-e.anchor.y*r.orig.height):(h=(.5-e.anchor.x)*r.orig.width,u=(.5-e.anchor.y)*r.orig.height),r.rotate&&(a.copyTo(Aa),a=Aa,ze.matrixAppendRotationInv(a,r.rotate,h,u),h=0,u=0),h-=o/2,u-=s/2,i.setContextTransform(a,e.roundPixels,1),e.roundPixels&&(h|=0,u|=0);var d=r.baseTexture.resolution,p=i._outerBlend;p&&(n.save(),n.beginPath(),n.rect(h*i.resolution,u*i.resolution,o*i.resolution,s*i.resolution),n.clip()),16777215!==e.tint?(e._cachedTint===e.tint&&e._tintedCanvas.tintId===e._texture._updateID||(e._cachedTint=e.tint,e._tintedCanvas=Ea.getTintedCanvas(e,e.tint)),n.drawImage(e._tintedCanvas,0,0,Math.floor(o*d),Math.floor(s*d),Math.floor(h*i.resolution),Math.floor(u*i.resolution),Math.floor(o*i.resolution),Math.floor(s*i.resolution))):n.drawImage(l,r._frame.x*d,r._frame.y*d,Math.floor(o*d),Math.floor(s*d),Math.floor(h*i.resolution),Math.floor(u*i.resolution),Math.floor(o*i.resolution),Math.floor(s*i.resolution)),p&&n.restore(),i.setBlendMode(t.BLEND_MODES.NORMAL)}},Oa.prototype.destroy=function(){this.renderer=null},Ko.prototype._tintedCanvas=null,Ko.prototype._renderCanvas=function(t){t.plugins.sprite.render(this)};var Da=new We,Ma=function(t){this.renderer=t,t.extract=this};Ma.prototype.image=function(t,e,r){var i=new Image;return i.src=this.base64(t,e,r),i},Ma.prototype.base64=function(t,e,r){return this.canvas(t).toDataURL(e,r)},Ma.prototype.canvas=function(t){var e,r,i,n,o=this.renderer;t&&(n=t instanceof Vr?t:o.generateTexture(t)),n?(e=n.baseTexture._canvasRenderTarget.context,r=n.baseTexture._canvasRenderTarget.resolution,i=n.frame):(e=o.rootContext,r=o.resolution,(i=Da).width=this.renderer.width,i.height=this.renderer.height);var s=Math.floor(i.width*r+1e-4),a=Math.floor(i.height*r+1e-4),h=new Se(s,a,1),u=e.getImageData(i.x*r,i.y*r,s,a);return h.context.putImageData(u,0,0),h.canvas},Ma.prototype.pixels=function(t){var e,r,i,n,o=this.renderer;return t&&(n=t instanceof Vr?t:o.generateTexture(t)),n?(e=n.baseTexture._canvasRenderTarget.context,r=n.baseTexture._canvasRenderTarget.resolution,i=n.frame):(e=o.rootContext,(i=Da).width=o.width,i.height=o.height),e.getImageData(0,0,i.width*r,i.height*r).data},Ma.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null};var Ca=16,Ra=function(t){function e(e){t.call(this,e),this.uploadHookHelper=this,this.canvas=document.createElement("canvas"),this.canvas.width=Ca,this.canvas.height=Ca,this.ctx=this.canvas.getContext("2d"),this.registerUploadHook(La)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.destroy=function(){t.prototype.destroy.call(this),this.ctx=null,this.canvas=null},e}(us);function La(t,e){if(e instanceof Or){var r=e.source,i=0===r.width?t.canvas.width:Math.min(t.canvas.width,r.width),n=0===r.height?t.canvas.height:Math.min(t.canvas.height,r.height);return t.ctx.drawImage(r,0,0,i,n,0,0,t.canvas.width,t.canvas.height),!0}return!1}return Ps.prototype._renderCanvas=function(t){var e=this._texture;if(e.baseTexture.valid){var r=t.context,i=this.worldTransform,n=e.baseTexture,o=n.getDrawableSource(),s=n.resolution,a=this.tilePosition.x/this.tileScale.x%e._frame.width*s,h=this.tilePosition.y/this.tileScale.y%e._frame.height*s;if(this._textureID!==this._texture._updateID||this._cachedTint!==this.tint){this._textureID=this._texture._updateID;var u=new Se(e._frame.width,e._frame.height,s);16777215!==this.tint?(this._tintedCanvas=Ea.getTintedCanvas(this,this.tint),u.context.drawImage(this._tintedCanvas,0,0)):u.context.drawImage(o,-e._frame.x*s,-e._frame.y*s),this._cachedTint=this.tint,this._canvasPattern=u.context.createPattern(u.canvas,"repeat")}r.globalAlpha=this.worldAlpha,t.setBlendMode(this.blendMode),t.setContextTransform(i),r.fillStyle=this._canvasPattern,r.scale(this.tileScale.x/s,this.tileScale.y/s);var l=this.anchor.x*-this._width,c=this.anchor.y*-this._height;this.uvRespectAnchor?(r.translate(a,h),r.fillRect(-a+l,-h+c,this._width/this.tileScale.x*s,this._height/this.tileScale.y*s)):(r.translate(a+l,h+c),r.fillRect(-a,-h,this._width/this.tileScale.x*s,this._height/this.tileScale.y*s))}},go.prototype.renderCanvas=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable){var e=t.context,r=this.worldTransform,i=!0,n=0,o=0,s=0,a=0;t.setBlendMode(this.blendMode),e.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var h=0;h<this.children.length;++h){var u=this.children[h];if(u.visible&&u._texture.valid){var l=u._texture.frame;if(e.globalAlpha=this.worldAlpha*u.alpha,u.rotation%(2*Math.PI)==0)i&&(t.setContextTransform(r,!1,1),i=!1),n=u.anchor.x*(-l.width*u.scale.x)+u.position.x+.5,o=u.anchor.y*(-l.height*u.scale.y)+u.position.y+.5,s=l.width*u.scale.x,a=l.height*u.scale.y;else{i||(i=!0),u.displayObjectUpdateTransform();var c=u.worldTransform;t.setContextTransform(c,this.roundPixels,1),n=u.anchor.x*-l.width+.5,o=u.anchor.y*-l.height+.5,s=l.width,a=l.height}var d=u._texture.baseTexture.resolution;e.drawImage(u._texture.baseTexture.getDrawableSource(),l.x*d,l.y*d,l.width*d,l.height*d,n*t.resolution,o*t.resolution,s*t.resolution,a*t.resolution)}}}},er.prototype._renderCanvas=function(t){},er.prototype.renderCanvas=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable){this._mask&&t.maskManager.pushMask(this._mask),this._renderCanvas(t);for(var e=0,r=this.children.length;e<r;++e)this.children[e].renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},$e.prototype.renderCanvas=function(t){},as.prototype._renderCanvas=function(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),Ko.prototype._renderCanvas.call(this,t)},ba.registerPlugin("accessibility",ir),ba.registerPlugin("extract",Ma),ba.registerPlugin("graphics",Pa),ba.registerPlugin("interaction",yr),ba.registerPlugin("mesh",Sa),ba.registerPlugin("prepare",Ra),ba.registerPlugin("sprite",Oa),t.AbstractBatchRenderer=Cn,t.AbstractRenderer=En,t.AnimatedSprite=fa,t.AppLoaderPlugin=fo,t.Application=Xn,t.Attribute=qr,t.BasePrepare=us,t.BaseRenderTexture=jr,t.BaseTexture=Or,t.BatchDrawCall=An,t.BatchGeometry=Ln,t.BatchPluginFactory=Bn,t.BatchRenderer=kn,t.BatchShaderGenerator=Rn,t.BatchTextureArray=On,t.BitmapFontLoader=Rs,t.BitmapText=Cs,t.Bounds=Qe,t.Buffer=Zr,t.CanvasExtract=Ma,t.CanvasGraphicsRenderer=Pa,t.CanvasMeshRenderer=Sa,t.CanvasPrepare=Ra,t.CanvasRenderer=ba,t.CanvasSpriteRenderer=Oa,t.Circle=qe,t.Container=er,t.CountLimiter=hs,t.CubeTexture=In,t.DEG_TO_RAD=Fe,t.DisplayObject=$e,t.Ellipse=Ke,t.Extract=Yn,t.FillStyle=Eo,t.Filter=Vi,t.Framebuffer=kr,t.GLProgram=an,t.GLTexture=yn,t.GRAPHICS_CURVES=bo,t.Geometry=ri,t.Graphics=Vo,t.GraphicsData=ko,t.GraphicsGeometry=Ho,t.LineStyle=Go,t.Loader=po,t.LoaderResource=vo,t.MaskData=mi,t.Matrix=Be,t.Mesh=ra,t.MeshBatchUvs=$s,t.MeshGeometry=sa,t.MeshMaterial=oa,t.NineSlicePlane=pa,t.ObjectRenderer=ui,t.ObservablePoint=Re,t.PI_2=Le,t.ParticleContainer=go,t.ParticleRenderer=xo,t.PlaneGeometry=aa,t.Point=Ce,t.Polygon=Ze,t.Prepare=ms,t.Program=Xi,t.Quad=ii,t.QuadUv=ni,t.RAD_TO_DEG=Ne,t.Rectangle=We,t.RenderTexture=Vr,t.RenderTexturePool=Wr,t.Renderer=Tn,t.RopeGeometry=ha,t.RoundedRectangle=Je,t.Runner=xr,t.Shader=Hi,t.SimpleMesh=ca,t.SimplePlane=la,t.SimpleRope=ua,t.Sprite=Ko,t.SpriteMaskFilter=Qi,t.Spritesheet=Es,t.SpritesheetLoader=Ss,t.State=Yi,t.System=Br,t.TEXT_GRADIENT=Zo,t.Text=as,t.TextMetrics=ns,t.TextStyle=$o,t.Texture=Yr,t.TextureLoader=co,t.TextureMatrix=Zi,t.TextureUvs=Hr,t.Ticker=ar,t.TickerPlugin=hr,t.TilingSprite=Ps,t.TilingSpriteRenderer=Ms,t.TimeLimiter=bs,t.Transform=Ve,t.UniformGroup=si,t.VERSION="5.2.2",t.ViewableBuffer=Dn,t.accessibility=or,t.autoDetectRenderer=Sn,t.canvasUtils=Ea,t.checkMaxIfStatementsInShader=Fi,t.defaultFilterVertex=Pn,t.defaultVertex=wn,t.filters=ga,t.graphicsUtils=Uo,t.groupD8=ze,t.interaction=_r,t.isMobile=M,t.resources=Fr,t.settings=C,t.systems=xn,t.useDeprecated=function(){var t=this;Object.defineProperties(t,{SVG_SIZE:{get:function(){return xe(va,"PIXI.utils.SVG_SIZE property has moved to PIXI.resources.SVGResource.SVG_SIZE"),t.SVGResource.SVG_SIZE}},TransformStatic:{get:function(){return xe(va,"PIXI.TransformStatic class has been removed, use PIXI.Transform"),t.Transform}},TransformBase:{get:function(){return xe(va,"PIXI.TransformBase class has been removed, use PIXI.Transform"),t.Transform}},TRANSFORM_MODE:{get:function(){return xe(va,"PIXI.TRANSFORM_MODE property has been removed"),{STATIC:0,DYNAMIC:1}}},WebGLRenderer:{get:function(){return xe(va,"PIXI.WebGLRenderer class has moved to PIXI.Renderer"),t.Renderer}},CanvasRenderTarget:{get:function(){return xe(va,"PIXI.CanvasRenderTarget class has moved to PIXI.utils.CanvasRenderTarget"),t.utils.CanvasRenderTarget}},loader:{get:function(){return xe(va,"PIXI.loader instance has moved to PIXI.Loader.shared"),t.Loader.shared}},FilterManager:{get:function(){return xe(va,"PIXI.FilterManager class has moved to PIXI.systems.FilterSystem"),t.systems.FilterSystem}},CanvasTinter:{get:function(){return xe("5.2.0","PIXI.CanvasTinter namespace has moved to PIXI.canvasUtils"),t.canvasUtils}},GroupD8:{get:function(){return xe("5.2.0","PIXI.GroupD8 namespace has moved to PIXI.groupD8"),t.groupD8}}}),t.prepare={},Object.defineProperties(t.prepare,{BasePrepare:{get:function(){return xe("5.2.1","PIXI.prepare.BasePrepare moved to PIXI.BasePrepare"),t.BasePrepare}},Prepare:{get:function(){return xe("5.2.1","PIXI.prepare.Prepare moved to PIXI.Prepare"),t.Prepare}},CanvasPrepare:{get:function(){return xe("5.2.1","PIXI.prepare.CanvasPrepare moved to PIXI.CanvasPrepare"),t.CanvasPrepare}}}),t.extract={},Object.defineProperties(t.extract,{Extract:{get:function(){return xe("5.2.1","PIXI.extract.Extract moved to PIXI.Extract"),t.Extract}},CanvasExtract:{get:function(){return xe("5.2.1","PIXI.extract.CanvasExtract moved to PIXI.CanvasExtract"),t.CanvasExtract}}}),t.extras={},Object.defineProperties(t.extras,{TilingSprite:{get:function(){return xe(va,"PIXI.extras.TilingSprite class has moved to PIXI.TilingSprite"),t.TilingSprite}},TilingSpriteRenderer:{get:function(){return xe(va,"PIXI.extras.TilingSpriteRenderer class has moved to PIXI.TilingSpriteRenderer"),t.TilingSpriteRenderer}},AnimatedSprite:{get:function(){return xe(va,"PIXI.extras.AnimatedSprite class has moved to PIXI.AnimatedSprite"),t.AnimatedSprite}},BitmapText:{get:function(){return xe(va,"PIXI.extras.BitmapText class has moved to PIXI.BitmapText"),t.BitmapText}}}),Object.defineProperties(t.utils,{getSvgSize:{get:function(){return xe(va,"PIXI.utils.getSvgSize function has moved to PIXI.resources.SVGResource.getSize"),t.SVGResource.getSize}}}),t.mesh={},Object.defineProperties(t.mesh,{Mesh:{get:function(){return xe(va,"PIXI.mesh.Mesh class has moved to PIXI.SimpleMesh"),t.SimpleMesh}},NineSlicePlane:{get:function(){return xe(va,"PIXI.mesh.NineSlicePlane class has moved to PIXI.NineSlicePlane"),t.NineSlicePlane}},Plane:{get:function(){return xe(va,"PIXI.mesh.Plane class has moved to PIXI.SimplePlane"),t.SimplePlane}},Rope:{get:function(){return xe(va,"PIXI.mesh.Rope class has moved to PIXI.SimpleRope"),t.SimpleRope}},RawMesh:{get:function(){return xe(va,"PIXI.mesh.RawMesh class has moved to PIXI.Mesh"),t.Mesh}},CanvasMeshRenderer:{get:function(){return xe(va,"PIXI.mesh.CanvasMeshRenderer class has moved to PIXI.CanvasMeshRenderer"),t.CanvasMeshRenderer}},MeshRenderer:{get:function(){return xe(va,"PIXI.mesh.MeshRenderer class has moved to PIXI.MeshRenderer"),t.MeshRenderer}}}),t.particles={},Object.defineProperties(t.particles,{ParticleContainer:{get:function(){return xe(va,"PIXI.particles.ParticleContainer class has moved to PIXI.ParticleContainer"),t.ParticleContainer}},ParticleRenderer:{get:function(){return xe(va,"PIXI.particles.ParticleRenderer class has moved to PIXI.ParticleRenderer"),t.ParticleRenderer}}}),t.ticker={},Object.defineProperties(t.ticker,{Ticker:{get:function(){return xe(va,"PIXI.ticker.Ticker class has moved to PIXI.Ticker"),t.Ticker}},shared:{get:function(){return xe(va,"PIXI.ticker.shared instance has moved to PIXI.Ticker.shared"),t.Ticker.shared}}}),t.loaders={},Object.defineProperties(t.loaders,{Loader:{get:function(){return xe(va,"PIXI.loaders.Loader class has moved to PIXI.Loader"),t.Loader}},Resource:{get:function(){return xe(va,"PIXI.loaders.Resource class has moved to PIXI.LoaderResource"),t.LoaderResource}},bitmapFontParser:{get:function(){return xe(va,"PIXI.loaders.bitmapFontParser function has moved to PIXI.BitmapFontLoader.use"),t.BitmapFontLoader.use}},parseBitmapFontData:{get:function(){return xe(va,"PIXI.loaders.parseBitmapFontData function has moved to PIXI.BitmapFontLoader.parse"),t.BitmapFontLoader.parse}},spritesheetParser:{get:function(){return xe(va,"PIXI.loaders.spritesheetParser function has moved to PIXI.SpritesheetLoader.use"),t.SpritesheetLoader.use}},getResourcePath:{get:function(){return xe(va,"PIXI.loaders.getResourcePath property has moved to PIXI.SpritesheetLoader.getResourcePath"),t.SpritesheetLoader.getResourcePath}}}),t.Loader.addPixiMiddleware=function(e){return xe(va,"PIXI.loaders.Loader.addPixiMiddleware function is deprecated, use PIXI.loaders.Loader.registerPlugin"),t.loaders.Loader.registerPlugin({use:e()})},Object.defineProperty(t.extract,"WebGLExtract",{get:function(){return xe(va,"PIXI.extract.WebGLExtract method has moved to PIXI.Extract"),t.Extract}}),Object.defineProperty(t.prepare,"WebGLPrepare",{get:function(){return xe(va,"PIXI.prepare.WebGLPrepare class has moved to PIXI.Prepare"),t.Prepare}}),t.Container.prototype._renderWebGL=function(t){xe(va,"PIXI.Container._renderWebGL method has moved to PIXI.Container._render"),this._render(t)},t.Container.prototype.renderWebGL=function(t){xe(va,"PIXI.Container.renderWebGL method has moved to PIXI.Container.render"),this.render(t)},t.DisplayObject.prototype.renderWebGL=function(t){xe(va,"PIXI.DisplayObject.renderWebGL method has moved to PIXI.DisplayObject.render"),this.render(t)},t.Container.prototype.renderAdvancedWebGL=function(t){xe(va,"PIXI.Container.renderAdvancedWebGL method has moved to PIXI.Container.renderAdvanced"),this.renderAdvanced(t)},Object.defineProperties(t.settings,{TRANSFORM_MODE:{get:function(){return xe(va,"PIXI.settings.TRANSFORM_MODE property has been removed"),0},set:function(){xe(va,"PIXI.settings.TRANSFORM_MODE property has been removed")}}});var e=t.BaseTexture;e.prototype.loadSource=function(e){xe(va,"PIXI.BaseTexture.loadSource method has been deprecated");var r=t.resources.autoDetectResource(e);r.internal=!0,this.setResource(r),this.update()};var r=!1;Object.defineProperties(e.prototype,{hasLoaded:{get:function(){return xe(va,"PIXI.BaseTexture.hasLoaded property has been removed, use PIXI.BaseTexture.valid"),this.valid}},imageUrl:{get:function(){return xe(va,"PIXI.BaseTexture.imageUrl property has been removed, use PIXI.BaseTexture.resource.url"),this.resource&&this.resource.url},set:function(t){xe(va,"PIXI.BaseTexture.imageUrl property has been removed, use PIXI.BaseTexture.resource.url"),this.resource&&(this.resource.url=t)}},source:{get:function(){return xe(va,"PIXI.BaseTexture.source property has been moved, use `PIXI.BaseTexture.resource.source`"),this.resource&&this.resource.source},set:function(t){xe(va,"PIXI.BaseTexture.source property has been moved, use `PIXI.BaseTexture.resource.source` if you want to set HTMLCanvasElement. Otherwise, create new BaseTexture."),this.resource&&(this.resource.source=t)}},premultiplyAlpha:{get:function(){return xe("5.2.0","PIXI.BaseTexture.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),0!==this.alphaMode},set:function(t){xe("5.2.0","PIXI.BaseTexture.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),this.alphaMode=Number(t)}},_id:{get:function(){return r||(xe("5.2.0","PIXI.BaseTexture._id batch local field has been changed to `_batchLocation`"),r=!0),this._batchLocation},set:function(t){this._batchLocation=t}}}),e.fromImage=function(t,r,i,n){xe(va,"PIXI.BaseTexture.fromImage method has been replaced with PIXI.BaseTexture.from");var o={scale:n,crossorigin:r};return e.from(t,{scaleMode:i,resourceOptions:o})},e.fromCanvas=function(t,r){return xe(va,"PIXI.BaseTexture.fromCanvas method has been replaced with PIXI.BaseTexture.from"),e.from(t,{scaleMode:r})},e.fromSVG=function(t,r,i,n){xe(va,"PIXI.BaseTexture.fromSVG method has been replaced with PIXI.BaseTexture.from");var o={scale:n,crossorigin:r};return e.from(t,{scaleMode:i,resourceOptions:o})},Object.defineProperties(t.resources.ImageResource.prototype,{premultiplyAlpha:{get:function(){return xe("5.2.0","PIXI.resources.ImageResource.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),0!==this.alphaMode},set:function(t){xe("5.2.0","PIXI.resources.ImageResource.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),this.alphaMode=Number(t)}}}),t.Point.prototype.copy=function(t){return xe(va,"PIXI.Point.copy method has been replaced with PIXI.Point.copyFrom"),this.copyFrom(t)},t.ObservablePoint.prototype.copy=function(t){return xe(va,"PIXI.ObservablePoint.copy method has been replaced with PIXI.ObservablePoint.copyFrom"),this.copyFrom(t)},t.Rectangle.prototype.copy=function(t){return xe(va,"PIXI.Rectangle.copy method has been replaced with PIXI.Rectangle.copyFrom"),this.copyFrom(t)},t.Matrix.prototype.copy=function(t){return xe(va,"PIXI.Matrix.copy method has been replaced with PIXI.Matrix.copyTo"),this.copyTo(t)},t.systems.StateSystem.prototype.setState=function(t){return xe("v5.1.0","StateSystem.setState has been renamed to StateSystem.set"),this.set(t)},Object.assign(t.systems.FilterSystem.prototype,{getRenderTarget:function(t,e){return xe(va,"PIXI.FilterManager.getRenderTarget method has been replaced with PIXI.systems.FilterSystem#getFilterTexture"),this.getFilterTexture(e)},returnRenderTarget:function(t){xe(va,"PIXI.FilterManager.returnRenderTarget method has been replaced with PIXI.systems.FilterSystem.returnFilterTexture"),this.returnFilterTexture(t)},calculateScreenSpaceMatrix:function(t){xe(va,"PIXI.systems.FilterSystem.calculateScreenSpaceMatrix method is removed, use `(vTextureCoord * inputSize.xy) + outputFrame.xy` instead");var e=t.identity(),r=this.activeState,i=r.sourceFrame,n=r.destinationFrame;return e.translate(i.x/n.width,i.y/n.height),e.scale(n.width,n.height),e},calculateNormalizedScreenSpaceMatrix:function(t){xe(va,"PIXI.systems.FilterManager.calculateNormalizedScreenSpaceMatrix method is removed, use `((vTextureCoord * inputSize.xy) + outputFrame.xy) / outputFrame.zw` instead.");var e=this.activeState,r=e.sourceFrame,i=e.destinationFrame,n=t.identity();n.translate(r.x/i.width,r.y/i.height);var o=i.width/r.width,s=i.height/r.height;return n.scale(o,s),n}}),Object.defineProperties(t.RenderTexture.prototype,{sourceFrame:{get:function(){return xe(va,"PIXI.RenderTexture.sourceFrame property has been removed"),this.filterFrame}},size:{get:function(){return xe(va,"PIXI.RenderTexture.size property has been removed"),this._frame}}});var i=function(t){function e(e,r,i,n){xe(va,"PIXI.filters.BlurXFilter class is deprecated, use PIXI.filters.BlurFilterPass"),t.call(this,!0,e,r,i,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(t.filters.BlurFilterPass),n=function(t){function e(e,r,i,n){xe(va,"PIXI.filters.BlurYFilter class is deprecated, use PIXI.filters.BlurFilterPass"),t.call(this,!1,e,r,i,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(t.filters.BlurFilterPass);Object.assign(t.filters,{BlurXFilter:i,BlurYFilter:n});var o=t.Sprite,s=t.Texture,a=t.Graphics;function h(t,e,r,i){return xe(va,"PIXI.Sprite."+t+" method is deprecated, use PIXI.Sprite.from"),o.from(e,{resourceOptions:{scale:i,crossorigin:r}})}function u(t,e,r,i){return xe(va,"PIXI.Texture."+t+" method is deprecated, use PIXI.Texture.from"),s.from(e,{resourceOptions:{scale:i,crossorigin:r}})}a.prototype.generateCanvasTexture||(a.prototype.generateCanvasTexture=function(){xe(va,'PIXI.Graphics.generateCanvasTexture method is only available in "pixi.js-legacy"')}),Object.defineProperty(t.Graphics.prototype,"graphicsData",{get:function(){return xe(va,"PIXI.Graphics.graphicsData property is deprecated, use PIXI.Graphics.geometry.graphicsData"),this.geometry.graphicsData}}),Object.defineProperty(t.SimpleRope.prototype,"points",{get:function(){return xe(va,"PIXI.SimpleRope.points property is deprecated, use PIXI.SimpleRope.geometry.points"),this.geometry.points},set:function(t){xe(va,"PIXI.SimpleRope.points property is deprecated, use PIXI.SimpleRope.geometry.points"),this.geometry.points=t}}),o.fromImage=h.bind(null,"fromImage"),o.fromSVG=h.bind(null,"fromSVG"),o.fromCanvas=h.bind(null,"fromCanvas"),o.fromVideo=h.bind(null,"fromVideo"),o.fromFrame=h.bind(null,"fromFrame"),s.fromImage=u.bind(null,"fromImage"),s.fromSVG=u.bind(null,"fromSVG"),s.fromCanvas=u.bind(null,"fromCanvas"),s.fromVideo=u.bind(null,"fromVideo"),s.fromFrame=u.bind(null,"fromFrame"),Object.defineProperty(t.AbstractRenderer.prototype,"autoResize",{get:function(){return xe(va,"PIXI.AbstractRenderer.autoResize property is deprecated, use PIXI.AbstractRenderer.autoDensity"),this.autoDensity},set:function(t){xe(va,"PIXI.AbstractRenderer.autoResize property is deprecated, use PIXI.AbstractRenderer.autoDensity"),this.autoDensity=t}}),Object.defineProperty(t.Renderer.prototype,"textureManager",{get:function(){return xe(va,"PIXI.Renderer.textureManager property is deprecated, use PIXI.Renderer.texture"),this.texture}}),t.utils.mixins={mixin:function(){xe(va,"PIXI.utils.mixins.mixin function is no longer available")},delayMixin:function(){xe(va,"PIXI.utils.mixins.delayMixin function is no longer available")},performMixins:function(){xe(va,"PIXI.utils.mixins.performMixins function is no longer available")}}},t.utils=Me,t}({});PIXI.useDeprecated();

console.log('%c Vylocity v0.0.1 ', 'background: #4a5876; color: #dabf70; font-weight: bold; padding: 6px 2px 7px 2px;', 'https://www.vylocity.com/');

/* pako 1.0.3 nodeca/pako */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.pako=e()}}(function(){return function e(t,i,n){function a(o,s){if(!i[o]){if(!t[o]){var f="function"==typeof require&&require;if(!s&&f)return f(o,!0);if(r)return r(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var d=i[o]={exports:{}};t[o][0].call(d.exports,function(e){var i=t[o][1][e];return a(i?i:e)},d,d.exports,e,t,i,n)}return i[o].exports}for(var r="function"==typeof require&&require,o=0;o<n.length;o++)a(n[o]);return a}({1:[function(e,t,i){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])}}return e},i.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,i,n,a){if(t.subarray&&e.subarray)return void e.set(t.subarray(i,i+n),a);for(var r=0;r<n;r++)e[a+r]=t[i+r]},flattenChunks:function(e){var t,i,n,a,r,o;for(n=0,t=0,i=e.length;t<i;t++)n+=e[t].length;for(o=new Uint8Array(n),a=0,t=0,i=e.length;t<i;t++)r=e[t],o.set(r,a),a+=r.length;return o}},r={arraySet:function(e,t,i,n,a){for(var r=0;r<n;r++)e[a+r]=t[i+r]},flattenChunks:function(e){return[].concat.apply([],e)}};i.setTyped=function(e){e?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,a)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,r))},i.setTyped(n)},{}],2:[function(e,t,i){"use strict";function n(e,t){if(t<65537&&(e.subarray&&o||!e.subarray&&r))return String.fromCharCode.apply(null,a.shrinkBuf(e,t));for(var i="",n=0;n<t;n++)i+=String.fromCharCode(e[n]);return i}var a=e("./common"),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var s=new a.Buf8(256),f=0;f<256;f++)s[f]=f>=252?6:f>=248?5:f>=240?4:f>=224?3:f>=192?2:1;s[254]=s[254]=1,i.string2buf=function(e){var t,i,n,r,o,s=e.length,f=0;for(r=0;r<s;r++)i=e.charCodeAt(r),55296===(64512&i)&&r+1<s&&(n=e.charCodeAt(r+1),56320===(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),r++)),f+=i<128?1:i<2048?2:i<65536?3:4;for(t=new a.Buf8(f),o=0,r=0;o<f;r++)i=e.charCodeAt(r),55296===(64512&i)&&r+1<s&&(n=e.charCodeAt(r+1),56320===(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),r++)),i<128?t[o++]=i:i<2048?(t[o++]=192|i>>>6,t[o++]=128|63&i):i<65536?(t[o++]=224|i>>>12,t[o++]=128|i>>>6&63,t[o++]=128|63&i):(t[o++]=240|i>>>18,t[o++]=128|i>>>12&63,t[o++]=128|i>>>6&63,t[o++]=128|63&i);return t},i.buf2binstring=function(e){return n(e,e.length)},i.binstring2buf=function(e){for(var t=new a.Buf8(e.length),i=0,n=t.length;i<n;i++)t[i]=e.charCodeAt(i);return t},i.buf2string=function(e,t){var i,a,r,o,f=t||e.length,l=new Array(2*f);for(a=0,i=0;i<f;)if(r=e[i++],r<128)l[a++]=r;else if(o=s[r],o>4)l[a++]=65533,i+=o-1;else{for(r&=2===o?31:3===o?15:7;o>1&&i<f;)r=r<<6|63&e[i++],o--;o>1?l[a++]=65533:r<65536?l[a++]=r:(r-=65536,l[a++]=55296|r>>10&1023,l[a++]=56320|1023&r)}return n(l,a)},i.utf8border=function(e,t){var i;for(t=t||e.length,t>e.length&&(t=e.length),i=t-1;i>=0&&128===(192&e[i]);)i--;return i<0?t:0===i?t:i+s[e[i]]>t?i:t}},{"./common":1}],3:[function(e,t,i){"use strict";function n(e,t,i,n){for(var a=65535&e|0,r=e>>>16&65535|0,o=0;0!==i;){o=i>2e3?2e3:i,i-=o;do a=a+t[n++]|0,r=r+a|0;while(--o);a%=65521,r%=65521}return a|r<<16|0}t.exports=n},{}],4:[function(e,t,i){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],5:[function(e,t,i){"use strict";function n(){for(var e,t=[],i=0;i<256;i++){e=i;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}function a(e,t,i,n){var a=r,o=n+i;e^=-1;for(var s=n;s<o;s++)e=e>>>8^a[255&(e^t[s])];return e^-1}var r=n();t.exports=a},{}],6:[function(e,t,i){"use strict";function n(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}t.exports=n},{}],7:[function(e,t,i){"use strict";var n=30,a=12;t.exports=function(e,t){var i,r,o,s,f,l,d,u,c,h,b,w,m,k,_,g,v,p,x,y,S,E,B,Z,A;i=e.state,r=e.next_in,Z=e.input,o=r+(e.avail_in-5),s=e.next_out,A=e.output,f=s-(t-e.avail_out),l=s+(e.avail_out-257),d=i.dmax,u=i.wsize,c=i.whave,h=i.wnext,b=i.window,w=i.hold,m=i.bits,k=i.lencode,_=i.distcode,g=(1<<i.lenbits)-1,v=(1<<i.distbits)-1;e:do{m<15&&(w+=Z[r++]<<m,m+=8,w+=Z[r++]<<m,m+=8),p=k[w&g];t:for(;;){if(x=p>>>24,w>>>=x,m-=x,x=p>>>16&255,0===x)A[s++]=65535&p;else{if(!(16&x)){if(0===(64&x)){p=k[(65535&p)+(w&(1<<x)-1)];continue t}if(32&x){i.mode=a;break e}e.msg="invalid literal/length code",i.mode=n;break e}y=65535&p,x&=15,x&&(m<x&&(w+=Z[r++]<<m,m+=8),y+=w&(1<<x)-1,w>>>=x,m-=x),m<15&&(w+=Z[r++]<<m,m+=8,w+=Z[r++]<<m,m+=8),p=_[w&v];i:for(;;){if(x=p>>>24,w>>>=x,m-=x,x=p>>>16&255,!(16&x)){if(0===(64&x)){p=_[(65535&p)+(w&(1<<x)-1)];continue i}e.msg="invalid distance code",i.mode=n;break e}if(S=65535&p,x&=15,m<x&&(w+=Z[r++]<<m,m+=8,m<x&&(w+=Z[r++]<<m,m+=8)),S+=w&(1<<x)-1,S>d){e.msg="invalid distance too far back",i.mode=n;break e}if(w>>>=x,m-=x,x=s-f,S>x){if(x=S-x,x>c&&i.sane){e.msg="invalid distance too far back",i.mode=n;break e}if(E=0,B=b,0===h){if(E+=u-x,x<y){y-=x;do A[s++]=b[E++];while(--x);E=s-S,B=A}}else if(h<x){if(E+=u+h-x,x-=h,x<y){y-=x;do A[s++]=b[E++];while(--x);if(E=0,h<y){x=h,y-=x;do A[s++]=b[E++];while(--x);E=s-S,B=A}}}else if(E+=h-x,x<y){y-=x;do A[s++]=b[E++];while(--x);E=s-S,B=A}for(;y>2;)A[s++]=B[E++],A[s++]=B[E++],A[s++]=B[E++],y-=3;y&&(A[s++]=B[E++],y>1&&(A[s++]=B[E++]))}else{E=s-S;do A[s++]=A[E++],A[s++]=A[E++],A[s++]=A[E++],y-=3;while(y>2);y&&(A[s++]=A[E++],y>1&&(A[s++]=A[E++]))}break}}break}}while(r<o&&s<l);y=m>>3,r-=y,m-=y<<3,w&=(1<<m)-1,e.next_in=r,e.next_out=s,e.avail_in=r<o?5+(o-r):5-(r-o),e.avail_out=s<l?257+(l-s):257-(s-l),i.hold=w,i.bits=m}},{}],8:[function(e,t,i){"use strict";function n(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function a(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new _.Buf16(320),this.work=new _.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function r(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=D,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new _.Buf32(we),t.distcode=t.distdyn=new _.Buf32(me),t.sane=1,t.back=-1,z):C}function o(e){var t;return e&&e.state?(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,r(e)):C}function s(e,t){var i,n;return e&&e.state?(n=e.state,t<0?(i=0,t=-t):(i=(t>>4)+1,t<48&&(t&=15)),t&&(t<8||t>15)?C:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=i,n.wbits=t,o(e))):C}function f(e,t){var i,n;return e?(n=new a,e.state=n,n.window=null,i=s(e,t),i!==z&&(e.state=null),i):C}function l(e){return f(e,_e)}function d(e){if(ge){var t;for(m=new _.Buf32(512),k=new _.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(x(S,e.lens,0,288,m,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;x(E,e.lens,0,32,k,0,e.work,{bits:5}),ge=!1}e.lencode=m,e.lenbits=9,e.distcode=k,e.distbits=5}function u(e,t,i,n){var a,r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new _.Buf8(r.wsize)),n>=r.wsize?(_.arraySet(r.window,t,i-r.wsize,r.wsize,0),r.wnext=0,r.whave=r.wsize):(a=r.wsize-r.wnext,a>n&&(a=n),_.arraySet(r.window,t,i-n,a,r.wnext),n-=a,n?(_.arraySet(r.window,t,i-n,n,0),r.wnext=n,r.whave=r.wsize):(r.wnext+=a,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=a))),0}function c(e,t){var i,a,r,o,s,f,l,c,h,b,w,m,k,we,me,ke,_e,ge,ve,pe,xe,ye,Se,Ee,Be=0,Ze=new _.Buf8(4),Ae=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return C;i=e.state,i.mode===X&&(i.mode=W),s=e.next_out,r=e.output,l=e.avail_out,o=e.next_in,a=e.input,f=e.avail_in,c=i.hold,h=i.bits,b=f,w=l,ye=z;e:for(;;)switch(i.mode){case D:if(0===i.wrap){i.mode=W;break}for(;h<16;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(2&i.wrap&&35615===c){i.check=0,Ze[0]=255&c,Ze[1]=c>>>8&255,i.check=v(i.check,Ze,2,0),c=0,h=0,i.mode=F;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",i.mode=ce;break}if((15&c)!==U){e.msg="unknown compression method",i.mode=ce;break}if(c>>>=4,h-=4,xe=(15&c)+8,0===i.wbits)i.wbits=xe;else if(xe>i.wbits){e.msg="invalid window size",i.mode=ce;break}i.dmax=1<<xe,e.adler=i.check=1,i.mode=512&c?q:X,c=0,h=0;break;case F:for(;h<16;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(i.flags=c,(255&i.flags)!==U){e.msg="unknown compression method",i.mode=ce;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=ce;break}i.head&&(i.head.text=c>>8&1),512&i.flags&&(Ze[0]=255&c,Ze[1]=c>>>8&255,i.check=v(i.check,Ze,2,0)),c=0,h=0,i.mode=L;case L:for(;h<32;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}i.head&&(i.head.time=c),512&i.flags&&(Ze[0]=255&c,Ze[1]=c>>>8&255,Ze[2]=c>>>16&255,Ze[3]=c>>>24&255,i.check=v(i.check,Ze,4,0)),c=0,h=0,i.mode=H;case H:for(;h<16;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}i.head&&(i.head.xflags=255&c,i.head.os=c>>8),512&i.flags&&(Ze[0]=255&c,Ze[1]=c>>>8&255,i.check=v(i.check,Ze,2,0)),c=0,h=0,i.mode=M;case M:if(1024&i.flags){for(;h<16;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}i.length=c,i.head&&(i.head.extra_len=c),512&i.flags&&(Ze[0]=255&c,Ze[1]=c>>>8&255,i.check=v(i.check,Ze,2,0)),c=0,h=0}else i.head&&(i.head.extra=null);i.mode=j;case j:if(1024&i.flags&&(m=i.length,m>f&&(m=f),m&&(i.head&&(xe=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),_.arraySet(i.head.extra,a,o,m,xe)),512&i.flags&&(i.check=v(i.check,a,m,o)),f-=m,o+=m,i.length-=m),i.length))break e;i.length=0,i.mode=K;case K:if(2048&i.flags){if(0===f)break e;m=0;do xe=a[o+m++],i.head&&xe&&i.length<65536&&(i.head.name+=String.fromCharCode(xe));while(xe&&m<f);if(512&i.flags&&(i.check=v(i.check,a,m,o)),f-=m,o+=m,xe)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=P;case P:if(4096&i.flags){if(0===f)break e;m=0;do xe=a[o+m++],i.head&&xe&&i.length<65536&&(i.head.comment+=String.fromCharCode(xe));while(xe&&m<f);if(512&i.flags&&(i.check=v(i.check,a,m,o)),f-=m,o+=m,xe)break e}else i.head&&(i.head.comment=null);i.mode=Y;case Y:if(512&i.flags){for(;h<16;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(c!==(65535&i.check)){e.msg="header crc mismatch",i.mode=ce;break}c=0,h=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=X;break;case q:for(;h<32;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}e.adler=i.check=n(c),c=0,h=0,i.mode=G;case G:if(0===i.havedict)return e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=f,i.hold=c,i.bits=h,N;e.adler=i.check=1,i.mode=X;case X:if(t===Z||t===A)break e;case W:if(i.last){c>>>=7&h,h-=7&h,i.mode=le;break}for(;h<3;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}switch(i.last=1&c,c>>>=1,h-=1,3&c){case 0:i.mode=J;break;case 1:if(d(i),i.mode=ie,t===A){c>>>=2,h-=2;break e}break;case 2:i.mode=$;break;case 3:e.msg="invalid block type",i.mode=ce}c>>>=2,h-=2;break;case J:for(c>>>=7&h,h-=7&h;h<32;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if((65535&c)!==(c>>>16^65535)){e.msg="invalid stored block lengths",i.mode=ce;break}if(i.length=65535&c,c=0,h=0,i.mode=Q,t===A)break e;case Q:i.mode=V;case V:if(m=i.length){if(m>f&&(m=f),m>l&&(m=l),0===m)break e;_.arraySet(r,a,o,m,s),f-=m,o+=m,l-=m,s+=m,i.length-=m;break}i.mode=X;break;case $:for(;h<14;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(i.nlen=(31&c)+257,c>>>=5,h-=5,i.ndist=(31&c)+1,c>>>=5,h-=5,i.ncode=(15&c)+4,c>>>=4,h-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=ce;break}i.have=0,i.mode=ee;case ee:for(;i.have<i.ncode;){for(;h<3;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}i.lens[Ae[i.have++]]=7&c,c>>>=3,h-=3}for(;i.have<19;)i.lens[Ae[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,Se={bits:i.lenbits},ye=x(y,i.lens,0,19,i.lencode,0,i.work,Se),i.lenbits=Se.bits,ye){e.msg="invalid code lengths set",i.mode=ce;break}i.have=0,i.mode=te;case te:for(;i.have<i.nlen+i.ndist;){for(;Be=i.lencode[c&(1<<i.lenbits)-1],me=Be>>>24,ke=Be>>>16&255,_e=65535&Be,!(me<=h);){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(_e<16)c>>>=me,h-=me,i.lens[i.have++]=_e;else{if(16===_e){for(Ee=me+2;h<Ee;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(c>>>=me,h-=me,0===i.have){e.msg="invalid bit length repeat",i.mode=ce;break}xe=i.lens[i.have-1],m=3+(3&c),c>>>=2,h-=2}else if(17===_e){for(Ee=me+3;h<Ee;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}c>>>=me,h-=me,xe=0,m=3+(7&c),c>>>=3,h-=3}else{for(Ee=me+7;h<Ee;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}c>>>=me,h-=me,xe=0,m=11+(127&c),c>>>=7,h-=7}if(i.have+m>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=ce;break}for(;m--;)i.lens[i.have++]=xe}}if(i.mode===ce)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=ce;break}if(i.lenbits=9,Se={bits:i.lenbits},ye=x(S,i.lens,0,i.nlen,i.lencode,0,i.work,Se),i.lenbits=Se.bits,ye){e.msg="invalid literal/lengths set",i.mode=ce;break}if(i.distbits=6,i.distcode=i.distdyn,Se={bits:i.distbits},ye=x(E,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,Se),i.distbits=Se.bits,ye){e.msg="invalid distances set",i.mode=ce;break}if(i.mode=ie,t===A)break e;case ie:i.mode=ne;case ne:if(f>=6&&l>=258){e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=f,i.hold=c,i.bits=h,p(e,w),s=e.next_out,r=e.output,l=e.avail_out,o=e.next_in,a=e.input,f=e.avail_in,c=i.hold,h=i.bits,i.mode===X&&(i.back=-1);break}for(i.back=0;Be=i.lencode[c&(1<<i.lenbits)-1],me=Be>>>24,ke=Be>>>16&255,_e=65535&Be,!(me<=h);){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(ke&&0===(240&ke)){for(ge=me,ve=ke,pe=_e;Be=i.lencode[pe+((c&(1<<ge+ve)-1)>>ge)],me=Be>>>24,ke=Be>>>16&255,_e=65535&Be,!(ge+me<=h);){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}c>>>=ge,h-=ge,i.back+=ge}if(c>>>=me,h-=me,i.back+=me,i.length=_e,0===ke){i.mode=fe;break}if(32&ke){i.back=-1,i.mode=X;break}if(64&ke){e.msg="invalid literal/length code",i.mode=ce;break}i.extra=15&ke,i.mode=ae;case ae:if(i.extra){for(Ee=i.extra;h<Ee;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}i.length+=c&(1<<i.extra)-1,c>>>=i.extra,h-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=re;case re:for(;Be=i.distcode[c&(1<<i.distbits)-1],me=Be>>>24,ke=Be>>>16&255,_e=65535&Be,!(me<=h);){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(0===(240&ke)){for(ge=me,ve=ke,pe=_e;Be=i.distcode[pe+((c&(1<<ge+ve)-1)>>ge)],me=Be>>>24,ke=Be>>>16&255,_e=65535&Be,!(ge+me<=h);){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}c>>>=ge,h-=ge,i.back+=ge}if(c>>>=me,h-=me,i.back+=me,64&ke){e.msg="invalid distance code",i.mode=ce;break}i.offset=_e,i.extra=15&ke,i.mode=oe;case oe:if(i.extra){for(Ee=i.extra;h<Ee;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}i.offset+=c&(1<<i.extra)-1,c>>>=i.extra,h-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=ce;break}i.mode=se;case se:if(0===l)break e;if(m=w-l,i.offset>m){if(m=i.offset-m,m>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=ce;break}m>i.wnext?(m-=i.wnext,k=i.wsize-m):k=i.wnext-m,m>i.length&&(m=i.length),we=i.window}else we=r,k=s-i.offset,m=i.length;m>l&&(m=l),l-=m,i.length-=m;do r[s++]=we[k++];while(--m);0===i.length&&(i.mode=ne);break;case fe:if(0===l)break e;r[s++]=i.length,l--,i.mode=ne;break;case le:if(i.wrap){for(;h<32;){if(0===f)break e;f--,c|=a[o++]<<h,h+=8}if(w-=l,e.total_out+=w,i.total+=w,w&&(e.adler=i.check=i.flags?v(i.check,r,w,s-w):g(i.check,r,w,s-w)),w=l,(i.flags?c:n(c))!==i.check){e.msg="incorrect data check",i.mode=ce;break}c=0,h=0}i.mode=de;case de:if(i.wrap&&i.flags){for(;h<32;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(c!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=ce;break}c=0,h=0}i.mode=ue;case ue:ye=R;break e;case ce:ye=O;break e;case he:return I;case be:default:return C}return e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=f,i.hold=c,i.bits=h,(i.wsize||w!==e.avail_out&&i.mode<ce&&(i.mode<le||t!==B))&&u(e,e.output,e.next_out,w-e.avail_out)?(i.mode=he,I):(b-=e.avail_in,w-=e.avail_out,e.total_in+=b,e.total_out+=w,i.total+=w,i.wrap&&w&&(e.adler=i.check=i.flags?v(i.check,r,w,e.next_out-w):g(i.check,r,w,e.next_out-w)),e.data_type=i.bits+(i.last?64:0)+(i.mode===X?128:0)+(i.mode===ie||i.mode===Q?256:0),(0===b&&0===w||t===B)&&ye===z&&(ye=T),ye)}function h(e){if(!e||!e.state)return C;var t=e.state;return t.window&&(t.window=null),e.state=null,z}function b(e,t){var i;return e&&e.state?(i=e.state,0===(2&i.wrap)?C:(i.head=t,t.done=!1,z)):C}function w(e,t){var i,n,a,r=t.length;return e&&e.state?(i=e.state,0!==i.wrap&&i.mode!==G?C:i.mode===G&&(n=1,n=g(n,t,r,0),n!==i.check)?O:(a=u(e,t,r,r))?(i.mode=he,I):(i.havedict=1,z)):C}var m,k,_=e("../utils/common"),g=e("./adler32"),v=e("./crc32"),p=e("./inffast"),x=e("./inftrees"),y=0,S=1,E=2,B=4,Z=5,A=6,z=0,R=1,N=2,C=-2,O=-3,I=-4,T=-5,U=8,D=1,F=2,L=3,H=4,M=5,j=6,K=7,P=8,Y=9,q=10,G=11,X=12,W=13,J=14,Q=15,V=16,$=17,ee=18,te=19,ie=20,ne=21,ae=22,re=23,oe=24,se=25,fe=26,le=27,de=28,ue=29,ce=30,he=31,be=32,we=852,me=592,ke=15,_e=ke,ge=!0;i.inflateReset=o,i.inflateReset2=s,i.inflateResetKeep=r,i.inflateInit=l,i.inflateInit2=f,i.inflate=c,i.inflateEnd=h,i.inflateGetHeader=b,i.inflateSetDictionary=w,i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":5,"./inffast":7,"./inftrees":9}],9:[function(e,t,i){"use strict";var n=e("../utils/common"),a=15,r=852,o=592,s=0,f=1,l=2,d=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],u=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,i,b,w,m,k,_){var g,v,p,x,y,S,E,B,Z,A=_.bits,z=0,R=0,N=0,C=0,O=0,I=0,T=0,U=0,D=0,F=0,L=null,H=0,M=new n.Buf16(a+1),j=new n.Buf16(a+1),K=null,P=0;for(z=0;z<=a;z++)M[z]=0;for(R=0;R<b;R++)M[t[i+R]]++;for(O=A,C=a;C>=1&&0===M[C];C--);if(O>C&&(O=C),0===C)return w[m++]=20971520,w[m++]=20971520,_.bits=1,0;for(N=1;N<C&&0===M[N];N++);for(O<N&&(O=N),U=1,z=1;z<=a;z++)if(U<<=1,U-=M[z],U<0)return-1;if(U>0&&(e===s||1!==C))return-1;for(j[1]=0,z=1;z<a;z++)j[z+1]=j[z]+M[z];for(R=0;R<b;R++)0!==t[i+R]&&(k[j[t[i+R]]++]=R);if(e===s?(L=K=k,S=19):e===f?(L=d,H-=257,K=u,P-=257,S=256):(L=c,K=h,S=-1),F=0,R=0,z=N,y=m,I=O,T=0,p=-1,D=1<<O,x=D-1,e===f&&D>r||e===l&&D>o)return 1;for(var Y=0;;){Y++,E=z-T,k[R]<S?(B=0,Z=k[R]):k[R]>S?(B=K[P+k[R]],Z=L[H+k[R]]):(B=96,Z=0),g=1<<z-T,v=1<<I,N=v;do v-=g,w[y+(F>>T)+v]=E<<24|B<<16|Z|0;while(0!==v);for(g=1<<z-1;F&g;)g>>=1;if(0!==g?(F&=g-1,F+=g):F=0,R++,0===--M[z]){if(z===C)break;z=t[i+k[R]]}if(z>O&&(F&x)!==p){for(0===T&&(T=O),y+=N,I=z-T,U=1<<I;I+T<C&&(U-=M[I+T],!(U<=0));)I++,U<<=1;if(D+=1<<I,e===f&&D>r||e===l&&D>o)return 1;p=F&x,w[p]=O<<24|I<<16|y-m|0}}return 0!==F&&(w[y+F]=z-T<<24|64<<16|0),_.bits=O,0}},{"../utils/common":1}],10:[function(e,t,i){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],11:[function(e,t,i){"use strict";function n(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=n},{}],"/lib/inflate.js":[function(e,t,i){"use strict";function n(e){if(!(this instanceof n))return new n(e);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var i=o.inflateInit2(this.strm,t.windowBits);if(i!==l.Z_OK)throw new Error(d[i]);this.header=new c,o.inflateGetHeader(this.strm,this.header)}function a(e,t){var i=new n(t);if(i.push(e,!0),i.err)throw i.msg;return i.result}function r(e,t){return t=t||{},t.raw=!0,a(e,t)}var o=e("./zlib/inflate"),s=e("./utils/common"),f=e("./utils/strings"),l=e("./zlib/constants"),d=e("./zlib/messages"),u=e("./zlib/zstream"),c=e("./zlib/gzheader"),h=Object.prototype.toString;n.prototype.push=function(e,t){var i,n,a,r,d,u,c=this.strm,b=this.options.chunkSize,w=this.options.dictionary,m=!1;if(this.ended)return!1;n=t===~~t?t:t===!0?l.Z_FINISH:l.Z_NO_FLUSH,"string"==typeof e?c.input=f.binstring2buf(e):"[object ArrayBuffer]"===h.call(e)?c.input=new Uint8Array(e):c.input=e,c.next_in=0,c.avail_in=c.input.length;do{if(0===c.avail_out&&(c.output=new s.Buf8(b),c.next_out=0,c.avail_out=b),i=o.inflate(c,l.Z_NO_FLUSH),i===l.Z_NEED_DICT&&w&&(u="string"==typeof w?f.string2buf(w):"[object ArrayBuffer]"===h.call(w)?new Uint8Array(w):w,i=o.inflateSetDictionary(this.strm,u)),i===l.Z_BUF_ERROR&&m===!0&&(i=l.Z_OK,m=!1),i!==l.Z_STREAM_END&&i!==l.Z_OK)return this.onEnd(i),this.ended=!0,!1;c.next_out&&(0!==c.avail_out&&i!==l.Z_STREAM_END&&(0!==c.avail_in||n!==l.Z_FINISH&&n!==l.Z_SYNC_FLUSH)||("string"===this.options.to?(a=f.utf8border(c.output,c.next_out),r=c.next_out-a,d=f.buf2string(c.output,a),c.next_out=r,c.avail_out=b-r,r&&s.arraySet(c.output,c.output,a,r,0),this.onData(d)):this.onData(s.shrinkBuf(c.output,c.next_out)))),0===c.avail_in&&0===c.avail_out&&(m=!0)}while((c.avail_in>0||0===c.avail_out)&&i!==l.Z_STREAM_END);return i===l.Z_STREAM_END&&(n=l.Z_FINISH),n===l.Z_FINISH?(i=o.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===l.Z_OK):n!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),c.avail_out=0,!0)},n.prototype.onData=function(e){this.chunks.push(e)},n.prototype.onEnd=function(e){e===l.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Inflate=n,i.inflate=a,i.inflateRaw=r,i.ungzip=a},{"./utils/common":1,"./utils/strings":2,"./zlib/constants":4,"./zlib/gzheader":6,"./zlib/inflate":8,"./zlib/messages":10,"./zlib/zstream":11}]},{},[])("/lib/inflate.js")});

class Diob {};
class Sound {};
var _vy_t_windowPar = window.parent;
try {
	window.parent.urlPar;
} catch (pErr) {
	_vy_t_windowPar = window;
}
var mainM, clientM, eventM = new EventManager(), diobM, resM, scrM, gameM, soundM, stM = new StaticManager(), funcM = new FuncManager(), dfM, VS = stM, urlPar = (_vy_t_windowPar.urlPar || undefined), serM, none = null, localM;
var _vy_t_xTileSize = 32, _vy_t_xTileSizeHalf = 16, _vy_t_yTileSize = 32, _vy_t_yTileSizeHalf = 16, _vy_t_blankFunc = function(){};
if (!serM) serM = {};
serM.remSockets = [];
serM.remConnections = [];
serM.resourceServer = location.origin + ((/(?:\.([^.]+))?$/.exec(location.pathname)[1])? location.pathname.substr(0, location.pathname.lastIndexOf('/') + 1) : location.pathname);

if (serM.resourceServer[serM.resourceServer.length - 1] === '/') serM.resourceServer = serM.resourceServer.substr(0, serM.resourceServer.length - 1);
var defM = {
				'imgPre': 'data:image/png;base64,',
				'gameMedBanner': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAgCAYAAABQISshAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAVxJREFUeNrs2M8rw3Ecx/F9GWllJX+AHJRSykk5ys2BE+WonDSH/RG2hfzYTXGRg1wkpYhdtFo7DDmstJbSHBUlUb57fup9Ukq274/3fN71aKe1vft+vp/36/NxXNeNtEK1RVqkbCO2EY8q2siXZ7PTm3y0Yxm1Zv6xg8SRr09kCIu4xRr6tC+tXiSloW0MaH9H4ljANfYxrP1lj2EORZjFPqp91+rEFPI4xzgczduv+Z0JXOAKk+jQPkfGcIICZtClfSCOmHGBEubRrX2yD2IHN1hCj/aI0g+TFCpY9TWieFCP2MWx1kaq2MAenn0PjU2oMlZwiNfA0m8DZXaqtCyh98Bj/B8qL5H/DJ+hOY/8sr5wiRRy8OS2w8tGPnAqDRRCfUL8od4k8WbkfBL+o+63epHIYXahe1VndkkGZs2vYwsPKi8fJB/dSaR4CnIgOfbK1DZiG/kfjdQFGAAn2kGLy2vQHQAAAABJRU5ErkJggg==',
				'blankIcon': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=',
				'appMaskS': {'ownState': true}
			};

window.onload = function() { new MainManager(); };
window.oncontextmenu = function() { return false; };
window.onfocus = function() {
	if (clientM && clientM.cOb && clientM.initiated && clientM.cOb.onWindowFocus) clientM.cOb.onWindowFocus();
};
window.onresize = function() {
	if (!mainM) return;
	mainM.setWindowSize();
	if (clientM && clientM.cOb && mainM.isInitialized && clientM.cOb.onWindowResize) clientM.cOb.onWindowResize(window.innerWidth, window.innerHeight);
	else mainM.resizeWindow = true;
};
window.onblur = function() {
	if (eventM) eventM.clearKeyDownEvents();
	if (clientM && clientM.cOb && clientM.initiated) {
		if (clientM.cOb._vy_focused) dfM.onUnfocus(clientM.cOb._vy_focused);
		if (clientM.cOb.onWindowBlur) clientM.cOb.onWindowBlur();
	}
};
window.onbeforeunload = function() {
};
window.onunload = function() {
	if (clientM && clientM.initiated) clientM.disconnected();
	if (funcM && stM.World.onDel) stM.World.onDel();
};

function dE(pLine, pFile, pError) {
	if (!mainM.codeFiles) {
		console.log(pError);
		return;
	}
	var error = 'Error:' + mainM.codeFiles[pFile] + ':' + pLine + ': ' + pError;
	if (error.indexOf('TypeError: ')) error = error.replace('TypeError: ', '');
	if (error.indexOf('not a function')) {
		if (error.indexOf('_vy_global.')) error = error.replace('_vy_global.', '');
	}
	console.log(error);
	clientM.outputText(error);
};

function MainManager() {
	mainM = this;
	mainM.initiate = function() {
		if (localM) mainM.parseLocalM();
		window.focus();
		new ScreenManager();
		new DiobManager();
		new ResourceManager();
		new SoundManager();
		new ClientManager();
		new GameManager();
	};
	mainM.initialized = function() {
		if (mainM.isInitialized) return;
		mainM.isInitialized = true;
		if (stM.World.onNew) stM.World.onNew();
		if (clientM.cOb.onNew) clientM.cOb.onNew(urlPar);
		if (resM.diobNewQueue.length) {
			for (var i in resM.diobNewQueue) {
				if (Array.isArray(resM.diobNewQueue[i])) diobM.diobOnNew(resM.diobNewQueue[i][0], resM.diobNewQueue[i][1]);
				else diobM.diobOnNew(resM.diobNewQueue[i]);
			}
			resM.diobNewQueue = [];
		}
		if (mainM.resizeWindow) {
			if (clientM.cOb.onWindowResize) clientM.cOb.onWindowResize(window.innerWidth, window.innerHeight);
			delete mainM.resizeWindow;
		} else if (window.innerWidth !== gameM.gameWidth || window.innerHeight !== gameM.gameHeight) {
			mainM.setWindowSize();
			if (clientM.cOb.onWindowResize) clientM.cOb.onWindowResize(window.innerWidth, window.innerHeight);
		}
		if (window.parent === window || !document.referrer || document.referrer.match(/:\/\/(.[^/]+)/)[1] !== 'vylocity.com') vyM.disableAPI = true;
		if (!vyM.disableAPI) {
			_vy_t_windowPar.authenticateGameAccount(function() {
				clientM.initiate();
			});
		} else {
			clientM.initiate();
		}
	};
	mainM.parseLocalM = function() {
		localM = JSON.parse(localM);
		if (localM.resourceServer) serM.resourceServer = localM.resourceServer;
	};
	mainM.setLocalM = function() {
		if (0) localM.resourceServer = serM.resourceServer;
		locSetLocalM(JSON.stringify(localM));
	};
	mainM.showServerList = function() {
		mainM.inServerList = true;
		mainM.gamesList.style.display = 'block';
		var logo = document.getElementById('logo_box');
		logo.style.display = 'block';
	};
	mainM.hideServerList = function() {
		mainM.inServerList = false;
		mainM.gamesList.style.display = 'none';
		document.getElementById('logo_box').style.display = 'none';
	};
	mainM.joinNewServer = function(pLocation, pEvent) {
		if (pEvent && (pEvent.target.className == 'player_list_toggle' || pEvent.target.parentNode.className == 'player_list_toggle')) return;
		mainM.gamesList.style.display = 'none';
		mainM.changeServer(pLocation);
	};
	mainM.changeServer = function(pAddress) {
		if (localM) mainM.setLocalM();
		var par = (urlPar)? ('?' + urlPar) : '';
		if (pAddress.indexOf('http') !== 0) pAddress = 'https://' + pAddress;
		if (!vyM.disableAPI) {
			_vy_t_windowPar.authenticateGameAccount(function() {
				location.href = pAddress + par;
			});
		} else {
			location.href = pAddress + par;
		}
	};
	mainM.scriptLoader = function(pScripts, pOnLoad) {
		for (i = 0, len = pScripts.length; i < len; i ++) {
			var e = document.createElement('script');
			e.setAttribute('type', 'text/javascript');
			e.setAttribute('src', pScripts[i] + '?v=' + mainM.codeVersion);
			if (pOnLoad) e.onload = pOnLoad;
			document.getElementsByTagName('head')[0].appendChild(e);
		}
	};
	mainM.setGameSettings = function() {
		if (!gameM.tileSize) gameM.tileSize = {'width': 32, 'height': 32};
		if (!gameM.tileSize.width && !gameM.tileSize.height) {
			gameM.tileSize = {'width': gameM.tileSize, 'height': gameM.tileSize};
		} else {
			if (!gameM.tileSize.width) gameM.tileSize = {'width': 32, 'height': gameM.tileSize.height};
			if (!gameM.tileSize.height) gameM.tileSize = {'width': gameM.tileSize.width, 'height': 32};
		}
		_vy_t_xTileSize = gameM.tileSize.width;
		_vy_t_xTileSizeHalf = Math.round(gameM.tileSize.width / 2);
		_vy_t_yTileSize = gameM.tileSize.height;
		_vy_t_yTileSizeHalf = Math.round(gameM.tileSize.height / 2);
		Diob.prototype._vy_w = _vy_t_xTileSize;
		Diob.prototype._vy_wH = _vy_t_xTileSizeHalf;
		Diob.prototype._vy_icoW = _vy_t_xTileSize;
		Diob.prototype._vy_h = _vy_t_yTileSize;
		Diob.prototype._vy_hH = _vy_t_yTileSizeHalf;
		Diob.prototype._vy_icoH = _vy_t_yTileSize;
		Diob.prototype._vy_rrelayerH = _vy_t_yTileSize;
		scrM.xScrDelayMax = _vy_t_xTileSize;
		scrM.yScrDelayMax = _vy_t_yTileSize;
		if (!gameM.playerMode) gameM.playerMode = 1;
		if (!gameM.gameHeight) gameM.gameHeight = 540;
		if (!gameM.gameWidth) gameM.gameWidth = 960;
		mainM.setCanvasSize();
		//if (gameM.resourceServer) serM.resourceServer = gameM.resourceServer;
		_vy_global = {};
		stM.global = _vy_global;
		stM.World.global = _vy_global;
	};
	mainM.setDefaultObjectTypes = function() {
		new ObjectType('Diob');
		new ObjectType('Movable', 'o._vy_layer = 2; o._vy_dir = \'south\'; o._vy_plane = 1; o._vy_isMovable = 1;', ['Diob']);
		new ObjectType('Mob', 'o._vy_layer = 4; o._vy_density = 1;', ['Movable']);
		new ObjectType('Particle', 'o._vy_layer = 5; o._vy_plane = 2; o.preventScreenRelayer = 1; o._vy_isParticle = 1;', ['Movable']);
		new ObjectType('Tile', 'o._vy_isLoc = 1;', ['Diob']);
		new ObjectType('Interface', 'o._vy_gui = 1;', ['Diob']);
		var t = new ObjectType('Client', 0, ['Diob']);
		t._vy_com = {};
		new ObjectType('Overlay', 'o._vy_layer = 5; o.mouseOpacity = 0; o.isOverlay = 1;', ['Diob']);
		new ObjectType('Region', 'o._vy_isRegion = 1;', ['Diob']);
		new ObjectType('Sound', 'o._vy_isSound = 1; o.volume = 100;');
	};
	mainM.createDefaultObjectTypes = function() {
		for (var i in mainM.defaultTypes) {
			var t = mainM.defaultTypes[i];
			var type = diobM.objectType[t];
			diobM.setTypeVariables(t);
			diobM.setTypeFunctions(t);
		}
		Diob.prototype._vy_region = diobM.regions['Region'];
	};
	mainM.getWebStyle = function(pStyle) {
		var style = '';
		while (pStyle.length) {
			var i = pStyle.search(/[\:|\s|\,]url\([\'|\"]?vyi\:[a-zA-Z0-9_\!\:\.\-\(\)\&\#\/\s]+[\'|\"]?\)[\;|\s|\}]/g);
			var i2 = pStyle.search(/[\:|\s|\,]url\([\'|\"]?vyf\:[a-zA-Z0-9_\!\:\.\-\(\)\&\#\/\s]+[\'|\"]?\)[\;|\s|\}]/g);
			if ((i === -1 && i2 !== -1) || (i2 >= 0 && i2 < i)) {
				var s = pStyle.match(/[\:|\s|\,]url\([\'|\"]?vyf\:[a-zA-Z0-9_\!\:\.\-\(\)\&\#\/\s]+[\'|\"]?\)[\;|\s|\}]/g)[0];
				var sI = s.indexOf('vyf:') + 4;
				var file = s.substr(sI, s.length - sI - ((s[s.length - 3] === '"' || s[s.length - 3] === '\'') ? 3 : 2)).split(':');
				var res = resM.resources['fil_' + file[0]];
				if (res) {
					if (file[1] && file[1] === 'text') style += pStyle.substr(0, i2) + s[0] + 'url(' + resM.fileText[file[0]].text + ');';
					else style += pStyle.substr(0, i2) + s[0] + 'url("' + (((res.r)? res.f : serM.resourceServer + '/resources/' + res.f) + '?v=' + res.v) + '");';
					pStyle = pStyle.substr(i2 + s.length);
				} else {
					style += pStyle.substr(0, i2) + s[0] + 'none;';
					pStyle = pStyle.substr(i2 + s.length);
				}
			} else if (i !== -1) {
				var s = pStyle.match(/[\:|\s|\,]url\([\'|\"]?vyi\:[a-zA-Z0-9_\!\:\.\-\(\)\&\#\/\s]+[\'|\"]?\)[\;|\s|\}]/g)[0];
				var sI = s.indexOf('vyi:') + 4;
				var icon = s.substr(sI, s.length - sI - ((s[s.length - 3] === '"' || s[s.length - 3] === '\'') ? 3 : 2)).split(':');
				style += pStyle.substr(0, i) + s[0] + 'url("' + stM.Icon.getDataURL(icon[0], icon[1], icon[2], parseInt(icon[3])) + '");';
				pStyle = pStyle.substr(i + s.length);
			} else {
				style += pStyle;
				pStyle = '';
			}
		};
		return style;
	};
	mainM.getWebText = function(pText) {
		mainM.webDiv.innerHTML = pText;
		var tags = mainM.webDiv.getElementsByTagName('*');
		for (var i = 0, len = tags.length; i < len; i ++) {
			var tag = tags[i];
			var remNodes = [];
			var addNodes = {};
			for (var i2 = 0, len2 = tag.attributes.length; i2 < len2; i2 ++) {
				var a = tag.attributes[i2];
				if (a.name === 'href') {
					var style = tag.getAttribute('style') || '';
					if (tag.href.indexOf('command:') === 0) {
						var check = tag.href.replace(/"([^"]*)"|'([^']*)'/g, '');
						if (check.match(/^command\:[a-zA-Z0-9_]+\(([a-zA-Z0-9_\,\[\]\'\"\{\}\:]+)?\)[\;]?$/)) {
							var params = tag.href.substr(tag.href.indexOf('(') + 1, tag.href.length - 2 - tag.href.indexOf('('));
							if (params) params = ', ' + params;
							addNodes['onclick'] = 'clientM.clientType._vy_com.' + tag.href.substr(8, tag.href.indexOf('(') - 8) + '.call(clientM.cOb' + params + ');';
							style += 'cursor: pointer;';
						}
						remNodes.push(a);
					} else if (tag.href.indexOf('#') === -1) {
						tag.setAttribute('target', '_blank');
					}
					tag.setAttribute('style', style + 'pointer-events: auto;');
				} else if (a.name === 'src') {
					var style = tag.getAttribute('style') || '';
					if (tag.src.indexOf('diob:') === 0) {
						var obj = diobM.objects[tag.src.substr(5)];
						if (obj && obj._vy_ico) {
							style += 'width: ' + obj._vy_icoW + 'px;height: ' + obj._vy_icoH + 'px;';
							if (obj._vy_sprite) tag.src = obj._vy_sprite;
							else tag.src = resM.getIconData(obj._vy_ico);
						}
					} else if (tag.src.indexOf('vyi:') === 0) {
						var icon = tag.src.split(':');
						tag.src = stM.Icon.getDataURL(icon[1], icon[2], icon[3], parseInt(icon[4]));
					} else if (tag.src.indexOf('vyf:') === 0) {
						var file = tag.src.split(':');
						var res = resM.resources['fil_' + file[1]];
						if (file[2] && file[2] === 'text') tag.src = resM.fileText[file[1]].text;
						else tag.src = ((res.r)? res.f : serM.resourceServer + '/resources/' + res.f) + '?v=' + res.v;
					}
					if (style) tag.setAttribute('style', style);
				} else if (mainM.webEvents[a.name.toLowerCase()]) {
					var val = tag.getAttribute(a.name.toLowerCase());
					var check = val.replace(/"([^"]*)"|'([^']*)'/g, '');
					if (check.match(/^command\:[a-zA-Z0-9_]+\(([a-zA-Z0-9_ \,\[\]\'\"\{\}\:]+)?\)[\;]?$/)) {
						var params = val.substr(val.indexOf('(') + 1, val.length - 2 - val.indexOf('('));
						if (params) params = ', ' + params;
						addNodes['on' + mainM.webEvents[a.name]] = 'clientM.clientType._vy_com.' + val.substr(8, val.indexOf('(') - 8) + '.call(clientM.cOb' + params + ');';
					}
					remNodes.push(a);
				}
			}
			for (var i2 = 0, len2 = remNodes.length; i2 < len2; i2 ++) {
				tag.removeAttributeNode(remNodes[i2]);
			}
			for (var n in addNodes) {
				tag.setAttribute(n, addNodes[n]);
			}
			if (tag.nodeName === 'INPUT' || tag.nodeName === 'TEXTAREA') {
				tag.setAttribute('onfocus', 'clientM.cOb.inInput = true;');
				tag.setAttribute('onfocusout', 'clientM.cOb.inInput = false;');
			}
			if (tag.type === 'password') tag.setAttribute('autocomplete', 'new-password');
		}
		return mainM.webDiv.innerHTML;
	};
	mainM.dE = function(pFunc, pD, pArgs, pError) {
		var error = 'Error: ';
		if (typeof(pD) === 'object') {
			if (pD._vy_type) {
				error += pD.name + ' (' + pD._vy_type + '.' + pFunc + ')';
			} else {
				error += 'unknown';
			}
		} else {
			error += pD;
		}
		console.log(error);
		clientM.outputText(error);
		if (stM.World.onError) stM.World.onError(error);
	};
	mainM.getWindowSize = function() {
		var width = window.innerWidth;
		var height = window.innerHeight;
		if (scrM.screenView.scaleTo) {
			if (scrM.screenView.scaleTo === 'none') {
				width = gameM.gameWidth;
				height = gameM.gameHeight;
			} else if (scrM.screenView.scaleTo === 'multiAspect') {
				var ratio = gameM.gameWidth / gameM.gameHeight;
				if (width / height !== ratio) {
					if (width >= gameM.gameWidth * 2 && height >= gameM.gameHeight * 2) {
						var c = (gameM.gameWidth > gameM.gameHeight)? (Math.floor(height / gameM.gameHeight)) : (Math.floor(width / gameM.gameWidth));
						width = gameM.gameWidth * c;
						height = gameM.gameHeight * c;
					} else {
						width = gameM.gameWidth;
						height = gameM.gameHeight;
					}
				}
			} else if (scrM.screenView.scaleTo === 'ratio') {
				/*height = Math.floor(width / (gameM.gameWidth / gameM.gameHeight));
				if (height > window.innerHeight) {
					width -= Math.ceil(width / (height / (height - window.innerHeight)));
					height = Math.floor(width / (gameM.gameWidth / gameM.gameHeight));
				}*/
				var ratio = Math.min(width / gameM.gameWidth, height / gameM.gameHeight);
				width = gameM.gameWidth * ratio;
				height = gameM.gameHeight * ratio;
			} else if (scrM.screenView.scaleTo === 'multiple') {
				if (width >= gameM.gameWidth * 2 && height >= gameM.gameHeight * 2) {
					var c = (gameM.gameWidth > gameM.gameHeight)? (Math.floor(height / gameM.gameHeight)) : (Math.floor(width / gameM.gameWidth));
					width = gameM.gameWidth * c;
					height = gameM.gameHeight * c;
				} else {
					width = gameM.gameWidth;
					height = gameM.gameHeight;
				}
			}
		}
		return {'width': width, 'height': height};
	};
	mainM.setWindowSize = function(pSkip) {
		if (!gameM) return;
		var size = mainM.getWindowSize();
		mainM.scaleWidth = size.width / gameM.gameWidth;
		mainM.scaleHeight = size.height / gameM.gameHeight;
		mainM.mapScaleWidth = (scrM.mapView.preventAutoScale)? 1 : mainM.scaleWidth;
		mainM.mapScaleHeight = (scrM.mapView.preventAutoScale)? 1 : mainM.scaleHeight;
		if (mainM.scaleWidth !== 1 || mainM.scaleHeight !== 1) mainM.scaled = true;
		else mainM.scaled = false;
		scrM.clearViewWidth = size.width;
		scrM.clearViewHeight = size.height;
		mainM.gameCanvasControl.width = scrM.mapView.width * mainM.scaleWidth;
		mainM.gameCanvasControl.height = scrM.mapView.height * mainM.scaleHeight;
		mainM.gameCanvasControl.style.width = mainM.gameCanvasControl.width + 'px';
		mainM.gameCanvasControl.style.height = mainM.gameCanvasControl.height + 'px';
		if (scrM.pixiApp) scrM.pixiApp.renderer.resize(mainM.gameCanvasControl.width, mainM.gameCanvasControl.height);
		if (scrM.mapView.scale && ((scrM.mapView.scale.x && scrM.mapView.scale.x !== 1) || (scrM.mapView.scale.y && scrM.mapView.scale.y !== 1))) {
			mainM.mapScaled = true;
			mainM.mapScaleWidth = scrM.mapView.scale.x * mainM.mapScaleWidth;
			mainM.mapScaleHeight = scrM.mapView.scale.y * mainM.mapScaleHeight;
			if (scrM.mapView.scale.x < 1 && scrM.mapView.width > scrM.clearViewWidth) {
				scrM.clearViewWidth = scrM.mapView.width;
			}
			if (scrM.mapView.scale.y < 1 && scrM.mapView.height > scrM.clearViewHeight) {
				scrM.clearViewHeight = scrM.mapView.height;
			}
		} else {
			if (mainM.mapScaleWidth !== 1 || mainM.mapScaleHeight !== 1) mainM.mapScaled = true;
			else mainM.mapScaled = false;
		}
		if (scrM.pixiApp) {
			scrM.pixiApp.stage.scale.x = mainM.mapScaleWidth;
			scrM.pixiApp.stage.scale.y = mainM.mapScaleHeight;
			if (scrM.mapView.xPos < 0) scrM.pixiApp.stage.x = scrM.mapView.xPos * mainM.mapScaleWidth;
			else scrM.pixiApp.stage.x = 0;
			if (scrM.mapView.yPos < 0) scrM.pixiApp.stage.y = scrM.mapView.yPos * mainM.mapScaleHeight;
			else scrM.pixiApp.stage.y = 0;
			if (scrM.mapView.angle) scrM.pixiApp.stage.rotation = -scrM.mapView.angle;
			else scrM.pixiApp.stage.rotation = 0;
			scrM.xMapPos = scrM.mapView.xPos;
			scrM.yMapPos = scrM.mapView.yPos;
			if (scrM.mapView.anchor) {
				if (typeof(scrM.mapView.anchor) !== 'object') scrM.mapView.anchor = {'x': scrM.mapView.anchor, 'y': scrM.mapView.anchor};
				scrM.pixiApp.stage.pivot.x = scrM.mapView.anchor.x * scrM.mapView.width;
				scrM.pixiApp.stage.pivot.y = scrM.mapView.anchor.y * scrM.mapView.height;
				if (scrM.mapView.scale && scrM.mapView.scale.x !== 1) {
					if (scrM.mapView.scale.x < 1) {
						scrM.pixiApp.stage.x -= scrM.pixiApp.stage.pivot.x / scrM.mapView.scale.x * mainM.scaleWidth;
						scrM.pixiApp.stage.pivot.x /= scrM.mapView.scale.x;
						scrM.pixiApp.stage.x += scrM.pixiApp.stage.pivot.x * mainM.scaleWidth * scrM.mapView.scale.x;
					} else {
						scrM.xMapPos -= scrM.pixiApp.stage.pivot.x;
						scrM.xMapPos += scrM.pixiApp.stage.pivot.x * mainM.scaleWidth / mainM.mapScaleWidth;
					}
				}
				if (scrM.mapView.scale && scrM.mapView.scale.y !== 1) {
					if (scrM.mapView.scale.y < 1) {
						scrM.pixiApp.stage.y -= scrM.pixiApp.stage.pivot.y / scrM.mapView.scale.y * mainM.scaleHeight;
						scrM.pixiApp.stage.pivot.y /= scrM.mapView.scale.y;
						scrM.pixiApp.stage.y += scrM.pixiApp.stage.pivot.y * mainM.scaleHeight * scrM.mapView.scale.y;
					} else {
						scrM.yMapPos -= scrM.pixiApp.stage.pivot.y;
						scrM.yMapPos += scrM.pixiApp.stage.pivot.y * mainM.scaleHeight / mainM.mapScaleHeight;
					}
				}
				scrM.pixiApp.stage.x += scrM.pixiApp.stage.pivot.x * mainM.scaleWidth;
				scrM.pixiApp.stage.y += scrM.pixiApp.stage.pivot.y * mainM.scaleHeight;
			} else {
				scrM.pixiApp.stage.pivot.x = 0;
				scrM.pixiApp.stage.pivot.y = 0;
			}
		}
		if (scrM.mapView.xPos > 0) mainM.gameCanvasControl.style.left = (scrM.mapView.xPos * mainM.mapScaleWidth) + 'px';
		else mainM.gameCanvasControl.style.left = '0px';
		if (scrM.mapView.yPos > 0) mainM.gameCanvasControl.style.top = (scrM.mapView.yPos * mainM.mapScaleHeight) + 'px';
		else mainM.gameCanvasControl.style.top = '0px';
		mainM.gameBody.style.width = size.width + 'px';
		mainM.gameBody.style.height = size.height + 'px';
		if (size.width < window.innerWidth) mainM.xBodyPos = (window.innerWidth - size.width) / 2;
		else mainM.xBodyPos = 0;
		if (size.height < window.innerHeight) mainM.yBodyPos = (window.innerHeight - size.height) / 2;
		else mainM.yBodyPos = 0;
		mainM.gameBody.style.top = mainM.yBodyPos + 'px';
		mainM.gameBody.style.left = mainM.xBodyPos + 'px';
		document.body.style.height = window.innerHeight + 'px';
		if (!pSkip) {
			for (var i = 0, len = scrM.interfaceElements.length; i < len; i ++) {
				var d = scrM.interfaceElements[i];
				if (d.edgeLock) scrM.setInterfaceElEdgeLock(d);
				if (d._vy_webBox) scrM.scaleWebBox(d);
			}
			mainM.setCanvasSmoothing(mainM.gameCanvasControl);
			for (var l in scrM.intBrush) {
				mainM.setInterfaceCanvasSize(l, size.width, size.height);
			}
			for (var l in scrM.topScreenCanvas) {
				if (!scrM.topScreenBrush[l].topSet || !scrM.topScreenBrush[l].topSet.autoScale) {
					scrM.topScreenCanvas[l].width = size.width;
					scrM.topScreenCanvas[l].height = size.height;
				}
				//if (scrM.topScreenBrush[l].topSet) scrM._setTopScreenSet(scrM.topScreenBrush[l], scrM.topScreenBrush[l].topSet);
			}
			mainM.errorDisplay.style.width = size.width + 'px';
		}
		if (scrM.screenTiles.length) {
			scrM.refreshTileScreen = true;
			scrM.moveTileScreen = true;
		}
	};
	mainM.setInterfaceCanvasSize = function(pInt, pWidth, pHeight) {
		if (!scrM.intBrush[pInt]) return;
		scrM.intCanvas[pInt].width = pWidth;
		scrM.intCanvas[pInt].height = pHeight;
		//scrM.intBrush[pInt].restore();
		mainM.setCanvasSmoothing(scrM.intCanvas[pInt], scrM.intBrush[pInt]);
		/*if (mainM.scaled) {
			scrM.intBrush[pInt].save();
			scrM.intBrush[pInt].scale(mainM.scaleWidth, mainM.scaleHeight);
		}*/
		scrM.refreshInt[pInt] = true;
	};
	mainM.setCanvasSmoothing = function(pCanvas, pBrush) {
		if (scrM.screenView.scaleNearest) {
			pCanvas.style['image-rendering'] = 'pixelated';
			if (pBrush) pBrush.imageSmoothingEnabled = false;
		} else {
			if (pBrush) pBrush.imageSmoothingEnabled = !scrM.disableImageSmoothing;
			pCanvas.style['image-rendering'] = 'auto';
		}
	};
	mainM.setCanvasSize = function() {
		mainM.canvasWidth = gameM.gameWidth;
		mainM.canvasHeight = gameM.gameHeight;
		mainM.gameCanvasControl.width = mainM.canvasWidth;
		mainM.gameCanvasControl.height = mainM.canvasHeight;
		mainM.topCanvasControl.width = mainM.canvasWidth;
		mainM.topCanvasControl.height = mainM.canvasHeight;
		mainM.canvasX = mainM.topCanvasControl.offsetLeft;
		mainM.canvasY = mainM.topCanvasControl.offsetTop;
		mainM.canvasXOffset = window.pageXOffset - mainM.canvasX;
		mainM.canvasYOffset = window.pageYOffset - mainM.canvasY;
	};
	mainM.showCustomLoadScreen = function() {
		mainM.showLoadScreen();
		if (!mainM.origLoadScreen) {
			if (gameM.loadScreen.css) {
				var head = document.getElementsByTagName('head')[0];
				var s = document.createElement('style');
				s.setAttribute('id', 'custom_load_css');
				s.setAttribute('type', 'text/css');
				s.appendChild(document.createTextNode(gameM.loadScreen.css));
				head.appendChild(s);
			}
			if (gameM.loadScreen.onTick) {
				eval('gameM.loadScreen.onTick = ' + gameM.loadScreen.onTick);
				if ({}.toString.call(gameM.loadScreen.onTick) !== '[object Function]') {
					delete gameM.loadScreen.onTick;
				}
			}
			mainM.origLoadScreen = mainM.loadScreen.innerHTML;
		}
		mainM.loadScreen.innerHTML = gameM.loadScreen.html;
	};
	mainM.showLoadScreen = function() {
		mainM.inLoadScreen = 1;
		mainM.loadScreen.style.opacity = 1;
		mainM.loadScreen.style.display = 'block';
	};
	mainM.hideLoadScreen = function(pForce) {
		if (gameM.loadScreen && !pForce) return;
		mainM.inLoadScreen = 0;
		mainM.loadScreen.style.opacity = 0;
		setTimeout(function() { mainM.loadScreen.style.display = 'none'; }, 600);
	};

	//onNew
	mainM.game = {'sound': true};
	mainM.gameCanvasControl = document.getElementById('game_canvas');
	mainM.topCanvasControl = document.getElementById('top_canvas');
	mainM.webBackground = document.getElementById('web_background');
	mainM.errorDisplay = document.getElementById('error_message');
	mainM.errorDisplay.style.width = window.innerWidth + 'px';
	mainM.fpsLabel = document.getElementById('fps_label');
	mainM.gameBody = document.getElementById('game_body');
	mainM.loadScreen = document.getElementById('load_screen');
	if (!vyM.disableVy) {
		if (!vyM.disableLoad) mainM.showLoadScreen();
		var logoLink = function() {
			window.open('https://www.vylocity.com/');
		};
		document.getElementById('load_screen_logo').onclick = logoLink;
		if (!vyM.disableAPI) {
			mainM.gamesList = document.getElementById('games_list');
			document.getElementById('logo_box').onclick = logoLink;
		}
	}
	mainM.canvasBackColor = '#000';
	mainM._vy_mouseDown = 0;
	mainM.scaleWidth = 1;
	mainM.scaleHeight = 1;
	mainM.mapScaleWidth = 1;
	mainM.mapScaleHeight = 1;
	mainM.xBodyPos = 0;
	mainM.yBodyPos = 0;
	mainM.codeVersion = '14';
	mainM.webDomain = window.location.hostname;
	mainM.webEvents = {'onfocus': 'focus', 'onunfocus': 'blur', 'onmousedown': 'mousedown', 'onmouseup': 'mouseup', 'onmouseclick': 'click', 'onmousedblclick': 'dblclick', 'onmousemove': 'mousemove', 'onmouseenter': 'mouseenter', 'onmouseexit': 'mouseout', 'onkeydown': 'keydown', 'onkeyup': 'keyup'};
	mainM.webDiv = document.createElement('div');
	mainM.defaultTypes = ['Diob', 'Movable', 'Mob', 'Tile', 'Interface', 'Client', 'Overlay', 'Region', 'Sound', 'Particle'];
	mainM.diobTypes = ['Diob', 'Movable', 'Mob', 'Tile', 'Interface', 'Overlay', 'Region', 'Particle'];
	mainM.initiate();
};

function ClientManager() {
	clientM = this;
	clientM.initialize = function() {
		clientM.clientType = diobM.objectType['Client'];
		clientM.clientType.alert = function(pMes) {
			eventM.clearKeyDownEvents();
			return alert(pMes);
		};
		clientM.clientType.prompt = function(pTitle, pMes, pFunc) {
			eventM.clearKeyDownEvents();
			var p = prompt(pTitle, pMes);
			if (pFunc) funcM._callback(pFunc, p);
			return p;
		};
		clientM.clientType.confirm = function(pMes, pFunc) {
			eventM.clearKeyDownEvents();
			var c = confirm(pMes);
			if (pFunc) funcM._callback(pFunc, c);
			return c;
		};
		clientM.clientType.aMes = function(pMes, pAdd) {
			funcM.aMes(pMes, pAdd);
		};
		clientM.clientType.log = function(pMes) {
			console.log(pMes);
		};
		clientM.clientType.setScreenBackground = function(pBack) {
			clientM.setScreenBackground(pBack);
		};
		clientM.clientType.setWebBackground = function(pBack) {
			clientM.setWebBackground(pBack);
		};
		clientM.clientType.setMacroAtlas = function(pMacro) {
			clientM.setMacroAtlas(pMacro);
		};
		clientM.clientType.addCustomMacro = function(pName, pKey, pDown, pUp) {
			clientM.addCustomMacro(pName, pKey, pDown, pUp);
		};
		clientM.clientType.removeCustomMacro = function(pName) {
			clientM.removeCustomMacro(pName);
		};
		clientM.clientType.getCustomMacroNames = function() {
			var arr = [];
			for (var k in this._vy_customMacros) {
				var macro = this._vy_customMacros[k];
				if (!macro) continue;
				arr.push(macro.name);
			}
			return arr;
		};
		clientM.clientType.getPlayerMob = function() {
			return this._vy_playerMob;
		};
		clientM.clientType.setPlayerMob = function(pMob) {
			if (!pMob) return;
			clientM.setPlayerMob(pMob);
		};
		clientM.clientType.setMaxFPS = function(pFPS) {
			clientM.setMaxFPS(pFPS);
		};
		clientM.clientType.setMouseCursor = function(pCursor, pX, pY) {
			clientM.setMouseCursor(pCursor, pX, pY);
		};
		clientM.clientType.getMouseCursor = function() {
			if (!this._vy_cursor) this._vy_cursor = {'cursor': 'default', 'x': 0, 'y': 0};
			return this._vy_cursor;
		};
		clientM.clientType.getMousePos = function() {
			return clientM.mousePos;
		};
		clientM.clientType.getFPS = function() {
			return clientM.fps;
		};
		clientM.clientType.getAccountName = function() {
			return clientM.accountName;
		};
		if (!clientM.clientType._vy_com.startMove) {
			clientM.clientType._vy_com.startMove = function(pDir) {
				var m = this._vy_playerMob;
				if (pDir) pDir = pDir.toLowerCase();
				if (pDir == 'north' || pDir == 'northeast' || pDir == 'northwest') m._vy_movingNorth = 1;
				else if (pDir == 'south' || pDir == 'southeast' || pDir == 'southwest') m._vy_movingSouth = 1;
				if (pDir == 'east' || pDir == 'northeast' || pDir == 'southeast') m._vy_movingEast = 1;
				else if (pDir == 'west' || pDir == 'northwest' || pDir == 'southwest') m._vy_movingWest = 1;
				eventM.setMovementObjPos(m);
			};
		}
		if (!clientM.clientType._vy_com.endMove) {
			clientM.clientType._vy_com.endMove = function(pDir) {
				var m = this._vy_playerMob;
				if (pDir) pDir = pDir.toLowerCase();
				if (!pDir || pDir == 'north' || pDir == 'northeast' || pDir == 'northwest') m._vy_movingNorth = 0;
				if (!pDir || pDir == 'south' || pDir == 'southeast' || pDir == 'southwest') m._vy_movingSouth = 0;
				if (!pDir || pDir == 'east' || pDir == 'northeast' || pDir == 'southeast') m._vy_movingEast = 0;
				if (!pDir || pDir == 'west' || pDir == 'northwest' || pDir == 'southwest') m._vy_movingWest = 0;
				eventM.setMovementObjPos(m);
			};
		}
		clientM.clientType.showInterface = function(pInt, pEl, pForce) {
			clientM.showInterface(pInt, pEl, pForce);
		};
		clientM.clientType.hideInterface = function(pInt, pEl) {
			clientM.hideInterface(pInt, pEl);
		};
		clientM.clientType.checkInterfaceShown = function(pInt, pEl) {
			var intPane = clientM.interfaces[pInt];
			if (!intPane) return false;
			if (pEl) {
				var element = intPane._vy_aContents[pEl];
				if (element) return ((!element.isHidden)? true : false);
			}
			return ((intPane._vy_shown)? true : false);
		};
		clientM.clientType.setMainOutput = function(pOutput) {
			clientM.cOb.mainOutput = pOutput;
			clientM.cOb._vy_mainOutputInt = clientM.cOb.mainOutput.substring(0, clientM.cOb.mainOutput.indexOf('.'));
			clientM.cOb._vy_mainOutputEl = clientM.cOb.mainOutput.substring(clientM.cOb.mainOutput.indexOf('.') + 1, clientM.cOb.mainOutput.length);
		};
		clientM.clientType.outputText = function(pText, pInt, pEl) {
			clientM.outputText(pText, pInt, pEl);
		};
		clientM.clientType.addInterfaceElement = function(pType, pInt, pName, pX, pY, pArgs) {
			return clientM.addInterfaceElement(pType, pInt, pName, pX, pY, pArgs);
		};
		clientM.clientType.removeInterfaceElement = function(pInt, pName) {
			clientM.removeInterfaceElement(pInt, pName);
		};
		clientM.clientType.getInterfaceElement = function(pInt, pEl) {
			return clientM.getInterfaceElement(pInt, pEl);
		};
		clientM.clientType.getInterfaceElements = function(pInt, pType, pChild) {
			return clientM.getInterfaceElements(pInt, pType, pChild);
		};
		clientM.clientType.getInterfaceElementsFromScreen = function(pX, pY, pX2, pY2, pType, pChild, pPage) {
			var arr = [];
			if (!pX2) pX2 = pX;
			if (!pY2) pY2 = pY;
			if (pPage) {
				pX += mainM.canvasXOffset - mainM.xBodyPos;
				pY += mainM.canvasYOffset - mainM.yBodyPos;
				pX2 += mainM.canvasXOffset - mainM.xBodyPos;
				pY2 += mainM.canvasYOffset - mainM.yBodyPos;
			} else {
				pX *= mainM.scaleWidth;
				pY *= mainM.scaleHeight;
				pX2 *= mainM.scaleWidth;
				pY2 *= mainM.scaleHeight;
			}
			for (var i = 0, len = scrM.interfaceElements.length; i < len; i ++) {
				var d = scrM.interfaceElements[i];
				var cO = (d.isOverlay)? d.isOverlay : d;
				var oX = ((d.isOverlay)? d._vy_x : 0) + cO._vy_x;
				var oY = ((d.isOverlay)? d._vy_y : 0) + cO._vy_y;
				if (cO._vy_x !== undefined && cO._vy_y !== undefined) {
					if (d.preventAutoScale) {
						if (oX + d._vy_w < pX || oX > pX2 || oY + d._vy_h < pY || oY > pY2) {
							continue;
						}
						if (!pType || funcM._isType(d._vy_type, pType, pChild)) {
							if (!arr.includes(d)) arr.push(d);
						}
					} else {
						if ((oX + d._vy_w) * mainM.scaleWidth < pX || oX * mainM.scaleWidth > pX2 || (oY + d._vy_h) * mainM.scaleHeight < pY || oY * mainM.scaleHeight > pY2) {
							continue;
						}
						if (!pType || funcM._isType(d._vy_type, pType, pChild)) {
							if (!arr.includes(d)) arr.push(d);
						}
					}
				}
			}
			return arr;
		};
		clientM.clientType.getInterfaceNames = function() {
			return Object.keys(clientM.interfaces)
		};
		clientM.clientType.setFocus = function(pVal1, pVal2) {
			if (pVal1 && typeof(pVal1) === 'string') {
				if (pVal2) pVal1 = clientM.getInterfaceElement(pVal1, pVal2);
			}
			if (pVal1) dfM.onFocus(pVal1);
			else clientM.unfocus();
		};
		clientM.clientType.getFocus = function() {
			return clientM.cOb._vy_focused;
		};
		clientM.clientType.setViewEye = function(pD) {
			clientM.setViewEye(pD);
		};
		clientM.clientType.getViewEye = function() {
			return clientM.cOb._vy_viewEye;
		};
		clientM.clientType.setViewEyeOffsets = function(pX, pY) {
			clientM.setViewEyeOffsets(pX, pY);
		};
		clientM.clientType.getViewEyeOffsets = function() {
			if (!clientM.cOb._vy_xViewEyeOffset) clientM.cOb._vy_xViewEyeOffset = 0;
			if (!clientM.cOb._vy_yViewEyeOffset) clientM.cOb._vy_yViewEyeOffset = 0;
			return {'x': clientM.cOb._vy_xViewEyeOffset, 'y': clientM.cOb._vy_yViewEyeOffset};
		};
		clientM.clientType.setViewEyeDelay = function(pDelay) {
			clientM.setViewEyeDelay(pDelay);
		};
		clientM.clientType.getViewEyeDelay = function() {
			return clientM.cOb._vy_viewEyeDelay;
		};
		clientM.clientType.setEdgeLimit = function(pX, pY) {
			clientM.setEdgeLimit(pX, pY);
		};
		clientM.clientType.playSound = function(pSound, pStart, pDuration) {
			return soundM.playSound(pSound, pStart, pDuration);
		};
		clientM.clientType.setLocalStorage = function(pKey, pData) {
			clientM.setLocalStorage(pKey, pData);
		};
		clientM.clientType.getLocalStorage = function(pKey) {
			if (!pKey) return;
			return window.localStorage.getItem(gameM.gameID + '_' + pKey);
		};
		clientM.clientType.addWebStyle = function(pName, pStyle) {
			clientM.addWebStyle(pName, pStyle);
		};
		clientM.clientType.removeWebStyle = function(pName) {
			clientM.removeWebStyle(pName);
		};
		clientM.clientType.addCustomFont = function(pName, pPath, pRemote, pStyle) {
			var src = (!pRemote)? stM.Resource.getResourcePath('file', pPath) : pPath;
			if (!pRemote) src = src.substring(0, src.indexOf('?v='));
			var format = src.substring(src.lastIndexOf('.') + 1);
			if (format === 'ttf') format = 'truetype';
			else if (format === 'otf') format = 'opentype';
			else if (format === 'eot') format = 'embedded-opentype';
			var style = '@font-face { font-family: "' + pName + '"; src: local("' + pName + '"), url("' + src + '") format("' + format + '");';
			if (pStyle) {
				for (var v in pStyle) {
					style += ' ' + v + ': ' + pStyle[v] + ';';
				}
			}
			style += ' }';
			clientM.addWebStyle(pName, style, 'cfont_');
		};
		clientM.clientType.removeCustomFont = function(pName) {
			clientM.removeWebStyle(pName, 'cfont_');
		};
		clientM.clientType.getWebTag = function(pID) {
			return document.getElementById(pID);
		};
		clientM.clientType.setWebTagStyle = function(pID, pStyle, pValue) {
			clientM.setWebTagStyle(pID, pStyle, pValue);
		};
		clientM.clientType.setWebTagContent = function(pID, pContent) {
			clientM.setWebTagContent(pID, pContent);
		};
		clientM.clientType.getWebTagContent = function(pID) {
			return clientM.getWebTagContent(pID);
		};
		clientM.clientType.setWebTagFocus = function(pID) {
			clientM.setWebTagFocus(pID);
		};
		clientM.clientType.callWebTagEvent = function(pID, pEvent) {
			clientM.callWebTagEvent(pID, pEvent);
		};
		clientM.clientType.removeWebTag = function(pID) {
			clientM.removeWebTag(pID);
		};
		clientM.clientType.getInterfaceCanvas = function(pInt, pEl) {
			var el = clientM.getInterfaceElement;
			if (el) return scrM.intCanvas[el._vy_layer];
		};
		clientM.clientType.addWebScript = function(pName, pLink, pModule, pFunc) {
			clientM.addWebScript(pName, pLink, pModule, pFunc);
		};
		clientM.clientType.removeWebScript = function(pName) {
			clientM.removeWebScript(pName);
		};
		clientM.clientType.evalWebScript = function(pScript) {
			return clientM.evalWebScript(pScript);
		};
		clientM.clientType.createTopScreen = function(pName, pLayer, pSet) {
			clientM.createTopScreen(pName, pLayer, pSet);
		};
		clientM.clientType.topScreenDraw = function(pArgs, pName) {
			var brush = scrM.topBrush;
			if (pName && scrM.topScreenBrush[pName]) brush = scrM.topScreenBrush[pName];
			clientM.topScreenDraw(brush, pArgs);
		};
		clientM.clientType.setTopScreen = function(pName, pNewName, pNewLayer, pNewData, pNewSet) {
			clientM.setTopScreen(pName, pNewName, pNewLayer, pNewData, pNewSet);
		};
		clientM.clientType.getTopScreen = function(pName, pType) {
			return clientM.getTopScreen(pName, pType);
		};
		clientM.clientType.setMapView = function(pView) {
			clientM.setMapView(pView);
		};
		clientM.clientType.getMapView = function() {
			return clientM.getMapView();
		};
		clientM.clientType.setScreenView = function(pView) {
			clientM.setScreenView(pView);
		};
		clientM.clientType.getScreenView = function() {
			return clientM.getScreenView();
		};
		clientM.clientType.getScreenPos = function(pO) {
			return clientM.getScreenPos(pO);
		};
		clientM.clientType.getPosFromScreen = function(pX, pY, pO) {
			if (!pO) pO = {};
			if (scrM.mapView.scale) {
				pO.x = scrM.xScr + (pX / scrM.mapView.scale.x) - scrM.xMapPos;
				pO.y = scrM.yScr + (pY / scrM.mapView.scale.y) - scrM.yMapPos;
			} else {
				pO.x = scrM.xScr + pX - scrM.xMapPos;
				pO.y = scrM.yScr + pY - scrM.yMapPos;
			}
			return pO;
		};
		clientM.clientType.changeServer = function(pAddress) {
			clientM.changeServer(pAddress);
		};
		clientM.clientType.getAddress = function() {
			return 'localhost';
		};
		clientM.clientType.callCommand = function(pCommand, pArgs, pSend) {
			if (!this._vy_commands[pCommand]) return;
			if (!pArgs || pArgs.constructor !== Array) this._vy_commands[pCommand].call(this, pArgs);
			else this._vy_commands[pCommand].apply(this, pArgs);
		};
		clientM.clientType.addCommand = function(pCommand, pFunc) {
			if (!pCommand) return;
			if (pFunc) this._vy_commands[pCommand] = pFunc;
			else if (clientM.clientType._vy_com[pCommand]) this._vy_commands[pCommand] = clientM.clientType._vy_com[pCommand];
		};
		clientM.clientType.removeCommand = function(pCommand) {
			if (!pCommand || !this._vy_commands[pCommand]) return;
			this._vy_commands[pCommand] = undefined;
		};
		clientM.clientType.sendPacket = function(pName, pData) {
			clientM.sendPacket(pName, pData);
		};
		clientM.clientType.getNavigator = function() {
			return clientM.navigator;
		};
		clientM.clientType.toggleScreenDrawing = function(pBool) {
			clientM.toggleScreenDrawing(pBool);
		};
		clientM.clientType.toggleMacroCapture = function(pBool) {
			clientM.toggleMacroCapture(pBool);
		};
		clientM.clientType.getWindowSize = function(pO) {
			if (!pO) pO = {};
			pO.width = window.innerWidth;
			pO.height = window.innerHeight;
			return pO;
		};
		clientM.clientType.setScreenSize = function(pWidth, pHeight) {
			gameM.gameWidth = pWidth;
			gameM.gameHeight = pHeight;
			mainM.setWindowSize();
			scrM.setViewEye(clientM.cOb._vy_viewEye);
		};
		clientM.clientType.getScreenSize = function(pO) {
			if (!pO) pO = {};
			pO.width = mainM.webBackground.offsetWidth;
			pO.height = mainM.webBackground.offsetHeight;
			return pO;
		};
		clientM.clientType.getScreenScale = function(pO) {
			if (!pO) pO = {};
			pO.x = mainM.scaleWidth;
			pO.y = mainM.scaleHeight;
			return pO;
		};
		clientM.clientType.toggleLoadScreen = clientM.toggleLoadScreen;
		clientM.clientType.clearKeyDownEvents = eventM.clearKeyDownEvents;
		clientM.clientType.sendDiob = function(pD, pVar) {};
		
		diobM.setClientTypeFunctions();
		clientM.cOb = newDiob(diobM.objectType['Client'], 0, true);
		stM.Client = clientM.cOb;
		clientM.cOb._vy_onScr = 1;
		clientM.cOb.address = 'localhost';
		dfM.setSize(clientM.cOb, gameM.gameWidth, gameM.gameHeight);
		if (clientM.cOb.mainOutput) {
			clientM.cOb._vy_mainOutputInt = clientM.cOb.mainOutput.substring(0, clientM.cOb.mainOutput.indexOf('.'));
			clientM.cOb._vy_mainOutputEl = clientM.cOb.mainOutput.substring(clientM.cOb.mainOutput.indexOf('.') + 1, clientM.cOb.mainOutput.length);
		}
		if (!clientM.cOb.hideFPS) mainM.fpsLabel.style.display = 'block';
		if (clientM.cOb.mainWebStyle) clientM.addWebStyle('default', clientM.cOb.mainWebStyle);
		if (clientM.cOb.webBackground) clientM.setWebBackground(clientM.cOb.webBackground);
		if (clientM.cOb.screenBackground !== undefined) clientM.setScreenBackground(clientM.cOb.screenBackground);
		if (clientM.cOb.screenView) scrM.setScreenView(clientM.cOb.screenView);
		else scrM.setScreenView();
		scrM.initiate();
		if (clientM.cOb.mapView) scrM.setMapView(clientM.cOb.mapView);
		else {
			scrM.setMapView();
			clientM.cOb.mapView = scrM.mapView;
		}
		clientM.cOb._vy_customMacros = {};
		clientM.cOb._vy_isClient = true;
		if (clientM.cOb._vy_color) dfM.setColor(clientM.cOb, clientM.cOb._vy_color);
		clientM.cOb._vy_mouseOp = 0;
		clientM.cOb._vy_x = 0;
		clientM.cOb._vy_y = 0;
		clientM.cOb._vy_loc = clientM.cOb;
		if (clientM.cOb.xEdgeLimit !== undefined || clientM.cOb.yEdgeLimit !== undefined) clientM.setEdgeLimit(clientM.cOb.xEdgeLimit, clientM.cOb.yEdgeLimit);
		clientM.setViewEyeOffsets((clientM.cOb.xViewEyeOffset || 0), (clientM.cOb.yViewEyeOffset || 0));
		Object.defineProperty(clientM.cOb, 'xViewEyeOffset', {
			get: function() {
				return this._vy_xViewEyeOffset;
			},
			set: function(pV) {
				clientM.setViewEyeOffsets(pV, (this._vy_yViewEyeOffset || 0));
			}
		});
		Object.defineProperty(clientM.cOb, 'yViewEyeOffset', {
			get: function() {
				return this._vy_yViewEyeOffset;
			},
			set: function(pV) {
				clientM.setViewEyeOffsets((this._vy_xViewEyeOffset || 0), pV);
			}
		});
		if (clientM.cOb.viewEyeDelay) clientM.setViewEyeDelay(clientM.cOb.viewEyeDelay);
	};
	clientM.initiate = function() {
		clientM.accountName = _vy_t_windowPar.playerAcc.name;
		clientM.cOb._vy_commands = {};
		for (var c in clientM.clientType._vy_com) {
			if (!clientM.clientType._vy_com.hasOwnProperty(c)) continue;
			clientM.cOb._vy_commands[c] = clientM.clientType._vy_com[c];
		}
		clientM.setMacroAtlas(gameM.mainMacro);
		if (!clientM.cOb._vy_playerMob) {
			var m = newDiob(diobM.objectType[((gameM.mainMob)? gameM.mainMob : 'Mob')]);
			if ((m._vy_x === undefined || m._vy_y === undefined) && gameM.mainMap) dfM.setMap(m, gameM.mainMap, 0, 0);
			clientM.cOb._vy_playerMob = m;
			m.client = clientM.cOb;
			if (m.onNew) {
				if (!mainM.isInitialized) resM.diobNewQueue.push(m);
				else diobM.diobOnNew(m);
			}
			clientM.setPlayerMob(m, true);
		}
		mainM.hideLoadScreen();
		clientM.initiated = true;
		eventM.setInputEvents();
		if (clientM.cOb.onConnect) clientM.cOb.onConnect(urlPar);
	};
	clientM.sendPacket = function(pName, pData) {
		if (clientM.cOb.onPacket) clientM.cOb.onPacket(pName, pData);
	};
	clientM.disconnected = function() {
		if (clientM.cOb.onDisconnect) clientM.cOb.onDisconnect();
		clientM.clearPlayerMob();
		if (clientM.cOb.onDel) clientM.cOb.onDel();
	};
	clientM.unfocus = function(pO) {
		if (!pO) {
			if (!clientM.cOb._vy_focused) {
				window.focus();
				return;
			}
			pO = clientM.cOb._vy_focused;
		}
		dfM.onUnfocus(pO);
		window.focus();
	};
	clientM.createTopScreen = function(pName, pLayer, pSet) {
		if (!pName) return;
		scrM.createTopScreenCanvas(pName, pLayer, pSet);
	};
	clientM.topScreenDraw = function(pBrush, pArgs) {
		scrM.customScreenDraw(pBrush, pArgs);
	};
	clientM.setTopScreen = function(pName, pNewName, pNewLayer, pNewData, pNewSet) {
		if (!pName || !pNewName) return;
		scrM.setTopScreen(pName, pNewName, pNewLayer, pNewData, pNewSet);
	};
	clientM.getTopScreen = function(pName, pType) {
		return scrM.getTopScreen(pName, pType);
	};
	clientM.setMapView = function(pView) {
		scrM.setMapView(pView);
	};
	clientM.getMapView = function() {
		return scrM.mapView;
	};
	clientM.setScreenView = function(pView) {
		scrM.setScreenView(pView);
	};
	clientM.getScreenView = function() {
		return scrM.screenView;
	};
	clientM.getScreenPos = function(pO) {
		if (pO) {
			pO.x = scrM.xScr;
			pO.y = scrM.yScr;
			return pO;
		}
		return {'x': scrM.xScr, 'y': scrM.yScr};
	};
	clientM.changeServer = function(pAddress) {
		if (!pAddress) return;
		mainM.changeServer(pAddress);
	};
	clientM.setScreenBackground = function(pBack) {
		clientM.cOb.screenBackground = pBack;
		if (!pBack) pBack = '';
		mainM.canvasBackColor = pBack;
		if (!pBack) pBack = 'transparent';
		mainM.gameBody.style.backgroundColor = pBack;
		mainM.gameCanvasControl.style.backgroundColor = pBack;
		document.body.style.backgroundColor = pBack;
	};
	clientM.setWebBackground = function(pText) {
		if (!pText) pText = '';
		document.getElementById('web_background').innerHTML = mainM.getWebText(pText);
		clientM.cOb.webBackground = pText;
	};
	clientM.addWebStyle = function(pName, pStyle, pPrefix) {
		if (!pStyle) return;
		if (!pPrefix) pPrefix = 'css_';
		var head = document.getElementsByTagName('head')[0];
		var s = document.createElement('style');
		if (pName) s.setAttribute('id', pPrefix + pName);
		s.setAttribute('type', 'text/css');
		if (pPrefix === 'css_') {
			s.appendChild(document.createTextNode(mainM.getWebStyle(pStyle)));
		} else {
			s.appendChild(document.createTextNode(pStyle));
		}
		head.appendChild(s);
	};
	clientM.removeWebStyle = function(pName, pPrefix) {
		if (!pPrefix) pPrefix = 'css_';
		var s = document.getElementById(pPrefix + pName);
		if (!s) return
		s.parentNode.removeChild(s);
	};
	clientM.setWebTagStyle = function(pID, pStyle, pValue) {
		if (!pID || !pStyle) return;
		var e = document.getElementById(pID);
		if (!e) return;
		e.style[pStyle] = mainM.getWebStyle(pValue);
	};
	clientM.setWebTagContent = function(pID, pContent) {
		if (!pID) return;
		var e = document.getElementById(pID);
		if (!e) return;
		if (e.tagName === 'INPUT' || e.tagName === 'TEXTAREA') e.value = pContent;
		else e.innerHTML = mainM.getWebText(pContent);
	};
	clientM.getWebTagContent = function(pID) {
		if (!pID) return;
		var e = document.getElementById(pID);
		if (!e) return;
		if (e.tagName === 'INPUT' || e.tagName === 'TEXTAREA') return e.value;
		else return e.innerHTML;
	};
	clientM.setWebTagFocus = function(pID) {
		if (!pID) return;
		var e = document.getElementById(pID);
		if (!e) return;
		e.focus();
	};
	clientM.callWebTagEvent = function(pID, pEvent) {
		if (!pID || !pEvent) return;
		var webE = mainM.webEvents[pEvent.toLowerCase()];
		if (!webE) return;
		var e = document.getElementById(pID);
		if (!e) return;
		e[webE]();
	};
	clientM.removeWebTag = function(pID) {
		if (!pID) return;
		var e = document.getElementById(pID);
		if (!e) return;
		e.parentNode.removeChild(e);
	};
	clientM.addWebScript = function(pName, pLink, pModule, pFunc) {
		if (!pLink) return;
		var head = document.getElementsByTagName('head')[0];
		var s = document.createElement('script');
		if (pName) s.setAttribute('id', 'script_' + pName);
		if (pModule) s.setAttribute('type', 'module');
		else s.setAttribute('type', 'text/javascript');
		s.setAttribute('src', pLink);
		if (pFunc) s.onload = pFunc;
		head.appendChild(s);
	};
	clientM.addWebModule = function(pName, pLink, pModule, pFunc) {
		if (!pLink) return;
		var head = document.getElementsByTagName('head')[0];
		var s = document.createElement('script');
		if (pName) s.setAttribute('id', 'module_' + pName);
		if (pModule) s.setAttribute('type', 'module');
		else s.setAttribute('type', 'text/javascript');
		s.setAttribute('src', pLink);
		if (pFunc) s.onload = pFunc;
		head.appendChild(s);
	};
	clientM.removeWebScript = function(pName) {
		var s = document.getElementById('script_' + pName);
		if (!s) return
		s.parentNode.removeChild(s);
	};
	clientM.evalWebScript = function(pScript) {
		return eval.call(null, pScript);
	};
	clientM.getAllLocalStorage = function() {
		var arr = {};
		try {
			for (var i = 0, len = window.localStorage.length; i < len; i ++) {
				var s = window.localStorage.key(i);
				if (s && s.indexOf(gameM.gameID + '_') === 0) {
					arr[s.slice(s.indexOf('_') + 1)] = window.localStorage.getItem(s);
				}
			}
		} catch (pErr) {
		}
		return arr;
	};
	clientM.setLocalStorage = function(pKey, pData) {
		_vy_t_windowPar.setLocalStorage(pKey, pData);
	};
	clientM.setMaxFPS = function(pFPS) {
		clientM.cOb.maxFPS = pFPS;
		scrM.setRenderDelay();
	};
	clientM.setMouseCursor = function(pCursor, pX, pY) {
		var cursor = pCursor;
		if (!pCursor) cursor = 'default';
		else {
			var pos = (pX !== undefined && pY !== undefined)? ' ' + pX + ' ' + pY : '';
			if (typeof(pCursor) === 'string') {
				if (pCursor.indexOf("/") !== -1 || pCursor.indexOf(".") !== -1) cursor = 'url("' + pCursor + '")' + pos + ', auto';
			} else if (pCursor._vy_ico && resM.getIconData(pCursor._vy_ico)) {
				cursor = 'url("' + resM.getIconData(pCursor._vy_ico) + '")' + pos + ', auto';
			}
		}
		clientM._vy_cursor = {'cursor': pCursor, 'x': (pX || 0), 'y': (pY || 0)};
		document.body.style.cursor = cursor;
	};
	clientM.addInterfaceElement = function(pType, pInt, pName, pX, pY, pArgs) {
		if (!pType || !pInt || pType.indexOf('Interface') !== 0) return;
		var intPane = clientM.interfaces[pInt];
		if (!intPane) return;
		var element = newDiob(diobM.objectType[pType]);
		element._vy_conts = [];
		if (pX !== undefined) element._vy_x = pX;
		if (pY !== undefined) element._vy_y = pY;
		if (pName) element._vy_name = pName;
		element._vy_parent = intPane;
		element._vy_clCon = clientM;
		if (element.onNew) {
			if (!mainM.isInitialized) resM.diobNewQueue.push([element, pArgs]);
			else diobM.diobOnNew(element, pArgs);
		}
		return clientM._addInterfaceElement(intPane, element, pName);
	};
	clientM._addInterfaceElement = function(pInt, pEl, pName) {
		var element = pEl;
		if (pName) element._vy_name = pName;
		element._vy_parent = pInt;
		element._vy_clCon = clientM;
		if (pInt._vy_aContents[pName]) {
			clientM.hideInterface(pInt, pInt._vy_aContents[pName]);
			var index = pInt._vy_conts.indexOf(pInt._vy_aContents[pName]);
			if (index !== -1) pInt._vy_conts.splice(index, 1);
		}
		pInt._vy_aContents[element._vy_name] = element;
		pInt._vy_conts.push(element);
		if (!element.isHidden) {
			if (pInt._vy_onScr) scrM.addToInterface(element);
			if (element.onShow) element.onShow(clientM.cOb);
		}
		return element;
	};
	clientM.removeInterfaceElement = function(pInt, pName) {
		if (!pInt || !pName) return;
		var intPane = clientM.interfaces[pInt];
		if (!intPane) return;
		var element = intPane._vy_aContents[pName];
		if (!element) return;
		if (element._vy_onScr) scrM.removeFromInterface(element);
		if (!element.isHidden) dfM.onHide(element);
		element._vy_parent = null;
		var index = intPane._vy_conts.indexOf(intPane._vy_aContents[pName]);
		if (index !== -1) intPane._vy_conts.splice(index, 1);
		if (element._vy_webBox) mainM.gameBody.removeChild(element._vy_webBox);
		delete intPane._vy_aContents[pName];
	};
	clientM.getInterfaceElement = function(pInt, pEl) {
		if (!pInt || !pEl) return;
		var intPane = clientM.interfaces[pInt];
		if (!intPane) return;
		var el = intPane._vy_aContents[pEl];
		if (!el) return;
		return el;
	};
	clientM.getInterfaceElements = function(pInt, pType, pChild) {
		var arr = [];
		if (!pInt) return arr;
		var intPane = clientM.interfaces[pInt];
		if (!intPane) return arr;
		for (var i = 0, len = intPane._vy_conts.length; i < len; i ++) {
			var obj = intPane._vy_conts[i];
			if (!obj) continue;
			if (!pType || funcM._isType(obj._vy_type, pType, pChild)) {
				arr.push(obj);
			}
		}
		return arr;
	};
	clientM.showInterface = function(pInt, pEl, pForce) {
		if (!pInt) return;
		var intPane = clientM.interfaces[pInt];
		if (!intPane) return;
		if (pEl) {
			var el = intPane._vy_aContents[pEl];
			if (el) {
				el.isHidden = 0;
				if (el.onShow) el.onShow(clientM.cOb);
				if (intPane._vy_onScr) scrM.addToInterface(el);
			}
		}
		if (!intPane._vy_shown) {
			intPane._vy_shown = true;
			scrM.addToInterface(intPane);
			for (var i = 0, len = intPane._vy_conts.length; i < len; i ++) {
				var e = intPane._vy_conts[i];
				if (e && (!e.isHidden || pForce)) {
					e.isHidden = 0;
					if (e.onShow) e.onShow(clientM.cOb);
				}
			}
		}
	};
	clientM.hideInterface = function(pInt, pEl) {
		if (!pInt) return;
		if (pEl) {
			var intPane = clientM.interfaces[pInt];
			if (intPane) {
				var el = intPane._vy_aContents[pEl];
				if (el) {
					el.isHidden = 1;
					dfM.onHide(el);
					if (el._vy_onScr) scrM.removeFromInterface(el);
				}
			}
		} else {
			var intPane = clientM.interfaces[pInt];
			if (!intPane) return;
			intPane._vy_shown = false;
			scrM.removeFromInterface(intPane);
			for (var i = 0, len = intPane._vy_conts.length; i < len; i ++) {
				var e = intPane._vy_conts[i];
				if (!e.isHidden) dfM.onHide(e);
			}
		}
	};
	clientM.outputText = function(pText, pInt, pEl) {
		if (!pInt) {
			if (!clientM || !clientM.cOb) return;
			pInt = clientM.cOb._vy_mainOutputInt;
			if (!pInt) return;
		}
		if (!pEl) {
			pInt = clientM.cOb._vy_mainOutputInt;
			pEl = clientM.cOb._vy_mainOutputEl;
		}
		var intPane = clientM.interfaces[pInt];
		if (!intPane) return;
		var el = intPane._vy_aContents[pEl];
		if (!el) return;
		if (el.interfaceType === 'WebBox') {
			el._vy_text += ((el._vy_text.length)? '\n' : '') + pText;
			if (el._vy_webBox) {
				if (!el._vy_outputQueue) el._vy_outputQueue = '';
				el._vy_outputQueue += '<div class="web_box_div" style="margin-bottom: ' + ((el._vy_textSty.lineSpace? el._vy_textSty.lineSpace : scrM.defaultText.lineSpace) + 'px') + '">' + mainM.getWebText(pText) + '</div>';
				if (!scrM.outputQueue.includes(el)) scrM.outputQueue.push(el);
			}
		} else {
			if (el.interfaceType === 'TextBox') {
				el._vy_text += ((el._vy_text.length)? '\n' : '') + pText;
				el._vy_scrollToBot = true;
			} else {
				el._vy_text += pText;
			}
			scrM.refreshInt[el._vy_layer] = true;
		}
	};
	clientM.setMacroAtlas = function(pMacro) {
		if (!pMacro) return;
		eventM.clearKeyDownEvents();
		if (!eventM.macros[pMacro]) return;
		clientM.cOb._vy_macroAtlas = pMacro;
	};
	clientM.addCustomMacro = function(pName, pKey, pDown, pUp) {
		if (!pKey || clientM.cOb._vy_customMacros['on' + pKey]) return;
		var macro = {'name': pName, 'key': pKey};
		if (pUp) {
			var up = pUp.match(/^(.*)\((.*)\)$/);
			if (up) {
				if (up[2]) up[2] = ',' + up[2];
				eval("macro.up = function() { clientM.clientType._vy_com." + up[1] + ".call(this" + up[2] + "); };");
			}
		}
		if (pDown) {
			var down = pDown.match(/^(.*)\((.*)\)$/);
			if (down) {
				if (down[2]) down[2] = ',' + down[2];
				eval("macro.down = function() { clientM.clientType._vy_com." + down[1] + ".call(this" + down[2] + "); };");
			}
		}
		clientM.cOb._vy_customMacros['on' + pKey] = macro;
	};
	clientM.removeCustomMacro = function(pName) {
		var key = '';
		for (var k in clientM.cOb._vy_customMacros) {
			var macro = clientM.cOb._vy_customMacros[k];
			if (macro && macro.name === pName) {
				key = k;
				break;
			}
		}
		clientM.cOb._vy_customMacros[key] = undefined;
	};
	clientM.clearPlayerMob = function() {
		if (clientM.cOb._vy_playerMob.onLogout) clientM.cOb._vy_playerMob.onLogout();
		if (clientM.cOb.mob === clientM.cOb._vy_playerMob) clientM.cOb.mob = undefined;
		if (clientM.cOb._vy_playerMob.client === clientM.cOb) clientM.cOb._vy_playerMob.client = undefined;
		eventM.clearKeyDownEvents();
		clientM.cOb._vy_playerMob._vy_clCon = 0;
	};
	clientM.setPlayerMob = function(pMob, pSkip) {
		if (clientM.cOb._vy_playerMob && !pSkip) {
			if (clientM.cOb._vy_playerMob === pMob) return;
			clientM.clearPlayerMob();
		} else scrM.clearScreen();
		if (!pMob) return;
		var old = clientM.cOb._vy_playerMob;
		clientM.cOb._vy_playerMob = pMob;
		pMob._vy_clCon = clientM;
		pMob.client = clientM.cOb;
		clientM.cOb.mob = pMob;
		resM.setMap(pMob._vy_mapN);
		if (!clientM.cOb._vy_viewEye || clientM.cOb._vy_viewEye === old) clientM.setViewEye(pMob);
		if (pMob.onLogin) pMob.onLogin();
	};
	clientM.setEdgeLimit = function(pX, pY) {
		if (pX === undefined || pX === -1) pX = Math.floor(scrM.xMap / 2);
		else if (pX < -1) pX = 0;
		if (pY === undefined || pY === -1) pY = Math.floor(scrM.yMap / 2);
		else if (pY < -1) pY = 0;
		clientM.xEdgeLimit = pX;
		clientM.yEdgeLimit = pY;
		scrM.setEdgeLimit(clientM.xEdgeLimit, clientM.yEdgeLimit);
		scrM.setViewFromObject(clientM.cOb._vy_viewEye);
	};
	clientM.setViewEye = function(pD) {
		if (pD && resM.mapName && resM.mapName !== pD._vy_mapN) return;
		clientM.cOb._vy_viewEye = pD;
		scrM.setViewEye(pD);
	};
	clientM.setViewEyeOffsets = function(pX, pY) {
		if (!pX) pX = 0;
		if (pY === undefined) pY = pX;
		clientM.cOb._vy_xViewEyeOffset = pX;
		clientM.cOb._vy_yViewEyeOffset = pY;
		scrM.xScrOff = pX;
		scrM.yScrOff = pY;
		if (scrM.viewEye) {
			scrM.xViewEye = scrM.mapWidthHalf - scrM.viewEye._vy_wH - scrM.xScrOff;
			scrM.yViewEye = scrM.mapHeightHalf - scrM.viewEye._vy_hH - scrM.yScrOff;
		}
		scrM.setViewFromObject(clientM.cOb._vy_viewEye, true, true);
	};
	clientM.setViewEyeDelay = function(pDelay) {
		if (!pDelay) pDelay = {};
		if (pDelay.step === undefined) pDelay.step = 1;
		if (pDelay.max === undefined) pDelay.max = {'x': _vy_t_xTileSize, 'y': _vy_t_yTileSize};
		scrM.scrDelayStep = pDelay.step;
		scrM.xScrDelayMax = pDelay.max.x;
		scrM.yScrDelayMax = pDelay.max.y;
		scrM.scrDelayTime = performance.now();
		if (gameM.mapMode === 'isometric') {
			scrM.xScrExtraTile = Math.ceil(scrM.xScrDelayMax / _vy_t_xTileSize) + (scrM.xMapHalf / 2);
			scrM.yScrExtraTile = Math.ceil(scrM.yScrDelayMax / _vy_t_yTileSize) + (scrM.yMapHalf / 2);
		} else {
			scrM.xScrExtraTile = Math.ceil(scrM.xScrDelayMax / _vy_t_xTileSize);
			scrM.yScrExtraTile = Math.ceil(scrM.yScrDelayMax / _vy_t_yTileSize);
		}
		scrM.xScrExtra = (scrM.xScrExtraTile + 1) * _vy_t_xTileSize;
		scrM.yScrExtra = (scrM.yScrExtraTile + 1) * _vy_t_yTileSize;
		clientM.cOb._vy_viewEyeDelay = pDelay;
	};
	clientM.toggleScreenDrawing = function(pVal) {
		var val = pVal;
		if (pVal === false) {
			val = true;
		} else if (pVal === true) {
			val = false;
		} else {
			if (scrM.pauseDraw) val = false;
			else val = pVal || true;
		}
		scrM.lastPauseDraw = val;
		if (val) scrM.pauseRender(val);
		else scrM.resumeRender();
	};
	clientM.toggleMacroCapture = function(pVal) {
		var old = eventM.pauseMacros;
		if (pVal === false) {
			eventM.pauseMacros = true;
		} else if (pVal === true) {
			eventM.pauseMacros = false;
		} else {
			if (pVal || !eventM.pauseMacros) eventM.pauseMacros = false;
			else eventM.pauseMacros = true;
		}
		if (eventM.pauseMacros) eventM.clearKeyDownEvents(1, ((old)? 0 : 1));
		else if (old) eventM.redoKeyDownEvents();
	};
	clientM.toggleLoadScreen = function(pVal) {
		if (pVal === false) {
			if (mainM.inLoadScreen) mainM.hideLoadScreen(1);
		} else if (pVal === true) {
			if (!mainM.inLoadScreen) mainM.showLoadScreen();
		} else {
			if (pVal || !mainM.inLoadScreen) {
				mainM.showLoadScreen();
			} else {
				mainM.hideLoadScreen(1);
			}
		}
	};
	clientM.clientID = 1;
	clientM.accountName = 'Guest';
	clientM.navigator = {'platform': navigator.appName, 'version': navigator.appVersion, 'vendor': navigator.vendor, 'language': navigator.language, 'system': navigator.oscpu};
	clientM.interfaces = [];
	clientM.viewPerspective = 1;
	clientM.mousePos = {'x': 0, 'y': 0};
	clientM.fps = 0;
};

function EventManager() {
	eventM = this;
	eventM.setInputEvents = function() {
		document.onmousewheel = eventM.onMouseWheelEvent;	
		document.onmousemove = eventM.onMouseMoveEvent;
		document.onmousedown = eventM.onMouseDownEvent;
		document.onclick = eventM.onMouseClickEvent;
		document.oncontextmenu = eventM.onMouseClickEvent;
		document.ondblclick = eventM.onMouseDblClickEvent;
		document.onmouseup = eventM.onMouseUpEvent;
		document.onkeydown = eventM.onKeyDownEvent;
		document.onkeyup = eventM.onKeyUpEvent;
	};
	eventM.findMouseOverEvents = function(pEvent) {
		var over = [];
		var cX = pEvent.clientX + mainM.canvasXOffset - mainM.xBodyPos;
		var cY = pEvent.clientY + mainM.canvasYOffset - mainM.yBodyPos;
		for (var i = 0, len = scrM.interfaceElements.length; i < len; i ++) {
			var d = scrM.interfaceElements[i];
			var cO = (d.isOverlay)? d.isOverlay : d;
			var oX = (d.isOverlay)? d._vy_x : 0;
			var oY = (d.isOverlay)? d._vy_y : 0;
			if (d._vy_mouseOp > 0) {
				var w = d._vy_w;
				var h = d._vy_h;
				if (d._vy_mouseOp === 1) {
					w = (d._vy_ico)? d._vy_icoW : 0;
					h = (d._vy_ico)? d._vy_icoH : 0;
					oX += d._vy_xIcoOff;
					oY += d._vy_yIcoOff;
				}
				if (d.preventAutoScale) {
					if ((cO._vy_x + oX) <= cX && (cO._vy_x + oX + w) > cX && (cO._vy_y + oY) <= cY && (cO._vy_y + oY + h) > cY) {
						if (!over.includes(d)) over.push(d);
					}
				} else {
					if ((cO._vy_x + oX) * mainM.scaleWidth <= cX && (cO._vy_x + oX + w) * mainM.scaleWidth > cX && (cO._vy_y + oY) * mainM.scaleHeight <= cY && (cO._vy_y + oY + h) * mainM.scaleHeight > cY) {
						if (!over.includes(d)) over.push(d);
					}
				}
			}
		}
		if (!over.length) {
			cX -= scrM.xMapPos * mainM.mapScaleWidth;
			cY -= scrM.yMapPos * mainM.mapScaleHeight;
			for (var i = scrM.planesArr.length; i --;) {
				var plane = scrM.planesArr[i];
				for (var i2 = 0, len2 = plane._vy_planeDis.length; i2 < len2; i2 ++) {
					var d = plane._vy_planeDis[i2];
					var cO = (d.isOverlay)? d.isOverlay : d;
					var oX = (d.isOverlay)? d._vy_x : 0;
					var oY = (d.isOverlay)? d._vy_y : 0;
					if (d._vy_mouseOp > 0) {
						var w = d._vy_w;
						var h = d._vy_h;
						if (d._vy_mouseOp === 1) {
							w = (d._vy_ico)? d._vy_icoW : 0;
							h = (d._vy_ico)? d._vy_icoH : 0;
							oX = cO._vy_x + oX + d._vy_xIcoOff;
							oY = cO._vy_y + oY + d._vy_yIcoOff;
						} else {
							oX = cO._vy_x + cO._vy_xOr + oX;
							oY = cO._vy_y + cO._vy_yOr + oY;
						}
						if ((oX - scrM.xScr) * mainM.mapScaleWidth <= cX && (oX - scrM.xScr + w) * mainM.mapScaleWidth > cX && (oY - scrM.yScr) * mainM.mapScaleHeight <= cY && (oY - scrM.yScr + h) * mainM.mapScaleHeight > cY) {
							if (!over.includes(d)) over.push(d);
						}
					}
				}
				if (over.length) break;
			}
		}
		if (!over.length) {
			for (var i in scrM.screenTiles) {
				var d = scrM.screenTiles[i];
				if (d._vy_mouseOp > 0) {
					var w = d._vy_w;
					var h = d._vy_h;
					if (d._vy_mouseOp === 1) {
						w = (d._vy_ico)? d._vy_icoW : 0;
						h = (d._vy_ico)? d._vy_icoH : 0;
						oX += d._vy_xIcoOff;
						oY += d._vy_yIcoOff;
					}
					if ((d._vy_x - scrM.xScr) * mainM.mapScaleWidth <= cX && (d._vy_x - scrM.xScr + w) * mainM.mapScaleWidth > cX && (d._vy_y - scrM.yScr) * mainM.mapScaleHeight <= cY && (d._vy_y - scrM.yScr + h) * mainM.mapScaleHeight > cY) {
						if (!over.includes(d)) over.push(d);
					}
				}
			}
		}
		return over;
	}
	eventM.onMouseMoveEvent = function(pEvent) {
		if (pEvent.clientX === undefined || pEvent.clientY === undefined) return;
		var over = eventM.findMouseOverEvents(pEvent);
		clientM.mousePos.x = Math.floor((pEvent.clientX - mainM.xBodyPos) / mainM.scaleWidth);
		clientM.mousePos.y = Math.floor((pEvent.clientY - mainM.yBodyPos) / mainM.scaleHeight);
		if (over.length) {
			var top;
			for (var i = 0, len = over.length; i < len; i ++) {
				var e = over[i];
				if (top && top._vy_layer > e._vy_layer) {
					continue;
				}
				top = e;
			}
			if (mainM._vy_mouseOver) {
				if (mainM._vy_mouseOver == top) {
					funcM.onMouseMove(mainM._vy_mouseOver, clientM.mousePos.x, clientM.mousePos.y);
					return;
				}
				funcM.onMouseExit(mainM._vy_mouseOver, clientM.mousePos.x, clientM.mousePos.y);
			}
			if (top) {
				if (top._vy_gui) {
					if ((top._vy_isIntInput) && clientM.cOb._vy_focused != top) pEvent.preventDefault();
					else if (!top._vy_webBox) pEvent.preventDefault();
				}
				mainM._vy_mouseOver = top;
				funcM.onMouseEnter(mainM._vy_mouseOver, clientM.mousePos.x, clientM.mousePos.y);
			} else if (clientM.cOb.onMouseMove) funcM.onMouseMove(0, clientM.mousePos.x, clientM.mousePos.y);
		} else {
			if (mainM._vy_mouseOver) {
				funcM.onMouseExit(mainM._vy_mouseOver, clientM.mousePos.x, clientM.mousePos.y);
				mainM._vy_mouseOver = 0;
			}
			if (clientM.cOb.onMouseMove) funcM.onMouseMove(0, clientM.mousePos.x, clientM.mousePos.y);
		}
	};
	eventM.onMouseClickEvent = function(pEvent) {
		if (pEvent.clientX === undefined || pEvent.clientY === undefined) return;
		//if (!window.hasFocus) window.focus();
		var over = eventM.findMouseOverEvents(pEvent);
		var cX = Math.floor((pEvent.clientX - mainM.xBodyPos) / mainM.scaleWidth);
		var cY = Math.floor((pEvent.clientY - mainM.yBodyPos) / mainM.scaleHeight);
		if (over.length) {
			var top;
			for (var i = 0, len = over.length; i < len; i++) {
				var e = over[i];
				if (top && top._vy_layer > e._vy_layer) {
					continue;
				}
				top = e;
			}
			if (top) {
				if (top._vy_gui) {
					if ((top._vy_isIntInput) && clientM.cOb._vy_focused != top) pEvent.preventDefault();
					else if (!top._vy_webBox) pEvent.preventDefault();
				}
				funcM.onMouseClick(top, cX, cY, (pEvent.button + 1));
			} else if (clientM.cOb.onMouseClick) funcM.onMouseClick(0, cX, cY, (pEvent.button + 1));
		} else {
			if (clientM.cOb.onMouseClick) funcM.onMouseClick(0, cX, cY, (pEvent.button + 1));
		}
		//pEvent.preventDefault();
	};
	eventM.onMouseDblClickEvent = function(pEvent) {
		if (pEvent.clientX === undefined || pEvent.clientY === undefined) return;
		if (!window.hasFocus) window.focus();
		var over = eventM.findMouseOverEvents(pEvent);
		var cX = Math.floor((pEvent.clientX - mainM.xBodyPos) / mainM.scaleWidth);
		var cY = Math.floor((pEvent.clientY - mainM.yBodyPos) / mainM.scaleHeight);
		if (over.length) {
			var top;
			for (var i = 0, len = over.length; i < len; i++) {
				var e = over[i];
				if (top && top._vy_layer > e._vy_layer) {
					continue;
				}
				top = e;
			}
			if (top) {
				if (top._vy_gui) {
					if ((top._vy_isIntInput) && clientM.cOb._vy_focused != top) pEvent.preventDefault();
					else if (!top._vy_webBox) pEvent.preventDefault();
				}
				funcM.onMouseDblClick(top, cX, cY, (pEvent.button + 1));
			} else if (clientM.cOb.onMouseDblClick) funcM.onMouseDblClick(0, cX, cY, (pEvent.button + 1));
		} else {
			if (clientM.cOb.onMouseDblClick) funcM.onMouseDblClick(0, cX, cY, (pEvent.button + 1));
		}
		//pEvent.preventDefault();
	};
	eventM.onMouseDownEvent = function(pEvent) {
		if (pEvent.clientX === undefined || pEvent.clientY === undefined) return;
		if (!window.hasFocus) window.focus();
		mainM._vy_mouseDown ++;
		var over = eventM.findMouseOverEvents(pEvent);
		var cX = Math.floor((pEvent.clientX - mainM.xBodyPos) / mainM.scaleWidth);
		var cY = Math.floor((pEvent.clientY - mainM.yBodyPos) / mainM.scaleHeight);
		if (over.length) {
			var top;
			for (var i = 0, len = over.length; i < len; i++) {
				var e = over[i];
				if (top && top._vy_layer > e._vy_layer) {
					continue;
				}
				top = e;
			}
			if (top) {
				if (top._vy_gui) {
					if ((top._vy_isIntInput) && clientM.cOb._vy_focused != top) pEvent.preventDefault();
					else if (!top._vy_webBox) pEvent.preventDefault();
				}
				funcM.onMouseDown(top, cX, cY, (pEvent.button + 1));
			} else if (clientM.cOb.onMouseDown) funcM.onMouseDown(0, cX, cY, (pEvent.button + 1));
		} else {
			if (clientM.cOb.onMouseDown) funcM.onMouseDown(0, cX, cY, (pEvent.button + 1));
		}
		//pEvent.preventDefault();
	};
	eventM.onMouseUpEvent = function(pEvent) {
		if (pEvent.clientX === undefined || pEvent.clientY === undefined || !mainM._vy_mouseDown) return;
		if (pEvent.button === 3) pEvent.preventDefault();
		var over = eventM.findMouseOverEvents(pEvent);
		var cX = Math.floor((pEvent.clientX - mainM.xBodyPos) / mainM.scaleWidth);
		var cY = Math.floor((pEvent.clientY - mainM.yBodyPos) / mainM.scaleHeight);
		if (over.length) {
			var top;
			for (var i = 0, len = over.length; i < len; i++) {
				var e = over[i];
				if (top && top._vy_layer > e._vy_layer) {
					continue;
				}
				top = e;
			}
			if (top) {
				if (top._vy_gui) {
					if ((top._vy_isIntInput) && clientM.cOb._vy_focused !== top) pEvent.preventDefault();
					else if (!top._vy_webBox) pEvent.preventDefault();
				}
				funcM.onMouseUp(top, cX, cY, (pEvent.button + 1));
			} else if (clientM.cOb.onMouseUp) funcM.onMouseUp(0, cX, cY, (pEvent.button + 1));
		} else {
			if (clientM.cOb.onMouseUp) funcM.onMouseUp(0, cX, cY, (pEvent.button + 1));
		}
		mainM._vy_mouseDown --;
		//pEvent.preventDefault();
		if (pEvent.button === 1 || pEvent.button === 2) {
			if (pEvent.detail === 2) eventM.onMouseDblClickEvent(pEvent);
			else if (pEvent.detail === 1) eventM.onMouseClickEvent(pEvent);
		}
	};
	eventM.onMouseWheelEvent = function(pEvent) {
		if (pEvent.clientX === undefined || pEvent.clientY === undefined || mainM._vy_mouseDown) return;
		var eType = 'mouseWheelScrollDown';
		if ((pEvent.detail? pEvent.detail * (-120) : pEvent.wheelDelta) > 0) eType = 'mouseWheelScrollUp';
		var over = eventM.findMouseOverEvents(pEvent);
		if (over.length) {
			var cX = Math.floor((pEvent.clientX - mainM.xBodyPos) / mainM.scaleWidth);
			var cY = Math.floor((pEvent.clientY - mainM.yBodyPos) / mainM.scaleHeight);
			var top;
			for (var i = 0, len = over.length; i < len; i++) {
				var e = over[i];
				if (top && top._vy_layer > e._vy_layer) {
					continue;
				}
				top = e;
			}
			if (top) {
				if (eType === 'mouseWheelScrollDown') {
					funcM.onMouseWheelScrollDown(top, cX, cY);
					if (top && top._vy_gui && top.interfaceType === 'TextBox') funcM._textBoxMouseWheelScrollDown(top);
				} else {
					funcM.onMouseWheelScrollUp(top, cX, cY);
					if (top && top._vy_gui && top.interfaceType === 'TextBox') funcM._textBoxMouseWheelScrollUp(top);
				}
			} else {
				if (eType === 'mouseWheelScrollDown' && clientM.cOb.onMouseWheelScrollDown) funcM.onMouseWheelScrollDown(0, cX, cY);
				else if (eType === 'mouseWheelScrollUp' && clientM.cOb.onMouseWheelScrollUp) funcM.onMouseWheelScrollUp(0, cX, cY);
			}
		} else {
			if (eType === 'mouseWheelScrollDown' && clientM.cOb.onMouseWheelScrollDown) funcM.onMouseWheelScrollDown(0, cX, cY);
			else if (eType === 'mouseWheelScrollUp' && clientM.cOb.onMouseWheelScrollUp) funcM.onMouseWheelScrollUp(0, cX, cY);
		}
	};
	eventM.onKeyDownEvent = function(pEvent) {
		var key = pEvent.key;
		if (clientM.cOb._vy_inCommandInput && key !== 'Escape') {
			if (pEvent.key === 'Enter') {
				var input = clientM.cOb._vy_inCommandInput;
				dfM.onExecute(input);
				if (input) {
					input._vy_text = '';
					input._vy_webBox.innerBox.value = '';
				}
			} else if (clientM.cOb.onKeyDown && (key === 'Shift' || key === 'Control' || key === 'Alt') && !pEvent.repeat) funcM.onKeyDown(key, pEvent);
			eventM.preventKeyDefaults(pEvent);
			return;
		}
		if (clientM.cOb.inInput) {
			eventM.preventKeyDefaults(pEvent);
			if (key !== 'Tab' && key !== 'Enter' && key !== 'Escape') return;
		}
		if ((pEvent.getModifierState('CapsLock') || pEvent.getModifierState('Shift')) && key.length === 1 && key.charCodeAt(0) >= 65 && key.charCodeAt(0) <= 90) key = key.toLowerCase();
		var f = (clientM.cOb._vy_customMacros['on' + key] && clientM.cOb._vy_customMacros['on' + key].down) || (clientM.cOb._vy_macroAtlas && eventM.macros[clientM.cOb._vy_macroAtlas]['on' + key] && eventM.macros[clientM.cOb._vy_macroAtlas]['on' + key].down);
		if (clientM.cOb.onKeyDown) funcM.onKeyDown(pEvent.key, pEvent);
		if (pEvent.repeat) {
			if (f) pEvent.preventDefault();
			return;
		}
		if (!eventM.pauseMacros && f) {
			eventM.setKeyDownEvent(f, key);
			pEvent.preventDefault();
			return;
		} else {
			eventM.setKeyDownEvent(0, key);
		}
		eventM.preventKeyDefaults(pEvent);
	};
	eventM.preventKeyDefaults = function(pEvent) {
		var key = pEvent.key;
		if (key === 'Tab' || (key === 'Backspace' && !clientM.cOb.inInput)) {
			pEvent.preventDefault();
			return;
		}
	};
	eventM.onKeyUpEvent = function(pEvent) {
		var key = pEvent.key;
		if (clientM.cOb.inInput) {
			eventM.clearKeyDownEvent(key);
			if (clientM.cOb.onKeyUp && (key === 'Shift' || key === 'Control' || key === 'Alt') && !pEvent.repeat) funcM.onKeyUp(key, pEvent);
			return;
		}
		if (clientM.cOb.onKeyUp) funcM.onKeyUp(key, pEvent);
		if ((pEvent.getModifierState('CapsLock') || pEvent.getModifierState('Shift')) && key.length === 1 && key.charCodeAt(0) >= 65 && key.charCodeAt(0) <= 90) key = key.toLowerCase();
		eventM.clearKeyDownEvent(key);
		if (!eventM.pauseMacros) {
			var f = (clientM.cOb._vy_customMacros['on' + key] &&  clientM.cOb._vy_customMacros['on' + key].up) || (clientM.cOb._vy_macroAtlas && eventM.macros[clientM.cOb._vy_macroAtlas]['on' + key] && eventM.macros[clientM.cOb._vy_macroAtlas]['on' + key].up);
			if (f) {
				if (f && f !== 1) f.call(clientM.cOb);
				pEvent.preventDefault();
				return;
			}
		}
	};
	eventM.setKeyDownEvent = function(pFunc, pKey) {
		if (eventM.keysDown.indexOf(pKey) === -1) {
			if (pFunc) {
				eventM.keyDown[pKey] = pFunc;
				if (pFunc !== 1) pFunc.call(clientM.cOb);
			}
			eventM.keysDown.push(pKey);
		}
	};
	eventM.clearKeyDownEvent = function(pKey) {
		eventM.keyDown[pKey] = 0;
		if (eventM.keysDown.indexOf(pKey) !== -1) {
			eventM.keysDown.splice(eventM.keysDown.indexOf(pKey), 1);
		}
	};
	eventM.redoKeyDownEvents = function() {
		for (var i = 0, len = eventM.keysDown.length; i < len; i ++) {
			if (!eventM.keysDown[i]) continue;
			var key = eventM.keysDown[i];
			if (clientM.cOb.onKeyDown) funcM.onKeyDown(key);
			if (eventM.keyDown[key]) {
				if (!eventM.pauseMacros && clientM.cOb) {
					var f = (clientM.cOb._vy_customMacros['on' + key] &&  clientM.cOb._vy_customMacros['on' + key].down) || (clientM.cOb._vy_macroAtlas && eventM.macros[clientM.cOb._vy_macroAtlas]['on' + key] && eventM.macros[clientM.cOb._vy_macroAtlas]['on' + key].down);
					if (f && f !== 1) f.call(clientM.cOb);
				}
			}
		}
	};
	eventM.clearKeyDownEvents = function(pSave, pForce) {
		for (var i = 0, len = eventM.keysDown.length; i < len; i ++) {
			if (!eventM.keysDown[i]) continue;
			var key = eventM.keysDown[i];
			if (!pSave) eventM.keysDown[i] = undefined;
			if (clientM.cOb.onKeyUp) funcM.onKeyUp(key);
			if (eventM.keyDown[key]) {
				if ((!eventM.pauseMacros || pForce) && clientM.cOb) {
					var f = (clientM.cOb._vy_customMacros['on' + key] &&  clientM.cOb._vy_customMacros['on' + key].up) || (clientM.cOb._vy_macroAtlas && eventM.macros[clientM.cOb._vy_macroAtlas]['on' + key] && eventM.macros[clientM.cOb._vy_macroAtlas]['on' + key].up);
					if (f && f !== 1) f.call(clientM.cOb);
				}
			}
		}
		if (!pSave) {
			eventM.keyDown = [];
			eventM.keysDown = [];
		}
	};
	eventM.movementObj = [];
	eventM.addMovementObj = function(pD) {
		if (!pD) return;
		if (pD._vy_moving || eventM.movementObj.includes(pD)) return;
		pD._vy_moving = true;
		pD.isMoving = true;
		eventM.movementObj.push(pD);
		dfM.setIconState(pD, 'move_' + pD._vy_dir, 1, 0, true);
		if (pD.onMoveStart) pD.onMoveStart();
	};
	eventM.removeMovementObj = function(pD) {
		var index = eventM.movementObj.indexOf(pD);
		if (index !== -1) eventM.movementObj.splice(index, 1);
		else return;
		if (!pD) return;
		pD._vy_moving = false;
		pD.isMoving = false;
		if (pD._vy_defIconState) dfM.setIconState(pD, pD._vy_dir);
		if (pD.onMoveEnd) pD.onMoveEnd();
	};
	eventM.moveToObj = [];
	eventM.movMoveTo = function(pD, pX, pY) {
		var x = pX - pD._vy_x, y = pY - pD._vy_y;
		if ((!pD._vy_x && pD._vy_x !== 0) || (!pD._vy_y && pD._vy_y !== 0) || Math.abs(x) > scrM.mapWidthHalf || Math.abs(y) > scrM.mapHeightHalf) {
			dfM.setPos(pD, pX, pY);
		} else {
			if (!eventM.moveToObj.includes(pD)) eventM.moveToObj.push(pD);
			pD._vy_xMov = pX;
			pD._vy_xMovD = x;
			pD._vy_yMov = pY;
			pD._vy_yMovD = y;
			pD._vy_tMov = 0;
		}
	};
	eventM.removeMoveToObj = function(pD) {
		var index = eventM.moveToObj.indexOf(pD);
		if (index !== -1) eventM.moveToObj.splice(index, 1);
		//if (!pD) return;
	};
	eventM.setMovementObjPos = function(pD) {
		pD._vy_movingX = 0;
		pD._vy_movingY = 0;
		if (pD._vy_movingNorth && !pD._vy_movingSouth) {
			if (pD._vy_movingEast && !pD._vy_movingWest) {
				pD._vy_movingX = 1;
				pD._vy_movingY = -1;
			} else if (pD._vy_movingWest && !pD._vy_movingEast) {
				pD._vy_movingX = -1;
				pD._vy_movingY = -1;
			} else {
				pD._vy_movingY = -1;
			}
		} else if (pD._vy_movingSouth && !pD._vy_movingNorth) {
			if (pD._vy_movingEast && !pD._vy_movingWest) {
				pD._vy_movingX = 1;
				pD._vy_movingY = 1;
			} else if (pD._vy_movingWest && !pD._vy_movingEast) {
				pD._vy_movingX = -1;
				pD._vy_movingY = 1;
			} else {
				pD._vy_movingY = 1;
			}
		} else if (pD._vy_movingEast && !pD._vy_movingWest) {
			pD._vy_movingX = 1;
		} else if (pD._vy_movingWest && !pD._vy_movingEast) {
			pD._vy_movingX = -1;
		}
		if ((pD._vy_movingX || pD._vy_movingY) && !pD._vy_moving) {
			if (!pD.moveSettings) dfM._setMoveSettings(pD);
			eventM.addMovementObj(pD);
		}
	};
	eventM.refreshObjectMovement = function(pT) {
		//var c = Math.max(Math.floor((pT - eventM.lastObjMove) / eventM.intervalDelay), 1);
		var c = pT - eventM.lastObjMove;
		
		for (var i = eventM.moveToObj.length; i --;) {
			var d = eventM.moveToObj[i];
			if (!d || !d.type) {
				eventM.removeMoveToObj(d);
				continue;
			}
			d._vy_tMov += c;
			if (d._vy_tMov >= serM.packetDelay + 20) {
				dfM.setPos(d, d._vy_xMov, d._vy_yMov);
				eventM.removeMoveToObj(d);
			} else dfM.setPos(d, d._vy_x + (d._vy_xMovD / (serM.packetDelay / c)), d._vy_y + (d._vy_yMovD / (serM.packetDelay / c)));
		}
		
		c /= 16.6667;
		for (var i = eventM.movementObj.length; i --;) {
			var d = eventM.movementObj[i];
			if (!d || !d.type || (!d._vy_movingX && !d._vy_movingY)) {
				eventM.removeMovementObj(d);
				continue;
			}
			var moveSet = d.moveSettings;
			if (moveSet.stepSize) {
				if (moveSet.stepTick) c = (pT - eventM.lastObjMove) / moveSet.stepTick;
				dfM.stepPos(d, d._vy_movingX * moveSet.stepSize * c, d._vy_movingY * moveSet.stepSize * c, true, '*', moveSet.stepSlide);
			}
		}
		eventM.lastObjMove = pT;
	};
	eventM.tickerObjects = [];
	eventM.addTicker = function(pO, pS) {
		if (eventM.tickerObjects.includes(pO)) return;
		eventM.tickerObjects.push(pO);
		pO._vy_tickT = pS;
		if (!pO._vy_tickT) pO._vy_tickT = {'c': 0};
		else pO._vy_tickT.c = 0;
		if (!pO._vy_tickT.delay) pO._vy_tickT.delay = 1;
		if (!pO._vy_tickT.resetAt) pO._vy_tickT.resetAt = 100;
		if (pO.onTickerAdd) pO.onTickerAdd();
		if (Object.getPrototypeOf(Object.getPrototypeOf(pO)) !== Diob.prototype) Object.defineProperty(pO, 'inTicker', eventM._inTicker);
	};
	eventM._inTicker = {
				get: function() {
					return this._vy_tickT;
				},
				set: function(pVal) {
					if (!pVal && this._vy_tickT) {
						eventM.removeTicker(this);
					}
				}
			};
	Object.defineProperty(Diob.prototype, 'inTicker', eventM._inTicker);
	eventM.removeTicker = function(pO) {
		var index = eventM.tickerObjects.indexOf(pO);
		if (index === -1) return;
		delete pO._vy_tickT;
		eventM.tickerObjects.splice(index, 1);
		if (pO.onTickerRemove) pO.onTickerRemove();
	};
	eventM.ticker = function() {
		var date = Date.now();
		var c = Math.max(Math.floor((date - eventM.lastTick) / eventM.tickerDelay), 1);
		eventM.lastTick = date;
		for (var cI = 0; cI < c; cI ++) {
			for (var i = eventM.tickerObjects.length; i --;) {
				var d = eventM.tickerObjects[i];
				d._vy_tickT.c ++;
				if (!(d._vy_tickT.c % d._vy_tickT.delay)) {
					if (d.onTick) d.onTick(d._vy_tickT.c);
					if (d._vy_tickT && d._vy_tickT.resetAt && d._vy_tickT.c >= d._vy_tickT.resetAt) {
						d._vy_tickT.c = 0;
						if (d._vy_tickT.resetEnd) eventM.removeTicker(d);
					}
				}
			}
		}
	};
	
	//onNew
	eventM.macros = {};
	eventM.keyDown = {};
	eventM.keysDown = [];
	//eventM.intervalDelay = 1;
};

function StaticManager() {
	stM = this;
	stM.JS = window || global;
	stM.Math = Math;
	stM.Math.getMatrix = function() {
		var matrix = [];
		for (var x = 0, xLen = arguments[0]; x < xLen; x ++) {
			matrix[x] = [];
			for (var y = 0, yLen = arguments[1]; y < yLen; y ++) {
				var num = parseFloat(arguments[x + y + 2]);
				if (!num) num = 0;
				matrix[x][y] = num;
			}
		}
		return matrix;
	};
	stM.Math.rand = function(pNum1, pNum2) {
		if (pNum2 === undefined) {
			if (pNum1 === undefined) {
				return Math.random();
			} else {
				return Math.floor(Math.random() * (pNum1 + 1));
			}
		} else {
			if (!pNum1) pNum1 = 0;
			return Math.floor(Math.random() * (pNum2 - pNum1 + 1) + pNum1);
		}
	};
	stM.Math.prob = function(pProb) {
		if (Math.random() <= pProb / 100) return true;
		return false;
	};
	stM.Date = new Date();
	stM.Date.newDate = function() {
		if (arguments[0]) return new Date(arguments[0]);
		return new Date();
	};
	stM.Date.now = Date.now;
	if (!stM.Date.now) {
		stM.Date.now = function() {
			return new Date().getTime();
		};
	}
	stM.World = {};
	stM.World.evalWebScript = function(pScript) {
		return eval.call(null, pScript);
	};
	stM.World.getGameSize = function() {
		return {'width': gameM.gameWidth, 'height': gameM.gameHeight};
	};
	stM.World.getGameVersion = function() {
		return gameM.gameVersion;
	};
	stM.World.getPlayerMode = function() {
		return gameM.playerMode;
	};
	stM.World.getHostAddress = function() {
		return 'localhost';
	};
	stM.World.sendMessage = function(pAddress, pMes, pCallback) {
		var xmlReq = new XMLHttpRequest();
		var prot = (pAddress.indexOf('http') !== 0)? 'https://' : '';
		xmlReq.open('GET', prot + pAddress + '/api?type=message&text=' + encodeURIComponent(pMes), true);
		if (pCallback) {
			xmlReq.onreadystatechange = function() {
				if (xmlReq.readyState == 4) {
					pCallback(0, xmlReq.responseText);
				}
			};
		}
		xmlReq.send();
	};
	stM.World.sendNotification = function(pName, pMessage, pFunc) {
		if (pFunc) funcM._callback(pFunc, [false, 'World.sendNotification only works in server code.']);
	};
	stM.World.checkSub = function(pName, pFunc) {
		if (pFunc) funcM._callback(pFunc, [false, 'World.checkSub only works in server code.']);
	};
	stM.World.getCodeType = function() {
		return 'local';
	};
	stM.World.getTileSize = function() {
		return {'width': _vy_t_xTileSize, 'height': _vy_t_yTileSize};
	};
	stM.World.getClients = function() {
		return [clientM.cOb];
	};
	stM.World.getServers = function(pFunc) {
		var arr = [];
		var xmlReq = new XMLHttpRequest();
		xmlReq.open('GET', 'https://' + mainM.webDomain + '/api?a=getServerList&gameID=' + encodeURIComponent(gameM.gameID) + '&trial=' + encodeURIComponent(gameM.trial), true);
		xmlReq.onreadystatechange = function() {
			if (xmlReq.readyState == 4) {
				if (xmlReq.status === 200) {
					var l = xmlReq.responseText.split(';');
					for (var i = 0, len = l.length; i < len; i ++) {
						var entry = l[i];
						if (!entry) continue;
						var s = entry.split('+');
						arr.push({'name': decodeURIComponent(s[1]), 'address': s[0], 'players': parseInt(s[2]), 'guests': parseInt(s[3])});
					}
				}
				if (pFunc) pFunc(arr);
			}
		};
		xmlReq.send();
	};
	stM.World.getWebContent = function(pLink, pFunc, pMime) {
		var xmlReq = new XMLHttpRequest();
		xmlReq.open('GET', pLink, true);
		if (pMime) xmlReq.overrideMimeType(pMime);
		xmlReq.onreadystatechange = function() {
			if (xmlReq.readyState == 4) {
				if (xmlReq.status === 200) {
					pFunc(xmlReq.responseText);
				} else if (pFunc) pFunc('');
			}
		};
		xmlReq.send();
	};
	stM.World.kickClient = location.reload;
	stM.World.shutdown = location.reload;
	stM.World.reboot = location.reload;
	stM.World.outputText = function(pText, pInt, pEl) {
		clientM.outputText(pText, pInt, pEl);
	};
	stM.World.playSound = function(pSound, pArr, pStart, pDuration) {
		if (!pArr || pArr.indexOf(clientM.cOb._vy_playerMob) !== -1) {
			return soundM.playSound(pSound, pStart, pDuration);
		}
	};
	stM.World.log = function(...pArgs) {
		console.log(...pArgs);
	};
	stM.World.getDiobs = function(pType, pChild) {
		var arr = [];
		for (var o in diobM.objects) {
			var obj = diobM.objects[o];
			if (!obj) continue;
			if (!pType || funcM._isType(obj._vy_type, pType, pChild)) {
				arr.push(obj);
			}
		}
		return arr;
	};
	stM.World.getDiobByID = function(pID) {
		return diobM.objects[pID];
	};
	stM.World.getDiobsByTag = function(pTag) {
		var arr = [];
		var t = diobM.tags[pTag];
		if (t) {
			for (var o in t) {
				arr.push(t[o]);
			}
		}
		return arr;
	};
	stM.World.getObjectsFromArray = function(pArr, pType, pChild) {
		if (!pArr) return [];
		var arr = [];
		for (var i = 0; i < pArr.length; i ++) {
			var obj = pArr[i];
			if (!obj) continue;
			if (!pType || funcM._isType(obj._vy_type, pType, pChild)) {
				arr.push(obj);
			}
		}
		return arr;
	};
	stM.World.getDiobsFromArray = stM.World.getObjectsFromArray;
	stM.World.openWebSocket = function(pAddress, pFunc, pSettings) {
		var f = function() {
			var socket = {'address': pAddress};
			socket.addEvent = function(pName, pFunc) {
				if (!serM.remConnections[this.address] || pName.toLowerCase() === 'connect' || pName.toLowerCase() === 'disconnect') return;
				serM.remConnections[this.address].on(pName, pFunc);
			};
			socket.send = function(pName, pData) {
				serM.remConnections[this.address].emit(pName, pData);
			};
			socket.close = function() {
				if (!serM.remConnections[this.address]) return;
				this.connected = false;
				serM.remConnections[this.address].disconnect();
				serM.remConnections[this.address] = undefined;
				serM.remSockets[this.address] = undefined;
			};
			
			mainM.io = io;
			setTimeout(function() {
				if (pSettings && pSettings.secure) {
					serM.remConnections[pAddress] = mainM.io.connect('https://' + pAddress, {'secure': true, 'force new connection': true});
				} else {
					serM.remConnections[pAddress] = mainM.io.connect(pAddress, {'force new connection': true});
				}
				serM.remSockets[pAddress] = socket;
				pFunc(socket);
				serM.remConnections[pAddress].on('connect', function() {
					socket.connected = true;
					if (socket.onConnect) socket.onConnect();
				});
				serM.remConnections[pAddress].on('disconnect', function() {
					socket.connected = false;
					if (socket.onDisconnect) socket.onDisconnect();
				});
				serM.remConnections[pAddress].on('error', function(pErr) {
					if (socket.onError) socket.onError(pErr);
				});
			}, 1);
		};
		if (serM.remSockets[pAddress] && serM.remSockets[pAddress].connected) return;
		f();
	};
	stM.World.hostWebSocket = function(pPort, pFunc) {
		var socket = {'port': pPort};
		socket.addEvent = function(pName, pFunc) {
			
		};
		socket.send = function(pName, pData) {

		};
		socket.clientSend = function(pClient, pName, pData) {
			
		};
		socket.clientClose = function(pClient) {
			
		};
		socket.getClients = function() {
			
		};
		socket.close = function() {

		};
		pFunc(socket);
	};
	stM.World.openMySQL = function(pDatabase) {
		
	};
	stM.World.getAddress = function() {
		return 'localhost';
	};
	stM.World.sendDiob = function(pD, pVar) {};
	stM.Resource = {};
	stM.Resource.loadResource = function(pType, pName, pFunc) {
		resM.loadResource(pType.substr(0, 3), pName, pFunc, true);
	};
	stM.Resource.getFileText = function(pName) {
		if (!resM.fileText[pName]) return;
		return resM.fileText[pName].text;
	};
	stM.Resource.setResource = function(pType, pName, pPath, pRemote) {
		var res = pType.substr(0, 3) + '_' + pName;
		resM.resources[res] = {'p': res, 'v': 0, 'f': pPath};
		if (pRemote) resM.resources[res].r = true;
	};
	stM.Resource.getResourcePath = function(pType, pName) {
		var r = pType.substr(0, 3) + '_' + pName;
		if (!resM.resources[r]) return;
		var res = resM.resources[r];
		return ((res.r)? res.f : serM.resourceServer + '/resources/' + res.f) + '?v=' + res.v;
	};
	stM.Util = {};
	stM.Util.handleCallback = function(pCallback) {
		return funcM._callback(pCallback);
	};
	stM.Util.copyObject = function(pO, pC, pD) {
		return stM.Util._copyObjectVars(pO, pC, pD);
	};
	stM.Util._copyObjectVars = function(pO, pC, pD, pS, pT) {
		for (var v in pC) {
			var cV = pC[v];
			if (cV !== undefined) {
				if ((pD && v.startsWith('_vy_')) || (pS && cV.constructor === Function) || (pT && cV && cV._vy_type)) continue;
				if (cV instanceof Object && (!pD || !cV._vy_type) && cV.constructor !== Function) {
					pO[v] = stM.Util._copyObjectVars((cV.constructor === Array)? [] : {}, cV, pD, pS, pT);
				} else pO[v] = cV;
			} else pO[v] = cV;
		}
		return pO;
	};
	stM.Util.getSaveObject = function(pS, pO) {
		return stM.Util._copyObjectVars(pO || {}, pS, 1, 1, 1);
	};
	stM.Util.getObjectKeys = Object.keys;
	stM.Util.getObjectValues = Object.values;
	stM.Util.getVariableType = function(pVar) {
		return typeof(pVar);
	};
	stM.Util.isObject = function(pVal) {
		if (typeof(pVal) === 'object' && pVal !== null) return true;
		return false;
	};
	stM.Util.isNumber = function(pVal) {
		var t = typeof(pVal);
		if (t === 'number' && !isNaN(pVal)) return true;
		else return false;
	};
	stM.Util.isString = function(pVal) {
		var t = typeof(pVal);
		if (t === 'string') return true;
		else return false;
	};
	stM.Util.isArray = function(pVal) {
		if (pVal && pVal.constructor === Array) return true;
		else return false;
	};
	stM.Util.isFunction = function(pVal) {
		return !!(pVal && pVal.constructor && pVal.call && pVal.apply);
	};
	stM.Util.toNumber = Number;
	stM.Util.toString = JSON.stringify;
	stM.Util.parseInt = parseInt;
	stM.Util.parseFloat = parseFloat;
	stM.Util.getCharFromCode = String.fromCharCode;
	stM.Util.pick = function(pVal1, pVal2) {
		var arr = (Array.isArray(pVal1) && !pVal2)? pVal1 : arguments;
		if (!arr.length) return;
		var i = Math.floor(Math.random() * arr.length);
		return arr[i];
	};
	stM.Util.regExp = function(pPattern, pFlags) {
		if (!pFlags) return new RegExp(pPattern);
		return new RegExp(pPattern, pFlags);
	};
	stM.Util.encodeWebTags = function(pText) {
		return pText.replace(/\</g, '&lt;').replace(/\>/g, '&gt;').replace(/\//g, '&#47;');
	};
	stM.Util.stringToObject = function(pString) {
		return JSON.parse(pString);
	};
	stM.Util.arrayBufferToBase64 = function(pArrBuff) {
		var binary = '';
		var bytes = new Uint8Array(pArrBuff);
		for (var i = 0, len = bytes.byteLength; i < len; i ++) {
			binary += String.fromCharCode(bytes[i]);
		}
		return btoa(binary);
	};
	stM.Util.encodeURI = function(pText) {
		return encodeURI(pText);
	};
	stM.Util.decodeURI = function(pText) {
		return decodeURI(pText);
	};
	stM.Util.encodeURIComponent = function(pText) {
		return encodeURIComponent(pText);
	};
	stM.Util.decodeURIComponent = function(pText) {
		return decodeURIComponent(pText);
	};
	stM.Util.toDegrees = function(pRad) {
		return pRad * 180 / Math.PI;
	};
	stM.Util.toRadians = function(pDeg) {
		return pDeg * Math.PI / 180;
	};
	stM.Util.gzUnzip = function(pData) {
		return pako.inflate(xmlReq.response, {to: 'string'});
	};
	stM.Util.getWebStyle = function(pStyle) {
		return mainM.getWebStyle(pStyle);
	};
	stM.Event = {};
	stM.Event.addTicker = eventM.addTicker;
	stM.Event.removeTicker = eventM.removeTicker;
	stM.Event.getTickers = function() {
		return eventM.tickerObjects.slice(0);
	};
	stM.Event.toggleTicker = function(pBool) {
		if (pBool === undefined && !eventM.tickerInterval) pBool = true;
		if (pBool) {
			if (!eventM.tickerInterval) {
				eventM.lastTick = Date.now();
				eventM.tickerInterval = setInterval(eventM.ticker, eventM.tickerDelay);
			}
		} else {
			clearInterval(eventM.tickerInterval);
			delete eventM.tickerInterval;
		}
	};
	stM.Event.interruptSpawn = function(pVal) {
		clearTimeout(pVal);
	};
	stM.Event.interruptThread = function(pVal) {
		clearInterval(pVal);
	};
	stM.Event.interpolatePos = function(pD, pX, pY) {
		dfM.setPos(pD, pX, pY);
	};
	stM.Map = {};
	stM.Map.dirs = ['east', 'northeast', 'north', 'northwest', 'west', 'southwest', 'south', 'southeast'];
	stM.Map._dirs = ['east', 'northeast', 'northeast', 'north', 'north', 'northwest', 'northwest', 'west', 'west', 'southwest', 'southwest', 'south', 'south', 'southeast', 'southeast', 'east'];
	stM.Map._cDirs = ['east', 'east', 'north', 'north', 'north', 'north', 'west', 'west', 'west', 'west', 'south', 'south', 'south', 'south', 'east', 'east'];
	stM.Map.getMaps = function() {
		var arr = [];
		for (var o in resM.maps) {
			if (o) arr.push(o);
		}
		return arr;
	};
	stM.Map.getClients = function(pMap) {
		if (!clientM.cOb._vy_playerMob || clientM.cOb._vy_playerMob._vy_mapN !== pMap) return [];
		return [clientM.cOb];
	};
	stM.Map.sendDiob = function(pMap, pD, pVar) {};
	stM.Map.getAngle = function(pA, pB, pCenter) {
		if (!pA) return;
		if (!pB) return pA.angle;
		return stM.Map._getAngle(pA, pB, pCenter);
	};
	stM.Map._getAngle = function(pA, pB, pCenter) {
		if (pCenter) return (Math.atan2((((pB.yOrigin)? (pB.yPos + pB.yOrigin) : pB.yPos) + Math.round(((pB.height)? pB.height : gameM.tileSize.height) / 2)) - (((pA.yOrigin)? (pA.yPos + pA.yOrigin) : pA.yPos) + Math.round(((pA.height)? pA.height : gameM.tileSize.height) / 2)), (((pA.xOrigin)? (pA.xPos + pA.xOrigin) : pA.xPos) + Math.round(((pA.width)? pA.width : gameM.tileSize.width) / 2)) - (((pB.xOrigin)? (pB.xPos + pB.xOrigin) : pB.xPos) + Math.round(((pB.width)? pB.width : gameM.tileSize.width) / 2))) + Math.PI);
		return (Math.atan2(((pB.yOrigin)? (pB.yPos + pB.yOrigin) : pB.yPos) - ((pA.yOrigin)? (pA.yPos + pA.yOrigin) : pA.yPos), ((pA.xOrigin)? (pA.xPos + pA.xOrigin) : pA.xPos) - ((pB.xOrigin)? (pB.xPos + pB.xOrigin) : pB.xPos)) + Math.PI);
	};
	stM.Map.getDir = function(pA, pB, pCenter, pCard) {
		if (!pA) return;
		if (!pB) return pA.dir;
		var angle = stM.Map._getAngle(pA, pB, pCenter) * 180 / Math.PI;
		if (angle >= 360) angle = 0;
		else if (angle < 0) angle = 360 + angle;
		if (pCard) return stM.Map._cDirs[Math.floor(angle / 22.5)];
		return stM.Map._dirs[Math.floor(angle / 22.5)];
	};
	stM.Map.getDirByAngle = function(pD, pAngle) {
		var dir = 'east';
		if (pD) dir = pD.dir;
		if (!pAngle) return dir;
		var i = stM.Map.dirs.indexOf(dir);
		if (i === undefined) return dir;
		pAngle = (i * 45) + (pAngle * 180 / Math.PI);
		if (pAngle >= 360 || pAngle <= -360) pAngle = pAngle % 360;
		if (pAngle < 0) pAngle += 360;
		return stM.Map._dirs[Math.floor(pAngle / 22.5)];
	};
	stM.Map.setRegion = function(pL, pR) {
		if (!pL || !pL.xCoord || !pL.yCoord || !pL.mapName) return;
		var loc = stM.Map.getLoc(pL.xCoord, pL.yCoord, pL.mapName);
		if (!loc) return;
		if (!pR) pR = 'Region';
		var region = pR;
		if (typeof(pR) === 'string') {
			region = diobM.regions[pR];
			if (!region) return;
		} else if (!pR._vy_isRegion) return;
		loc._vy_region = region;
		scrM.refreshTileScreen = true;
	};
	stM.Map.getRegionByType = function(pType) {
		return diobM.regions[pType];
	};
	stM.Map.getDiobsByRegion = function(pR, pType, pChild, pMap) {
		if (!pR) return;
		var region;
		if (typeof(pR) === 'string') region = diobM.regions[pR];
		else {
			for (var i in diobM.regions) {
				if (diobM.regions[i] === pR) {
					region = diobM.regions[i];
					break;
				}
			}
			if (!region) return;
		}
		var diobs = [];
		if (pMap) {
			var map = resM.maps[pMap];
			if (!map) return;
			for (var y = 1, yLen = map.yMax; y <= yLen; y ++) {
				for (var x = 1, xLen = map.xMax; x <= xLen; x ++) {
					var t = map.tiles[x + xLen * y];
					if (!t || t._vy_region !== region) continue;
					diobs.push(t);
					for (var i2 in t.contents) {
						var c = t.contents[i2];
						if (!c || c.loc !== t) continue;
						diobs.push(c);
					}
				}
			}
		} else {
			for (var o in diobM.objects) {
				var obj = diobM.objects[o];
				if (!obj || obj.region !== region || obj._vy_isRegion) continue;
				if (!pType || obj._vy_type === pType || (pChild && obj._vy_type.indexOf(pType) === 0 && obj._vy_type.length > pType.length && obj._vy_type[pType.length] === '/')) {
					diobs.push(obj);
				}
			}
		}
		return diobs;
	};
	stM.Map.getDiobsByTag = function(pTag, pMap) {
		if (!pMap) return stM.World.getDiobsByTag(pTag);
		var diobs = [];
		var map = resM.maps[pMap];
		if (!map) return diobs;
		for (var y = 1, yLen = map.yMax; y <= yLen; y ++) {
			for (var x = 1, xLen = map.xMax; x <= xLen; x ++) {
				var t = map.tiles[x + xLen * y];
				if (!t) continue;
				if (t._vy_tag === pTag) diobs.push(t);
				for (var i2 in t.contents) {
					var c = t.contents[i2];
					if (!c || c._vy_tag !== pTag) continue;
					diobs.push(c);
				}
			}
		}
		return diobs;
	};
	stM.Map.getLoc = function(pVal1, pVal2, pVal3) {
		if (!pVal1) return;
		var tile;
		if (typeof(pVal1) === 'number') {
			if (!pVal2 || !pVal3) return;
			var map = resM.maps[pVal3];
			if (map) tile = map.tiles[pVal1 + map.xMax * pVal2];
		} else {
			if (pVal1._vy_isLoc) tile = pVal1;
			else tile = pVal1.loc;
		}
		return tile;
	};
	stM.Map.setLoc = function(pL, pT) {
		if (!pL || !pT || !pL.xCoord || !pL.yCoord || !pL.mapName) return;
		var loc = stM.Map.getLoc(pL.xCoord, pL.yCoord, pL.mapName);
		var map = resM.maps[pL.mapName];
		if (!loc || !map) return;
		var tile = (typeof(pT) === 'string')? newDiob(diobM.objectType[pT], 0, true) : pT;
		if (!tile._vy_isLoc) return;
		tile._vy_mapN = pL.mapName;
		tile._vy_region = loc._vy_region;
		//dfM.setCoords(tile, pL.xCoord, pL.yCoord, 0, 0, 1);
		tile._vy_x = (pL.xCoord - 1) * _vy_t_xTileSize;
		tile._vy_y = (pL.yCoord - 1) * _vy_t_yTileSize;
		if (loc._vy_conts) {
			var contents = loc._vy_conts.slice(0);
			for (var i = 0, len = contents.length; i < len; i ++) {
				var d = contents[i];
				if (d._vy_loc && d._vy_loc === loc) d._vy_loc = tile;
				dfM.removeFromContents(loc, d);
				dfM.addToContents(tile, d);
			}
		}
		map.tiles[pL.xCoord + map.xMax * pL.yCoord] = tile;
		if (tile.onNew && typeof(pT) === 'string') {
			if (!mainM.isInitialized) resM.diobNewQueue.push(tile);
			else diobM.diobOnNew(tile);
		}
		if (loc._vy_onScr) {
			scrM.removeFromScreen(loc);
			scrM.addToScreen(tile);
		}
		dfM.setID(tile, loc._vy_id);
		loc._vy_isLoc = 0;
		loc._vy_id = 0;
		if (loc.onDel) loc.onDel();
		diobM.deleteDiob(loc);
		diobM.objects[tile._vy_id] = tile;
		return tile;
	};
	stM.Map.getLocByDir = function(pL, pDir) {
		if (!pDir) return;
		var x = 0;
		if (pDir.indexOf('east') !== -1) x = 1;
		else if (pDir.indexOf('west') !== -1) x = -1;
		var y = 0;
		if (pDir.indexOf('south') !== -1) y = 1;
		else if (pDir.indexOf('north') !== -1) y = -1;
		var tile = stM.Map.getLoc(pL.xCoord + x, pL.yCoord + y, pL.mapName);
		if (!tile) tile = resM.voidTile;
		return tile;
	};
	stM.Map.getLocByPos = function(pX, pY, pMap) {
		return stM.Map.getLoc(Math.floor(pX / _vy_t_xTileSize) + 1, Math.floor(pY / _vy_t_yTileSize) + 1, pMap);
	};
	stM.Map.getDist = function(pA, pB, pEdge) {
		if (!pA || !pB || pA.xPos === undefined || pA.yPos === undefined || pB.xPos === undefined || pB.yPos === undefined) return;
		var wA = ((pA.width)? pA.width : gameM.tileSize.width) / 2;
		var hA = ((pA.height)? pA.height : gameM.tileSize.height) / 2;
		var wB = ((pB.width)? pB.width : gameM.tileSize.width) / 2;
		var hB = ((pB.height)? pB.height : gameM.tileSize.height) / 2;
		if (pEdge) {
			var alterA = stM.Map._getDistArr[stM.Map.dirs.indexOf(stM.Map.getDir(pA, pB, true))];
			var alterB = stM.Map._getDistArr[stM.Map.dirs.indexOf(stM.Map.getDir(pB, pA, true))];
			wA = (wA * 2 * alterA[0]);
			hA = (hA * 2 * alterA[1]);
			wB = (wB * 2 * alterB[0]);
			hB = (hB * 2 * alterB[1]);
		}
		var xA = (pA.xOrigin)? pA.xPos + pA.xOrigin : pA.xPos;
		var yA = (pA.yOrigin)? pA.yPos + pA.yOrigin : pA.yPos;
		var xB = (pB.xOrigin)? pB.xPos + pB.xOrigin : pB.xPos;
		var yB = (pB.yOrigin)? pB.yPos + pB.yOrigin : pB.yPos;
		return Math.sqrt(Math.pow((xB + wB) - (xA + wA), 2) + Math.pow((yB + hB) - (yA + hA), 2));
	};
	stM.Map._getDistArr = [[1, 0.5], [1, 0], [0.5, 0], [0, 0], [0, 0.5], [0, 1], [0.5, 1], [1, 1]];
	stM.Map.pixelDist = stM.Map.getDist;
	stM.Map.getTileDist = function(pA, pB) {
		if (!pA || !pB || !pA.xCoord || !pA.yCoord || !pB.xCoord || !pB.yCoord) return;
		return Math.max(Math.abs(pB.xCoord - pA.xCoord), Math.abs(pB.yCoord - pA.yCoord));
	};
	stM.Map.tileDist = stM.Map.getTileDist;
	stM.Map.getRange = function(pO, pVal1, pVal2, pOmit) {
		if (!pO) return [];
		if (!pO._vy_type) pO = stM.Map.getLoc(pO.x, pO.y, pO.map);
		return stM.Map._range(pO, pVal1, pVal2, pOmit);
	};
	stM.Map.pixelRange = stM.Map.getRange;
	stM.Map.getRangeByType = function(pO, pType, pChild, pVal1, pVal2, pOmit) {
		if (!pO) return [];
		if (!pO._vy_type) pO = stM.Map.getLoc(pO.x, pO.y, pO.map);
		return stM.Map._range(pO, pVal1, pVal2, pOmit, pType, pChild);
	};
	stM.Map.pixelRangeByType = stM.Map.getRangeByType;
	stM.Map.getRangeView = function(pO, pVal1, pVal2, pOmit) {
		if (!pO) return [];
		if (!pO._vy_type) pO = stM.Map.getLoc(pO.x, pO.y, pO.map);
		return stM.Map._range(pO, pVal1, pVal2, pOmit, null, null, 1);
	};
	stM.Map.pixelRangeView = stM.Map.getRangeView;
	stM.Map.getRangeViewByType = function(pO, pType, pChild, pVal1, pVal2, pOmit) {
		if (!pO) return [];
		if (!pO._vy_type) pO = stM.Map.getLoc(pO.x, pO.y, pO.map);
		return stM.Map._range(pO, pVal1, pVal2, pOmit, pType, pChild, 1);
	};
	stM.Map.pixelRangeViewByType = stM.Map.getRangeViewByType;
	stM.Map.getRangeViewers = function(pO, pVal1, pVal2, pOmit) {
		if (!pO) return [];
		if (!pO._vy_type) pO = stM.Map.getLoc(pO.x, pO.y, pO.map);
		return stM.Map._range(pO, pVal1, pVal2, pOmit, null, null, 2);
	};
	stM.Map.pixelRangeViewers = stM.Map.getRangeViewers;
	stM.Map.getRangeViewersByType = function(pO, pType, pChild, pVal1, pVal2, pOmit) {
		if (!pO) return [];
		if (!pO._vy_type) pO = stM.Map.getLoc(pO.x, pO.y, pO.map);
		return stM.Map._range(pO, pVal1, pVal2, pOmit, pType, pChild, 2);
	};
	stM.Map.pixelRangeViewersByType = stM.Map.getRangeViewersByType;
	stM.Map._range = function(pD, pVal1, pVal2, pOmit, pType, pChild, pVis) {
		var map = resM.maps[pD._vy_mapN];
		if (typeof(pD) !== 'object' || !map) return [];
		if (pD._vy_x === undefined || pD._vy_y === undefined) return [];
		if (!pVal1) pVal1 = 0;
		if (pVal1 < 0) pVal1 = 0;
		if (pVal2 === undefined) pVal2 = pVal1;
		else if (pVal2 < 0) pVal2 = 0;
		var arr = [],
			xTile = Math.floor(pVal1 / _vy_t_xTileSize) + 1,
			yTile = Math.floor(pVal2 / _vy_t_yTileSize) + 1,
			xCo = Math.floor(pD._vy_x / _vy_t_xTileSize) + 1,
			yCo = Math.floor(pD._vy_y / _vy_t_yTileSize) + 1;
		for (var x = 0 - xTile, xLen = xTile + pD._vy_xTiles - 1; x <= xLen; x ++) {
			for (var y = 0 - yTile, yLen = yTile + pD._vy_yTiles - 1; y <= yLen; y ++) {
				var tile = map.tiles[xCo + x + map.xMax * (yCo + y)];
				if (tile && tile._vy_conts) {
					for (var i = tile._vy_conts.length; i --;) {
						var obj = tile._vy_conts[i];
						if (!obj || !obj._vy_type) continue;
						if (obj === pD && pOmit) continue;
						if (obj._vy_x + obj._vy_xOr + obj._vy_w <= pD._vy_x - pVal1 || obj._vy_x >= pD._vy_x + pD._vy_xOr + pD._vy_w + pVal1 || obj._vy_y + obj._vy_yOr + obj._vy_h <= pD._vy_y - pVal2 || obj._vy_y >= pD._vy_y + pD._vy_yOr + pD._vy_h + pVal2) continue;
						if (!pType || funcM._isType(obj._vy_type, pType, pChild)) {
							if (pVis === 1 && obj._vy_invisibility > pD._vy_visibility && obj._vy_viewers.indexOf(pD) === -1) continue;
							if (pVis === 2 && pD._vy_invisibility > obj._vy_visibility && pD._vy_viewers.indexOf(obj) === -1) continue;
							if (arr.indexOf(obj) === -1) arr.push(obj);
						}
					}
				}
			}
		}
		return arr;
	};
	stM.Map.getTileRange = function(pO, pVal1, pVal2, pOmit) {
		if (!pO) return [];
		if (!pO._vy_type) pO = stM.Map.getLoc(pO.x, pO.y, pO.map);
		return stM.Map._tileRange(pO, pVal1, pVal2, pOmit);
	};
	stM.Map.tileRange = stM.Map.getTileRange;
	stM.Map.getTileRangeByType = function(pO, pType, pChild, pVal1, pVal2, pOmit) {
		if (!pO) return [];
		if (!pO._vy_type) pO = stM.Map.getLoc(pO.x, pO.y, pO.map);
		return stM.Map._tileRange(pO, pVal1, pVal2, pOmit, pType, pChild);
	};
	stM.Map.tileRangeByType = stM.Map.getTileRangeByType;
	stM.Map.getTileRangeView = function(pO, pVal1, pVal2, pOmit) {
		if (!pO) return [];
		if (!pO._vy_type) pO = stM.Map.getLoc(pO.x, pO.y, pO.map);
		return stM.Map._tileRange(pO, pVal1, pVal2, pOmit, null, null, 1);
	};
	stM.Map.tileRangeView = stM.Map.getTileRangeView;
	stM.Map.getTileRangeViewByType = function(pO, pType, pChild, pVal1, pVal2, pOmit) {
		if (!pO) return [];
		if (!pO._vy_type) pO = stM.Map.getLoc(pO.x, pO.y, pO.map);
		return stM.Map._tileRange(pO, pVal1, pVal2, pOmit, pType, pChild, 1);
	};
	stM.Map.tileRangeViewByType = stM.Map.getTileRangeViewByType;
	stM.Map.getTileRangeViewers = function(pO, pVal1, pVal2, pOmit) {
		if (!pO) return [];
		if (!pO._vy_type) pO = stM.Map.getLoc(pO.x, pO.y, pO.map);
		return stM.Map._tileRange(pO, pVal1, pVal2, pOmit, null, null, 2);
	};
	stM.Map.tileRangeViewers = stM.Map.getTileRangeViewers;
	stM.Map.getTileRangeViewersByType = function(pO, pType, pChild, pVal1, pVal2, pOmit) {
		if (!pO) return [];
		if (!pO._vy_type) pO = stM.Map.getLoc(pO.x, pO.y, pO.map);
		return stM.Map._tileRange(pO, pVal1, pVal2, pOmit, pType, pChild, 2);
	};
	stM.Map.tileRangeViewersByType = stM.Map.getTileRangeViewersByType;
	stM.Map._tileRange = function(pD, pVal1, pVal2, pOmit, pType, pChild, pVis) {
		var map = resM.maps[pD._vy_mapN];
		if (typeof(pD) !== 'object' || !map) return [];
		if (pD._vy_x === undefined || pD._vy_y === undefined) return [];
		if (!pVal1) pVal1 = 0;
		if (pVal2 === undefined) pVal2 = pVal1;
		if (pVal1 < 0) pVal1 = 0;
		if (pVal2 < 0) pVal2 = 0;
		var arr = [],
			xCo = Math.floor(pD._vy_x / _vy_t_xTileSize) + 1,
			yCo = Math.floor(pD._vy_y / _vy_t_yTileSize) + 1;
		for (var x = 0 - pVal1, xLen = pVal1 + pD._vy_xTiles - 1; x <= xLen; x ++) {
			for (var y = 0 - pVal2, yLen = pVal2 + pD._vy_yTiles - 1; y <= yLen; y ++) {
				var tile = map.tiles[xCo + x + map.xMax * (yCo + y)];
				if (tile && tile._vy_conts) {
					for (var i = tile._vy_conts.length; i --;) {
						var obj = tile._vy_conts[i];
						if (!obj || !obj._vy_type) continue;
						if (obj === pD && pOmit) continue;
						if (!pType || funcM._isType(obj._vy_type, pType, pChild)) {
							if (pVis === 1 && obj._vy_invisibility > pD._vy_visibility && obj._vy_viewers.indexOf(pD) === -1) continue;
							if (pVis === 2 && pD._vy_invisibility > obj._vy_visibility && pD._vy_viewers.indexOf(obj) === -1) continue;
							if (arr.indexOf(obj) === -1) arr.push(obj);
						}
					}
				}
			}
		}
		return arr;
	};
	stM.Map.getDiobs = function(pMap, pType, pChild, pAdd) {
		var arr = [];
		if (!pMap) return arr;
		if (!resM.maps[pMap]) resM.loadMap(pMap);
		if (!resM.maps[pMap]) return arr;
		var map = resM.maps[pMap];
		if (!map) return [];
		for (var y = 1, yLen = map.yMax; y <= yLen; y ++) {
			for (var x = 1, xLen = map.xMax; x <= xLen; x ++) {
				var t = map.tiles[x + map.xMax * y];
				if (!t) continue;
				if (pAdd) {
					if (!pType || funcM._isType(t._vy_type, pType, pChild)) {
						arr.push(t);
					}
					if ((!pType || funcM._isType(t.region._vy_type, pType, pChild)) && arr.includes(t._vy_region)) {
						if (!arr.includes(t._vy_region)) arr.push(t._vy_region);
					}
				}
				for (var i2 in t.contents) {
					var c = t.contents[i2];
					if (!c || c.loc !== t) continue;
					if (!pType || funcM._isType(c._vy_type, pType, pChild)) {
						if (!arr.includes(c)) arr.push(c);
					}
				}
			}
		}
		return arr;
	};
	stM.Map.getDiobsByPos = function(pMap, pX, pY, pX2, pY2, pType, pChild, pAdd) {
		var arr = [];
		if (!pX2) pX2 = pX;
		if (!pY2) pY2 = pY;
		var x = Math.floor(pX / _vy_t_xTileSize) + 1;
		var y = Math.floor(pY / _vy_t_yTileSize) + 1;
		var tiles = stM.Map.getTiles(pMap, x, y, Math.floor(pX2 / _vy_t_xTileSize) + 1 - x, Math.floor(pY2 / _vy_t_yTileSize) + 1 - y);
		for (var i = 0, len = tiles.length; i < len; i ++) {
			var t = tiles[i];
			if (pAdd) {
				if (!pType || funcM._isType(t._vy_type, pType, pChild)) {
					arr.push(t);
				}
				if ((!pType || funcM._isType(t.region._vy_type, pType, pChild)) && arr.includes(t._vy_region)) {
					if (!arr.includes(t._vy_region)) arr.push(t._vy_region);
				}
			}
			if (!t._vy_conts) continue
			for (var c = 0, cLen = t._vy_conts.length; c < cLen; c ++) {
				var d = t._vy_conts[c];
				if (d._vy_x + d._vy_xOr + d._vy_w < pX || d._vy_x + d._vy_xOr > pX2 || d._vy_y + d._vy_yOr + d._vy_h < pY || d._vy_y + d._vy_yOr > pY2) continue;
				if (!pType || funcM._isType(d._vy_type, pType, pChild)) {
					if (!arr.includes(d)) arr.push(d);
				}
			}
		}
		return arr;
	};
	stM.Map.getScreenDiobs = function(pType, pChild, pAdd) {
		var arr = [];
		for (var i = 0, len = scrM.planesArr.length; i < len; i ++) {
			var plane = scrM.planesArr[i];
			for (var i2 = plane._vy_planeDis.length; i2 --;) {
				var d = plane._vy_planeDis[i2];
				if (!pType || funcM._isType(d._vy_type, pType, pChild)) {
					arr.push(d);
				}
			}
		}
		if (pAdd) {
			for (var i = 0, len = scrM.screenTiles.length; i < len; i ++) {
				var tile = scrM.screenTiles[i];
				if (!pType || funcM._isType(tile._vy_type, pType, pChild)) {
					arr.push(tile);
				}
				if (!pType || funcM._isType(tile._vy_region._vy_type, pType, pChild)) {
					if (!arr.includes(tile._vy_region)) arr.push(tile._vy_region);
				}
			}
		}
		return arr;
	};
	stM.Map.getTiles = function(pMap, pX, pY, pW, pH) {
		var arr = [];
		if (!pMap) return arr;
		var map = resM.maps[pMap];
		if (!map) resM.loadMap(pMap);
		if (!map) return arr;
		if (!pX || !pY) {
			for (var y = 1, yLen = map.yMax; y <= yLen; y ++) {
				for (var x = 1, xLen = map.xMax; x <= xLen; x ++) {
					arr.push(map.tiles[x + map.xMax * y]);
				}
			}
		} else {
			if (!pW) pW = 0;
			if (!pH) pH = 0;
			var sX = (pW < 0)? pX + pW : pX;
			var sY = (pH < 0)? pY + pH : pY;
			var eX = (pW < 0)? pX : pX + pW;
			var eY = (pH < 0)? pY : pY + pH;
			for (var x = sX; x <= eX; x ++) {
				for (var y = sY; y <= eY; y ++) {
					var tile = map.tiles[x + map.xMax * y];
					if (tile) arr.push(tile);
				}
			}
		}
		return arr;
	};
	stM.Map.getTilesByRange = function(pD, pVal1, pVal2, pType, pChild, pOmit) {
		var map = resM.maps[pD._vy_mapN];
		if (typeof(pD) !== 'object' || !map) return [];
		if (pD._vy_x === undefined || pD._vy_y === undefined) return [];
		if (!pD._vy_type) pD = stM.Map.getLoc(pD.x, pD.y, pD.map);
		if (!pVal1) pVal1 = 0;
		if (pVal1 < 0) pVal1 = 0;
		if (pVal2 === undefined) pVal2 = pVal1;
		else if (pVal2 < 0) pVal2 = 0;
		var arr = [],
			xTile = Math.floor(pVal1 / _vy_t_xTileSize) + 1,
			yTile = Math.floor(pVal2 / _vy_t_yTileSize) + 1,
			xCo = Math.floor(pD._vy_x / _vy_t_xTileSize) + 1,
			yCo = Math.floor(pD._vy_y / _vy_t_yTileSize) + 1;
		for (var x = 0 - xTile, xLen = xTile + pD._vy_xTiles - 1; x <= xLen; x ++) {
			for (var y = 0 - yTile, yLen = yTile + pD._vy_yTiles - 1; y <= yLen; y ++) {
				var tile = map.tiles[xCo + x + map.xMax * (yCo + y)];
				if (tile) {
					if (tile._vy_x + _vy_t_xTileSize <= pD._vy_x - pVal1 || tile._vy_x >= pD._vy_x + pD._vy_xOr + pD._vy_w + pVal1 || tile._vy_y + _vy_t_yTileSize <= pD._vy_y - pVal2 || tile._vy_y >= pD._vy_y + pD._vy_yOr + pD._vy_h + pVal2) continue;
					if (tile === pD && pOmit) continue;
					if (!pType || funcM._isType(tile._vy_type, pType, pChild)) {
						if (arr.indexOf(tile) === -1) arr.push(tile);
					}
				}
			}
		}
		return arr;
	};
	stM.Map.setMapSize = function(pMap, pW, pH, pTile) {
		var map = resM.maps[pMap];
		if (!pMap || !map) return;
		if (!pW) pW = 0;
		if (pH === undefined) pH = pW;
		if (!pTile) pTile = 'Tile';
		var tiles = map.tiles.slice(),
			oX = map.xMax,
			oY = map.yMax,
			remTiles = [];
		map.tiles = new Array(pW + pW * pH);
		map.xMax = pW;
		map.yMax = pH;
		if (pW < oX) {
			for (var x = oX, xLen = pW + 1; x >= xLen; x --) {
				for (var y = oY; y >= 1; y --) {
					var tile = tiles[x + oX * y];
					if (tile._vy_conts) {
						for (var i = tile._vy_conts.length; i --;) {
							diobM.deleteDiob(tile._vy_conts[i]);
						}
					}
					diobM.deleteDiob(tile);
					remTiles.push(tile);
				}
			}
		} else if (pW > oX) {
			for (var x = oX + 1, xLen = pW; x <= xLen; x ++) {
				for (var y = 1; y <= pH; y ++) {
					var obj = resM.newMapTile(map, pTile, x, y);
					if (obj.onNew) {
						if (!mainM.isInitialized) resM.diobNewQueue.push(obj);
						else diobM.diobOnNew(obj);
					}
				}
			}
		}
		if (pH < oY) {
			for (var x = oX; x >= 1; x --) {
				for (var y = oY, yLen = pH + 1; y >= yLen; y --) {
					var tile = tiles[x + oX * y];
					if (tile._vy_conts) {
						for (var i = tile._vy_conts.length; i --;) {
							diobM.deleteDiob(tile._vy_conts[i]);
						}
					}
					diobM.deleteDiob(tile);
					remTiles.push(tile);
				}
			}
		} else if (pH > oY) {
			for (var x = 1; x <= pW; x ++) {
				for (var y = oX + 1, yLen = pH; y <= yLen; y ++) {
					var obj = resM.newMapTile(map, pTile, x, y);
					if (obj.onNew) {
						if (!mainM.isInitialized) resM.diobNewQueue.push(obj);
						else diobM.diobOnNew(obj);
					}
				}
			}
		}
		for (var i = tiles.length; i --;) {
			var tile = tiles[i];
			if (tile && !remTiles.includes(tile)) map.tiles[Math.floor(tile._vy_x / _vy_t_xTileSize) + 1 + pW * (Math.floor(tile._vy_y / _vy_t_yTileSize) + 1)] = tile;
		}
		map.xMaxWidth = pW * _vy_t_xTileSize;
		map.yMaxHeight = pH * _vy_t_yTileSize;
		if (resM.map === map && !scrM.pauseDraw) {
			scrM.clearScreen();
			scrM.setViewFromObject(scrM.viewEye, true, true);
		}
	};
	stM.Map.getMapSize = function(pMap) {
		if (!pMap) return {'x': 0, 'y': 0, 'xPos': 0, 'yPos': 0};
		if (!resM.maps[pMap]) resM.loadMap(pMap);
		if (!resM.maps[pMap]) return {'x': 0, 'y': 0, 'xPos': 0, 'yPos': 0};
		return {'x': resM.maps[pMap].xMax, 'y': resM.maps[pMap].yMax, 'xPos': resM.maps[pMap].xMaxWidth, 'yPos': resM.maps[pMap].yMaxHeight};
	};
	stM.Map.createMap = function(pName, pX, pY, pTile) {
		resM.createMap(pName, pX, pY, pTile);
	};
	stM.Map.cloneMap = function(pMap, pName, pFunc) {
		resM.cloneMap(pMap, pName, pFunc);
	};
	stM.Map.deleteMap = function(pName) {
		resM.deleteMap(pName);
	};
	stM.File = {};
	stM.File.makeDir = function(pPath, pFunc) {
		if (pFunc) funcM._callback(pFunc);
	};
	stM.File.getDir = function(pPath, pFunc) {
		if (pFunc) funcM._callback(pFunc);
	};
	stM.File.getStats = function(pPath, pFunc) {
		if (pFunc) funcM._callback(pFunc);
	};
	stM.File.remove = function(pPath, pFunc) {
		if (pFunc) funcM._callback(pFunc);
	};
	stM.File.appendText = function(pFile, pData, pFunc) {
		if (pFunc) funcM._callback(pFunc, 'Unable to append text.');
	};
	stM.File.writeText = function(pFile, pData, pFunc) {
		if (pFunc) funcM._callback(pFunc, 'Unable to write text.');
	};
	stM.File.readText = function(pFile, pFunc) {
		if (pFunc) funcM._callback(pFunc, [0, 'Unable to read text.']);
	};
	stM.File.writeSave = function(pFile, pSave, pFunc) {
		if (pFunc) funcM._callback(pFunc, 'Unable to write save.');
	};
	stM.File.readSave = function(pFile, pFunc) {
		if (pFunc) funcM._callback(pFunc, [0, 'Unable to read save.']);
	};
	stM.File.exists = function(pFile, pFunc) {
		if (pFunc) funcM._callback(pFunc, 0);
	};
	stM.Icon = {};
	stM.Icon.newAtlas = function(pAtlas) {
		if (!pAtlas || resM.resImg[pAtlas]) return;
		resM.resImg[pAtlas] = {};
		resM.loadedAtlases[pAtlas] = {'loading': false};
	};
	stM.Icon.newIcon = function(pAtlas, pIcon, pWidth, pHeight, pData) {
		if (!pAtlas || !resM.resImg[pAtlas]) return;
		if (!pWidth) pWidth = _vy_t_xTileSize;
		if (!pHeight) pHeight = _vy_t_yTileSize;
		var r = resM.resImg[pAtlas][pIcon];
		if (!r) {
			resM.resImg[pAtlas][pIcon] = {};
			r = resM.resImg[pAtlas][pIcon];
		}
		r = r[''];
		if (!r) r = resM.loadAtlasIcon(encodeURIComponent(pIcon), 0, pData, pWidth, pHeight, pAtlas);
		else {
			r.loaded = false;
			r.width = pWidth;
			r.height = pHeight;
			r.imageData = pData;
		}
		r.states = [];
		resM.resImg[pAtlas][pIcon][''] = r;
	};
	stM.Icon.newIconState = function(pAtlas, pIcon, pState, pData) {
		if (!pAtlas || !resM.resImg[pAtlas] || !resM.resImg[pAtlas][pIcon]) return;
		var parIcon = resM.resImg[pAtlas][pIcon][''];
		var r = resM.resImg[pAtlas][pIcon][pState];
		if (!r) r = resM.loadAtlasIcon(encodeURIComponent(pState), 0, pData, parIcon.width, parIcon.height, pAtlas);
		else {
			r.loaded = false;
			r.imageData = pData;
			r.frames = [r];
		}
		r.statePar = parIcon;
		resM.resImg[pAtlas][pIcon][pState] = r;
		parIcon.states.push(r);
	};
	stM.Icon.newFrame = function(pDelay, pAtlas, pIcon, pState, pData) {
		if (!pAtlas || !resM.resImg[pAtlas] || !resM.resImg[pAtlas][pIcon]) return;
		var parIcon;
		if (pState !== undefined) {
			if (!resM.resImg[pAtlas][pIcon][pState]) return;
			parIcon = resM.resImg[pAtlas][pIcon][pState];
		} else {
			parIcon = resM.resImg[pAtlas][pIcon][''];
		}
		var r = resM.loadAtlasIcon(null, pDelay, pData, parIcon.width, parIcon.height, pAtlas);
		r.parent = parIcon;
		if (!parIcon.frames || parIcon.frames.length <= 1) {
			parIcon.frames = [parIcon, r];
			for (var o in diobM.objects) {
				var obj = diobM.objects[o];
				if (!obj || obj._vy_ico !== parIcon) continue;
				dfM.setIcon(obj, obj._vy_ico);
			}
		} else {
			parIcon.frames.push(r);
			scrM.refreshTileScreen = true;
		}
	};
	stM.Icon.setFrameDelay = function(pAtlas, pIcon, pState, pFrame, pDelay) {
		if (!pAtlas || !resM.resImg[pAtlas] || !resM.resImg[pAtlas][pIcon]) return;
		var parIcon;
		if (pState !== undefined) {
			if (!resM.resImg[pAtlas][pIcon][pState]) return;
			parIcon = resM.resImg[pAtlas][pIcon][pState];
		} else {
			parIcon = resM.resImg[pAtlas][pIcon][''];
		}
		if (pFrame > 1) {
			parIcon.frames[pFrame - 1].delay = pDelay;
		} else {
			parIcon.delay = pDelay;
		}
	};
	stM.Icon.getFrameDelay = function(pAtlas, pIcon, pState, pFrame) {
		if (!pAtlas || !resM.resImg[pAtlas] || !resM.resImg[pAtlas][pIcon]) return;
		var parIcon;
		if (pState !== undefined) {
			if (!resM.resImg[pAtlas][pIcon][pState]) return;
			parIcon = resM.resImg[pAtlas][pIcon][pState];
		} else {
			parIcon = resM.resImg[pAtlas][pIcon][''];
		}
		if (pFrame > 1) {
			return parIcon.frames[pFrame - 1].delay;
		} else {
			return parIcon.delay;
		}
	};
	stM.Icon.getFrameCount = function(pAtlas, pIcon, pState) {
		if (!pAtlas || !resM.resImg[pAtlas] || !resM.resImg[pAtlas][pIcon]) return;
		var parIcon;
		if (pState !== undefined) {
			if (!resM.resImg[pAtlas][pIcon][pState]) return;
			parIcon = resM.resImg[pAtlas][pIcon][pState];
		} else {
			parIcon = resM.resImg[pAtlas][pIcon][''];
		}
		return ((parIcon.frames)? parIcon.frames.length : 1);
	};
	stM.Icon.clone = function(pArgs) {
		if (!pArgs || !pArgs.atlas) return;
		if (!resM.resImg[pArgs.atlas]) resM.loadAtlas(pArgs.atlas);
		if (!resM.resImg[pArgs.atlas]) return;
		var nAtlas = pArgs.atlas;
		if (pArgs.newAtlas && pArgs.atlas !== pArgs.newAtlas) {
			if (!resM.resImg[pArgs.newAtlas]) resM.loadAtlas(pArgs.newAtlas);
			if (!resM.resImg[pArgs.newAtlas]) {
				resM.resImg[pArgs.newAtlas] = {};
				resM.loadedAtlases[pArgs.newAtlas] = {'loading': false};
			}
			nAtlas = pArgs.newAtlas;
		}
		var cloneIcon = function(pIcon, pClone) {
			pIcon.loaded = false;
			pIcon.delay = pClone.delay;
			pIcon.imageData = resM.getIconData(pClone);
			pIcon.loading = false;
			//resM.loadIconImage(pIcon);
		};
		if (pArgs.icon !== undefined) {
			var iconName = (pArgs.newIcon)? pArgs.newIcon : pArgs.icon;
			var icon = resM.resImg[pArgs.atlas][pArgs.icon];
			if (!icon) return;
			icon = icon[''];
			if (!pArgs.state && pArgs.state !== '') {
				if (!pArgs.frame) {
					if (resM.resImg[nAtlas][iconName]) return;
					stM.Icon.newIcon(nAtlas, iconName, icon.width, icon.height);
					var newIcon = resM.resImg[nAtlas][iconName][''];
					cloneIcon(newIcon, icon);
					if (icon.frames) {
						newIcon.frames = [newIcon];
						for (var f = 1, fLen = icon.frames.length; f < fLen; f ++) {
							stM.Icon.newFrame(null, nAtlas, iconName);
							cloneIcon(newIcon.frames[f], icon.frames[f]);
						}
					}
					if (icon.states.length) {
						for (var s = 0, sLen = icon.states.length; s < sLen; s ++) {
							stM.Icon.newIconState(nAtlas, iconName, icon.states[s].name);
							cloneIcon(newIcon.states[newIcon.states.length - 1], icon.states[s]);
						}
					}
				} else {
					if (!icon.frames[pArgs.frame - 1]) return;
					var fIcon = resM.resImg[nAtlas][iconName][''];
					stM.Icon.newFrame(null, nAtlas, iconName);
					cloneIcon(fIcon.frames[fIcon.frames.length - 1], icon.frames[pArgs.frame - 1]);
				}
			} else {
				var name = (pArgs.newState)? pArgs.newState : pArgs.state;
				var icon = resM.resImg[pArgs.atlas][pArgs.icon][pArgs.state];
				if (!icon) return;
				if (!pArgs.frame) {
					if (resM.resImg[nAtlas][iconName][name]) return;
					stM.Icon.newIconState(nAtlas, iconName, name);
					var newIcon = resM.resImg[nAtlas][iconName][name];
					cloneIcon(newIcon, icon);
					if (icon.frames) {
						newIcon.frames = [newIcon];
						for (var f = 1, fLen = icon.frames.length; f < fLen; f ++) {
							stM.Icon.newFrame(null, nAtlas, name);
							cloneIcon(newIcon.frames[f], icon.frames[f]);
						}
					}
					var parIcon = resM.resImg[nAtlas][iconName][''];
					parIcon.states.push(newIcon);
				} else {
					if (!icon.frames[pArgs.frame - 1]) return;
					var fIcon = resM.resImg[nAtlas][name][''];
					stM.Icon.newFrame(null, nAtlas, iconName, name);
					cloneIcon(fIcon.frames[fIcon.frames.length - 1], icon.frames[pArgs.frame - 1]);
				}
			}
		} else {
			for (var i in resM.resImg[pArgs.atlas]) {
				for (var i2 in resM.resImg[pArgs.atlas][i]) {
					var icon = resM.resImg[pArgs.atlas][i][i2];
					if (icon.statePar) continue;
					stM.Icon.newIcon(nAtlas, icon.name, icon.width, icon.height);
					var newIcon = resM.resImg[nAtlas][icon.name][''];
					cloneIcon(newIcon, icon);
					if (icon.frames) {
						newIcon.frames = [newIcon];
						for (var f = 1, fLen = icon.frames.length; f < fLen; f ++) {
							stM.Icon.newFrame(null, nAtlas, icon.name);
							cloneIcon(newIcon.frames[f], icon.frames[f]);
						}
					}
				}
			}
			for (var i in resM.resImg[pArgs.atlas]) {
				for (var i2 in resM.resImg[pArgs.atlas][i]) {
					var icon = resM.resImg[pArgs.atlas][i][i2];
					if (!icon.statePar) continue;
					stM.Icon.newIconState(nAtlas, icon.statePar.name, icon.name);
					var newIcon = resM.resImg[nAtlas][icon.statePar.name][icon.name];
					cloneIcon(newIcon, icon);
					if (icon.frames) {
						newIcon.frames = [newIcon];
						for (var f = 1, fLen = icon.frames.length; f < fLen; f ++) {
							stM.Icon.newFrame(null, nAtlas, icon.statePar.name, icon.name);
							cloneIcon(newIcon.frames[f], icon.frames[f]);
						}
					}
					var parIcon = resM.resImg[nAtlas][icon.statePar.name][''];
					parIcon.states.push(newIcon);
				}
			}
		}
	};
	stM.Icon.applyFilter = function(pFilter, pAtlas, pIcon, pState, pFrame, pFunc) {
		if (!pFilter || !pAtlas || typeof(pFilter) !== 'object' || !pFilter.type) return;
		var alter = function(pAlter) {
			var finishAlter = function() {
				var canvas = document.createElement('canvas');
				var brush = canvas.getContext('2d');
				canvas.width = pAlter.width;
				canvas.height = pAlter.height;
				brush.drawImage(pAlter.image, 0, 0);
				var d = brush.getImageData(0, 0, pAlter.width, pAlter.height);
				if (pFilter.type === 'grayscale') {
					for (var i = 0, len = d.data.length; i < len; i += 4) {
						var v = (0.2126 * d.data[i]) + (0.7152 * d.data[i + 1]) + (0.0722 * d.data[i + 2]);
						d.data[i] = d.data[i + 1] = d.data[i + 2] = v;
					}
				} else if (pFilter.type === 'lighten') {
					if (!pFilter.value) pFilter.value = 1;
					for (var i = 0, len = d.data.length; i < len; i += 4) {
						d.data[i] += pFilter.value;
						d.data[i + 1] += pFilter.value;
						d.data[i + 2] += pFilter.value;
					}
				} else if (pFilter.type === 'darken') {
					if (!pFilter.value) pFilter.value = 1;
					for (var i = 0, len = d.data.length; i < len; i += 4) {
						d.data[i] -= pFilter.value;
						d.data[i + 1] -= pFilter.value;
						d.data[i + 2] -= pFilter.value;
					}
				} else if (pFilter.type === 'invert') {
					for (var i = 0, len = d.data.length; i < len; i += 4) {
						d.data[i] = 255 - d.data[i];
						d.data[i + 1] = 255 - d.data[i + 1];
						d.data[i + 2] = 255 - d.data[i + 2];
					}
				}
				brush.putImageData(d, 0, 0);
				pAlter.imageData = canvas.toDataURL();
				//if (pAlter.pixiTex && pAlter.pixiTex !== resM.blankPixiTex) pAlter.pixiTex.destroy();
				//if (pFunc) funcM._callback(pFunc);
				pAlter.loading = false;
				resM.loadIconImage(pAlter, 0, pFunc, false, true);
				for (var l in scrM.intBrush) {
					scrM.refreshInt[l] = true;
				}
				scrM.refreshTileScreen = true;
			};
			if (!pAlter.loaded || !pAlter.image || !pAlter.image.src) {
				resM.loadIconImage(pAlter, null, finishAlter, false, true);
				//var img = new Image();
				//img.onload = function() {
				//	finishAlter();
				//};
				//img.src = pAlter.imageData;
			} else {
				finishAlter();
			}
		};
		resM.alterIcon(pAtlas, pIcon, pState, pFrame, alter);
	};
	stM.Icon.alterColor = function(pInfo, pAtlas, pIcon, pState, pFrame, pFunc) {
		if (!pInfo || !pAtlas || typeof(pInfo) !== 'object') return;
		if (!pInfo.type) pInfo.type = 'normal';
		var alter = function(pAlter) {
			var finishAlter = function() {
				var canvas = document.createElement('canvas');
				var brush = canvas.getContext('2d');
				canvas.width = pAlter.width;
				canvas.height = pAlter.height;
				brush.drawImage(pAlter.image, 0, 0);
				if (pInfo.type === 'swap') {
					var d = brush.getImageData(0, 0, pAlter.width, pAlter.height);
					if (pInfo.colors) {
						for (var o in pInfo.colors) {
							for (var i = 0, len = d.data.length; i < len; i += 4) {
								if ((o.red === undefined || o.red === d.data[i]) && (o.green === undefined || o.green === d.data[i + 1]) && (o.blue === undefined || o.blue === d.data[i + 2]) && (o.alpha === undefined || o.alpha === d.data[i + 3])) { 
									if (o.newRed !== undefined) d.data[i] = o.newRed;
									if (o.newGreen !== undefined) d.data[i + 1] = o.newGreen;
									if (o.newBlue !== undefined) d.data[i + 2] = o.newBlue;
									if (o.newAlpha !== undefined) d.data[i + 3] = o.newAlpha;
								}
							}
						}
					} else {
						for (var i = 0, len = d.data.length; i < len; i += 4) {
							if ((pInfo.red === undefined || pInfo.red === d.data[i]) && (pInfo.green === undefined || pInfo.green === d.data[i + 1]) && (pInfo.blue === undefined || pInfo.blue === d.data[i + 2]) && (pInfo.alpha === undefined || pInfo.alpha === d.data[i + 3])) { 
								if (pInfo.newRed !== undefined) d.data[i] = pInfo.newRed;
								if (pInfo.newGreen !== undefined) d.data[i + 1] = pInfo.newGreen;
								if (pInfo.newBlue !== undefined) d.data[i + 2] = pInfo.newBlue;
								if (pInfo.newAlpha !== undefined) d.data[i + 3] = pInfo.newAlpha;
							}
						}
					}
					brush.putImageData(d, 0, 0);
				} else if (pInfo.type === 'normal') {
					var d = brush.getImageData(0, 0, pAlter.width, pAlter.height);
					for (var i = 0, len = d.data.length; i < len; i += 4) {
						if (pInfo.red) d.data[i] += pInfo.red;
						if (pInfo.green) d.data[i + 1] += pInfo.green;
						if (pInfo.blue) d.data[i + 2] += pInfo.blue;
						if (pInfo.alpha) d.data[i + 3] += pInfo.alpha;
					}
					brush.putImageData(d, 0, 0);
				} else {
					var canvas2 = document.createElement('canvas');
					var brush2 = canvas2.getContext('2d');
					canvas2.width = pAlter.width;
					canvas2.height = pAlter.height;
					brush2.drawImage(pAlter.image, 0, 0);
					brush2.save();
					brush2.globalCompositeOperation = 'source-atop';
					if (pInfo.hex) {
						brush2.fillStyle = pInfo.hex;
					} else {
						brush2.fillStyle = 'rgba(' + ((pInfo.red)? pInfo.red : 0) + ',' + ((pInfo.green)? pInfo.green : 0) + ',' + ((pInfo.blue)? pInfo.blue : 0) + ',' + ((pInfo.alpha)? pInfo.alpha : 255) + ')';
					}
					brush2.fillRect(0, 0, pAlter.width, pAlter.height);
					brush.save();
					if (pInfo.type === 'multiply') {
						brush.globalCompositeOperation = 'multiply';
					}
					brush.drawImage(canvas2, 0, 0);
					brush.restore();
					brush2.restore();
				}
				pAlter.imageData = canvas.toDataURL();
				//if (pAlter.pixiTex && pAlter.pixiTex !== resM.blankPixiTex) pAlter.pixiTex.destroy();
				//if (pFunc) funcM._callback(pFunc);
				pAlter.loading = false;
				resM.loadIconImage(pAlter, 0, pFunc, false, true);
				for (var l in scrM.intBrush) {
					scrM.refreshInt[l] = true;
				}
				scrM.refreshTileScreen = true;
			};
			if (!pAlter.loaded || !pAlter.image || !pAlter.image.src) {
				resM.loadIconImage(pAlter, null, finishAlter, false, true);
				//var img = pAlter.image;
				//img.onload = function() {
				//	finishAlter();
				//};
				//img.src = pAlter.imageData;
			} else {
				finishAlter();
			}
		};
		resM.alterIcon(pAtlas, pIcon, pState, pFrame, alter);
	};
	stM.Icon._getIcon = function(pAtlas, pIcon, pState, pFrame) {
		if (!pAtlas || !resM.resImg[pAtlas]) return;
		if (!pIcon) pIcon = '';
		if (!resM.resImg[pAtlas][pIcon]) return;
		if (!pState) pState = '';
		var state = resM.resImg[pAtlas][pIcon][pState];
		if (state) return ((!pFrame)? state : ((state.frames && state.frames.length >= pFrame)? state.frames[pFrame - 1] : state));
	};
	stM.Icon.getRawData = function(pAtlas, pIcon, pState, pFrame) {
		var icon = stM.Icon._getIcon(pAtlas, pIcon, pState, pFrame);
		if (!icon) return;
		if (!icon.loaded) resM.loadIconImage(icon);
		var s = new PIXI.Sprite(PIXI.Texture.from(icon.imageData));
		if (!scrM.pixiAppOp) scrM.pixiAppOp = new PIXI.Application({'width': icon.width, 'height': icon.height, 'transparent': true});
		else scrM.pixiAppOp.renderer.resize(icon.width, icon.height);
		scrM.pixiAppOp.stage.addChild(s);
		var data = scrM.pixiAppOp.renderer.extract.pixels(scrM.pixiAppOp.stage);
		for (var i = scrM.pixiAppOp.stage.children.length; i --;) {
			scrM.pixiAppOp.stage.removeChild(scrM.pixiAppOp.stage.children[i]);
		}
		return {'width': icon.width, 'height': icon.height, 'data': data};
	};
	stM.Icon.setRawData = function(pData, pAtlas, pIcon, pState, pFrame, pFunc) {
		if (!pAtlas || !pData) return;
		var icon = stM.Icon._getIcon(pAtlas, pIcon, pState, pFrame);
		if (!icon) return;
		resM.iconCanvas.width = icon.width;
		resM.iconCanvas.height = icon.height;
		resM.iconCanvasBrush.putImageData(pData, 0, 0);
		icon.imageData = resM.iconCanvas.toDataURL();
		icon.loading = false;
		resM.loadIconImage(icon, 0, pFunc, false, true);
	};
	stM.Icon.getDataURL = function(pAtlas, pIcon, pState, pFrame) {
		var icon = stM.Icon._getIcon(pAtlas, pIcon, pState, pFrame);
		if (!icon) return;
		return resM.getIconData(icon);
	};
	stM.Icon.setDataURL = function(pData, pAtlas, pIcon, pState, pFrame, pFunc, pParams) {
		var icon = stM.Icon._getIcon(pAtlas, pIcon, pState, pFrame);
		if (!icon) {
			if (pFunc) funcM._callback(pFunc, 'Invalid icon destination.');
			return;
		}
		icon.imageData = pData;
		icon.loaded = false;
		resM.loadIconImage(icon, null, pFunc, false, true);
	};
	stM.Icon.draw = function(pArgs, pAtlas, pIcon, pState, pFrame, pFunc) {
		var icon = stM.Icon._getIcon(pAtlas, pIcon, pState, pFrame);
		if (!icon) {
			if (pFunc) funcM._callback(pFunc, 'Invalid icon destination.');
			return;
		}
		var f = function() {
			var canvas = document.createElement('canvas');
			var brush = canvas.getContext('2d');
			canvas.width = icon.width;
			canvas.height = icon.height;
			if (icon.image) brush.drawImage(icon.image, 0, 0);
			var f2 = function() {
				pAlter.imageData = canvas.toDataURL();
				//if (pAlter.pixiTex && pAlter.pixiTex !== resM.blankPixiTex) pAlter.pixiTex.destroy();
				icon.loaded = false;
				resM.loadIconImage(icon, null, pFunc, false, true);
				for (var l in scrM.intBrush) {
					scrM.refreshInt[l] = true;
				}
				scrM.refreshTileScreen = true;
				scrM.refreshScrEyeLoc = true;
				if (pFunc) funcM._callback(pFunc);
			};
			scrM.customScreenDraw(brush, pArgs, f2);
		};
		if (!icon.loaded || !icon.image || !icon.image.src) {
			resM.loadIconImage(icon, null, f, false, true);
		} else f();
	};
	stM.Icon.getIconSize = function(pAtlas, pIcon, pState, pFrame) {
		var icon = stM.Icon._getIcon(pAtlas, pIcon, pState, pFrame);
		if (!icon) return;
		return {'width': icon.width, 'height': icon.height};
	};
	stM.Icon.cacheImage = function(pAtlas, pIcon, pFunc) {
		if (!resM.loadedAtlases[pAtlas] || resM.loadedAtlases[pAtlas].loading) {
			var f = function(pStatus, pAtlas, pIcon, pFunc) {
				if (pStatus === 'loaded') {
					stM.Icon.cacheImage(pAtlas, pIcon, pFunc);
				} else if (pFunc) funcM._callback(pFunc);
			};
			resM.loadAtlas(pAtlas, false, [f, this, [pAtlas, pIcon, pFunc]]);
			return;
		}
		if (pIcon) {
			var icon = stM.Icon._getIcon(pAtlas, pIcon);
			if (!icon) {
				if (pFunc) funcM._callback(pFunc, 'Invalid icon destination.');
				return;
			}
			resM.loadIconImage(icon, null, pFunc, false, true);
		} else {
			var c = 0;
			var f = function() {
				c --;
				if (c <= 0 && pFunc) funcM._callback(pFunc);
			};
			for (var i in resM.resImg[pAtlas]) {
				for (var i2 in resM.resImg[pAtlas][i]) c ++;
			}
			for (var i in resM.resImg[pAtlas]) {
				for (var i2 in resM.resImg[pAtlas][i]) {
					var icon = resM.resImg[pAtlas][i][i2];
					resM.loadIconImage(icon, null, f, false, true);
				}
			}
		}
	};
	stM.Icon.getIconNames = function(pAtlas) {
		if (!pAtlas || !resM.resImg[pAtlas]) return [];
		var arr = [];
		var atlas = resM.resImg[pAtlas];
		for (var n in atlas) arr.push(n);
		return arr;
	};
	stM.Icon.getIconStateNames = function(pAtlas, pIcon) {
		if (!pAtlas || !resM.resImg[pAtlas] || !resM.resImg[pAtlas][pIcon]) return;
		var arr = [];
		var icon = resM.resImg[pAtlas][pIcon][''];
		if (!icon || !icon.states || !icon.states.length) return arr;
		for (var i = 0, len = icon.states.length; i < len; i ++) {
			var s = icon.states[i];
			if (s) arr.push(s.name);
		}
		return arr;
	};
	stM.Macro = {};
	stM.Macro.newMacroAtlas = function(pName) {
		if (!pName || eventM.macros[pName]) return;
		eventM.macros[pName] = {};
	};
	stM.Macro.newMacro = function(pName, pAtlas, pKey, pDown, pUp) {
		if (!pAtlas || !pKey || !eventM.macros[pAtlas]) return;
		eventM.macros[pAtlas]['on' + pKey] = {'name': pName};
		if (pUp) {
			var up = pUp.match(/^(.*)\((.*)\)$/);
			if (up) {
				if (up[2]) up[2] = ',' + up[2];
				eval("eventM.macros['" + pAtlas + "']['on" + pKey + "'].up = function() { clientM.clientType._vy_com." + up[1] + ".call(this" + up[2] + "); };");
			}
		}
		if (pDown) {
			var down = pDown.match(/^(.*)\((.*)\)$/);
			if (down) {
				if (down[2]) down[2] = ',' + down[2];
				eval("eventM.macros['" + pAtlas + "']['on" + pKey + "'].down = function() { clientM.clientType._vy_com." + down[1] + ".call(this" + down[2] + "); };");
			}
		}
	};
	stM.Macro.removeMacro = function(pName, pAtlas) {
		if (!pAtlas || !eventM.macros[pAtlas]) return;
		for (var k in eventM.macros[pAtlas]) {
			var macro = eventM.macros[pAtlas][k];
			if (macro && macro.name === pName) eventM.macros[pAtlas][k] = undefined;
		}
	};
	stM.Macro.getMacroAtlasNames = function() {
		var arr = [];
		for (var k in eventM.macros) {
			arr.push(k);
		}
		return arr;
	};
	stM.Macro.getMacroNames = function() {
		var arr = [];
		for (var k in eventM.macros) {
			for (var k2 in eventM.macros[k]) {
				var macro = eventM.macros[k][k2];
				arr.push(macro.name);
			}
		}
		return arr;
	};
	stM.Type = {};
	stM.Type.setStaticVariable = function(pType, pVar, pVal) {
		var t = diobM.objectType[pType];
		if (!t) return;
		if (!t._vy_staticVars) t._vy_staticVars = {};
		t._vy_staticVars[pVar] = pVal;
	};
	stM.Type.getStaticVariable = function(pType, pVar) {
		var t = diobM.objectType[pType];
		if (!t || !t._vy_staticVars) return;
		return t._vy_staticVars[pVar];
	};
	stM.Type.addInheritance = function(pType, pInherit) {
		diobM.addInheritance(pType, pInherit);
	};
	stM.Type.removeInheritance = function(pType, pInherit) {
		diobM.removeInheritance(pType, pInherit);
	};
	stM.Type.getInheritances = function(pType) {
		return diobM.getInheritances(pType);
	};
	stM.Type.setFunction = function(pType, pName, pFunc) {
		if (!diobM.objectType[pType]) return;
		if (!funcM.oF[pType]) funcM.oF[pType] = {};
		funcM.oF[pType][pName] = pFunc;
		for (var tT in diobM.objectType) {
			if (!funcM._isType(tT, pType, 1)) continue;
			diobM.resetTypeFunctions(tT);
		}
	};
	stM.Type.getFunction = function(pType, pName) {
		return diobM.objectType[pType][pName];
	};
	stM.Type.setVariables = function(pType, pVars) {
		if (!diobM.objectType[pType]) return;
		var t = diobM.objectType[pType];
		for (var v in pVars) {
			if (diobM.defProp[v]) {
				t[diobM.defProp[v]] = pVars[v];
			} else {
				t[v] = pVars[v];
			}
		}
		for (var tT in diobM.objectType) {
			if (!funcM._isType(tT, pType, 1)) continue;
			diobM.setTypeVariables(tT);
		}
	};
	stM.Type.getVariable = function(pType, pVar, pOwn) {
		var type = diobM.objectType[pType];
		if (!type) return;
		if (pOwn && !type.hasOwnProperty(pVar)) return;
		if (diobM.defProp[pVar]) pVar = diobM.defProp[pVar];
		var pV = type[pVar];
		var rV = pV
		if (pV && pV instanceof Object) {
			var o = (pV.constructor === Array)? [] : {};
			for (var iV in pV) {
				o[iV] = pV[iV];
			}
			rV = o;
		} else rV = pV;
		return rV;
	};
	stM.Type.getVariables = function(pType, pAll) {
		var type = diobM.objectType[pType];
		if (!type) return;
		var vars = {};
		var cVars = {};
		for (var v in type) {
			if (!type.hasOwnProperty(v) && !pAll) continue;
			if (v.startsWith('_vy_')) {
				if (diobM.defPropR[v]) cVars[diobM.defPropR[v]] = type[v];
				continue;
			}
			cVars[v] = type[v];
		}
		diobM.copyObjectVars(vars, cVars);
		return vars;
	};
	stM.Type.newType = function(pType) {
		if (diobM.objectType[pType]) return;
		var dT = new ObjectType(pType);
		diobM.setTypeVariables(pType);
		diobM.setTypeFunctions(pType);
		if ((dT._vy_baseType === 'Region' || dT._vy_isRegion) && !diobM.regions.hasOwnProperty(dT._vy_type)) {
			var obj = newDiob(diobM.objectType[dT._vy_type]);
			diobM.regions[dT.type] = obj;
		}
	};
	stM.Type.getTypes = function(pParent, pOmit) {
		var arr = [];
		for (var t in diobM.objectType) {
			if (!pParent) {
				arr.push(t);
			} else if (funcM._isType(t, pParent, 1)) {
				if (pOmit && t === pParent) continue;
				arr.push(t);
			}
		}
		return arr;
	};
	stM.Type.isType = function(pType, pType2) {
		if (!pType || !diobM.objectType[pType]) return false;
		if (!pType2 || funcM._isType(pType, pType2, 1)) return true;
		return false;
	};
	stM.Type.callFunction = function(pType, pFunc, pD, pArgs) {
		if (!diobM.objectType[pType]) return;
		var f = diobM.objectType[pType][pFunc];
		if (!f) return;
		return f.apply(pD, pArgs);
	};
};

function FuncManager() {
	funcM = this;
	funcM.oF = {};
	funcM.oFs = {};
	funcM.objCommand = {};
	funcM.expFunc = {};
	funcM.alert = function(pMes) {
		eventM.clearKeyDownEvents();
		alert(pMes);
	};
	funcM.prompt = function(pTitle, pMes) {
		eventM.clearKeyDownEvents();
		return prompt(pTitle, pMes);
	};
	funcM.confirm = function(pMes) {
		eventM.clearKeyDownEvents();
		return confirm(pMes);
	};
	funcM.aMes = function(pMes, pAdd) {
		pMes = mainM.getWebText(pMes);
		if (pAdd) mainM.errorDisplay.innerText += pMes;
		else mainM.errorDisplay.innerText = pMes;
	};
	funcM.delProp = function(pO, pProp) {
		delete pO[pProp];
	};
	funcM.delDiob = function(pD) {
		if (!pD) return;
		var args = Array.prototype.slice.call(arguments);
		args.shift();
		if (args.length) diobM.deleteDiob(pD, args);
		else diobM.deleteDiob(pD);
	};
	funcM.newDiob = function(pType) {
		if (!pType) pType = 'Diob';
		var obj = funcM._newDiob(pType);
		if (obj && obj.onNew) {
			if (arguments.length > 1) {
				var args = [];
				for (var i = 1, len = arguments.length; i < len; i ++) {
					args.push(arguments[i]);
				}
				if (!mainM.isInitialized) resM.diobNewQueue.push([obj, args]);
				else diobM.diobOnNew(obj, args);
			} else {
				if (!mainM.isInitialized) resM.diobNewQueue.push(obj);
				else diobM.diobOnNew(obj);
			}
		}
		return obj;
	};
	funcM._newDiob = function(pType, pTemp, pID) {
		if (pType.includes('{')) {
			pType = decodeURIComponent(pType);
			return funcM._parseNewObType(newDiob(diobM.objectType[pType.substring(0, pType.indexOf('{')).trim()], pID, pTemp), pType);
		}
		return newDiob(diobM.objectType[pType], pID, pTemp);
	};
	funcM.newObject = function(pType) {
		if (!pType) return {};
		var type = pType;
		if (pType.includes('{')) type = pType.substring(0, pType.indexOf('{')).trim();
		var t = diobM.objectType[type];
		if (!t) return {};
		var o = Object.create(t);
		o.type = type;
		if (t._vy_vyVars) {
			for (var i = t._vy_vyVars.length; i --;) {
				var v = t._vy_vyVars[i];
				o[diobM.defPropR[v]] = o[v];
				delete o[v];
			}
		}
		if (t._vy_obVars) {
			for (var i = t._vy_obVars.length; i --;) {
				var v = t._vy_obVars[i];
				o[v] = stM.Util._copyObjectVars((o[v].constructor === Array)? [] : {}, o[v]);
			}
		}
		if (type !== pType) funcM._parseNewObType(o, pType);
		if (o.onNew) {
			if (arguments.length > 1) {
				var args = [];
				for (var i = 1, len = arguments.length; i < len; i ++) {
					args.push(arguments[i]);
				}
				if (!mainM.isInitialized) resM.diobNewQueue.push([o, args]);
				else o.onNew.apply(o, args);
			} else {
				if (!mainM.isInitialized) resM.diobNewQueue.push(o);
				else o.onNew();
			}
		}
		return o;
	};
	funcM._parseNewObType = function(pO, pType) {
		var vars = pType.substring(pType.indexOf('{') + 1, pType.length - 1).split(';');
		for (var i in vars) {
			var s = vars[i].split('=');
			if (s[0]) {
				var s0 = s[0].trim();
				var s1 = (s[1])? s[1].trim() : s[1];
				if (!s1) pO[s0] = s1;
				else {
					if (s1[0] === "'" || s1[0] === '"') pO[s0] = decodeURIComponent(s1.substr(1, s1.length - 2));
					else if (s1[0] === '{' || s1[0] === '[') pO[s0] = JSON.parse(s1);
					else if (!isNaN(s1)) pO[s0] = parseFloat(s1);
					else pO[s0] = decodeURIComponent(s1);
				}
			}
		}
		return pO;
	};
	funcM.delObject = function(pO) {
		if (!pO) return;
		if (pO._vy_id) {
			funcM.delDiob.apply(pO, arguments);
			return;
		}
		if (pO._vy_tickT) eventM.removeTicker(pO);
		if (arguments.length > 1 && pO.onDel) {
			var args = Array.prototype.slice.call(arguments);
			args.shift();
			pO.onDel.apply(pO, args);
		} else if (pO.onDel) pO.onDel();
		pO.__proto__ = null;
		for (var v in pO) delete pO[v];
	};
	funcM._callback = function(pFunc, pAdd) {
		if (Array.isArray(pFunc)) {
			if (pAdd !== undefined) {
				if (!pFunc[2]) pFunc[2] = [];
				if (Array.isArray(pAdd)) {
					for (var i = pAdd.length; i --;) {
						pFunc[2].unshift(pAdd[i]);
					}
				} else pFunc[2].unshift(pAdd);
			}
			return pFunc[0].apply(pFunc[1], pFunc[2]);
		} else {
			if (Array.isArray(pAdd)) {
				return pFunc.apply(null, pAdd);
			} else {
				return pFunc(pAdd);
			}
		}
	};
	funcM._isType = function(pType, pParent, pChild) {
		if (!pType) return;
		if (pType === pParent) return true;
		if (pChild && pType.startsWith(pParent) && pType[pParent.length] === '/') return true;
	};
	funcM.onMouseEnter = function(pD, pX, pY) {
		if (clientM.cOb.onMouseEnter) clientM.cOb.onMouseEnter(pD, pX, pY);
		if (pD) {
			if (pD._vy_gui) dfM.onMouseEnter(pD, pX - pD._vy_x, Math.abs(pD._vy_y - pY));
			else dfM.onMouseEnter(pD, pX - (pD._vy_x - scrM.xScr) - scrM.mapView.xPos, pY - (pD._vy_y - scrM.yScr) - scrM.mapView.yPos);
		}
	};
	funcM.onMouseExit = function(pD, pX, pY) {
		if (clientM.cOb.onMouseExit) clientM.cOb.onMouseExit(pD, pX, pY);
		if (pD) {
			if (pD._vy_gui) dfM.onMouseExit(pD, pX - pD._vy_x, Math.abs(pD._vy_y - pY));
			else dfM.onMouseExit(pD, pX - (pD._vy_x - scrM.xScr) - scrM.mapView.xPos, pY - (pD._vy_y - scrM.yScr) - scrM.mapView.yPos);
		}
	};
	funcM.onMouseMove = function(pD, pX, pY) {
		if (clientM.cOb.onMouseMove) clientM.cOb.onMouseMove(pD, pX, pY);
		if (pD) {
			if (pD._vy_gui) dfM.onMouseMove(pD, pX - pD._vy_x, Math.abs(pD._vy_y - pY));
			else dfM.onMouseMove(pD, pX - (pD._vy_x - scrM.xScr) - scrM.mapView.xPos, pY - (pD._vy_y - scrM.yScr) - scrM.mapView.yPos);
		}
	};
	funcM.onMouseClick = function(pD, pX, pY, pButton) {
		if (clientM.cOb.onMouseClick) clientM.cOb.onMouseClick(pD, pX, pY, pButton);
		if (pD) {
			if (pD._vy_gui) dfM.onMouseClick(pD, pX - pD._vy_x, Math.abs(pD._vy_y - pY), pButton);
			else dfM.onMouseClick(pD, pX - (pD._vy_x - scrM.xScr) - scrM.mapView.xPos, pY - (pD._vy_y - scrM.yScr) - scrM.mapView.yPos, pButton);
		}
	};
	funcM.onMouseDblClick = function(pD, pX, pY, pButton) {
		if (clientM.cOb.onMouseDblClick) clientM.cOb.onMouseDblClick(pD, pX, pY, pButton);
		if (pD) {
			if (pD._vy_gui) dfM.onMouseDblClick(pD, pX - pD._vy_x, Math.abs(pD._vy_y - pY), pButton);
			else dfM.onMouseDblClick(pD, pX - (pD._vy_x - scrM.xScr) - scrM.mapView.xPos, pY - (pD._vy_y - scrM.yScr) - scrM.mapView.yPos, pButton);
		}
	};
	funcM.onMouseDown = function(pD, pX, pY, pButton) {
		if (clientM.cOb.onMouseDown) clientM.cOb.onMouseDown(pD, pX, pY, pButton);
		if (pD) {
			if (pD._vy_gui) dfM.onMouseDown(pD, pX - pD._vy_x, Math.abs(pD._vy_y - pY), pButton);
			else dfM.onMouseDown(pD, pX - (pD._vy_x - scrM.xScr) - scrM.mapView.xPos, pY - (pD._vy_y - scrM.yScr) - scrM.mapView.yPos, pButton);
			if (clientM.cOb._vy_focused !== pD) dfM.onFocus(pD);
		} else if (clientM.cOb._vy_focused) dfM.onUnfocus(clientM.cOb._vy_focused);
	};
	funcM.onMouseUp = function(pD, pX, pY, pButton) {
		if (clientM.cOb.onMouseUp) clientM.cOb.onMouseUp(pD, pX, pY, pButton);
		if (pD) {
			if (pD._vy_gui) dfM.onMouseUp(pD, pX - pD._vy_x, Math.abs(pD._vy_y - pY), pButton);
			else dfM.onMouseUp(pD, pX - (pD._vy_x - scrM.xScr) - scrM.mapView.xPos, pY - (pD._vy_y - scrM.yScr) - scrM.mapView.yPos, pButton);
		}
	};
	funcM.onMouseWheelScrollDown = function(pD, pX, pY) {
		if (clientM.cOb.onMouseWheelScrollDown) clientM.cOb.onMouseWheelScrollDown(pD, pX, pY);
		if (pD) {
			if (pD._vy_gui) dfM.onMouseWheelScrollDown(pD, pX - pD._vy_x, Math.abs(pD._vy_y - pY));
			else dfM.onMouseWheelScrollDown(pD, pX - (pD._vy_x - scrM.xScr) - scrM.mapView.xPos, pY - (pD._vy_y - scrM.yScr) - scrM.mapView.yPos);
		}
	};
	funcM.onMouseWheelScrollUp = function(pD, pX, pY) {
		if (clientM.cOb.onMouseWheelScrollUp) clientM.cOb.onMouseWheelScrollUp(pD, pX, pY);
		if (pD) {
			if (pD._vy_gui) dfM.onMouseWheelScrollUp(pD, pX - pD._vy_x, Math.abs(pD._vy_y - pY));
			else dfM.onMouseWheelScrollUp(pD, pX - (pD._vy_x - scrM.xScr) - scrM.mapView.xPos, pY - (pD._vy_y - scrM.yScr) - scrM.mapView.yPos);
		}
	};
	funcM.onKeyDown = function(pKey, pEvent) {
		if (clientM.cOb.onKeyDown) clientM.cOb.onKeyDown(pKey, pEvent);
	};
	funcM.onKeyUp = function(pKey, pEvent) {
		if (clientM.cOb.onKeyUp) clientM.cOb.onKeyUp(pKey, pEvent);
	};
	funcM._textBoxMouseWheelScrollDown = function(pD) {
		if (pD._vy_webBox) {
			pD._vy_webBox.innerBox.scrollTop += (pD._vy_webBox.parent._vy_textSty.fontSize)? pD._vy_webBox.parent._vy_textSty.fontSize : scrM.defaultText.fontSize;
		} else {
			if (!pD._vy_textSty.topLine) pD._vy_textSty.topLine = 0;
			pD._vy_scrollToBot = false;
			pD._vy_textSty.topLine ++;
			scrM.refreshInt[pD._vy_layer] = true;
		}
	};
	funcM._textBoxMouseWheelScrollUp = function(pD) {
		if (pD._vy_webBox) {
			pD._vy_webBox.innerBox.scrollTop -= (pD._vy_webBox.parent._vy_textSty.fontSize)? pD._vy_webBox.parent._vy_textSty.fontSize : scrM.defaultText.fontSize;
		} else {
			if (!pD._vy_textSty.topLine) pD._vy_textSty.topLine = 0;
			pD._vy_scrollToBot = false;
			pD._vy_textSty.topLine --;
			if (pD._vy_textSty.topLine < 0) pD._vy_textSty.topLine = 0;
			scrM.refreshInt[pD._vy_layer] = true;
		}
	};
	funcM._textInputFocused = function(pD) {
		eventM.clearKeyDownEvents();
		if (pD.interfaceType === 'CommandInput') clientM.cOb._vy_inCommandInput = pD;
		else if (pD._vy_isIntInput) clientM.cOb._vy_inTextInput = pD;
		clientM.cOb.inInput = pD.interfaceType;
		pD._vy_webBox.innerBox.value = pD._vy_text;
		pD._vy_webBox.style.pointerEvents = 'auto';
		pD._vy_webBox.innerBox.focus();
	};
	funcM._textInputUnfocused = function(pD) {
		if (pD.interfaceType === 'CommandInput') clientM.cOb._vy_inCommandInput = 0;
		else if (pD._vy_isIntInput) clientM.cOb._vy_inTextInput = 0;
		clientM.cOb.inInput = false;
		pD._vy_webBox.innerBox.value = pD._vy_text;
		pD._vy_webBox.style.pointerEvents = 'none';
		pD._vy_webBox.innerBox.blur();
	};
	stM.newDiob = funcM.newDiob;
	stM.delDiob = funcM.delDiob;
	stM.newObject = funcM.newObject;
	stM.delObject = funcM.delObject;
	stM.delProp = funcM.delProp;
};

function DiobManager() {
	diobM = this;
	new DiobFunc();
	diobM.objIDCount = 0;
	diobM.objects = {};
	diobM.tags = {};
	diobM.objectType = [];
	diobM.regions = [];
	diobM.defProp = {'iconName': '_vy_icoName', 'atlasName': '_vy_atlas', 'iconState': '_vy_icoState', 'xIconOffset': '_vy_xIcoOff', 'yIconOffset': '_vy_yIcoOff', 'layer': '_vy_layer', 'relayerHeight': '_vy_relayerH', 'width': '_vy_w', 'height': '_vy_h', 'angle': '_vy_angle', 'anchor': '_vy_anchor', 'alpha': '_vy_alpha', 'scale': '_vy_scale', 'transform': '_vy_transform', 'animator': '_vy_animator', 'color': '_vy_color', 'composite': '_vy_composite', 'plane': '_vy_plane', 'mouseOpacity': '_vy_mouseOp', 'name': '_vy_name', 'id': '_vy_id', 'tag': '_vy_tag', 'xCoord': '_vy_xCo', 'yCoord': '_vy_yCo', 'mapName': '_vy_mapN', 'text': '_vy_text', 'textStyle': '_vy_textSty', 'xPos': '_vy_x', 'yPos': '_vy_y', 'xOrigin': '_vy_xOr', 'yOrigin': '_vy_yOr', 'invisibility': '_vy_invisibility', 'visibility': '_vy_visibility', 'xCoordOffset': '_vy_xCoOff', 'yCoordOffset': '_vy_yCoOff', 'dir': '_vy_dir', 'clientSyncData': '_vy_cSyncD', 'density': '_vy_density'};
	diobM.defPropR = {'_vy_icoName': 'iconName', '_vy_atlas': 'atlasName', '_vy_icoState': 'iconState', '_vy_xIcoOff': 'xIconOffset', '_vy_yIcoOff': 'yIconOffset', '_vy_layer': 'layer', '_vy_relayerH': 'relayerHeight', '_vy_w': 'width', '_vy_h': 'height', '_vy_angle': 'angle', '_vy_anchor': 'anchor', '_vy_alpha': 'alpha', '_vy_scale': 'scale', '_vy_transform': 'transform', '_vy_animator': 'animator', '_vy_color': 'color', '_vy_composite': 'composite', '_vy_plane': 'plane', '_vy_mouseOp': 'mouseOpacity', '_vy_name': 'name', '_vy_id': 'id', '_vy_tag': 'tag', '_vy_xCo': 'xCoord', '_vy_yCo': 'yCoord', '_vy_mapN': 'mapName', '_vy_text': 'text', '_vy_textSty': 'textStyle', '_vy_x': 'xPos', '_vy_y': 'yPos', '_vy_xOr': 'xOrigin', '_vy_yOr': 'yOrigin', '_vy_invisibility': 'invisibility', '_vy_visibility': 'visibility', '_vy_xCoOff': 'xCoordOffset', '_vy_yCoOff': 'yCoordOffset', '_vy_dir': 'dir', '_vy_cSyncD': 'clientSyncData', '_vy_density': 'density'};
	diobM.loadTypes = function() {
		var t = {'types': []};
		var json = _vy_types;
		var f = function(pType, pVar, pInherit) {
			new ObjectType(pType, ((pVar)? decodeURIComponent(pVar.replace(/\+/g, ' ')) : 0), pInherit);
			t.types.push(pType);
		};
		if (!json.v) {
			for (var i = 0, len = json.types.length; i < len; i ++) {
				var type = json.types[i];
				f(type.p, type.v, type.inheritances);
			}
		} else if (json.v === 1) {
			for (var i = 0, len = json.t.length; i < len; i += 3) {
				f(json.t[i], json.t[i + 1], json.t[i + 2]);
			}
		}
		var f2 = function() {
			for (var type in diobM.objectType) {
				var dT = diobM.objectType[type];
				if ((dT.baseType === 'Region' || dT._vy_isRegion) && !diobM.regions.hasOwnProperty(dT.type)) {
					var obj = newDiob(diobM.objectType[dT.type]);
					if (obj.onNew) {
						if (!mainM.isInitialized) resM.diobNewQueue.push(obj);
						else diobM.diobOnNew(obj);
					}
					diobM.regions[dT.type] = obj;
				}
				if (dT._vy_name === undefined) {
					var iL = type.lastIndexOf('/');
					dT._vy_name = (iL !== -1)? type.substr(iL + 1).replace(/_/g, ' ') : type.replace(/_/g, ' ');
				}
			}
			if (funcM.oF['World']) {
				for (var i in funcM.oF['World']) {
					stM.World[i] = funcM.oF['World'][i];
					//eval('stM.World.' + i + '=' + funcM.oF['World'][i]);
				}
				delete funcM.oF['World'];
			}
			if (clientM.clientID) resM.typesLoaded();
			else clientM.typesLoadedQueue = 1;
			funcM.oFs = {};
			delete _vy_types;
		};
		var i = 0;
		var len = t.types.length;
		if (t.types.length >= 500) {
			var th = setInterval(function() {
				var c = 0;
				var e = '';
				for (; i < len; i ++) {
					c ++;
					var type = t.types[i];
					diobM.setTypeVariables(type);
					e += diobM.setTypeFunctions(type, true);
					if (c >= 250) break;
				}
				eval(e);
				if (i >= len - 1) {
					f2();
					clearInterval(th);
				}
			}, 25);
		} else {
			var e = '';
			for (; i < len; i ++) {
				var type = t.types[i];
				diobM.setTypeVariables(type);
				e += diobM.setTypeFunctions(type, true);
			}
			eval(e);
			f2();
		}
	};
	diobM.deleteDiob = function(pD, pArgs, pSkip) {
		if (!pD._vy_type || pD._vy_isLoc) return;
		if (pD.isOverlay) dfM.removeOverlay(pD.isOverlay, pD, true);
		if (pD._vy_moving) eventM.removeMovementObj(pD);
		if (pD._vy_locs) {
			for (var i = pD._vy_locs.length; i --;) dfM.removeFromContents(pD._vy_locs[i], pD);
			if (pD._vy_crossed) {
				for (var i = pD._vy_crossed.length; i --;) {
					var obj = pD._vy_crossed[i];
					if (obj && obj._vy_crossed) obj._vy_crossed.splice(obj._vy_crossed.indexOf(pD), 1);
					pD._vy_crossed.splice(pD._vy_crossed.indexOf(obj), 1);
					if (pD.onUncrossed) pD.onUncrossed(obj);
					if (obj && obj.onUncrossed) obj.onUncrossed(pD);
				}
			}
			if (pD._vy_offGridLocs) dfM._clearOffGridLocs(pD);
		}
		
		if (pD._vy_tickT) eventM.removeTicker(pD);
		if (pD._vy_tag && diobM.tags[pD._vy_tag]) {
			var index = diobM.tags[pD._vy_tag].indexOf(pD);
			if (index !== -1) diobM.tags[pD._vy_tag].splice(index, 1);
		}
		if (pD._vy_id && !pSkip) {
			if (pD.onDel) {
				if (pArgs) pD.onDel.apply(pD, pArgs);
				else pD.onDel();
			}
			delete diobM.objects[pD._vy_id];
		}
		if (pD._vy_gui) {
			if (pD._vy_parent) clientM.removeInterfaceElement(pD._vy_parent._vy_name, pD._vy_name);
		} else if (pD._vy_onScr) {
			scrM.removeFromScreen(pD);
		}
		if (clientM.cOb && clientM.cOb._vy_focused === pD) clientM.cOb._vy_focused = null;
		if (mainM._vy_mouseOver === pD) mainM._vy_mouseOver = null;
		//pD._vy_viewers = null;
		if (pD._vy_over) {
			for (var o in pD._vy_over) {
				var over = pD._vy_over[o];
				over.isOverlay = null;
				diobM.deleteDiob(over, pArgs, pSkip);
			}
		}
		//pD._vy_over = null;
		pD.__proto__ = null;
		for (var v in pD) delete pD[v];
	};
	diobM.transVars = ['alpha', 'scale', 'angle', 'xIconOffset', 'yIconOffset', 'xScale', 'yScale'];
	diobM.transDiobs = [];
	diobM.refTransLast = performance.now();
	diobM.refreshTransitions = function(pT) {
		var i = diobM.transDiobs.length;
		var time = pT - diobM.refTransLast;
		var diff = Math.max(time, 1);
		while (i--) {
			var d = diobM.transDiobs[i];
			var fin = 0;
			var trans = d._vy_transitions;
			for (var v in trans) {
				var t = trans[v];
				t.i += diff;
				t.iT += diff;
				fin ++;
				if (t.i >= t.t || t.r) {
					var diff2 = Math.round(t.t / t.i);
					t.i = 0;
					t.s -= diff2;
					var c = t.c * diff2;
					if (t.r) {
						t.tt -= time;
						c = t.c / (t.t / time);
					}
					c *= diobM._refreshTransitionsEase(t.e, t);
					switch (v) {
						case 'alpha':
						case 'xIconOffset':
						case 'yIconOffset':
						case 'angle':
							if ((t.s <= 0 && !t.r) || (t.c > 0 && d[diobM.defProp[v]] + c >= t.v) || (t.c < 0 && d[diobM.defProp[v]] + c <= t.v) || t.tt <= 0) {
								d[v] = t.v;
								fin --;
								delete d._vy_transitions[v];
							} else d[v] += c;
							break;
						case 'xScale':
							if ((t.s <= 0 && !t.r) || (t.c > 0 && d._vy_scale.x + c >= t.v) || (t.c < 0 && d._vy_scale.x + c <= t.v) || t.tt <= 0) {
								d._vy_scale.x = t.v;
								fin --;
								delete d._vy_transitions[v];
							} else d._vy_scale.x += c;
							d.setScale(d._vy_scale.x, d._vy_scale.y);
							break;
						case 'yScale':
							if ((t.s <= 0 && !t.r) || (t.c > 0 && d._vy_scale.y + c >= t.v) || (t.c < 0 && d._vy_scale.y + c <= t.v) || t.tt <= 0) {
								d._vy_scale.y = t.v;
								fin --;
								delete d._vy_transitions[v];
							} else d._vy_scale.y += c;
							d.setScale(d._vy_scale.x, d._vy_scale.y);
							break;
						case 'scale':
							var done = 0;
							if ((t.s <= 0 && !t.r) || (t.c > 0 && d._vy_scale.x + c >= t.v) || (t.c < 0 && d._vy_scale.x + c <= t.v) || t.tt <= 0) {
								d._vy_scale.x = t.v;
								done ++;
							} else d._vy_scale.x += c;
							if ((t.s <= 0 && !t.r) || (t.c > 0 && d._vy_scale.y + c >= t.v) || (t.c < 0 && d._vy_scale.y + c <= t.v) || t.tt <= 0) {
								d._vy_scale.y = t.v;
								done ++;
							} else d._vy_scale.y += c;
							d.setScale(d._vy_scale.x, d._vy_scale.y);
							if (done >= 2) {
								fin --;
								delete d._vy_transitions[v];
							}
							break;
					}
					if (d.onTransition) d.onTransition(v, c);
				}
			}
			if (!fin) {
				if (d.onTransition) d.onTransition();
				if (d._vy_transQ && d._vy_transQ.length) {
					var arr = d._vy_transQ.shift();
					if (Array.isArray(arr[1])) {
						for (var iA = 0, lenA = arr.length; iA < lenA; iA ++) {
							var a = arr[iA];
							dfM.setTransition(d, a[0], a[1], a[2], a[3], a[4], a[5], 1, 1);
						}
					} else {
						dfM.setTransition(d, arr[0], arr[1], arr[2], arr[3], arr[4], arr[5], 1, 1);
					}
				} else {
					diobM.transDiobs.splice(diobM.transDiobs.indexOf(d), 1);
					if (d._vy_transL && d._vy_transL.length) {
						for (var iL = 1, lenL = d._vy_transL.length; iL < lenL; iL ++) {
							var a = d._vy_transL[iL];
							dfM.setTransition(d, a[0], a[1], a[2], a[3], a[4], a[5], 0, 1);
						}
						if (d._vy_transL[0] !== -1) {
							d._vy_transL[0] --;
							if (d._vy_transL[0] <= 0) d._vy_transL = [];
						}
					}
				}
			}
		}
		diobM.refTransLast = pT;
	};
	diobM._refreshTransitionsEase = function(pEase, pT) {
		if (!pEase) return 1;
		var t = pT.iT, d = pT.eT, c = pT.cV;
		if (pEase === 'quadraticIn') {
			t /= d;
			return c * t * t;
		} else if (pEase === 'quadraticOut') {
			t /= d;
			return -c * t * (t - 2);
		} else if (pEase === 'quadraticInOut') {
			t /= d / 2;
			if (t < 1) return c / 2 * t * t;
			t --;
			return -c / 2 * (t * (t - 2) - 1);
		} else if (pEase === 'cubicIn') {
			t /= d;
			return c * t * t * t;
		} else if (pEase === 'cubicOut') {
			t /= d;
			t --;
			return c * (t * t * t + 1);
		} else if (pEase === 'cubicInOut') {
			t /= d / 2;
			if (t < 1) return c / 2 * t * t * t;
			t -= 2;
			return c / 2 * (t * t * t + 2);
		} else if (pEase === 'quarticIn') {
			t /= d;
			return c * t * t * t * t;
		} else if (pEase === 'quarticOut') {
			t /= d;
			t --;
			return -c * (t * t * t * t - 1);
		} else if (pEase === 'quarticInOut') {
			t /= d / 2;
			if (t < 1) return c / 2 * t * t * t * t;
			t -= 2;
			return -c / 2 * (t * t * t * t - 2);
		} else if (pEase === 'quinticIn') {
			t /= d;
			return c * t * t * t * t * t;
		} else if (pEase === 'quinticOut') {
			t /= d;
			t --;
			return c * (t * t * t * t * t + 1);
		} else if (pEase === 'quinticInOut') {
			t /= d / 2;
			if (t < 1) return c / 2 * t * t * t * t * t;
			t -= 2;
			return c / 2 * (t * t * t * t * t + 2);
		} else if (pEase === 'sineIn') {
			return -c * Math.cos(t / d * (Math.PI / 2)) + c;
		} else if (pEase === 'sineOut') {
			return c * Math.sin(t / d * (Math.PI / 2));
		} else if (pEase === 'sineInOut') {
			return -c / 2 * (Math.cos(Math.PI * t / d) - 1);
		} else if (pEase === 'expoIn') {
			return c * Math.pow(2, 10 * (t / d - 1));
		} else if (pEase === 'expoOut') {
			return c * (-Math.pow(2, -10 * t / d) + 1);
		} else if (pEase === 'expoInOut') {
			t /= d / 2;
			if (t < 1) return c / 2 * Math.pow(2, 10 * (t - 1));
			t --;
			return c / 2 * (-Math.pow(2, -10 * t) + 2);
		} else if (pEase === 'circularIn') {
			t /= d;
			return -c * (Math.sqrt(1 - t * t) - 1);
		} else if (pEase === 'circularOut') {
			t /= d;
			t --;
			return c * Math.sqrt(1 - t * t);
		} else if (pEase === 'circularInOut') {
			t /= d / 2;
			if (t < 1) return -c / 2 * (Math.sqrt(1 - t * t) - 1);
			t -= 2;
			return c / 2 * (Math.sqrt(1 - t * t) + 1);
		}
		return 1;
	};
	diobM.resetTypeFunctions = function(pType, pSkip) {
		var type = diobM.objectType[pType];
		if (!type) return;
		if (type._vy_com) type._vy_com = {};
		if (!pSkip) diobM.setTypeFunctions(pType);
	};
	diobM.setTypeFunctions = function(pType, pRet) {
		var type = diobM.objectType[pType];
		if (!type) return '';
		diobM.setTypeDefaultFunctions(pType);
		var functs = {};
		var oFuncts = {};
		var inherits = [];
		if (type._vy_parentT) {
			if (funcM.oFs[type._vy_parentT._vy_type]) {
				for (var f in funcM.oFs[type._vy_parentT._vy_type]) {
					var t = funcM.oFs[type._vy_parentT._vy_type];
					if (!t.hasOwnProperty(f)) continue;
					functs[f] = t[f];
				}
			} else {
				var parents = [];
				var check = type._vy_parentT;
				while (check) {
					parents.unshift(check); 
					check = check._vy_parentT;
				}
				for (var i = 0, len = parents.length; i < len; i ++) {
					var t = parents[i];
					if (!t) continue;
					if (t._vy_inheritances) diobM.setTypeFunctionsInherit(t._vy_inheritances, functs, oFuncts, inherits);
					if (funcM.oF[t._vy_type]) {
						for (var f in funcM.oF[t._vy_type]) {
							var fS = funcM.oF[t._vy_type][f].toString();
							//if (!funcM.oF[t.type][f] || fS.match(/function[ ]?\(([0-9a-zA-Z_\,]+)?\)\{(override\;)?\}/mi)) continue;
							if (!funcM.oF[t._vy_type][f]) funcM.oF[t._vy_type][f] = 'return retVal;';
							else funcM.oF[t._vy_type][f] = fS.substring(0, fS.length - 1) + 'return retVal;}';
							if (!functs[f]) functs[f] = 'var ';
							functs[f] += 'retVal=(' + funcM.oF[t._vy_type][f] + ').apply(this,arguments);';
							var oF = fS.match(/function[ ]?\(([0-9a-zA-Z_\,]+)?\)\{override\;(.*)\}/mi);
							if (oF) oFuncts[f] = 'var retVal=(function(' + (oF[1] || '') + '){' + (oF[2] || '') + 'return retVal;}).apply(this,arguments);';
						}
					}
				}
			}
		}
		if (type._vy_inheritances) diobM.setTypeFunctionsInherit(type._vy_inheritances, functs, oFuncts, inherits);
		if (funcM.oF[type._vy_type]) {
			for (var f in funcM.oF[type._vy_type]) {
				var fS = funcM.oF[type._vy_type][f].toString();
				//if (!funcM.oF[type._vy_type][f] || fS.match(/function[ ]?\(([0-9a-zA-Z_\,]+)?\)\{(override\;)?\}/mi)) continue;
				if (!funcM.oF[type._vy_type][f]) funcM.oF[type._vy_type][f] = 'return retVal;';
				else funcM.oF[type._vy_type][f] = fS.substring(0, fS.length - 1) + 'return retVal;}';
				if (!functs[f]) functs[f] = 'var ';
				functs[f] += 'retVal=(' + funcM.oF[type._vy_type][f] + ').apply(this,arguments);';
				var oF = fS.match(/function[ ]?\(([0-9a-zA-Z_\,]+)?\)\{override\;(.*)\}/mi);
				if (oF) oFuncts[f] = 'var retVal=(function(' + (oF[1] || '') + '){' + (oF[2] || '') + 'return retVal;}).apply(this,arguments);';
			}
		}
		var e = '';
		for (var f in functs) {
			if (!funcM.oFs[pType]) funcM.oFs[pType] = {};
			if (oFuncts[f]) {
				funcM.oFs[pType][f] = oFuncts[f];
				e += 'diobM.objectType["' + pType + '"]["' + f + '"]=' + 'function(){' + oFuncts[f] + 'return retVal;};\n';
			} else {
				funcM.oFs[pType][f] = functs[f];
				e += 'diobM.objectType["' + pType + '"]["' + f + '"]=' + 'function(){' + functs[f] + 'return retVal;};\n';
			}
		}
		if (pRet) return e;
		eval(e);
	};
	diobM.setTypeFunctionsInherit = function(pA, pFuncts, pOFuncts, pInherits) {
		for (var i = 0, len = pA.length; i < len; i ++) {
			var split = pA[i].split('/');
			var type = '';
			for (var i2 = 0, len2 = split.length; i2 < len2; i2 ++) {
				if (type) type += '/';
				type += split[i2];
				var t = diobM.objectType[type];
				if (!t) continue;
				if (pInherits.includes(type)) continue;
				pInherits.push(type);
				if (t._vy_inheritances) diobM.setTypeFunctionsInherit(t._vy_inheritances, pFuncts, pOFuncts, pInherits);
				if (funcM.oF[t._vy_type]) {
					for (var f in funcM.oF[t._vy_type]) {
						var fS = funcM.oF[t._vy_type][f].toString();
						//if (!funcM.oF[t._vy_type][f] || fS.match(/function[ ]?\(([0-9a-zA-Z_\,]+)?\)\{(override\;)?\}/mi)) continue;
						if (!funcM.oF[t._vy_type][f]) funcM.oF[t._vy_type][f] = 'return retVal;';
						else funcM.oF[t._vy_type][f] = fS.substring(0, fS.length - 1) + 'return retVal;}';
						if (!pFuncts[f]) pFuncts[f] = 'var ';
						pFuncts[f] += 'retVal=(' + funcM.oF[t._vy_type][f] + ').apply(this,arguments);';
						var oF = fS.match(/function[ ]?\(([0-9a-zA-Z_\,]+)?\)\{override\;(.*)\}/mi);
						if (oF) pOFuncts[f] = 'var retVal=(function(' + (oF[1] || '') + '){' + (oF[2] || '') + 'return retVal;}).apply(this,arguments);';
					}
				}
			}
		}
	};
	diobM.setClientTypeFunctions = function() {
		var e = '';
		if (funcM.objCommand['Client']) {
			for (var f in funcM.objCommand['Client']) {
				e += 'clientM.clientType._vy_com["' + f + '"]=' + funcM.objCommand['Client'][f] + ';';
			}
		}
		eval(e);
	};
	diobM.ignoreObVars = ['_vy_inheritances', '_vy_parentT', '_vy_obVars', '_vy_staticVars', '_vy_vyVars', '_vy_vyrVars', '_vy_com'];
	diobM.refreshDiobVars = ['invisibility', 'tag', 'anchor', 'scale', 'width', 'height', 'color', 'alpha', 'composite', 'animator', 'transform', 'anchor', 'angle', 'relayerHeight', 'xOrigin', 'yOrigin'];
	diobM.setTypeVariables = function(pType) {
		var type = diobM.objectType[pType];
		if (!type) return;
		var vars = {};
		if (type._vy_parentT) {
			var parents = [];
			var check = type._vy_parentT;
			while (check) {
				parents.unshift(check);
				check = check._vy_parentT;
			}
			for (var i = 0, len = parents.length; i < len; i ++) {
				var p = parents[i];
				if (p._vy_inheritances) diobM._setTypeVariablesInherit(p._vy_inheritances, vars);
				for (var v in p) {
					if (!p.hasOwnProperty(v)) continue;
					vars[v] = p[v];
				}
			}
		}
		if (type._vy_inheritances) diobM._setTypeVariablesInherit(type._vy_inheritances, vars);
		for (var v in vars) {
			if (type.hasOwnProperty(v) || diobM.ignoreObVars.includes(v)) continue;
			type[v] = vars[v];
		}
		for (var v in type) {
			var cV = type[v];
			if (diobM.ignoreObVars.includes(v)) continue;
			if ((typeof(cV) === 'object' && cV !== null) || Array.isArray(cV)) {
				if (!type._vy_obVars) type._vy_obVars = [];
				if (!type._vy_obVars.includes(v)) type._vy_obVars.push(v);
			} else if (diobM.refreshDiobVars.includes(diobM.defPropR[v]) && type.hasOwnProperty(v)) {
				if (!type._vy_vyrVars) type._vy_vyrVars = [];
				if (!type._vy_vyrVars.includes(v)) type._vy_vyrVars.push(v);
			}
			if (v.startsWith('_vy_') && diobM.defPropR[v]) {
				if (!type._vy_vyVars) type._vy_vyVars = [];
				if (!type._vy_vyVars.includes(v)) type._vy_vyVars.push(v);
			}
		}
	};
	diobM._setTypeVariablesInherit = function(pA, pVars) {
		for (var i2 = 0, len2 = pA.length; i2 < len2; i2 ++) {
			var split = pA[i2].split('/');
			var tType = '';
			for (var i3 = 0, len3 = split.length; i3 < len3; i3 ++) {
				if (tType) tType += '/';
				tType += split[i3];
				var t = diobM.objectType[tType];
				if (!t) continue;
				if (t._vy_inheritances) diobM._setTypeVariablesInherit(t._vy_inheritances, pVars);
				for (var v in t) {
					if (!t.hasOwnProperty(v)) continue;
					pVars[v] = t[v];
				}
			}
		}
	};
	diobM.addInheritance = function(pType, pInherit) {
		if (!pType || !pInherit || !diobM.objectType[pType] || !diobM.objectType[pInherit]) return;
		var t = diobM.objectType[pType];
		if (!t._vy_inheritances) t._vy_inheritances = [];
		if (t._vy_inheritances.indexOf(pInherit) !== -1) return;
		t._vy_inheritances.push(pInherit);
		diobM.resetTypeFunctions(pType);
	};
	diobM.removeInheritance = function(pType, pInherit) {
		if (!pType || !pInherit || !diobM.objectType[pType] || !diobM.objectType[pInherit]) return;
		var t = diobM.objectType[pType];
		if (!t._vy_inheritances || t._vy_inheritances.indexOf(pInherit) === -1) return;
		t._vy_inheritances.splice(t._vy_inheritances.indexOf(pInherit), 1);
		diobM.resetTypeFunctions(pType);
	};
	diobM.getInheritances = function(pType) {
		if (!pType || !diobM.objectType[pType]) return;
		var t = diobM.objectType[pType];
		if (!t._vy_inheritances) return [];
		return t._vy_inheritances;
	};
	diobM.setTypeDefaultFunctions = function(pType) {
		if (!pType || !diobM.objectType[pType]) return;
		var type = diobM.objectType[pType];
		if (type._vy_isLoc || type.isOverlay || type._vy_isRegion) {
			type.setLoc = null;
			type.setCoords = null;
			type.setCoordOffsets = null;
			type.step = null;
			type.stepDir = null;
			type.stepPos = null;
			type.move = null;
			type.moveDir = null;
			type.movePos = null;
			if (type._vy_isLoc || type._vy_isRegion) {
				type.setPos = null;
			}
		} else if (type._vy_baseType === 'Mob') {
			type.getClient = function() {
				if (!this || !this._vy_clCon) return;
				return this._vy_clCon.cOb;
			};
		} else if (type._vy_gui) {
			type.getClient = function() {
				if (!this || !this._vy_clCon) return;
				return this._vy_clCon.cOb;
			};
			type.hide = function() {
				clientM.hideInterface(this._vy_parent._vy_name, this._vy_name);
			};
			type.show = function() {
				clientM.showInterface(this._vy_parent._vy_name, this._vy_name);
			};
			type.getInterfaceName = function() {
				return this._vy_parent._vy_name;
			};
			type.setText = function(pText) {
				return dfM.setTextInt(this, pText);
			};
			type.execute = function(pClient) {
				dfM.onExecute(this, pClient);
			};
			type.setPos = function(pX, pY) {
				dfM.setPosInt(this, pX, pY);
			};
			type.getDOM = function() {
				return this._vy_webBox;
			};
		} else if (type._vy_baseType === 'Client') {
			type.getPlane = function(pPlane) {
				if (pPlane === undefined) return Object.values(scrM.planes);
				return scrM.planes[pPlane];
			};
			type.setPlane = function(pPlane, pVar, pVal) {
				var p = scrM.planes[pPlane];
				if (!p) {
					dfM._setPlane(pPlane);
					p = scrM.planes[pPlane];
				}
				p[pVar] = pVal;
			};
		} else if (type._vy_baseType === 'Sound') {
			Object.setPrototypeOf(type, Sound.prototype);
		};
	};
	diobM.diobOnNew = function(pD, pArgs) {
		if (!pD || !pD.onNew) return;
		if (pArgs) pD.onNew.apply(pD, pArgs);
		else pD.onNew();
	};
	diobM.copyObjectVars = function(pO, pC) {
		for (var v in pC) {
			var pV = pC[v];
			if (pV && pV instanceof Object) {
				var o = (pV.constructor === Array)? [] : {};
				diobM.copyObjectVars(o, pV);
				pO[v] = o;
			} else pO[v] = pV;
		}
	};
};

function ObjectType(pType, pVars, pInherit) {
	var type = this;
	if (diobM.objectType[pType]) type = diobM.objectType[pType];
	var i = pType.indexOf("/");
	var iL = pType.lastIndexOf("/");
	if (i != -1) {
		var p = pType.substring(0, pType.lastIndexOf("/"));
		if (diobM.objectType[p]) type._vy_parentT = diobM.objectType[p];
		//else type._vy_parentT = new ObjectType(p);
		type._vy_baseType = pType.substring(0, i);
	} else {
		type._vy_baseType = pType;
	}
	type._vy_parentType = (iL !== -1)?  pType.substr(0, iL) : '';
	if (pInherit) type._vy_inheritances = pInherit;
	type._vy_type = pType;
	var bType = diobM.objectType[type._vy_baseType];
	if (!type._vy_parentType) bType = type;
	if (bType) {
		var found;
		if (bType._vy_inheritances) {
			for (var i = 0, len = bType._vy_inheritances.length; i < len; i ++) {
				if (mainM.diobTypes.includes(bType._vy_inheritances[i])) {
					found = true;
					break;
				}
			}
		}
		if (mainM.diobTypes.includes(type._vy_baseType) || found) {
			Object.setPrototypeOf(type, Diob.prototype);
		}
	}
	
	var o = type;
	if (pVars) {
		try {
			eval(pVars);
		} catch (pE) {
			dE('unknown', 'unknown', 'Invalid type variable for ' + pType);
		}
	}
	diobM.objectType[pType] = type;
	return type;
};
ObjectType.prototype.setStaticVariable = function(pVar, pVal) {
	stM.Type.setStaticVariable(this._vy_type, pVar, pVal);
};
ObjectType.prototype.getStaticVariable = function(pVar) {
	return stM.Type.getStaticVariable(this._vy_type, pVar);
};

function newDiob(pType, pID, pTemp) {
	if (!pType) pType = diobM.objectType['Diob'];
	var d = Object.create(pType);
	if (pType._vy_obVars) {
		for (var i = pType._vy_obVars.length; i --;) {
			var v = pType._vy_obVars[i];
			d[v] = stM.Util._copyObjectVars((d[v].constructor === Array)? [] : {}, d[v], 0, 0, 1);
		}
	}
	if (pType._vy_vyrVars) {
		if (d._vy_invisibility) d._vy_viewers = [];
		if (d._vy_anchor !== undefined) dfM.setAnchor(d, d._vy_anchor);
		if (d._vy_scale) dfM.setScale(d, d._vy_scale);
		if (d._vy_w !== _vy_t_xTileSize || d._vy_h !== _vy_t_yTileSize) dfM.setSize(d, d._vy_w, d._vy_h);
		if (d._vy_tag) d.setTag(d._vy_tag);
		if (d._vy_xOr || d._vy_yOr) dfM.setOrigin(d, d._vy_xOr, d._vy_yOr);
		if (d._vy_color) dfM.setColor(d, d._vy_color);
		if (d._vy_alpha !== 1) dfM.setAlpha(d, d._vy_alpha);
		else if (d._vy_composite) dfM.setComposite(d, d._vy_composite);
		if (d._vy_animator) dfM.setAnimator(d, d._vy_animator);
		if (d._vy_transform) dfM.setTransform(d, d._vy_transform);
		if (d._vy_angle) dfM.setAngle(d, d._vy_angle);
		if (d._vy_relayerH) d.relayerHeight = d._vy_relayerH;
	}
	if (!pTemp) {
		diobM.objects[dfM.setID(d, pID)] = d;
		if (d._vy_atlas) {
			dfM.setAtlas(d, d._vy_atlas, d._vy_icoName, true);
			if (d._vy_icoState) {
				if (!resM.iconStates.includes(d._vy_icoState)) d._vy_defIconState = 0;
				dfM.setIconState(d, d._vy_icoState, 0, 0, true);
			} else if (d._vy_dir) dfM.setDir(d, d._vy_dir, 1);
		}
	}
	return d;
};

Diob.prototype._vy_w = _vy_t_xTileSize;
Diob.prototype._vy_wH = _vy_t_xTileSizeHalf;
Diob.prototype._vy_icoW = _vy_t_xTileSize;
Diob.prototype._vy_h = _vy_t_yTileSize;
Diob.prototype._vy_hH = _vy_t_yTileSizeHalf;
Diob.prototype._vy_icoH = _vy_t_yTileSize;
Diob.prototype._vy_mouseOp = 2;
Diob.prototype._vy_text = '';
Diob.prototype._vy_angle = 0;
Diob.prototype._vy_scale = undefined;
Diob.prototype._vy_plane = 0;
Diob.prototype._vy_icoName = '';
Diob.prototype._vy_icoState = '';
Diob.prototype._vy_defIconState = 1;
Diob.prototype._vy_invisibility = 0;
Diob.prototype._vy_visibility = 0;
Diob.prototype._vy_xTiles = 1;
Diob.prototype._vy_yTiles = 1;
Diob.prototype._vy_layer = 1;
Diob.prototype._vy_rrelayerH = _vy_t_yTileSize;
Diob.prototype._vy_alpha = 1;
Diob.prototype._vy_xIcoOff = 0;
Diob.prototype._vy_yIcoOff = 0;
Diob.prototype._vy_xCoOff = 0;
Diob.prototype._vy_yCoOff = 0;
Diob.prototype._vy_xOr = 0;
Diob.prototype._vy_yOr = 0;
Diob.prototype.setSpriteData = function(pData, pType) {
	if (!this._vy_pixS) this._vy_pixS = new PIXI.Sprite();
	if (!pData) {
		delete this._vy_sprite;
		scrM.updateScreenSpriteIcon(this);
		return;
	}
	this._vy_sprite = pData;
	if (!pType) pType = 'url';
	if (pType === 'url') this._vy_pixS.texture = PIXI.Texture.from(pData);
};
Diob.prototype.getSpriteData = function(pType) {
	var imageData = (this._vy_ico)? resM.getIconData(this._vy_ico) : defM.blankIcon;
	if (!pType) pType = 'url';
	var s = new PIXI.Sprite(PIXI.Texture.from(imageData));
	if (this._vy_pixS) s.filters = this._vy_pixS.filters;
	if (!scrM.pixiAppOp) scrM.pixiAppOp = new PIXI.Application({'width': this._vy_icoW, 'height': this._vy_icoH, 'transparent': true});
	else scrM.pixiAppOp.renderer.resize(this._vy_icoW, this._vy_icoH);
	scrM.pixiAppOp.stage.addChild(s);
	var data;
	if (pType === 'url') data = scrM.pixiAppOp.renderer.extract.base64(scrM.pixiAppOp.stage);
	else if (pType === 'pixels') data = scrM.pixiAppOp.renderer.extract.pixels(scrM.pixiAppOp.stage);
	else if (pType === 'canvas') data = scrM.pixiAppOp.renderer.extract.canvas(scrM.pixiAppOp.stage);
	for (var i = scrM.pixiAppOp.stage.children.length; i --;) {
		scrM.pixiAppOp.stage.removeChild(scrM.pixiAppOp.stage.children[i]);
	}
	return data;
};
Diob.prototype.setPattern = function(pX, pY, pWidth, pHeight) {
	if (pX === undefined) {
		var scr = this._vy_onScr;
		if (scr) scrM.removeFromScreen(this);
		delete this._vy_pixS;
		delete this._vy_pattern;
		scrM.setScreenSprite(this);
		scrM.updateScreenSprite(this);
		if (scr) scrM.addToScreen(this);
		return;
	}
	if (!this._vy_pattern) {
		var scr = this._vy_onScr;
		if (scr) scrM.removeFromScreen(this);
		this._vy_pixS = new PIXI.TilingSprite((this._vy_ico && this._vy_ico.pixiTex)? this._vy_ico.pixiTex : resM.blankPixiTex);
		this._vy_pattern = 1;
		if (pWidth === undefined) pWidth = this._vy_w;
		if (pHeight === undefined) pHeight = this._vy_h;
		if (scr) scrM.addToScreen(this);
	}
	this._vy_pixS.tilePosition.set(pX, pY);
	if (pWidth !== undefined) this._vy_pixS.width = pWidth;
	if (pHeight !== undefined) this._vy_pixS.height = pHeight;
};
Diob.prototype.setStaticVariable = function(pVar, pVal) {
	stM.Type.setStaticVariable(this._vy_type, pVar, pVal);
};
Diob.prototype.getStaticVariable = function(pVar) {
	return stM.Type.getStaticVariable(this._vy_type, pVar);
};
Diob.prototype.sendPacket = function(pName, pData) {
	if (this.onPacket) this.onPacket(clientM.cOb, pName, pData);
};
Diob.prototype.setTransition = function(pO, pS, pT, pQ, pL, pE) {
	dfM.setTransition(this, pO, pS, pT, pQ, pL, pE);
};
Diob.prototype.setIcon = function(pAtlas, pIcon) {
	dfM.setAtlas(this, pAtlas, pIcon);
};
Diob.prototype.getIcon = function() {
	return {'atlas': this.atlasName, 'icon': this.iconName};
};
Object.defineProperty(Diob.prototype, 'iconName', {
	get: function() {
		return this._vy_icoName;
	},
	set: function(pVal) {
		dfM.setAtlas(this, this.atlasName, pVal);
	}
});
Object.defineProperty(Diob.prototype, 'atlasName', {
	get: function() {
		return this._vy_atlas;
	},
	set: function(pVal) {
		dfM.setAtlas(this, pVal, this._vy_icoName);
	}
});
Diob.prototype.setIconState = function(pState, pFrame) {
	//if (this.isOverlay && this._vy_appMask) return;
	dfM.setIconState(this, pState, 0, pFrame);
};
Diob.prototype.getIconState = function() {
	return this._vy_icoState;
};
Object.defineProperty(Diob.prototype, 'iconState', {
	get: function() {
		return this._vy_icoState;
	},
	set: function(pVal) {
		dfM.setIconState(this, pVal);
	}
});
Diob.prototype.setFrame = function(pFrame, pDelay, pCont) {
	dfM.setFrame(this, pFrame, pDelay, pCont);
};
Diob.prototype.setIconOffsets = function(pX, pY) {
	dfM.setIconOffsets(this, pX, pY);
};
Diob.prototype.getIconOffsets = function() {
	return {'x': this._vy_xIcoOff, 'y': this._vy_yIcoOff};
};
Object.defineProperty(Diob.prototype, 'xIconOffset', {
	get: function() {
		return this._vy_xIcoOff;
	},
	set: function(pVal) {
		dfM.setIconOffsets(this, pVal, this._vy_yIcoOff);
	}
});
Object.defineProperty(Diob.prototype, 'yIconOffset', {
	get: function() {
		return this._vy_yIcoOff;
	},
	set: function(pVal) {
		dfM.setIconOffsets(this, this._vy_xIcoOff, pVal);
	}
});
Diob.prototype.setLayer = function(pLayer) {
	dfM.setLayer(this, pLayer);
};
Diob.prototype.getLayer = function() {
	return this._vy_layer;
};
Object.defineProperty(Diob.prototype, 'layer', {
	get: function() {
		return this._vy_layer;
	},
	set: function(pVal) {
		dfM.setLayer(this, pVal);
	}
});
Object.defineProperty(Diob.prototype, 'relayerHeight', {
	get: function() {
		return this._vy_relayerH;
	},
	set: function(pVal) {
		this._vy_relayerH = pVal;
		this._vy_rrelayerH = pVal;
	}
});
Diob.prototype.setSize = function(pWidth, pHeight) {
	dfM.setSize(this, pWidth, pHeight);
};
Diob.prototype.getSize = function() {
	return {'width': this._vy_w, 'height': this._vy_h};
};
Object.defineProperty(Diob.prototype, 'width', {
	get: function() {
		return this._vy_w;
	},
	set: function(pVal) {
		dfM.setSize(this, pVal, this._vy_h);
	}
});
Object.defineProperty(Diob.prototype, 'height', {
	get: function() {
		return this._vy_h;
	},
	set: function(pVal) {
		dfM.setSize(this, this._vy_w, pVal);
	}
});
Diob.prototype.setAngle = function(pAngle) {
	dfM.setAngle(this, pAngle);
};
Diob.prototype.getAngle = function() {
	return this._vy_angle;
};
Object.defineProperty(Diob.prototype, 'angle', {
	get: function() {
		return this._vy_angle;
	},
	set: function(pVal) {
		dfM.setAngle(this, pVal);
	}
});
Diob.prototype.setAnchor = function(pX, pY) {
	dfM.setAnchor(this, pX, pY);
};
Diob.prototype.getAnchor = function() {
	if (!this._vy_anchor) this._vy_anchor = {'x': 0.5, 'y': 0.5};
	return this._vy_anchor;
};
Object.defineProperty(Diob.prototype, 'anchor', {
	get: function() {
		return this.getAnchor();
	},
	set: function(pVal) {
		dfM.setAnchor(this, pVal);
	}
});
Diob.prototype.setAlpha = function(pAlpha) {
	dfM.setAlpha(this, pAlpha);
};
Diob.prototype.getAlpha = function() {
	return this._vy_alpha;
};
Object.defineProperty(Diob.prototype, 'alpha', {
	get: function() {
		return this._vy_alpha;
	},
	set: function(pVal) {
		dfM.setAlpha(this, pVal);
	}
});
Diob.prototype.setScale = function(pX, pY) {
	dfM.setScale(this, pX, pY);
};
Diob.prototype.getScale = function() {
	if (this._vy_scale === undefined) this._vy_scale = {'x': 1, 'y': 1};
	return this._vy_scale;
};
Object.defineProperty(Diob.prototype, 'scale', {
	get: function() {
		return this._vy_scale;
	},
	set: function(pVal) {
		dfM.setScale(this, pVal);
	}
});
Diob.prototype.setTransform = function(pTransform) {
	dfM.setTransform(this, pTransform);
};
Diob.prototype.getTransform = function(pAsObj) {
	if (pAsObj) {
		var m = this._vy_transform;
		return {'scaleX': m[0], 'skewY': m[1], 'skewX': m[3], 'scaleY': m[4], 'moveX': m[6], 'moveY': m[7]};
	} else return this._vy_transform;
};
Object.defineProperty(Diob.prototype, 'transform', {
	get: function() {
		return this._vy_transform;
	},
	set: function(pVal) {
		dfM.setTransform(this, pVal);
	}
});
Diob.prototype.setAnimator = function(pAnimator) {
	dfM.setAnimator(this, pAnimator);
};
Diob.prototype.getAnimator = function() {
	return this._vy_animator;
};
Object.defineProperty(Diob.prototype, 'animator', {
	get: function() {
		return this._vy_animator;
	},
	set: function(pVal) {
		dfM.setAnimator(this, pVal);
	}
});
Diob.prototype.setColor = function(pColor) {
	dfM.setColor(this, pColor);
};
Diob.prototype.getColor = function() {
	return this._vy_color;
};
Object.defineProperty(Diob.prototype, 'color', {
	get: function() {
		return this._vy_color;
	},
	set: function(pVal) {
		dfM.setColor(this, pVal);
	}
});
Diob.prototype.setMask = function(pMask) {
	dfM.setMask(this, pMask);
};
Diob.prototype.getMask = function() {
	return this._vy_mask;
};
Diob.prototype.setComposite = function(pComposite) {
	dfM.setComposite(this, pComposite);
};
Diob.prototype.getComposite = function() {
	return this._vy_composite;
};
Object.defineProperty(Diob.prototype, 'composite', {
	get: function() {
		return this._vy_composite;
	},
	set: function(pVal) {
		dfM.setComposite(this, pVal);
	}
});
Diob.prototype.setPlane = function(pPlane) {
	dfM.setPlane(this, pPlane);
};
Diob.prototype.getPlane = function() {
	return this._vy_plane;
};
Object.defineProperty(Diob.prototype, 'plane', {
	get: function() {
		return this._vy_plane;
	},
	set: function(pVal) {
		dfM.setPlane(this, pVal);
	}
});
Object.defineProperty(Diob.prototype, 'mouseOpacity', {
	get: function() {
		return this._vy_mouseOp;
	},
	set: function(pVal) {
		this._vy_mouseOp = pVal;
	}
});
Object.defineProperty(Diob.prototype, 'clientSyncData', {
	get: function() {
		return this._vy_cSyncD;
	},
	set: function(pVal) {
		if (this.onClientSyncData) {
			var old = this._vy_cSyncD;
			this._vy_cSyncD = pVal;
			this.onClientSyncData(old);
		} else this._vy_cSyncD = pVal;
	}
});
Object.defineProperty(Diob.prototype, 'density', {
	get: function() {
		return this._vy_density;
	},
	set: function(pVal) {
		this._vy_density = pVal;
	}
});
Diob.prototype.setAppearance = function(pD) {
	for (var i in resM.appearVars) {
		var v = resM.appearVars[i];
		var dV = pD[v];
		if (dV) {
			if (dV instanceof Object && !Array.isArray(dV)) {
				this[v] = {};
				for (var v2 in dV) this[v][v2] = dV[v2];
			} else if (Array.isArray(dV)) this[v] = dV.slice(0);
			else this[v] = dV;
		}
	}

	dfM.setAtlas(this, this._vy_atlas, this._vy_icoName, true);
	if (pD.layer !== undefined) dfM.setLayer(this, pD.layer);
	if (pD.plane !== undefined) dfM.setPlane(this, pD.plane);
	if (pD._vy_scale) dfM.setScale(this, pD._vy_scale.x, pD._vy_scale.y);
	if (pD.transform !== undefined) dfM.setTransform(this, this._vy_transform);
	if (pD._vy_alpha !== undefined) dfM.setAlpha(this, pD._vy_alpha);
	if (pD.angle !== undefined) dfM.setAngle(this, pD.angle);
	if (pD.color !== undefined) dfM.setColor(this, pD.color);
	if (pD.text !== undefined) this.setText(pD.text);
	if (pD.animator !== undefined) dfM.setAnimator(this, pD.animator);
	if (pD.anchor !== undefined) dfM.setAnchor(this, pD._vy_anchor.x, pD._vy_anchor.y);
	if (pD._vy_type) {
		dfM.setOverlays(this, null);
		for (var i in pD._vy_over) {
			var o = pD._vy_over[i];
			var over = dfM.addOverlay(this, o._vy_type, o._vy_appMask, true);
			if (over) over.setAppearance(o);
		}
		if (pD._vy_overScr) {
			var sO = dfM.getOverScreen(pD, 'pixels');
			dfM.setOverScreen(this, sO.x, sO.y, sO.width, sO.height, sO.data, sO.settings);
		} else this._vy_overScr = null;
	}
};
Diob.prototype.setName = function(pName) {
	this._vy_name = pName;
};
Diob.prototype.getName = function() {
	return this._vy_name;
};
Object.defineProperty(Diob.prototype, 'name', {
	get: function() {
		return this.getName();
	},
	set: function(pVal) {
		this.setName(pVal);
	}
});
Diob.prototype.getID = function() {
	return this._vy_id;
};
Object.defineProperty(Diob.prototype, 'id', {
	get: function() {
		return this._vy_id;
	},
	set: function(pVal) {
		if (!pVal) {
			delete diobM.objects[this._vy_id];
			this._vy_id = pVal;
		}
		return;
	}
});
Diob.prototype.getTag = function() {
	return this._vy_tag;
};
Diob.prototype.setTag = function(pTag) {
	if (this._vy_tag) {
		var t = diobM.tags[this._vy_tag];
		if (t) {
			var index = t.indexOf(this);
			if (index >= 0) t.splice(index, 1);
		}
	}
	this._vy_tag = pTag;
	if (!diobM.tags[pTag]) diobM.tags[pTag] = [];
	diobM.tags[pTag].push(this);
};
Object.defineProperty(Diob.prototype, 'tag', {
	get: function() {
		return this._vy_tag;
	},
	set: function(pVal) {
		if (this._vy_tag === pVal) return;
		this.setTag(pVal);
	}
});
Diob.prototype.getType = function() {
	return this._vy_type;
};
Object.defineProperty(Diob.prototype, 'type', {
	get: function() {
		return this._vy_type;
	},
	set: function(pVal) {
		return;
	}
});
Diob.prototype.getBaseType = function() {
	return this._vy_baseType;
};
Object.defineProperty(Diob.prototype, 'baseType', {
	get: function() {
		return this._vy_baseType;
	},
	set: function(pVal) {
		return;
	}
});
Diob.prototype.getParentType = function() {
	return this._vy_parentType;
};
Object.defineProperty(Diob.prototype, 'parentType', {
	get: function() {
		return this._vy_parentType;
	},
	set: function(pVal) {
		return;
	}
});
Diob.prototype.getContents = function(pType, pChild) {
	if (!this._vy_conts) return [];
	if (pType) {
		var arr = [];
		for (var i = 0, len = this._vy_conts.length; i < len; i ++) {
			var obj = this._vy_conts[i];
			if (!obj) continue;
			if (funcM._isType(obj._vy_type, pType, pChild)) {
				arr.push(obj);
			}
		}
		return arr;
	} else return this._vy_conts;
};
Object.defineProperty(Diob.prototype, 'contents', {
	get: function() {
		if (!this._vy_conts) this._vy_conts = [];
		return this._vy_conts;
	},
	set: function(pVal) {
		return;
	}
});
Diob.prototype.getCrossed = function(pType, pChild) {
	if (!this._vy_crossed) this._vy_crossed = [];
	if (pType) {
		var arr = [];
		for (var o in this._vy_crossed) {
			var obj = this._vy_crossed[o];
			if (!obj) continue;
			if (funcM._isType(obj._vy_type, pType, pChild)) {
				arr.push(obj);
			}
		}
		return arr;
	} else return this._vy_crossed;
};
Object.defineProperty(Diob.prototype, 'crossed', {
	get: function() {
		if (!this._vy_crossed) this._vy_crossed = [];
		return this._vy_crossed;
	},
	set: function(pVal) {
		return;
	}
});
Diob.prototype.getCoords = function() {
	return {'x': Math.floor(this._vy_x / _vy_t_xTileSize) + 1, 'y': Math.floor(this._vy_y / _vy_t_yTileSize) + 1};
};
Diob.prototype.setCoords = function(pX, pY, pReset) {
	//dfM.setCoords(this, pX, pY, pReset);
	if (pReset) {
		this._vy_xCoOff = 0;
		this._vy_yCoOff = 0;
	}
	dfM.setPos(this, (pX - 1) * _vy_t_xTileSize + this._vy_xCoOff, (pY - 1) * _vy_t_yTileSize + this._vy_yCoOff, true);
};
Object.defineProperty(Diob.prototype, 'xCoord', {
	get: function() {
		return Math.floor(this._vy_x / _vy_t_xTileSize) + 1;
	},
	set: function(pVal) {
		if (this._vy_isLoc) return;
		this.setLoc(pVal, Math.floor(this._vy_y / _vy_t_yTileSize) + 1);
	}
});
Object.defineProperty(Diob.prototype, 'yCoord', {
	get: function() {
		return Math.floor(this._vy_y / _vy_t_yTileSize) + 1;
	},
	set: function(pVal) {
		if (this._vy_isLoc) return;
		this.setLoc(Math.floor(this._vy_x / _vy_t_xTileSize) + 1, pVal);
	}
});
Diob.prototype.setLoc = function(pVal1, pVal2, pVal3) {
	if (!this._vy_locs) this._vy_locs = [];
	if (!pVal1) {
		dfM.setMap(this, pVal3, -100000, -100000);
		return;
	}
	var x = pVal1;
	var y = pVal2;
	if (typeof(pVal1) === 'number') {
		if (!pVal2) return;
	} else {
		if (pVal1._vy_isLoc) {
			x = Math.floor(pVal1._vy_x / _vy_t_xTileSize) + 1;
			y = Math.floor(pVal1._vy_y / _vy_t_yTileSize) + 1;
			pVal3 = pVal1._vy_mapN;
		} else if (pVal1.loc) {
			x = Math.floor(pVal1._vy_loc._vy_x / _vy_t_xTileSize) + 1;
			y = Math.floor(pVal1._vy_loc._vy_y / _vy_t_yTileSize) + 1;
			pVal3 = pVal1._vy_mapN;
		} else return;
	}
	//if (!pVal3 && !this._vy_mapN && gameM.mainMap) pVal3 = gameM.mainMap;
	if (pVal3) dfM.setMap(this, pVal3, (x - 1) * _vy_t_xTileSize, (y - 1) * _vy_t_yTileSize);
	else {
		this._vy_xCoOff = 0;
		this._vy_yCoOff = 0;
		dfM.setLoc(this, x, y);
	}
};
Diob.prototype.getLoc = function() {
	var tile;
	if (this._vy_isLoc) tile = this;
	else tile = this.loc;
	return tile;
};
Diob.prototype.getLocs = function() {
	if (this._vy_isLoc) return [this];
	else {
		if (!this._vy_locs) this._vy_locs = [];
		return this._vy_locs;
	}
};
Object.defineProperty(Diob.prototype, 'loc', {
	get: function() {
		var map = resM.maps[this._vy_mapN];
		if (!this.isOverlay && !this._vy_isLoc && map) {
			var x = Math.floor(this._vy_x / _vy_t_xTileSize) + 1,
				y = Math.floor(this._vy_y / _vy_t_yTileSize) + 1;
			if (this._vy_origin) {
				if (x <= 0 && this._vy_x + this._vy_xOr >= 0) x = 1;
				if (y <= 0 && this._vy_y + this._vy_yOr >= 0) y = 1;
			}
			this._vy_loc = map.tiles[x + map.xMax * y];
		}
		return this._vy_loc;
	},
	set: function(pVal) {
		if (!pVal) {
			this.setLoc();
			return;
		}
		if (!pVal._vy_isLoc) return;
		dfM.setMap(this, pVal._vy_mapN, pVal._vy_x, pVal._vy_y);
		return;
	}
});
Diob.prototype.getMapName = function() {
	return this._vy_mapN;
};
Object.defineProperty(Diob.prototype, 'mapName', {
	get: function() {
		return this._vy_mapN;
	},
	set: function(pVal) {
		dfM.setMap(this, pVal,this._vy_x, this._vy_y);
	}
});
Diob.prototype.getRegion = function() {
	var region;
	if (this._vy_isRegion) region = this;
	else if (this._vy_isLoc) region = this._vy_region;
	else if (this.loc) region = this.loc._vy_region;
	return region;
};
Object.defineProperty(Diob.prototype, 'region', {
	get: function() {
		return this.getRegion();
	}
});
Diob.prototype.addOverlay = function(pOver, pAppearance, pSkipEvent) {
	return dfM.addOverlay(this, pOver, pAppearance, false, pSkipEvent);
};
Diob.prototype.removeOverlay = function(pOver, pSave) {
	dfM.removeOverlay(this, pOver, pSave);
};
Diob.prototype.getOverlays = function(pType, pChild) {
	if (!this._vy_over) this._vy_over = [];
	if (pType) {
		var arr = [];
		for (var i = 0, len = this._vy_over.length; i < len; i ++) {
			var obj = this._vy_over[i];
			if (!obj) continue;
			if (funcM._isType(obj._vy_type, pType, pChild)) {
				arr.push(obj);
			}
		}
		return arr;
	}
	return this._vy_over;
};
Diob.prototype.setOverlays = function(pOver, pSave) {
	dfM.setOverlays(this, pOver, pSave);
};
Object.defineProperty(Diob.prototype, 'overlays', {
	get: function() {
		return this.getOverlays();
	},
	set: function(pVal) {
		dfM.setOverlays(this, pVal);
	}
});
Diob.prototype.getText = function() {
	return dfM.getText(this);
};
Diob.prototype.setText = function(pText) {
	return dfM.setText(this, pText);
};
Object.defineProperty(Diob.prototype, 'text', {
	get: function() {
		return dfM.getText(this);
	},
	set: function(pVal) {
		this.setText(pVal);
	}
});
Diob.prototype.getTextStyle = function() {
	return this._vy_textSty;
};
Diob.prototype.setTextStyle = function(pTextStyle) {
	dfM.setTextStyle(this, pTextStyle);
};
Object.defineProperty(Diob.prototype, 'textStyle', {
	get: function() {
		if (!this._vy_textSty) this._vy_textSty = {};
		return this._vy_textSty;
	},
	set: function(pVal) {
		this.setTextStyle(pVal);
	}
});
Diob.prototype.setPos = function(pX, pY, pMap) {
	//if (!pMap && !this._vy_mapN && gameM.mainMap && !this.isOverlay) pMap = gameM.mainMap;
	if (pMap && this._vy_mapN !== pMap) {
		dfM.setMap(this, pMap, pX, pY);
	} else dfM.setPos(this, pX, pY);
};
Diob.prototype.getPos = function() {
	return {'x': this._vy_x, 'y': this._vy_y};
};
Object.defineProperty(Diob.prototype, 'xPos', {
	get: function() {
		return this._vy_x;
	},
	set: function(pVal) {
		if (this._vy_isLoc) return;
		if (this._vy_gui) dfM.setPosInt(this, pVal, this._vy_y);
		else dfM.setPos(this, pVal, this._vy_y);
	}
});
Object.defineProperty(Diob.prototype, 'yPos', {
	get: function() {
		return this._vy_y;
	},
	set: function(pVal) {
		if (this._vy_isLoc) return;
		if (this._vy_gui) dfM.setPosInt(this, this._vy_x, pVal);
		else dfM.setPos(this, this._vy_x, pVal);
	}
});
Diob.prototype.setOrigin = function(pX, pY) {
	dfM.setOrigin(this, pX, pY);
};
Diob.prototype.getOrigin = function() {
	return {'x': this._vy_xOr, 'y': this._vy_yOr};
};
Object.defineProperty(Diob.prototype, 'xOrigin', {
	get: function() {
		return this._vy_xOr;
	},
	set: function(pVal) {
		if (this._vy_isLoc) return;
		dfM.setOrigin(this, pVal, this._vy_yOr);
	}
});
Object.defineProperty(Diob.prototype, 'yOrigin', {
	get: function() {
		return this._vy_yOr;
	},
	set: function(pVal) {
		if (this._vy_isLoc) return;
		dfM.setOrigin(this, this._vy_xOr, pVal);
	}
});
Diob.prototype.setInvisibility = function(pLevel) {
	dfM.setInvisibility(this, pLevel);
};
Diob.prototype.getInvisibility = function() {
	return this._vy_invisibility;
};
Object.defineProperty(Diob.prototype, 'invisibility', {
	get: function() {
		return this._vy_invisibility;
	},
	set: function(pVal) {
		dfM.setInvisibility(this, pVal);
	}
});
Diob.prototype.setVisibility = function(pLevel) {
	dfM.setVisibility(this, pLevel);
};
Diob.prototype.getVisibility = function() {
	return this._vy_visibility;
};
Object.defineProperty(Diob.prototype, 'visibility', {
	get: function() {
		return this._vy_visibility;
	},
	set: function(pVal) {
		dfM.setVisibility(this, pVal);
	}
});
Diob.prototype.playAnimation = function(pAtlas, pIcon, pState, pFrame, pEnd, pSet, pFunc) {
	dfM.playAnimation(this, pAtlas, pIcon, pState, pFrame, pEnd, pSet, pFunc);
};
Diob.prototype.getAnimation = function(pVal) {
	if (pVal === 'onFrame') return ((this._vy_anim)? this._vy_anim.frame + 1 : 0);
	if (pVal === 'frameCount') return ((this._vy_ico && this._vy_ico.parent.frames)? this._vy_ico.parent.frames.length : 0);
	if (pVal === 'atlasName') return ((this._vy_ico)? this._vy_icon.atlas : '');
	if (pVal === 'iconName') {
		if (this._vy_ico) {
			if (this._vy_ico.parent.statePar) return this._vy_ico.parent.statePar.name;
			else return this._vy_ico.parent.name;
		} else return '';
	}
	if (pVal === 'iconState') return ((this._vy_ico && this._vy_ico.parent.statePar)? this._vy_ico.parent.name : '');
	if (this._vy_ico) {
		var o = {'onFrame': (this._vy_anim)? this._vy_anim.frame + 1 : 0, 'frameCount': (this._vy_ico.parent.frames)? this._vy_ico.parent.frames.length : 0, 'atlasName': this._vy_ico.atlas};
		if (this._vy_ico.parent.statePar) {
			o.iconName = this._vy_ico.parent.statePar.name;
			o.iconState = this._vy_ico.parent.name;
		} else {
			o.iconName = this._vy_ico.parent.name;
			o.iconState = '';
		}
		return o;
	}
	return {'onFrame': 0, 'frameCount': 0, 'atlasName': '', 'iconName': '', 'iconState': ''};
};
Diob.prototype.addInvisibilityViewer = function(pD) {
	dfM.addInvisibilityViewer(this, pD);
};
Diob.prototype.removeInvisibilityViewer = function(pD) {
	dfM.removeInvisibilityViewer(this, pD);
};
Diob.prototype.getInvisibilityViewers = function() {
	if (!this._vy_viewers) this._vy_viewers = [];
	return this._vy_viewers;
};
Diob.prototype.setCoordOffsets = function(pX, pY) {
	var x = Math.floor(this._vy_x / _vy_t_xTileSize) + 1;
	var y = Math.floor(this._vy_y / _vy_t_yTileSize) + 1;
	this._vy_xCoOff = pX;
	if (this._vy_xCoOff >= gameM.tileSize.width) {
		x += Math.floor(this._vy_xCoOff / gameM.tileSize.width)
		this._vy_xCoOff = this._vy_xCoOff % gameM.tileSize.width
	} else if (this._vy_xCoOff < 0) {
		this._vy_xCoOff = Math.abs(this._vy_xCoOff)
		x -= Math.ceil(this._vy_xCoOff / gameM.tileSize.width)
		this._vy_xCoOff = gameM.tileSize.width - (this._vy_xCoOff % gameM.tileSize.width)
	}
	this._vy_yCoOff = pY;
	if (this._vy_yCoOff >= gameM.tileSize.height) {
		y += Math.floor(this._vy_yCoOff / gameM.tileSize.height)
		this._vy_yCoOff = this._vy_yCoOff % gameM.tileSize.height
	} else if (this._vy_yCoOff < 0) {
		this._vy_yCoOff = Math.abs(this._vy_yCoOff)
		y -= Math.ceil(this._vy_yCoOff / gameM.tileSize.height)
		this._vy_yCoOff = gameM.tileSize.height - (this._vy_yCoOff % gameM.tileSize.height)
	}
	if (!this._vy_locs) this._vy_locs = [];
	dfM.setLoc(this, x, y);
};
Diob.prototype.getCoordOffsets = function() {
	return {'x': this._vy_xCoOff, 'y': this._vy_yCoOff};
};
Object.defineProperty(Diob.prototype, 'xCoordOffset', {
	get: function() {
		return this._vy_xCoOff;
	},
	set: function(pVal) {
		this._vy_xCoOff = pVal;
		if (this._vy_x !== undefined && this._vy_y !== undefined) this.setCoordOffsets(this._vy_xCoOff, this._vy_yCoOff);
	}
});
Object.defineProperty(Diob.prototype, 'yCoordOffset', {
	get: function() {
		return this._vy_yCoOff;
	},
	set: function(pVal) {
		this._vy_yCoOff = pVal;
		if (this._vy_x !== undefined && this._vy_y !== undefined) this.setCoordOffsets(this._vy_xCoOff, this._vy_yCoOff);
	}
});
Diob.prototype.getDir = function() {
	return this._vy_dir;
};
Diob.prototype.setDir = function(pDir) {
	if (!pDir || stM.Map.dirs.indexOf(pDir) === -1) pDir = 'south';
	dfM.setDir(this, pDir);
};
Object.defineProperty(Diob.prototype, 'dir', {
	get: function() {
		return this._vy_dir;
	},
	set: function(pVal) {
		this.setDir(pVal);
	}
});
Diob.prototype.step = function(pArg1, pArg2, pArg3) {
	if (!this.moveSettings) dfM._setMoveSettings(this);
	if (typeof(pArg1) === 'number') {
		return dfM.stepPos(this, pArg1, pArg2, pArg3);
	} else {
		var pos = dfM._getStepPosFromDir(this, pArg1);
		var s = (pArg2 !== undefined)? pArg2 : this.moveSettings.stepSize;
		return dfM.stepPos(this, pos.x * s, pos.y * s, true, pArg1, pArg3);
	}
};
Diob.prototype.stepDir = function(pDir, pSize, pSlide) {
	if (!this.moveSettings) dfM._setMoveSettings(this);
	var pos = dfM._getStepPosFromDir(this, pDir);
	var s = (pSize !== undefined)? pSize : this.moveSettings.stepSize;
	return dfM.stepPos(this, pos.x * s, pos.y * s, true, pDir, pSlide);
};
Diob.prototype.stepPos = function(pX, pY, pGlide, pSlide) {
	if (!this.moveSettings) dfM._setMoveSettings(this);
	return dfM.stepPos(this, pX, pY, pGlide, 0, pSlide);
};
Diob.prototype.move = function(pArg1, pArg2) {
	if (!pArg1) {
		eventM.removeMovementObj(this);
		return;
	}
	if (!this.moveSettings) dfM._setMoveSettings(this);
	var pos;
	if (typeof(pArg1) !== 'number') {
		pos = dfM._getStepPosFromDir(this, pArg1);
		pos.x *= this.moveSettings.stepSize;
		pos.y *= this.moveSettings.stepSize;
	} else {
		pos = {'x': pArg1, 'y': pArg2};
	}
	this._vy_movingX = pos.x;
	this._vy_movingY = pos.y;
	eventM.addMovementObj(this);
};
Diob.prototype.moveDir = function(pDir) {
	if (!pDir) {
		eventM.removeMovementObj(this);
		return;
	}
	if (!this.moveSettings) dfM._setMoveSettings(this);
	var pos = dfM._getStepPosFromDir(this, pDir);
	this._vy_movingX = pos.x;
	this._vy_movingY = pos.y;
	eventM.addMovementObj(this);
};
Diob.prototype.movePos = function(pX, pY) {
	if (!pX) {
		if (!pY) {
			eventM.removeMovementObj(this);
			return;
		} else pX = 0;
	}
	if (!this.moveSettings) dfM._setMoveSettings(this);
	this._vy_movingX = pX;
	this._vy_movingY = pY;
	eventM.addMovementObj(this);
};
Diob.prototype.setOverScreen = function(pX, pY, pWidth, pHeight, pData, pSet) {
	dfM.setOverScreen(this, pX, pY, pWidth, pHeight, pData, pSet);
};
Diob.prototype.getOverScreen = function(pType) {
	return dfM.getOverScreen(this, pType);
};
Diob.prototype.overScreenDraw = function(pArgs) {
	dfM.overScreenDraw(this, pArgs);
};
Diob.prototype.checkScreenShown = function() {
	return (this._vy_onScr)? true : false;
};
Diob.prototype.addFilter = function(pName, pType, pArgs) {
	dfM.addFilter(this, pName, pType, pArgs);
};
Diob.prototype.removeFilter = function(pName) {
	dfM.removeFilter(this, pName);
};
Diob.prototype.getFilters = function() {
	if (!this._vy_filters) this._vy_filters = {};
	return Object.keys(this._vy_filters);
};

function DiobFunc() {
	dfM = this;
	dfM.setID = function(pD, pID) {
		if (!pID) pID = (++diobM.objIDCount);
		pD._vy_id = pID;
		return pID;
	};
	dfM.setName = function(pD, pName) {
		pD.setName(pName);
	};
	dfM.setText = function(pD, pText) {
		if (!pText && pText !== 0) pText = '';
		if (pD._vy_text === pText) return pText;
		pD._vy_text = pText.toString();
		if (pD._vy_onScr) {
			if (pD._vy_gui) {
				if (!pD._vy_webBox) scrM.refreshInt[pD._vy_layer] = true;
			} else {
				if (!pD._vy_pixT) {
					scrM.setScreenSpriteText(pD);
					scrM.updateScreenSprite(pD);
					if (!pD._vy_isLoc) scrM.readdToScreen(pD);
				} else scrM.updateScreenSpriteText(pD);
			}
		}
		return pD._vy_text;
	};
	dfM.setTextInt = function(pD, pText) {
		pText = dfM.setText(pD, pText);
		if (pD._vy_webBox) {
			if (pD._vy_webBox.innerBox.className === 'text_input') {
				pD._vy_webBox.innerBox.value = pText;
			} else {
				if (pD._vy_webBox.innerBox.scrollHeight - pD._vy_webBox.innerBox.scrollTop - 50 <= pD._vy_webBox.innerBox.clientHeight) {
					pD._vy_webBox.innerBox.innerHTML = mainM.getWebText(pText);
					pD._vy_webBox.innerBox.scrollTop = pD._vy_webBox.innerBox.scrollHeight;
				} else pD._vy_webBox.innerBox.innerHTML = mainM.getWebText(pText);
			}
		}
	};
	dfM.getText = function(pD) {
		if (pD._vy_gui && pD._vy_webBox) {
			if (pD._vy_webBox.innerBox.className === 'text_input') pD._vy_text = pD._vy_webBox.innerBox.value;
			else pD._vy_text = pD._vy_webBox.innerBox.innerHTML;
		}
		return pD._vy_text;
	};
	dfM.setTextStyle = function(pD, pStyle) {
		if (!pStyle) pStyle = {};
		pD._vy_textSty = pStyle;
		if (pD._vy_webBox) scrM.setWebBoxStyle(pD);
		if (pD._vy_pixT) {
			if (pD._vy_textSty.anchor) pD._vy_pixT.anchor.set(pD._vy_textSty.anchor.x, pD._vy_textSty.anchor.y);
			else pD._vy_pixT.anchor.set(0, 0);
			if (pD._vy_textSty.scale) {
				pD._vy_pixT.scale.x = pD._vy_textSty.scale.x;
				pD._vy_pixT.scale.y = pD._vy_textSty.scale.y;
			} else {
				pD._vy_pixT.scale.x = 1;
				pD._vy_pixT.scale.y = 1;
			}
			pD._vy_pixT._vy_xPos = pD._vy_textSty.xPos || 0;
			pD._vy_pixT._vy_yPos = pD._vy_textSty.yPos || 0;
		}
		if (pD._vy_onScr) {
			if (pD._vy_pixT) scrM.updateScreenSpriteText(pD);
			if (pD._vy_gui) scrM.refreshInt[pD._vy_layer] = true;
			if (pD._vy_pixS) scrM.updateScreenSpritePosDef(pD, 1);
		}
	};
	dfM.setIcon = function(pD, pIcon, pSkip, pFrame) {
		//if (pD._vy_ico === pIcon) return;
		var ico = pD._vy_ico;
		pD._vy_ico = pIcon;
		if (!pD._vy_appMask || pD._vy_appMask.ownAnim) {
			if (pD._vy_anim && (pFrame || (pD._vy_animator && pD._vy_animator.keepFrame) || pD._vy_anim.keepFrame) && pD._vy_ico && pD._vy_ico.parent.frames) {
				if (pIcon.parent.frames.length > pD._vy_anim.frame) {
					pFrame = 1;
					pD._vy_ico = pD._vy_ico.parent.frames[pD._vy_anim.frame];
					if (!pD._vy_ico) pD._vy_ico = pIcon;
					pIcon = pD._vy_ico;
				} else pFrame = 0;
			}
			if (!pSkip) {
				if (pD._vy_anim && !pFrame) {
					pD._vy_anim.frame = 0;
					pD._vy_anim.timer = 0;
				}
				if (pIcon && pIcon.parent.frames && pIcon.parent.frames.length > 1) {
					if (!pD._vy_anim) dfM._setAnimator(pD);
					if (!pFrame) {
						if (pD._vy_animator) {
							if (pD._vy_animator.reverse) pD._vy_anim.frame = pIcon.parent.frames.length - 1;
							dfM._altFrameDelay(pD);
						}
						pD._vy_anim.lastCheck = performance.now();
					}
					pD._vy_anim.delay = pIcon.parent.frames[pD._vy_anim.frame].delay;
					pD._vy_anim.isPaused = false;
					if (pD._vy_onScr && !pD._vy_onScrAnim) scrM.addScreenAnimation(pD);
				}
			}
			if (pD._vy_anim && !pD._vy_anim.isPaused && (!pD._vy_ico || !pD._vy_ico.parent.frames || pD._vy_ico.parent.frames.length === 1) && !pD._vy_anim.sync && !pD._vy_anim.playAnim) pD._vy_anim.isPaused = true;
		}
		if (pD._vy_onScr) {
			if (pD._vy_ico) {
				if (pD._vy_gui && (!pD._vy_ico.image || !pD._vy_ico.image.src)) {
					if (pD.isOverlay && pD._vy_appMask) resM.loadIconImage(pD._vy_ico, pD.isOverlay, false, true, true);
					else resM.loadIconImage(pD._vy_ico, pD, false, true, true);
				} else if (!pD._vy_ico.loaded) resM.loadIconImage(pD._vy_ico, pD);
			}
			if (pD._vy_pixS) scrM.updateScreenSpriteIcon(pD);
			if (pD._vy_gui) {
				if (pD.isOverlay && pD._vy_appMask) scrM.refreshInt[pD.isOverlay._vy_layer] = true;
				else scrM.refreshInt[pD._vy_layer] = true;
			}
		}
		if (pD.onIconUpdate && pD._vy_ico !== ico) {
			if (ico) {
				if (ico.parent.statePar) {
					pD.onIconUpdate(ico.atlas, ico.parent.statePar.name, ico.parent.name, ((ico.parent.frames)? (ico.parent.frames.indexOf(ico) + 1) : 1));
				} else {
					pD.onIconUpdate(ico.atlas, ico.parent.name, '', ((ico.parent.frames)? (ico.parent.frames.indexOf(ico) + 1) : 1));
				}
			} else pD.onIconUpdate();
		}
	};
	dfM._setAnimator = function(pD) {
		pD._vy_anim = {'frame': 0, 'timer': 0, 'lastCheck': performance.now()};
	};
	dfM._setIconOverlay = function(pD, pO) {
		var ico = pO._vy_ico;
		if (pO._vy_atlas) {
			if (resM.resImg[pO._vy_atlas] && resM.resImg[pO._vy_atlas][pO._vy_icoName]) {
				var icon = resM.resImg[pO._vy_atlas][pO._vy_icoName][pO._vy_icoState];
				if (icon && pD._vy_ico && pD._vy_ico.parent.frames && pD._vy_anim && icon.parent.frames) {
					var newIcon = icon.parent.frames[pD._vy_anim.frame];
					if (newIcon) icon = newIcon;
					else return;
				}
				pO._vy_ico = icon;
			}
		} else pO._vy_ico = null;
		if (pO._vy_ico) {
			if (pO._vy_gui && (!pO._vy_ico.image || !pO._vy_ico.image.src)) {
				if (pO.isOverlay && pO._vy_appMask) resM.loadIconImage(pO._vy_ico, pO.isOverlay, false, true, true);
				else resM.loadIconImage(pO._vy_ico, pO, false, true, true);
			} else if (!pO._vy_ico.loaded) resM.loadIconImage(pO._vy_ico, pO);
		}
		if (pO._vy_onScr && pO._vy_pixS) scrM.updateScreenSpriteIcon(pO, true);
		if (pO.onIconUpdate && pO._vy_ico !== ico) {
			if (ico) {
				if (ico.parent.statePar) {
					pO.onIconUpdate(ico.atlas, ico.parent.statePar.name, ico.parent.name, ((ico.parent.frames)? (ico.parent.frames.indexOf(ico) + 1) : 1));
				} else {
					pO.onIconUpdate(ico.atlas, ico.parent.name, '', ((ico.parent.frames)? (ico.parent.frames.indexOf(ico) + 1) : 1));
				}
			} else pO.onIconUpdate();
		}
	};
	dfM.setFrame = function(pD, pFrame, pDelay, pCont) {
		if (!pD._vy_anim || !pD._vy_ico || !pD._vy_ico.parent.frames) return;
		if (pFrame > pD._vy_ico.parent.frames.length) pFrame = pD._vy_ico.parent.frames.length;
		else if (pFrame <= 0) pFrame = 1;
		if (pD._vy_anim && pD._vy_anim.playAnim) {
			pD._vy_anim.playAnim.frame = pFrame;
			return;
		}
		pD._vy_anim.fF = {'f': pD._vy_anim.frame, 'c': pCont};
		if (pDelay !== undefined) {
			if (!pDelay) pDelay = 0;
			else if (pDelay === -1) {
				if (!pD._vy_animator) pD._vy_animator = {'isPaused': true};
				else pD._vy_animator.isPaused = true;
				pDelay = 0;
			}
			pD._vy_anim.delay = pDelay;
		}
		pD._vy_anim.keepFrame = 1;
		pD._vy_anim.frame = pFrame - 1;
		if (pD._vy_animator && pD._vy_animator.reverse) pD._vy_anim.frame = pFrame + 1;
		dfM._setFrameIcon(pD, pD._vy_anim.frame);
		pD._vy_anim.timer = 0;
		pD._vy_anim.lastCheck = performance.now();
	};
	dfM._altFrameDelay = function(pD) {
		if (!pD._vy_animator || !pD._vy_ico) return;
		pD._vy_anim.delay = pD._vy_ico.delay;
		if (!pD._vy_animator.speed) return;
		if (pD._vy_animator.speed < 0) pD._vy_anim.delay = pD._vy_anim.delay * Math.abs(pD._vy_animator.speed);
		else pD._vy_anim.delay = pD._vy_anim.delay / pD._vy_animator.speed;
		//else if (pD._vy_animator.speed > 1) pD._vy_anim.delay = Math.round(pD._vy_anim.delay / pD._vy_animator.speed);
		//else if (pD._vy_animator.speed < 0) pD._vy_anim.delay = Math.round(pD._vy_anim.delay * Math.abs(pD._vy_animator.speed));
		//if (pD._vy_anim.delay < 1) pD._vy_anim.delay = 1;
	};
	dfM._setFrame = function(pD, pTime) {
		var ms = pTime - pD._vy_anim.lastCheck;
		pD._vy_anim.lastCheck = pTime;
		if (pD._vy_animator && pD._vy_animator.isPaused) return;
		pD._vy_anim.timer += ms;
		if (pD._vy_anim.timer >= pD._vy_anim.delay) {
			if (dfM._setOnFrame(pD, Math.floor(pD._vy_anim.timer / pD._vy_anim.delay))) return;
			var i = dfM._setFrameIcon(pD, pD._vy_anim.frame);
			if (i) pD._vy_anim.delay = i.delay;
			if (pD._vy_animator) dfM._altFrameDelay(pD);
		}
	};
	dfM._setFrameIcon = function(pD, pFrame) {
		var i = (pD._vy_ico.parent.frames)? pD._vy_ico.parent.frames[pFrame] : 0;
		if (!i) i = resM.resImg[pD._vy_atlas][pD._vy_icoName][pD._vy_icoState];
		dfM.setIcon(pD, i, true);
		return i;
	};
	dfM._setOnFrame = function(pD, pAmount) {
		var len = (pD._vy_ico.parent.frames)? pD._vy_ico.parent.frames.length : 1;
		var frames = pAmount;
		if (frames > len) frames = len + (frames % len);
		if (pD._vy_animator && pD._vy_animator.reverse) {
			pD._vy_anim.frame -= frames;
			if (pD._vy_anim.frame < 0) {
				pD._vy_anim.frame = len - 1;
				if (pD._vy_anim.playAnim) {
					if (pD._vy_anim.playAnim.l) pD._vy_anim.playAnim.l --;
					else {
						dfM._stopAnimation(pD);
						return true;
					}
				}
			}
		} else {
			pD._vy_anim.frame += frames;
			if (pD._vy_anim.frame >= len) {
				pD._vy_anim.frame = 0;
				if (pD._vy_anim.playAnim) {
					if (pD._vy_anim.playAnim.l) pD._vy_anim.playAnim.l --;
					else {
						dfM._stopAnimation(pD);
						return true;
					}
				}
			}
		}
		pD._vy_anim.timer -= pD._vy_anim.delay * pAmount;
		if (pD._vy_anim.playAnim && pD._vy_anim.playAnim.eF && pD._vy_anim.playAnim.eF < pD._vy_anim.frame + 1 && !pD._vy_anim.playAnim.l) {
			dfM._stopAnimation(pD);
			return true;
		}
		if (pD._vy_anim.fF) {
			if (!pD._vy_anim.fF.c) {
				pD._vy_anim.frame = pD._vy_anim.fF.f;
				if (pD._vy_animator && pD._vy_animator.reverse) pD._vy_anim.frame = pD._vy_anim.fF.f;
				dfM._setFrameIcon(pD, pD._vy_anim.frame);
			}
			pD._vy_anim.fF = 0;
		}
		if (pD._vy_anim.keepFrame) pD._vy_anim.keepFrame = 0;
	};
	dfM.setIconState = function(pD, pState, pMove, pFrame, pForce) {
		if (!pState) pState = '';
		if (pD._vy_anim) {
			if (pD._vy_anim.playAnim) {
				pD._vy_anim.playAnim.state = pState;
				return;
			}
			if (!pFrame && ((pD._vy_animator && pD._vy_animator.keepFrame) || pD._vy_anim.keepFrame)) pFrame = true;
		}
		if (pD._vy_recheckState) {
			delete pD._vy_recheckState;
			delete pD._vy_recheckStateM;
		}
		if (pD._vy_icoState === pState && !pForce) return;
		var icon;
		if (resM.resImg[pD._vy_atlas] && resM.resImg[pD._vy_atlas][pD._vy_icoName]) {
			icon = resM.resImg[pD._vy_atlas][pD._vy_icoName][pState];
			if (!icon && resM.iconStates.includes(pState)) {
				pD._vy_recheckState = pState;
				var newState = (pD._vy_currCarDir)? pD._vy_currCarDir : pD._vy_dir;
				if (pMove) {
					pD._vy_recheckStateM = 1;
					pState = pState.substr(5);
					icon = resM.resImg[pD._vy_atlas][pD._vy_icoName][pState];
					if (!icon) {
						if (!resM.resImg[pD._vy_atlas][pD._vy_icoName]['move_' + newState]) pState = newState;
						else pState = 'move_' + newState;
						icon = resM.resImg[pD._vy_atlas][pD._vy_icoName][pState];
						if (!icon) pState = '';
					}
				} else if (!stM.Map._cDirs.includes(pState)) {
					pState = newState;
					icon = resM.resImg[pD._vy_atlas][pD._vy_icoName][pState];
				}
				if (!icon && pState) {
					pState = '';
					icon = resM.resImg[pD._vy_atlas][pD._vy_icoName][pState];
				}
				if (pD._vy_icoState === pState && !pForce) return;
			}
		}
		//var old = pD._vy_icoState;
		if (pState === undefined) pState = '';
		pD._vy_icoState = pState;
		if (resM.iconStates.includes(pD._vy_icoState)) pD._vy_defIconState = 1;
		else pD._vy_defIconState = 0;
		if (icon) {
			if (pD.isOverlay && pD._vy_appMask && !pD._vy_appMask.ownAnim) {
				dfM._setIconOverlay(pD.isOverlay, pD);
			} else {
				dfM.setIcon(pD, icon, false, pFrame);
			}
			dfM._setIconSize(pD);
		}
		if (pD._vy_firstOverApp || pD._vy_firstUnderApp) {
			for (var i = pD._vy_over.length; i --;) {
				var over = pD._vy_over[i];
				if (over && over._vy_appMask && !over._vy_appMask.ownState) dfM.setIconState(over, pD._vy_icoState, pMove, pFrame, pForce);
			}
		}
	};
	dfM.setAtlas = function(pD, pAtlas, pName, pForce) {
		if (pD.isOverlay && pD._vy_appMask) {
			if (pD._vy_appMask.shareIcon) pName = pD.isOverlay._vy_icoName;
			if (!pD._vy_appMask.ownState && pD._vy_icoState !== pD.isOverlay._vy_icoState) pD._vy_icoState = pD.isOverlay._vy_icoState;
		}
		if (pD._vy_atlas === pAtlas && pD._vy_icoName === pName) {
			if (!pForce) return;
		} else {
			pD._vy_atlas = pAtlas;
			pD._vy_icoName = pName;
			if (pD._vy_solidColor && pAtlas) {
				delete pD._vy_solidColor;
				if (pD._vy_onScr) {
					scrM.removeFromScreen(pD, 0, 0, 1);
					delete pD._vy_pixS;
					scrM.addToScreen(pD, 1);
				} else delete pD._vy_pixS;
			}
		}
		if (pD._vy_anim && pD._vy_anim.playAnim) {
			pD._vy_anim.playAnim.atlas = pAtlas;
			pD._vy_anim.playAnim.icon = pName;
			return;
		}
		if (pD._vy_firstOverApp || pD._vy_firstUnderApp) {
			for (var i = pD._vy_over.length; i --;) {
				var over = pD._vy_over[i];
				if (over._vy_appMask && over._vy_appMask.shareIcon) {
					dfM.setAtlas(over, over._vy_atlas, pName, pForce);
				}
			}
		}
		if (pD._vy_onScr || !pD._vy_isLoc) {
			resM.setObjectIcon(pD);
			if (!pD._vy_ico && pD._vy_atlas) dfM.setIconState(pD, pD._vy_icoState, pD._vy_moving, 0, true);
			else if (pD._vy_gui) scrM.refreshInt[pD._vy_layer] = true;
			dfM._setIconSize(pD);
			//if (pD._vy_onScr && pD._vy_pixS) scrM.updateScreenSpritePos(pD);
		}
    };
	dfM._setIconSize = function(pD, pForce) {
		var icon = pD._vy_ico;
		if (icon) {
			if (pD._vy_icoW !== icon.width || pD._vy_icoH !== icon.height) {
				pD._vy_icoW = icon.width;
				pD._vy_icoH = icon.height;
				if (!pD._vy_relayerH && pD._vy_rrelayerH !== icon.height) pD._vy_rrelayerH = pD._vy_icoH;
				dfM._setIconSizeCheck(pD);
			}
		} else if (pD._vy_icoW !== pD._vy_w || pD._vy_icoH !== pD._vy_h) {
			pD._vy_icoW = pD._vy_w;
			pD._vy_icoH = pD._vy_h;
			if (!pD._vy_relayerH && pD._vy_rrelayerH !== pD._vy_h) pD._vy_rrelayerH = pD._vy_icoH;
			dfM._setIconSizeCheck(pD);
		} else if (pForce) dfM._setIconSizeCheck(pD);
	};
	dfM._setIconSizeCheck = function(pD) {
		if (pD._vy_scale && (pD._vy_scale.x !== 1 || pD._vy_scale.y !== 1)) {
			if (!pD._vy_anchor) pD.getAnchor();
			if (pD._vy_scale.x) {
				pD._vy_icoXS = -(pD._vy_icoW * (pD._vy_scale.x - 1) * pD._vy_anchor.x);
				pD._vy_icoWS = pD._vy_icoW * pD._vy_scale.x;
			} else {
				pD._vy_icoXS = 0;
				pD._vy_icoWS = pD._vy_icoW;
			}
			if (pD._vy_scale.y) {
				pD._vy_icoYS = -(pD._vy_icoH * (pD._vy_scale.y - 1) * pD._vy_anchor.y);
				pD._vy_icoHS = pD._vy_icoH * pD._vy_scale.y;
			} else {
				pD._vy_icoYS = 0;
				pD._vy_icoHS = pD._vy_icoH;
			}
		} else if (pD._vy_iconWS) {
			delete pD._vy_icoXS;
			delete pD._vy_icoYS;
			delete pD._vy_icoWS;
			delete pD._vy_icoHS;
		}
		dfM._checkOffGrid(pD);
		dfM._setPosData(pD);
	};
	dfM.setPos = function(pD, pX, pY, pSkip, pSkip2, pForce) {
		var oX = pD._vy_x;
		var oY = pD._vy_y;
		var oMap = pD._vy_mapN;
		pD._vy_x = pX;
		pD._vy_y = pY;
		dfM._setPosData(pD);
		if ((!pSkip2 && pD._vy_x === oX && pD._vy_y === oY) || pD.isOverlay) return;
		if (!pSkip) {
			pD._vy_xCoOff = pX % _vy_t_xTileSize;
			pD._vy_yCoOff = pY % _vy_t_yTileSize;
			if (!pD._vy_locs) pD._vy_locs = [];
			if (resM.maps[pD._vy_mapN]) dfM.setLoc(pD, Math.floor(pX / _vy_t_xTileSize) + 1, Math.floor(pY / _vy_t_yTileSize) + 1, false, true, true);
			//else dfM.setCoords(pD, Math.floor(pX / _vy_t_xTileSize) + 1, Math.floor(pY / _vy_t_yTileSize) + 1, false, true);
		}
		if (pD.onRelocated && (!pSkip2 || pForce)) pD.onRelocated(oX, oY, oMap);
	};
	dfM.setPosInt = function(pD, pX, pY) {
		var oX = pD._vy_x;
		var oY = pD._vy_y;
		pD._vy_x = pX;
		pD._vy_y = pY;
		if (pD._vy_webBox) scrM.scaleWebBox(pD);
		/*if (pD.edgeLock) {
			pD._vy_yPoL = pD._vy_y;
			pD._vy_xPoL = pD._vy_x;
		}*/
		if (pD._vy_x === oX && pD._vy_y === oY) return;
		if (pD._vy_onScr) {
			scrM.refreshInt[pD._vy_layer] = true;
			if (pD._vy_over) {
				for (var i = pD._vy_over.length; i --;) {
					scrM.refreshInt[pD._vy_over[i]._vy_layer] = true;
				}
			}
		}
		if (pD.onRelocated) pD.onRelocated(oX, oY);
	};
	dfM.setOrigin = function(pD, pX, pY) {
		pD._vy_xOr = pX;
		pD._vy_yOr = pY;
		//pD._vy_yTiles = Math.floor(pD._vy_h / _vy_t_yTileSize) + 1;
		//pD._vy_xTiles = Math.floor(pD._vy_w / _vy_t_xTileSize) + 1;
		if (pD._vy_xOr || pD._vy_yOr) pD._vy_origin = 1;
		else delete pD._vy_origin;
		if (!pD.isOverlay && pD.loc) dfM.setLoc(pD, Math.floor(pD._vy_x / _vy_t_xTileSize) + 1, Math.floor(pD._vy_y / _vy_t_yTileSize) + 1);
	};
	dfM.setIconOffsets = function(pD, pX, pY) {
		if (pD._vy_xIcoOff === pX && pD._vy_yIcoOff === pY) return;
		pD._vy_xIcoOff = pX;
		pD._vy_yIcoOff = pY;
		dfM._checkOffGrid(pD);
		dfM._setPosData(pD);
		if (pD._vy_onScr) {
			if (pD._vy_pixS) scrM.updateScreenSpritePos(pD);
			else if (pD._vy_gui) scrM.refreshInt[pD._vy_layer] = true;
		}
	};
	dfM._setPosData = function(pD) {
		if (pD._vy_isOffGrid) {
			var dMap = resM.maps[pD._vy_mapN];
			if (!dMap) {
				if (pD._vy_offGridLocs) dfM._clearOffGridLocs(pD);
				return;
			}
			var newLocs = [];
			if (pD._vy_icoWS) {
				for (var x = Math.floor((pD._vy_x + pD._vy_xIcoOff + pD._vy_icoXS) / _vy_t_xTileSize) + 1, xLen = Math.floor((pD._vy_x + pD._vy_xIcoOff + pD._vy_icoXS + pD._vy_icoWS) / _vy_t_xTileSize) + 1; x <= xLen; x ++) {
					for (var y = Math.floor((pD._vy_y + pD._vy_yIcoOff + pD._vy_icoYS) / _vy_t_yTileSize) + 1, yLen = Math.floor((pD._vy_y + pD._vy_yIcoOff + pD._vy_icoYS + pD._vy_icoHS) / _vy_t_yTileSize) + 1; y <= yLen; y ++) {
						var loc = dMap.tiles[x + dMap.xMax * y];
						if (loc) newLocs.push(loc);
					}
				}
			} else {
				for (var x = Math.floor((pD._vy_x + pD._vy_xIcoOff) / _vy_t_xTileSize) + 1, xLen = Math.floor((pD._vy_x + pD._vy_xIcoOff + pD._vy_icoW) / _vy_t_xTileSize) + 1; x <= xLen; x ++) {
					for (var y = Math.floor((pD._vy_y + pD._vy_yIcoOff) / _vy_t_yTileSize) + 1, yLen = Math.floor((pD._vy_y + pD._vy_yIcoOff + pD._vy_icoH) / _vy_t_yTileSize) + 1; y <= yLen; y ++) {
						var loc = dMap.tiles[x + dMap.xMax * y];
						if (loc) newLocs.push(loc);
					}
				}
			}
			if (pD._vy_offGridLocs) dfM._clearOffGridLocs(pD, newLocs);
			for (var i = newLocs.length; i --;) {
				var loc = newLocs[i];
				if (!loc._vy_offGridDiobs) loc._vy_offGridDiobs = [pD];
				else if (!loc._vy_offGridDiobs.includes(pD)) loc._vy_offGridDiobs.push(pD);
				if (!pD._vy_onScr && loc._vy_onScr) scrM.addToScreen(pD);
			}
			pD._vy_offGridLocs = newLocs;
		}
		if (pD._vy_onScr && pD._vy_pixS) scrM.updateScreenSpritePos(pD);
	};
	dfM._checkOffGrid = function(pD) {
		if (!pD._vy_isLoc && !pD._vy_gui && !pD.isOverlay) {
			if (Math.abs(pD._vy_xIcoOff) > _vy_t_xTileSize || Math.abs(pD._vy_yIcoOff) > _vy_t_yTileSize || (pD._vy_scale && (pD._vy_scale.x || pD._vy_scale.y))) {
				pD._vy_isOffGrid = 1;
				return;
			} else if (pD._vy_icoW >= pD._vy_w || pD._vy_icoH >= pD._vy_h) {
				pD._vy_isOffGrid = 1;
				return;
			}
		}
		if (pD._vy_isOffGrid) delete pD._vy_isOffGrid;
	};
	dfM._clearOffGridLocs = function(pD, pNew) {
		var locs = pD._vy_offGridLocs;
		for (var i = locs.length; i --;) {
			var loc = locs[i];
			if (!loc || !loc._vy_offGridDiobs) continue;
			if (!pNew || !pNew.includes(loc)) {
				loc._vy_offGridDiobs.splice(loc._vy_offGridDiobs.indexOf(pD), 1);
			}
		}
		if (!pNew) pD._vy_offGridLocs = [];
	};
	/*dfM.setCoords = function(pD, pX, pY, pReset, pSkip, pSkip2) {
		pD._vy_xCo = pX;
		pD._vy_yCo = pY;
		if (pReset) {
			pD._vy_xCoOff = 0;
			pD._vy_yCoOff = 0;
		}
		if (!pSkip2) dfM.setPos(pD, (pX - 1) * _vy_t_xTileSize + pD._vy_xCoOff, (pY - 1) * _vy_t_yTileSize + pD._vy_yCoOff, true, pSkip);
	};*/
	dfM.setMap = function(pD, pMap, pX, pY, pSkip, pSkip2) {
		if (pMap) {
			if (pD._vy_mapN !== pMap) {
				if (!resM.maps[pMap] || !resM.maps[pMap].isLoaded) {
					if (!resM.loadingResources['map_' + pMap]) resM.loadMap(pMap);
					if (resM.loadingResources['map_' + pMap]) {
						if (!pD._vy_waitingMap || pD._vy_waitingMap.map !== pMap) {
							dfM._setMap(pD, null, undefined, undefined, 1, pSkip2);
							if (pD.onMapChange) pD.onMapChange(pMap, true);
							resM.loadingResources['map_' + pMap].diobs.push(pD);
						}
						pD._vy_waitingMap = {'map': pMap, 'x': pX, 'y': pY, 's': pSkip};
						return;
					}
				}
			}
			dfM._setMap(pD, pMap, pX, pY, pSkip, pSkip2);
		} else {
			dfM._setMap(pD, pMap, -100000, -100000, pSkip, pSkip2);
			//dfM.setCoords(pD, pX, pY, pReset, pSkip, true);
		}
	};
	dfM._setMap = function(pD, pMap, pX, pY, pSkip, pSkip2) {
		var oX = pD._vy_x;
		var oY = pD._vy_y;
		var oMap = pD._vy_mapN;
		if (pD._vy_mapN !== pMap) {
			if (pD._vy_locs) {
				for (var i = pD._vy_locs.length; i --;) {
					dfM.removeFromContents(pD._vy_locs[i], pD);
				}
			}
			if (pD._vy_crossed) {
				for (var i = pD._vy_crossed.length; i --;) {
					var obj = pD._vy_crossed[i];
					if (obj && obj._vy_crossed) obj._vy_crossed.splice(obj._vy_crossed.indexOf(pD), 1);
					pD._vy_crossed.splice(i, 1);
					if (pD.onUncrossed) pD.onUncrossed(obj);
					if (obj && obj.onUncrossed) obj.onUncrossed(pD);
				}
				if (!pD._vy_type) return;
			}
			if (pD._vy_onScr) scrM.removeFromScreen(pD);
			pD._vy_mapN = pMap;
			if (pD._vy_clCon) resM.setMap(pD._vy_mapN);
			if (pD._vy_over) {
				for (var i = pD._vy_over.length; i --;) {
					pD._vy_over[i]._vy_mapN = pD._vy_mapN;
				}
			}
			if (pD.onMapChange && !pSkip) pD.onMapChange(oMap, false);
		}
		if (!pSkip2) {
			if (!pD._vy_locs) pD._vy_locs = [];
			if (pX !== undefined && pY !== undefined) {
				pD._vy_x = pX;
				pD._vy_y = pY;
			}
			dfM.setPos(pD, pD._vy_x, pD._vy_y, false, true);
			/*if (resM.maps[pMap]) {
				if (pX && pY) dfM.setLoc(pD, pX, pY, pSkip, true);
				else dfM.setLoc(pD, Math.floor(pD._vy_x / _vy_t_xTileSize) + 1, Math.floor(pD._vy_y / _vy_t_yTileSize) + 1, pSkip, true);
			} else {
				//dfM.setCoords(pD, pX, pY, pReset, true);
				dfM.setPos(pD, (pX - 1) * _vy_t_xTileSize + pD._vy_xCoOff, (pY - 1) * _vy_t_yTileSize + pD._vy_yCoOff, true, true);
			}*/
			if (pD.onRelocated && !pSkip) pD.onRelocated(oX, oY, oMap);
		}
	};
	dfM.setLoc = function(pD, pX, pY, pSkip, pSkip2, pSkip3) {
		//dfM.setCoords(pD, pX, pY, pReset, pSkip2, pSkip3);
		if (!pSkip3) dfM.setPos(pD, (pX - 1) * _vy_t_xTileSize + pD._vy_xCoOff, (pY - 1) * _vy_t_yTileSize + pD._vy_yCoOff, true, pSkip2);
		for (var i = pD._vy_locs.length; i --;) {
			var tile = pD._vy_locs[i];
			if (pD._vy_x + pD._vy_xOr + pD._vy_w <= tile._vy_x || pD._vy_x + pD._vy_xOr >= tile._vy_x + _vy_t_xTileSize || pD._vy_y + pD._vy_yOr + pD._vy_h <= tile._vy_y || pD._vy_y + pD._vy_yOr >= tile._vy_y + _vy_t_yTileSize) {
				dfM.removeFromContents(tile, pD);
			}
		}
		if (pD._vy_crossed) {
			for (var i = pD._vy_crossed.length; i --;) {
				var obj = pD._vy_crossed[i];
				if (!obj || !obj._vy_type || pD._vy_x + pD._vy_xOr + pD._vy_w <= obj._vy_x + obj._vy_xOr || pD._vy_x + pD._vy_xOr >= obj._vy_x + obj._vy_xOr + obj._vy_w || pD._vy_y + pD._vy_yOr + pD._vy_h <= obj._vy_y + obj._vy_yOr || pD._vy_y + pD._vy_yOr >= obj._vy_y + obj._vy_yOr + obj._vy_h) {
					if (obj && obj._vy_crossed) obj._vy_crossed.splice(obj._vy_crossed.indexOf(pD), 1);
					pD._vy_crossed.splice(i, 1);
					if (pD.onUncrossed) pD.onUncrossed(obj);
					if (obj && obj.onUncrossed) obj.onUncrossed(pD);
				}
			}
			if (!pD._vy_type) return;
		}
		var crossed, crossedReloc, newLoc, map = resM.maps[pD._vy_mapN];
		if (map) {
			if (pD._vy_xOr) pX += Math.floor(pD._vy_xOr / _vy_t_xTileSize);
			if (pD._vy_yOr) pY += Math.floor(pD._vy_yOr / _vy_t_yTileSize);
			for (var y = pY, yLen = y + pD._vy_yTiles; y <= yLen; y ++) {
				for (var x = pX, xLen = x + pD._vy_xTiles; x <= xLen; x ++) {
					var tile = map.tiles[x + map.xMax * y];
					if (!tile || pD._vy_x + pD._vy_xOr + pD._vy_w <= tile._vy_x || pD._vy_x + pD._vy_xOr >= tile._vy_x + _vy_t_xTileSize || pD._vy_y + pD._vy_yOr + pD._vy_h <= tile._vy_y || pD._vy_y + pD._vy_yOr >= tile._vy_y + _vy_t_yTileSize) continue;
					if (dfM.addToContents(tile, pD, pSkip)) newLoc = true;
					if (!pD._vy_isParticle) {
						for (var i = tile._vy_conts.length; i --;) {
							var obj = tile._vy_conts[i];
							if (!obj._vy_type || obj === pD || pD._vy_x + pD._vy_xOr + pD._vy_w <= obj._vy_x + obj._vy_xOr || pD._vy_x + pD._vy_xOr >= obj._vy_x + obj._vy_xOr + obj._vy_w || pD._vy_y + pD._vy_yOr + pD._vy_h <= obj._vy_y + obj._vy_yOr || pD._vy_y + pD._vy_yOr >= obj._vy_y + obj._vy_yOr + obj._vy_h) continue;
							if (pD._vy_crossed && pD._vy_crossed.includes(obj)) {
								if (pD.onCrossedRelocated || obj.onCrossedRelocated) {
									if (!crossedReloc) crossedReloc = [];
									if (!crossedReloc.includes(obj)) crossedReloc.push(obj);
								}
								continue;
							}
							if (!crossed) crossed = [];
							if (!crossed.includes(obj)) crossed.push(obj);
						}
					}
				}
			}
			if (crossed) {
				for (var i = 0, len = crossed.length; i < len; i ++) {
					var obj = crossed[i];
					if (!pD._vy_crossed) pD._vy_crossed = [obj];
					else pD._vy_crossed.push(obj);
					if (!obj._vy_crossed) obj._vy_crossed = [pD];
					else obj._vy_crossed.push(pD);
					if (obj.onCrossed) obj.onCrossed(pD, true);
					if (pD.onCrossed) pD.onCrossed(obj);
					if (!pD._vy_type) return;
				}
			}
			if (crossedReloc) {
				for (var i = 0, len = crossedReloc.length; i < len; i ++) {
					var obj = crossedReloc[i];
					if (pD.onCrossedRelocated) pD.onCrossedRelocated(obj);
					if (obj.onCrossedRelocated) obj.onCrossedRelocated(pD, 1);
					if (!pD._vy_type) return;
				}
			}
		}
		if (pD._vy_onScr) {
			if (!pD.preventScreenRelayer) pD._vy_onScrRelayer = true;
			if (pD.onScreenMoved) pD.onScreenMoved(clientM.cOb);
		}
		if (pD._vy_isViewEye) scrM.setViewFromObject(pD, newLoc);
	};
	dfM.setSize = function(pD, pWidth, pHeight) {
		pD._vy_w = pWidth;
		pD._vy_wH = Math.round(pD._vy_w / 2);
		pD._vy_h = pHeight;
		pD._vy_hH = Math.round(pD._vy_h / 2);
		pD._vy_yTiles = Math.floor(pD._vy_h / _vy_t_yTileSize) + 1;
		pD._vy_xTiles = Math.floor(pD._vy_w / _vy_t_xTileSize) + 1;
		dfM._checkOffGrid(pD);
		if (pD._vy_gui) {
			if (pD._vy_webBox) scrM.setWebBoxSize(pD);
			if (pD._vy_onScr) scrM.refreshInt[pD._vy_layer] = true;
		} else if (!pD.isOverlay && pD.loc) dfM.setLoc(pD, Math.floor(pD._vy_x / _vy_t_xTileSize) + 1, Math.floor(pD._vy_y / _vy_t_yTileSize) + 1);
		if (pD._vy_isViewEye) {
			scrM.xViewEye = scrM.mapWidthHalf - pD._vy_wH + scrM.xScrOff;
			scrM.yViewEye = scrM.mapHeightHalf - pD._vy_hH + scrM.yScrOff;
		}
	};
	dfM._checkDrawModified = function(pD) {
		if (pD._vy_angle !== 0 || pD._vy_alpha !== 1 || pD._vy_scale || pD._vy_transform || pD._vy_composite || (pD._vy_anchor && (pD._vy_anchor.x || pD._vy_anchor.y))) {
			pD._vy_drawModified = true;
		} else pD._vy_drawModified = false;
		if (pD._vy_onScr && pD._vy_gui) {
			if (pD.isOverlay && pD._vy_appMask) scrM.refreshInt[pD.isOverlay._vy_layer] = true;
			else scrM.refreshInt[pD._vy_layer] = true;
		}
	};
	dfM.setTransition = function(pD, pO, pS, pT, pQ, pL, pE, pSkip, pSkip2) {
		if (!pD._vy_transitions) pD._vy_transitions = {};
		if (!pQ && !pL) {
			if (pD._vy_transQ) pD._vy_transQ = [];
			if (pD._vy_transL) pD._vy_transL = [];
		}
		if (!pO) {
			for (var v in pD._vy_transitions) {
				if (!pD._vy_transitions.hasOwnProperty(v)) continue;
				pD[v] = pD._vy_transitions[v].v;
				delete pD._vy_transitions[v];
			}
			var index = diobM.transDiobs.indexOf(pD);
			if (index !== -1) diobM.transDiobs.splice(index, 1);
			return;
		}
		if (pL && !pSkip2) {
			if (!pD._vy_transL) pD._vy_transL = [];
			if (!pD._vy_transL.length) pD._vy_transL.push(pL);
			pD._vy_transL.push([pO, pS, pT, pQ, pL, pE]);
		}
		if (pQ && diobM.transDiobs.includes(pD) && !pSkip) {
			if (!pD._vy_transQ) pD._vy_transQ = [];
			if (pQ === -1) {
				if (pD._vy_transQ.length) {
					var arr = pD._vy_transQ[pD._vy_transQ.length - 1];
					if (Array.isArray(arr[1])) {
						arr.push([pO, pS, pT, pQ, pL, pE]);
					} else {
						pD._vy_transQ[pD._vy_transQ.length - 1] = [arr, [pO, pS, pT, pQ, pL, pE]];
					}
				} else {
					pD._vy_transQ.push([pO, pS, pT, pQ, pL, pE]);
				}
			} else {
				pD._vy_transQ.push([pO, pS, pT, pQ, pL, pE]);
			}
			return;
		}
		var t = (!pT || pT <= 0)? 100 : pT;
		var s = (!pS)? 1 : pS;
		for (var v in pO) {
			if (!diobM.transVars.includes(v)) continue;
			var o = {'v': pO[v], 't': t, 'i': 0, 'iT': 0, 's': s};
			if (pE) {
				o.cV = Math.abs(pD[diobM.defProp[v]] - o.v);
				o.e = pE;
			}
			if (s < 0) {
				o.r = 1;
				o.tt = t;
				s = 1;
			} else o.tt = s * t;
			o.eT = o.tt;
			switch (v) {
				case 'alpha':
				case 'xIconOffset':
				case 'yIconOffset':
				case 'angle':
					o.c = (pO[v] - pD[diobM.defProp[v]]) / s;
					break;
				case 'xScale':
					if (!pD._vy_scale) pD._vy_scale = {'x': 1, 'y': 1};
					o.c = (pO[v] - pD._vy_scale.x) / s;
					o.cV = Math.abs(pD._vy_scale.x - o.v);
					break;
				case 'yScale':
					if (!pD._vy_scale) pD._vy_scale = {'x': 1, 'y': 1};
					o.c = (pO[v] - pD._vy_scale.y) / s;
					o.cV = Math.abs(pD._vy_scale.y - o.v);
					break;
				case 'scale':
					if (!pD._vy_scale) pD._vy_scale = {'x': 1, 'y': 1};
					o.c = (pO[v] - Math.max(pD._vy_scale.x, pD._vy_scale.y)) / s;
					break;
			}
			pD._vy_transitions[v] = o;
			if (!diobM.transDiobs.includes(pD)) diobM.transDiobs.push(pD);
		}
		if (pD.onTransition) pD.onTransition('', 0, pO);
	};
	dfM.setAngle = function(pD, pAngle) {
		pD._vy_angle = pAngle;
		if (pD._vy_isPlane && pD._vy_pixS) {
			scrM.updateScreenSpriteTrans(pD);
		} else {
			if (pD._vy_onScr && (!pD._vy_appMask || pD._vy_appMask.ownMod) && pD._vy_pixS) scrM.updateScreenSpriteTrans(pD);
			if (pD._vy_gui) dfM._checkDrawModified(pD);
		}
	};
	dfM.setAnchor = function(pD, pX, pY) {
		if (typeof(pX) === 'object') {
			pY = pX.y;
			pX = pX.x;
		}
		if (pY === undefined) pY = pX;
		if (!pD._vy_anchor) pD._vy_anchor = {'x': pX, 'y': pY};
		else {
			pD._vy_anchor.x = pX;
			pD._vy_anchor.y = pY;
		}
		if (pD._vy_pixS && pD._vy_pixS.anchor) {
			if (pD._vy_anchor) pD._vy_pixS.anchor.set(pD._vy_anchor.x, pD._vy_anchor.y);
			else pD._vy_pixS.anchor.set(0.5, 0.5);
		}
		if (pD._vy_gui) dfM._checkDrawModified(pD);
		else dfM._setIconSizeCheck(pD);
	};
	dfM.setAlpha = function(pD, pAlpha) {
		pD._vy_alpha = pAlpha;
		if (pD._vy_alpha < 0) pD._vy_alpha = 0;
		else if (pD._vy_alpha > 1) pD._vy_alpha = 1;
		if (pD._vy_isPlane && pD._vy_pixS) {
			scrM.updateScreenSpriteTrans(pD);
		} else {
			if (pD._vy_onScr && (!pD._vy_appMask || pD._vy_appMask.ownMod) && pD._vy_pixS) scrM.updateScreenSpriteTrans(pD);
			if (pD._vy_gui) {
				if (pD._vy_webBox) pD._vy_webBox.innerBox.style.opacity = pAlpha;
				dfM._checkDrawModified(pD);
			}
		}
	};
	dfM.setScale = function(pD, pX, pY) {
		if (!pX) pD._vy_scale = 0;
		else {
			if (typeof(pX) === 'object') {
				if (pX.height) pY = pX.height;
				else pY = pX.y;
				if (pX.width) pX = pX.width;
				else pX = pX.x;
			}
			if (!pY) pY = pX;
			if (typeof(pD._vy_scale) !== 'object') pD._vy_scale = {'x': pX, 'y': pY};
			else {
				pD._vy_scale.x = pX;
				pD._vy_scale.y = pY;
			}
		}
		if (pD._vy_isPlane && pD._vy_pixS) {
			scrM.updateScreenSpriteTrans(pD);
		} else {
			if (pD._vy_onScr && (!pD._vy_appMask || pD._vy_appMask.ownMod) && pD._vy_pixS) scrM.updateScreenSpriteTrans(pD);
			if (pD._vy_gui) dfM._checkDrawModified(pD);
			else dfM._setIconSizeCheck(pD);
		}
	};
	dfM.setTransform = function(pD, pTransform) {
		if (Array.isArray(pTransform)) pD._vy_transform = pTransform;
		else {
			if (!(pTransform instanceof Object)) pD._vy_transform = 0;
			else {
				if (!pTransform.scaleX) pTransform.scaleX = 1;
				if (!pTransform.scaleY) pTransform.scaleY = 1;
				if (!pTransform.skewX) pTransform.skewX = 0;
				if (!pTransform.skewY) pTransform.skewY = 0;
				if (!pTransform.moveX) pTransform.moveX = 0;
				if (!pTransform.moveY) pTransform.moveY = 0;
				pD._vy_transform = [pTransform.scaleX, pTransform.skewY, 0, pTransform.skewX, pTransform.scaleY, 0, pTransform.moveX, pTransform.moveY, 1];
			}
		}
		if (!pD._vy_transform && pD._vy_pixS) {
			if (pD._vy_pixS.skew.x) pD._vy_pixS.skew.x = 0;
			if (pD._vy_pixS.skew.y) pD._vy_pixS.skew.y = 0;
			if (pD._vy_pixS.pivot.x)  pD._vy_pixS.pivot.x = 0;
			if (pD._vy_pixS.pivot.y)  pD._vy_pixS.pivot.y = 0;
		}
		if (pD._vy_isPlane && pD._vy_pixS) {
			scrM.updateScreenSpriteTrans(pD);
		} else {
			if (pD._vy_onScr && (!pD._vy_appMask || pD._vy_appMask.ownMod) && pD._vy_pixS) scrM.updateScreenSpriteTrans(pD);
			if (pD._vy_gui) dfM._checkDrawModified(pD);
		}
	};
	dfM.setAnimator = function(pD, pAnimator) {
		if (!pD._vy_anim) dfM._setAnimator(pD);
		if (pD._vy_anim.playAnim) {
			pD._vy_anim.playAnim.anim = pAnimator;
			return;
		}
		pD._vy_animator = pAnimator;
		dfM._altFrameDelay(pD);
		if (pD._vy_over) {
			for (var c = 0, cLen = pD._vy_over.length; c < cLen; c ++) {
				var o = pD._vy_over[c];
				if (o && o._vy_appMask && !o._vy_appMask.ownAnim && o._vy_anim) {
					o._vy_animator = pD._vy_animator;
					dfM._altFrameDelay(o);
				}
			}
		}
	};
	dfM.setColor = function(pD, pColor) {
		if (!pD._vy_gui) {
			var s = (pD._vy_isClient)? scrM.pixiApp.stage : pD._vy_pixS;
			if (!s) {
				pD._vy_pixS = new PIXI.Sprite();
				s = pD._vy_pixS;
			}
			if (!pD._vy_atlas) {
				pD._vy_solidColor = true;
				pD._vy_pixS.texture = new PIXI.Texture(PIXI.Texture.WHITE);
				pD._vy_pixS.width = pD._vy_w;
				pD._vy_pixS.height = pD._vy_h;
			}
			if (pColor && typeof(pColor) === 'object') {
				if (pColor.tint) pD._vy_pixS.tint = pColor.tint;
			} else {
				if (pD._vy_color && pD._vy_color.tint) pD._vy_pixS.tint = 0xFFFFFF;
				var c = dfM._getColorIcon(pD, pColor);
				pColor = c.color;
				if (pD._vy_colorAtlas && resM.colorMatrix[pD._vy_colorAtlas]) {
					var filters = s.filters;
					if (filters) {
						var index = filters.indexOf(resM.colorMatrix[pD._vy_colorAtlas]);
						if (index !== -1) {
							filters.splice(index, 1);
							s.filters = filters;
						}
					}
				}
				if (pColor) {
					pD._vy_colorAtlas = c.m.toString().split(',', 20).join(',');
					pD._vy_colorMatrix = c.m;
					if (!resM.colorMatrix[pD._vy_colorAtlas]) resM.createColorMatrixFilter(pD._vy_colorMatrix, pD._vy_colorAtlas);
					if (s) {
						var filters = [resM.colorMatrix[pD._vy_colorAtlas]];
						if (s.filters) filters = s.filters.concat(filters);
						s.filters = filters;
					}
				}
			}
		}
		pD._vy_color = pColor;
		if (pD._vy_onScr && pD._vy_gui) scrM.refreshInt[pD._vy_layer] = true;
	};
	dfM._getColorIcon = function(pD, pColor) {
		var m = pColor, r = 0, g = 0, b = 0, a = 255;
		if (!Array.isArray(pColor)) {
			if (typeof pColor !== 'string') pColor = 0;
			else {
				if (pColor.startsWith('#')) {
					pColor = pColor.replace('#', '');
					r = parseInt(pColor.substring(0, 2), 16);
					g = parseInt(pColor.substring(2, 4), 16);
					b = parseInt(pColor.substring(4, 6), 16);
				} else if (pColor.startsWith('rgba(') || pColor.startsWith('rgb(')) {
					pColor = pColor.replace('rgba(', '').replace(')', '').replace(/ /g, '');
					pColor = pColor.replace('rgb(', '');
					var cL = pColor.split(',');
					r = parseInt(cL[0]);
					g = parseInt(cL[1]);
					b = parseInt(cL[2]);
					if (cL.length > 3) a *= parseFloat(cL[3]);
				}
				pColor = m;
				m = [r / 255, 0, 0, 0, 0, 0, g / 255, 0, 0, 0, 0, 0, b / 255, 0, 0, 0, 0, 0, a / 255, 0];
			}
		}
		return {'color': pColor, 'm': m};
	};
	dfM.setMask = function(pD, pMask) {
		pD._vy_mask = pMask;
		if (pMask) {
			if (!pD._vy_pixS) scrM.setScreenSprite(pD);
			if (!pMask._vy_pixS) {
				if (pMask.isSprite) {
					pD._vy_pixS.mask = pMask;
					return;
				}
				scrM.setScreenSprite(pMask);
			}
			pD._vy_pixS.mask = pMask._vy_pixS;
		} else {
			pD._vy_pixS.mask = null;
		}
	};
	dfM.setComposite = function(pD, pComposite) {
		if (!pComposite || pComposite === 'normal') pComposite = '';
		pD._vy_composite = pComposite;
		if (pD._vy_onScr || pD._vy_isPlane) {
			if (pD._vy_pixS) {
				if (!scrM.composites[pD._vy_composite]) pD._vy_pixS.blendMode = scrM.composites.normal;
				else pD._vy_pixS.blendMode = scrM.composites[pD._vy_composite];
			}
			if (pD._vy_gui) scrM.refreshInt[pD._vy_layer] = true;
		}
		if (pD._vy_gui) dfM._checkDrawModified(pD);
	};
	dfM.setPlane = function(pD, pPlane) {
		if (!pPlane) pPlane = 0;
		dfM._setPlane(pPlane);
		var scr;
		if (pD._vy_onScr && !pD._vy_appMask) {
			scr = pD._vy_onScr;
			scrM.removeFromScreen(pD, 0, 0, 1);
		}
		pD._vy_plane = pPlane;
		if (scr) scrM.addToScreen(pD, 1);
	};
	dfM._setPlane = function(pPlane) {
		if (!scrM.planes[pPlane] && scrM.pixiApp) {
			scrM.planes[pPlane] = 1;
			var plane = newDiob(diobM.objectType['Diob'], 0, 1);
			plane._vy_isPlane = true;
			plane._vy_plane = pPlane;
			plane._vy_planeDis = [];
			var index = scrM.planesArr.length;
			for (var i = 0, len = index; i < len; i ++) {
				var p = scrM.planesArr[i];
				if (p._vy_plane > pPlane) {
					index = i;
					break;
				}
			}
			if (index === scrM.planesArr.length) scrM.planesArr.push(plane);
			else scrM.planesArr.splice(index, 0, plane);
			scrM.planes[pPlane] = plane;
			plane._vy_pixS = new PIXI.Container();
			scrM.setScreenSprite(plane);
			scrM.pixiApp.stage.addChildAt(plane._vy_pixS, index + 1);
			return plane;
		}
	};
	dfM.setLayer = function(pD, pLayer) {
		if (pD._vy_layer === pLayer) return;
		if (pD._vy_onScr) {
			if (pD._vy_gui) {
				scrM.removeFromInterface(pD);
				pD._vy_layer = pLayer;
				if (pD._vy_webBox) {
					pD._vy_webBox.parentNode.removeChild(pD._vy_webBox);
					pD._vy_webBox = null;
				}
				if (!pD._vy_appMask) scrM.addToInterface(pD, true);
			} else {
				pD._vy_layer = pLayer;
				if (!pD._vy_appMask) scrM.readdToScreen(pD, true);
				else if (pD.isOverlay) {
					dfM._removeOverlayApp(pD.isOverlay, pD);
					dfM._addOverlayApp(pD.isOverlay, pD);
					scrM.removeFromScreen(pD.isOverlay, 0, 0, 1);
					scrM.addToScreen(pD.isOverlay, 1);
				}
			}
		} else if (pD._vy_appMask) {
			pD._vy_layer = pLayer;
			dfM._removeOverlayApp(pD.isOverlay, pD);
			dfM._addOverlayApp(pD.isOverlay, pD);
		} else pD._vy_layer = pLayer;
	};
	dfM.playAnimation = function(pD, pAtlas, pIcon, pState, pFrame, pEnd, pSet, pFunc) {
		if (!pD._vy_anim) dfM._setAnimator(pD);
		if (pD._vy_anim.playAnim) dfM._stopAnimation(pD);
		if (!pAtlas) return;
		if (!resM.loadedAtlases[pAtlas] || resM.loadedAtlases[pAtlas].loading) {
			resM.loadAtlas(pAtlas, false, [dfM._playAnimation, this, Array.prototype.slice.call(arguments)]);
			return;
		}
		if (pFrame === -1) pFrame = pD._vy_anim.frame + 1;
		var anim = {'atlas': pD._vy_atlas, 'icon': pD._vy_icoName, 'state': pD._vy_icoState, 'eF': pEnd, 'f': pFunc};
		anim.def = pD._vy_defIconState;
		if (pD._vy_atlas !== pAtlas || pD._vy_icoName !== pIcon) dfM.setAtlas(pD, pAtlas, pIcon);
		if (pD._vy_icoState !== pState) dfM.setIconState(pD, pState);
		if (pSet) {
			if (pSet.loop) anim.l = pSet.loop;
			anim.anim = pD._vy_animator || null;
			pD._vy_animator = pSet;
			if (pSet.rFrame && pD._vy_anim.frame) anim.frame = pD._vy_anim.frame + 1;
			if (pSet.delay) pD._vy_anim.delay = pSet.delay;
		}
		pD._vy_defIconState = anim.def;
		if (!pD._vy_ico || ((!pD._vy_ico.parent.frames || !pD._vy_ico.parent.frames.length) && (!pSet || !pSet.delay))) {
			dfM._stopAnimationSet(pD, anim);
		} else {
			if (pD._vy_ico && pD._vy_ico.parent.frames) {
				if (pFrame) {
					if (pD._vy_ico.parent.frames.length < pFrame) pFrame = pD._vy_ico.parent.frames.length;
					else if (pFrame < 1) pFrame = 1;
				} else pFrame = 1;
			} else if (pD._vy_anim.isPaused) pD._vy_anim.isPaused = false;
			pD._vy_anim.lastCheck = performance.now();
			pD._vy_anim.frame = pFrame - 1;
			pD._vy_anim.timer = 0;
			pD._vy_anim.playAnim = anim;
			dfM._setFrameIcon(pD, pD._vy_anim.frame);
			if (pD._vy_onScr && !pD._vy_onScrAnim) scrM.addScreenAnimation(pD);
		}
	};
	dfM._playAnimation = function(pStatus, pD, pAtlas, pIcon, pState, pFrame, pEnd, pSet, pFunc) {
		if (pStatus === 'loaded') {
			dfM.playAnimation(pD, pAtlas, pIcon, pState, pFrame, pEnd, pSet, pFunc);
		} else if (pFunc) funcM._callback(pFunc);
	};
	dfM._stopAnimation = function(pD) {
		if (!pD._vy_anim.playAnim) return;
		var anim = {'atlas': pD._vy_anim.playAnim.atlas, 'icon': pD._vy_anim.playAnim.icon, 'state': pD._vy_anim.playAnim.state, 'frame': pD._vy_anim.playAnim.frame, 'f': pD._vy_anim.playAnim.f, 'anim': pD._vy_anim.playAnim.anim};
		pD._vy_anim.playAnim = false;
		dfM._stopAnimationSet(pD, anim);
		if (anim.f) funcM._callback(anim.f);
	};
	dfM._stopAnimationSet = function(pD, pAnim) {
		dfM.setAtlas(pD, pAnim.atlas, pAnim.icon, true);
		dfM.setIconState(pD, pAnim.state, pD._vy_moving, 0, true);
		if (pAnim.frame || pAnim.frame === 0) dfM.setFrame(pD, pAnim.frame);
		if (pAnim.anim !== undefined) pD._vy_animator = pAnim.anim;
	};
	dfM.addOverlay = function(pD, pOver, pAppearance, pSkip, pSkipEvent, pID) {
		if (pD.isOverlay && pD.isOverlay !== 1) return;
		if (!pOver) pOver = 'Overlay';
		var o = pOver, passed;
		if (typeof(pOver) === 'string') {
			pOver = funcM._newDiob(pOver, 1, pID);
			pOver._vy_loc = pD;
			pOver.isOverlay = pD;
			if (pOver.onNew && !pID) {
				if (!mainM.isInitialized) resM.diobNewQueue.push(pOver);
				else diobM.diobOnNew(pOver);
			}
			o = pOver;
		} else {
			if (!pOver._vy_type) return;
			passed = true;
			if (pOver.isOverlay && typeof(pOver.isOverlay) === 'object') {
				if (pOver.isOverlay === pD) return pOver;
				dfM.removeOverlay(pOver.isOverlay, pOver, true);
			} else if (pSkip) {
				o = newDiob(diobM.objectType[pOver._vy_type], pID, 1);
				o._vy_loc = pD;
				o.isOverlay = pD;
				if (o.onNew) {
					if (!mainM.isInitialized) resM.diobNewQueue.push(o);
					else diobM.diobOnNew(o);
				}
			} else if (pOver._vy_x < 0 || pOver._vy_y < 0) dfM.setPos(pOver, 0, 0, 1, 1);
		}
		passed = (pOver._vy_baseType === 'Overlay' && !pSkip)? true : false;
		if (pD._vy_client) o._vy_client = pD._vy_client;
		if (!o._vy_id) diobM.objects[dfM.setID(o, pID)] = o;
		if (!passed) {
			if (o !== pOver) o.setAppearance(pOver);
			o.mouseOpacity = pOver._vy_mouseOp;
			if (pOver._vy_x) o._vy_x = pOver._vy_x;
			if (pOver._vy_y) o._vy_y = pOver._vy_y;
		}
		
		o._vy_loc = pD;
		o.isOverlay = pD;
		if (o._vy_isLoc) o._vy_isLoc = false;
		if (pAppearance !== undefined) o._vy_appMask = pAppearance;
		else if (!o._vy_appMask) o._vy_appMask = o.appearMask;
		if (pD._vy_isClient) delete o._vy_appMask;
		if (pD._vy_gui) {
			o._vy_gui = pD._vy_gui;
			o.setText = function(pText) {
				return dfM.setTextInt(this, pText);
			};
			dfM._checkDrawModified(o);
		}
		if (o._vy_appMask) {
			o._vy_plane = pD._vy_plane;
			if (typeof(o._vy_appMask) !== 'object') o._vy_appMask = true;
			dfM.setAtlas(o, o._vy_atlas, o._vy_icoName, true);
			if (!o._vy_appMask.ownState) dfM.setIconState(o, pD._vy_icoState, pD._vy_moving, true);
			dfM._addOverlayApp(pD, o);
			if (pD._vy_anim || o._vy_appMask.ownAnim) {
				if (!o._vy_anim) dfM._setAnimator(o);
				if (!o._vy_appMask.ownAnim) o._vy_animator = pD._vy_animator;
			}
			//if (pD._vy_color) dfM.setColor(o, pD._vy_color);
		} else {
			dfM.setAtlas(o, o._vy_atlas, o._vy_icoName, true);
		}
		if (!o._vy_x) o._vy_x = 0;
		if (!o._vy_y) o._vy_y = 0;
		if (!pD._vy_over) pD._vy_over = [o];
		else pD._vy_over.push(o);
		o._vy_mapN = pD._vy_mapN;
		if (pD._vy_onScr) {
			if (pD._vy_isClient) {
				o._vy_client = clientM;
				scrM.addToScreen(o);
			} else {
				if (!o._vy_appMask) {
					if (pD._vy_gui) scrM.addToInterface(o);
					else scrM.addToScreen(o);
				} else {
					if (pD._vy_gui) {
						o._vy_onScr = pD._vy_onScr;
						if (o._vy_ico && (!o._vy_ico.image || !o._vy_ico.image.src)) resM.loadIconImage(o._vy_ico, pD, false, true, true);
						scrM.refreshInt[pD._vy_layer] = true;
					} else {
						scrM.removeFromScreen(pD, 0, 0, 1);
						scrM.addToScreen(pD, 1);
					}
				}
			}
		}
		if (pD.onAddOverlay && !pSkipEvent) pD.onAddOverlay(o);
		return o;
	};
	dfM._addOverlayApp = function(pD, pO) {
		if (pO._vy_appMask.isUnder) {
			if (!pD._vy_firstUnderApp) pD._vy_firstUnderApp = pO;
			else {
				var d = pD._vy_firstUnderApp;
				while (d) {
					var next = d._vy_nextUnderApp;
					if (d._vy_layer > pO._vy_layer) {
						if (!d._vy_prevUnderApp) {
							pD._vy_firstUnderApp = pO;
						} else {
							pO._vy_prevUnderApp = d._vy_prevUnderApp;
							d._vy_prevUnderApp._vy_nextUnderApp = pO;
						}
						d._vy_prevUnderApp = pO;
						pO._vy_nextUnderApp = d;
						break;
					}
					if (!d._vy_nextUnderApp) {
						d._vy_nextUnderApp = pO;
						pO._vy_prevUnderApp = d;
						break;
					}
					d = next;
				}
			}
		} else {
			if (!pD._vy_firstOverApp) pD._vy_firstOverApp = pO;
			else {
				var d = pD._vy_firstOverApp;
				while (d) {
					var next = d._vy_nextOverApp;
					if (d._vy_layer > pO._vy_layer) {
						if (!d._vy_prevOverApp) {
							pD._vy_firstOverApp = pO;
						} else {
							pO._vy_prevOverApp = d._vy_prevOverApp;
							d._vy_prevOverApp._vy_nextOverApp = pO;
						}
						d._vy_prevOverApp = pO;
						pO._vy_nextOverApp = d;
						break;
					}
					if (!d._vy_nextOverApp) {
						d._vy_nextOverApp = pO;
						pO._vy_prevOverApp = d;
						break;
					}
					d = next;
				}
			}
		}
	};
	dfM.removeOverlay = function(pD, pOver, pSkip) {
		if (!pD._vy_over) return;
		if (typeof(pOver) === 'string') {
			for (var i = pD._vy_over.length; i --;) {
				var obj = pD._vy_over[i];
				if (!obj || obj === pOver || obj._vy_type === pOver) {
					dfM._removeOverlay(pD, obj, pSkip);
				}
			}
		} else dfM._removeOverlay(pD, pOver, pSkip);
	};
	dfM._removeOverlay = function(pD, pO, pSkip) {
		var index = pD._vy_over.indexOf(pO);
		if (index !== -1) pD._vy_over.splice(index, 1);
		if (!pO) return;
		if (pO._vy_appMask) {
			dfM._removeOverlayApp(pD, pO);
		} else {
			if (pO._vy_onScr) {
				if (pO._vy_gui) scrM.removeFromInterface(pO);
				else scrM.removeFromScreen(pO);
			}
		}
		if (pD.onRemoveOverlay) pD.onRemoveOverlay(pO);
		if (!pSkip) diobM.deleteDiob(pO);
		else {
			pO._vy_mapN = undefined;
			delete pO.isOverlay;
		}
	};
	dfM._removeOverlayApp = function(pD, pO) {
		if (pO._vy_appMask.isUnder) {
			if (pD._vy_firstUnderApp === pO) pD._vy_firstUnderApp = pO._vy_nextUnderApp;
			if (pO._vy_nextUnderApp) {
				pO._vy_nextUnderApp._vy_prevUnderApp = pO._vy_prevUnderApp;
			}
			if (pO._vy_prevUnderApp) {
				pO._vy_prevUnderApp._vy_nextUnderApp = pO._vy_nextUnderApp;
			}
			delete pO._vy_nextUnderApp;
			delete pO._vy_prevUnderApp;
		} else {
			if (pD._vy_firstOverApp === pO) pD._vy_firstOverApp = pO._vy_nextOverApp;
			if (pO._vy_nextOverApp) {
				pO._vy_nextOverApp._vy_prevOverApp = pO._vy_prevOverApp;
			}
			if (pO._vy_prevOverApp) {
				pO._vy_prevOverApp._vy_nextOverApp = pO._vy_nextOverApp;
			}
			delete pO._vy_nextOverApp;
			delete pO._vy_prevOverApp;
		}
		if (pO._vy_onScr) {
			if (pO._vy_gui) scrM.refreshInt[pD._vy_layer] = true;
			else {
				delete pO._vy_onScr;
				if (pO._vy_onScrAnim) delete pO._vy_onScrAnim;
				var plane = scrM.planes[pO._vy_plane];
				if (plane) plane._vy_pixS.removeChild(pO._vy_pixS);
			}
		}
	};
	dfM.setOverlays = function(pD, pOver, pSave) {
		if (!pD._vy_over) pD._vy_over = [];
		if (!pOver || !(pOver instanceof Array)) pOver = [];
		for (var i = pD._vy_over.length; i --;) {
			var over = pD._vy_over[i];
			if (!pOver.includes(over)) dfM.removeOverlay(pD, over, pSave);
		}
		for (var i = 0, len = pOver.length; i < len; i ++) dfM.addOverlay(pD, pOver[i]);
		return pD._vy_over;
	};
	dfM.addToContents = function(pD, pC, pSkip) {
		if (!pD._vy_conts) pD._vy_conts = [];
		if (pC._vy_locs.includes(pD)) return;
		pD._vy_conts.push(pC);
		if (pD._vy_onScr) scrM.addToScreen(pC);
		pC._vy_locs.push(pD);
		if (pC._vy_isMovable && !pC._vy_isParticle) {
			if (!pSkip && pD.onEntered) pD.onEntered(pC);
			if (pD._vy_region) {
				if (!pC._vy_inRegion) pC._vy_inRegion = [];
				if (!pC._vy_inRegion.includes(pD._vy_region)) {
					pC._vy_inRegion.push(pD._vy_region);
					if (pD._vy_region.onEntered && !pSkip) pD._vy_region.onEntered(pC);
				}
			}
		}
		return true;
	};
	dfM.removeFromContents = function(pD, pC) {
		var index = pD._vy_conts.indexOf(pC);
		if (index === -1) return;
		pD._vy_conts.splice(index, 1);
		pC._vy_locs.splice(pC._vy_locs.indexOf(pD), 1);
		if (pC._vy_isMovable && !pC._vy_isParticle) {
			if (pD.onExited) pD.onExited(pC);
			if (pD._vy_region) {
				index = pC._vy_inRegion.indexOf(pD._vy_region);
				if (index !== -1) {
					var found;
					for (var i = pC._vy_locs.length; i --;) {
						var tile = pC._vy_locs[i];
						if (tile._vy_region === pD._vy_region) {
							found = 1;
							break;
						}
					}
					if (!found) {
						pC._vy_inRegion.splice(index, 1);
						if (pD._vy_region.onExited) pD._vy_region.onExited(pC);
					}
				}
			}
		}
		//if (pC._vy_loc === pD) pC._vy_loc = 0;
	};
	dfM.setInvisibility = function(pD, pLevel, pSkip) {
		if (!pLevel) pLevel = 0;
		pD._vy_invisibility = pLevel;
		if (pLevel && !pD._vy_viewers) pD._vy_viewers = [];
		if (!pSkip && clientM.cOb && clientM.cOb._vy_playerMob) {
			if (pD._vy_gui) {
				scrM.refreshInt[pD._vy_layer] = true;
			} else {
				if (!pLevel || pD._vy_viewers.includes(clientM.cOb._vy_playerMob)) {
					if (pD._vy_isLoc) scrM.setMapViewDisplay();
					else if (pD.loc && pD._vy_loc._vy_onScr) scrM.addToScreen(pD);
					else if (pD.isOverlay && pD.isOverlay._vy_onScr) scrM.addToScreen(pD);
				} else if (pLevel) {
					if (pD._vy_onScr && !pD._vy_viewers.includes(clientM.cOb._vy_playerMob) && clientM.cOb._vy_playerMob._vy_visibility < pD._vy_invisibility) {
						scrM.removeFromScreen(pD, true);
					}
				}
			}
		}
	};
	dfM.setVisibility = function(pD, pLevel, pSkip) {
		if (!pLevel) pLevel = 0;
		pD._vy_visibility = pLevel;
		if (!pSkip && clientM.cOb && pD === clientM.cOb._vy_playerMob) {
			scrM.setMapViewDisplay();
		}
	};
	dfM.addInvisibilityViewer = function(pD, pViewer) {
		if (pD._vy_viewers.includes(pViewer)) return;
		pD._vy_viewers.push(pViewer);
		if (pD._vy_isLoc) scrM.setMapViewDisplay();
		else if (pD.loc && pD._vy_loc._vy_onScr) scrM.addToScreen(pD);
	};
	dfM.removeInvisibilityViewer = function(pD, pViewer) {
		if (!pD._vy_viewers.includes(pViewer)) return;
		pD._vy_viewers.splice(pD._vy_viewers.indexOf(pViewer), 1);
		if (pD._vy_onScr && clientM.cOb && pViewer === clientM.cOb._vy_playerMob && (clientM.cOb._vy_playerMob._vy_visibility < pD._vy_invisibility || !pD._vy_viewers.includes(clientM.cOb._vy_playerMob))) {
			scrM.removeFromScreen(pD);
		}
	};
	dfM.setOverScreen = function(pD, pX, pY, pWidth, pHeight, pData, pSet) {
		if (!pX) pX = 0;
		if (!pY) pY = 0;
		if (!pWidth) pWidth = pD._vy_w;
		if (!pHeight) pHeight = pD._vy_h;
		if (!pD._vy_overScr) {
			pD._vy_overScr = {};
			var canvas = document.createElement('canvas');
			pD._vy_overScr.brush = canvas.getContext('2d');
			pD._vy_overScr.canvas = canvas;
		}
		pD._vy_overScr.x = pX;
		pD._vy_overScr.y = pY;
		pD._vy_overScr.canvas.width = pWidth;
		pD._vy_overScr.canvas.height = pHeight;
		if (pSet) pD._vy_overScr.settings = pSet;
		else pD._vy_overScr.settings = {};
		if (pD._vy_overScr.settings.scaleNearest) pD._vy_overScr.brush.imageSmoothingEnabled = false;
		else pD._vy_overScr.brush.imageSmoothingEnabled = !scrM.disableImageSmoothing;
		if (pD._vy_overScr.settings.composite) pD._vy_overScr.brush.globalCompositeOperation = pD._vy_overScr.settings.composite;
		else pD._vy_overScr.brush.globalCompositeOperation = 'source-over';
		if (pD._vy_overScr.settings.alpha) pD._vy_overScr.brush.globalAlpha = pD._vy_overScr.settings.alpha;
		else pD._vy_overScr.brush.globalAlpha = 1;
		if (pData) {
			if (typeof pData === 'string') {
				var img = new Image();
				img.onload = function() {
					pD._vy_overScr.brush.drawImage(img, 0, 0);
				};
				img.src = pData;
			} else pD._vy_overScr.brush.putImageData(pData, 0, 0);
		}
		if (pD._vy_onScr && !pD._vy_gui) {
			if (!pD._vy_overScrSprite) {
				scrM.setScreenSpriteOverScreen(pD);
				if (!pD._vy_isLoc) scrM.readdToScreen(pD);
			} else pD._vy_overScrSprite.texture = PIXI.Texture.from(pD._vy_overScr.canvas.toDataURL());
			if (pD._vy_pixS) scrM.updateScreenSpritePosDef(pD, 1);
		}
	};
	dfM.getOverScreen = function(pD, pType) {
		if (!pD._vy_overScr) return;
		var o = {'x': pD._vy_overScr.x, 'y': pD._vy_overScr.y, 'width': pD._vy_overScr.canvas.width, 'height': pD._vy_overScr.canvas.height};
		if (pType === 'url') o.data = pD._vy_overScr.canvas.toDataURL();
		else if (pType === 'pixels') o.data = pD._vy_overScr.brush.getImageData(0, 0, gameM.gameWidth, gameM.gameHeight);
		else if (pType === 'canvas') o.data = pD._vy_overScr.canvas;
		else if (pType === 'sprite') o.data = pD._vy_overScrSprite;
		o.settings = pD._vy_overScr.settings;
		return o;
	};
	dfM.overScreenDraw = function(pD, pArgs) {
		if (!pD._vy_overScr) dfM.setOverScreen(pD);
		if (!pArgs) pArgs = pD._vy_overScr.settings;
		var f = function() {
			if (pD._vy_onScr) {
				if (pD._vy_gui) scrM.refreshInt[pD._vy_layer] = true;
				else if (pD._vy_overScrSprite) pD._vy_overScrSprite.texture = PIXI.Texture.from(pD._vy_overScr.canvas.toDataURL());
			}
		};
		scrM.customScreenDraw(pD._vy_overScr.brush, pArgs, f);
	};
	dfM.addFilter = function(pD, pName, pType, pArgs) {
		if (!pD._vy_pixS) scrM.setScreenSprite(pD);
		if (!pD._vy_filters) pD._vy_filters = {};
		if (pD._vy_filters[pName]) dfM.removeFilter(pD, pName);
		var filter;
		if (pType === 'colorMatrix') {
			filter = new PIXI.filters.ColorMatrixFilter();
			if (pArgs) {
				if (pArgs.matrix) filter.matrix = pArgs.matrix;
				if (pArgs.contrast !== undefined) filter.contrast(pArgs.amount);
				if (pArgs.brightness !== undefined) filter.brightness(pArgs.brightness);
				if (pArgs.saturate !== undefined) filter.saturate(pArgs.saturate);
				if (pArgs.hue !== undefined) filter.hue(pArgs.hue);
			}
		} else if (pType === 'blackAndWhite') {
			filter = new PIXI.filters.ColorMatrixFilter();
			filter.blackAndWhite();
		} else if (pType === 'grayscale') {
			filter = new PIXI.filters.ColorMatrixFilter();
			if (pArgs) filter.greyscale(pArgs.amount);
		} else if (pType === 'lsd') {
			filter = new PIXI.filters.ColorMatrixFilter();
			filter.lsd();
		} else if (pType === 'negative') {
			filter = new PIXI.filters.ColorMatrixFilter();
			filter.negative();
		} else if (pType === 'night') {
			filter = new PIXI.filters.ColorMatrixFilter();
			if (pArgs) filter.night(pArgs.intensity);
		} else if (pType === 'predator') {
			filter = new PIXI.filters.ColorMatrixFilter();
			if (pArgs) filter.predator(pArgs.amount);
		} else if (pType === 'sepia') {
			filter = new PIXI.filters.ColorMatrixFilter();
			filter.sepia();
		} else if (pType === 'rbSwap') {
			filter = new PIXI.filters.ColorMatrixFilter();
			filter.toBGR();
		} else if (pType === 'blur') {
			if (pArgs) {
				filter = new PIXI.filters.BlurFilter(pArgs.strength, pArgs.quality, pArgs.resolution, pArgs.kernelSize);
				if (pArgs.blurX) filter.blurX = pArgs.blurX;
				if (pArgs.blurY) filter.blurY = pArgs.blurY;
			} else filter = new PIXI.filters.BlurFilter();
		} else if (pType === 'displacement') {
			if (pArgs) {
				var d = pArgs.diob;
				if (!d._vy_pixS) scrM.setScreenSprite(d);
				filter = new PIXI.filters.DisplacementFilter(d._vy_pixS, pArgs.scale);
			} else filter = new PIXI.filters.DisplacementFilter();
		} else if (pType === 'noise') {
			if (pArgs) filter = new PIXI.filters.NoiseFilter(pArgs.amount, pArgs.seed);
			else filter = new PIXI.filters.NoiseFilter();
		} else if (pType === 'custom') {
			if (pArgs) filter = pArgs.filter;
			else filter = new PIXI.filters.ColorMatrixFilter();
		} else filter = new PIXI.filters.ColorMatrixFilter();
		if (pArgs) {
			if (pArgs.alpha !== undefined) filter.alpha = pArgs.alpha;
			if (pArgs.blendMode) filter.blendMode = scrM.composites[pArgs.blendMode];
			if (pArgs.padding !== undefined) filter.padding = pArgs.padding;
			if (pArgs.resolution !== undefined) filter.resolution = pArgs.resolution;
		}
		var filters = [filter];
		if (pD._vy_isClient) {
			if (scrM.pixiApp.stage.filters) filters = scrM.pixiApp.stage.filters.concat(filters);
			scrM.pixiApp.stage.filters = filters;
		} else {
			if (pD._vy_pixS.filters) filters = pD._vy_pixS.filters.concat(filters);
			pD._vy_pixS.filters = filters;
		}
		pD._vy_filters[pName] = filter;
	};
	dfM.removeFilter = function(pD, pName) {
		if (!pD._vy_filters) return;
		var filter = pD._vy_filters[pName];
		if (pD._vy_isClient) {
			var filters = scrM.pixiApp.stage.filters;
			var index = filters.indexOf(filter);
			if (index !== -1) filters.splice(index, 1);
			scrM.pixiApp.stage.filters = filters;
		} else if (pD._vy_pixS && pD._vy_pixS.filters) {
			var filters = pD._vy_pixS.filters;
			var index = filters.indexOf(filter);
			if (index !== -1) filters.splice(index, 1);
			pD._vy_pixS.filters = filters;
		}
		delete pD._vy_filters[pName];
	};
	dfM.onHide = function(pD) {
		if (pD.onHide) pD.onHide(clientM.cOb);
	};
	dfM.onExecute = function(pD) {
		if (pD.onExecute) pD.onExecute(clientM.cOb);
	};
	dfM.onFocus = function(pD) {
		if (clientM.cOb._vy_focused) {
			if (clientM.cOb._vy_focused === pD) return;
			dfM.onUnfocus(clientM.cOb._vy_focused);
		}
		clientM.cOb._vy_focused = pD;
		if (pD.onFocus) pD.onFocus(clientM.cOb);
		if (pD._vy_gui && pD._vy_isIntInput) funcM._textInputFocused(pD);
	};
	dfM.onUnfocus = function(pD) {
		if (clientM.cOb._vy_focused === pD) clientM.cOb._vy_focused = null;
		if (pD.onUnfocus) pD.onUnfocus(clientM.cOb);
		if (pD._vy_gui && pD._vy_isIntInput) funcM._textInputUnfocused(pD);
	};
	dfM.onBump = function(pD, pBlocker) {
		if (pD.onBump) pD.onBump(pBlocker);
		dfM.onBumped(pBlocker, pD);
	};
	dfM.onBumped = function(pD, pBumper) {
		if (pD.onBumped) pD.onBumped(pBumper);
	};
	dfM.onMove = function(pD, pX, pY, pDir) {
		var movable = true;
		if (pD.onMove) movable = pD.onMove(pX, pY, pDir);
		return movable;
	};
	dfM.onMoved = function(pD, pX, pY, pDir) {
		if (pD.onMoved) pD.onMoved(pX, pY, pDir);
	};
	dfM.onMouseEnter = function(pD, pX, pY) {
		if (pD.onMouseEnter) pD.onMouseEnter(clientM.cOb, pX, pY);
	};
	dfM.onMouseExit = function(pD, pX, pY) {
		if (pD.onMouseExit) pD.onMouseExit(clientM.cOb, pX, pY);
	};
	dfM.onMouseMove = function(pD, pX, pY) {
		if (pD.onMouseMove) pD.onMouseMove(clientM.cOb, pX, pY);
	};
	dfM.onMouseClick = function(pD, pX, pY, pButton) {
		if (pD.onMouseClick) pD.onMouseClick(clientM.cOb, pX, pY, pButton);
	};
	dfM.onMouseDblClick = function(pD, pX, pY, pButton) {
		if (pD.onMouseDblClick) pD.onMouseDblClick(clientM.cOb, pX, pY, pButton);
	};
	dfM.onMouseDown = function(pD, pX, pY, pButton) {
		if (pD.onMouseDown) pD.onMouseDown(clientM.cOb, pX, pY, pButton);
	};
	dfM.onMouseUp = function(pD, pX, pY, pButton) {
		if (pD.onMouseUp) pD.onMouseUp(clientM.cOb, pX, pY, pButton);
	};
	dfM.onMouseWheelScrollUp = function(pD, pX, pY) {
		if (pD.onMouseWheelScrollUp) pD.onMouseWheelScrollUp(clientM.cOb, pX, pY);
	};
	dfM.onMouseWheelScrollDown = function(pD, pX, pY) {
		if (pD.onMouseWheelScrollDown) pD.onMouseWheelScrollDown(clientM.cOb, pX, pY);
	};
	dfM.setDir = function(pD, pDir, pForce) {
		if (typeof(pDir) === 'number') {
			if (pDir == 1) pDir = 'north';
			else if (pDir == 2) pDir = 'south';
			else if (pDir == 8) pDir = 'west';
			else if (pDir == 4) pDir = 'east';
			else if (pDir == 5) pDir = 'northeast';
			else if (pDir == 6) pDir = 'southeast';
			else if (pDir == 10) pDir = 'southwest';
			else if (pDir == 9) pDir = 'northwest';
			else pDir = 'south';
		}
		if (!pDir || !stM.Map.dirs.includes(pDir)) pDir = 'south';
		if (pD._vy_dir === pDir && !pForce) return;
		if (pDir.length > 5) {
			if (pDir.indexOf(pD._vy_lastCarDir) > 0) pD._vy_currCarDir = pD._vy_lastCarDir;
			else pD._vy_currCarDir = pDir.substr(0, 5);
			if (pD._vy_dir && pD._vy_dir.length > 5) pD._vy_lastCarDir = pD._vy_currCarDir;
		} else pD._vy_lastCarDir = pDir;
		if (pD.onDirUpdate) {
			var oldDir = pD._vy_dir;
			pD._vy_dir = pDir;
			pD.onDirUpdate(oldDir);
		} else pD._vy_dir = pDir;
		if (pD._vy_defIconState) {
			if (!pD._vy_moving) dfM.setIconState(pD, pD._vy_dir, 0, 0, true);
			else dfM.setIconState(pD, 'move_' + pD._vy_dir, 1, 0, true);
		}
	};
	dfM._getStepPosFromDir = function(pD, pDir) {
		var pos = {'x': 0, 'y': 0};
		if (pDir === 'north' || pDir === 'northeast' || pDir === 'northwest') {
			pos.y = -1;
		} else if (pDir === 'south' || pDir === 'southeast' || pDir === 'southwest') {
			pos.y = 1;
		}
		if (pDir === 'east' || pDir === 'northeast' || pDir === 'southeast') {
			pos.x = 1;
		} else if (pDir === 'west' || pDir === 'northwest' || pDir === 'southwest') {
			pos.x = -1;
		}
		return pos;
	};
	dfM._setMoveSettings = function(pD) {
		pD.moveSettings = {'stepSize': 2, 'stepGlide': true};
	};
	
	dfM.stepPos = function(pD, pX, pY, pGlide, pDir, pSlide) {
		if (!pD._vy_mapN || pX === undefined) return;
		if (pY === undefined) pY = pX;
		var dir = '';
		if (!pDir || pDir === '*') {
			if (pY > 0) dir = 'south';
			else if (pY < 0) dir = 'north';
			if (pX > 0) dir += 'east';
			else if (pX < 0) dir += 'west';
		} else dir = pDir;
		if (dfM.onMove(pD, pX, pY, dir)) {
			if (pDir && !pSlide) dfM.setDir(pD, dir);
			var oldX = pD._vy_x;
			var oldY = pD._vy_y;
			var blockers;
			if (!pD._vy_isParticle) {
				var ret = dfM._stepPos(pD, pX, pY, pGlide, dir);
				if (ret[0].length === 1 && pD.moveSettings.stepGlide) {
					if (ret[1]) {
						blockers = dfM.stepGlideFunc(pD, ret[0][0], dir);
					} else blockers = ret[0].concat(dfM.stepGlideFunc(pD, ret[0][0], dir));
				} else if (ret[1]) blockers = [];
				else blockers = ret[0];
			} else {
				if (pX) pD._vy_x += pX;
				if (pY) pD._vy_y += pY;
				blockers = [];
			}
			var x = pD._vy_x - oldX;
			var y = pD._vy_y - oldY;
			if (x || y) {
				dfM.setPos(pD, pD._vy_x, pD._vy_y, false, true);
				dfM.onMoved(pD, x, y, dir);
				if (pD.onRelocated) pD.onRelocated(oldX, oldY, pD._vy_mapN, true);
			}
			if (blockers && blockers.length && !ret[1]) {
				var blocked = [];
				for (var i = blockers.length; i --;) {
					var obj = blockers[i];
					if (!obj || blocked.includes(obj)) continue;
					dfM.onBump(pD, obj);
					blocked.push(obj);
				}
			}
			if (x || y) return true;
		}
	};
	dfM._stepPos = function(pD, pX, pY, pGlide, pDir) {
		var dMap = resM.maps[pD._vy_mapN],
			blockers = [],
			stepX = (pX)? ((pX > 0)? 1 : -1) : 0,
			stepY = (pY)? ((pY > 0)? 1 : -1) : 0;
		pX = Math.abs(pX);
		pY = Math.abs(pY);
		var x1 = (pD._vy_xOr)? Math.floor((pD._vy_x + pD._vy_xOr) / _vy_t_xTileSize) : Math.floor(pD._vy_x / _vy_t_xTileSize),
			y1 = (pD._vy_yOr)? Math.floor((pD._vy_y + pD._vy_yOr) / _vy_t_yTileSize) : Math.floor(pD._vy_y / _vy_t_yTileSize),
			x2 = x1 + pD._vy_xTiles + 1,
			y2 = y1 + pD._vy_yTiles + 1,
			noExit;
		if (stepX >= 0) {
			x2 += Math.ceil(pX / _vy_t_xTileSize);
		} else if (stepX < 0) {
			x1 -= Math.ceil(pX / _vy_t_xTileSize);
			if (x1 < 1) x1 = 1;
		}
		if (x2 > dMap.xMax) x2 = dMap.xMax;
		if (stepY >= 0) {
			y2 += Math.ceil(pY / _vy_t_yTileSize);
		} else if (stepY < 0) {
			y1 -= Math.ceil(pY / _vy_t_yTileSize);
			if (y1 < 1) y1 = 1;
		}
		if (y2 > dMap.yMax) y2 = dMap.yMax;
		
		while (pX || pY) {
			var xO = pD._vy_x + pD._vy_xOr,
				yO = pD._vy_y + pD._vy_yOr,
				xWO = xO + pD._vy_w,
				yHO = yO + pD._vy_h;
			if (xO + stepX < 0 || xO + stepX > dMap.xMaxWidth - pD._vy_w) {
				pX = 0;
				if (xO + stepX < 0) pD._vy_x = 0 - pD._vy_xOr;
				else pD._vy_x = (dMap.xMaxWidth - pD._vy_w) - pD._vy_xOr;
				stepX = 0;
				blockers.push(resM.voidTile);
			}
			if (yO + stepY < 0 || yO + stepY > dMap.yMaxHeight - pD._vy_h) {
				pY = 0;
				if (pD._vy_y + pD._vy_yOr + stepY < 0) pD._vy_y = 0 - pD._vy_yOr;
				else pD._vy_y = (dMap.yMaxHeight - pD._vy_h) - pD._vy_yOr;
				stepY = 0;
				blockers.push(resM.voidTile);
			}
			if (pX <= 0 && pY <= 0) break;
			var canGlide = (pGlide && pX > 0 && pY > 0) ? true : false;
			if (pX > 0) {
				if (pX < 1) {
					stepX *= pX;
					pX = 0;
				} else pX --;
			}
			if (pY > 0) {
				if (pY < 1) {
					stepY *= pY;
					pY = 0;
				} else pY --;
			}
			var fBlockers = [],
				x = pD._vy_x + stepX,
				y = pD._vy_y + stepY;
			for (var l = pD._vy_locs.length; l --;) {
				var tile = pD._vy_locs[l];
				if (tile.onExit) {
					if (dfM._stepPosCheckCollide(pD, tile, stepX, stepY) && !tile.onExit(pD, pDir)) {
						noExit = true;
						var dirB;
						if (stepX && stepY) {
							if (stepX > 0) {
								if (xWO + stepX >= tile._vy_x + _vy_t_xTileSize) dirB = stM.Map.getLocByDir(tile, 'east');
								else dirB = stM.Map.getLocByDir(tile, ((stepY > 0)? 'south' : 'north'));
							} else if (stepX < 0) {
								if (xO + stepX <= tile._vy_x) dirB = stM.Map.getLocByDir(tile, 'west');
								else dirB = stM.Map.getLocByDir(tile, ((stepY > 0)? 'south' : 'north'));
							}
						} else dirB = stM.Map.getLocByDir(tile, pDir);
						if (dirB) fBlockers.push(dirB);
					}
				}
			}
			
			if (!fBlockers.length) {
				for (var iY = y1; iY <= y2; iY ++) {
					for (var iX = x1; iX <= x2; iX ++) {
						var tile = dMap.tiles[iX + dMap.xMax * iY];
						if (!tile) continue;
						if (dfM._stepPosCheckCollide(pD, tile, stepX, stepY)) {
							if (tile._vy_density && pD._vy_density && (tile._vy_density > pD._vy_density || (tile._vy_density ==/*req*/ pD._vy_density && !tile.allowDensityCross))) {
								fBlockers.push(tile);
							} else if (tile.onEnter && !pD._vy_locs.includes(tile)) {
								if (!tile.onEnter(pD, pDir)) fBlockers.push(tile);
								if (pD._vy_mapN !== dMap.name) return [[]];
							}
						}
						if (tile._vy_conts) {
							for (var i3 = tile._vy_conts.length; i3 --;) {
								var obj = tile._vy_conts[i3];
								if (!obj || pD === obj) continue;
								if (pD.onCross || obj.onCross) {
									if (dfM._stepPosCheckCollide(pD, obj, stepX, stepY, pD._vy_crossed)) {
										if (pD.onCross && !pD.onCross(obj) && !fBlockers.includes(obj)) fBlockers.push(obj);
										else if (obj.onCross && !fBlockers.includes(obj) && !obj.onCross(pD, true)) fBlockers.push(obj);
										if (pD._vy_mapN !== dMap.name) return [[]];
										if (!obj._vy_type) continue;
									}
								}
								if (!pD._vy_density || !obj._vy_density) continue;
								if ((obj._vy_density > pD._vy_density || (obj._vy_density ==/*req*/ pD._vy_density && !obj.allowDensityCross)) && (!pD._vy_crossed || !pD._vy_crossed.includes(obj))) {
									if (dfM._stepPosCheckCollide(pD, obj, stepX, stepY, fBlockers)) fBlockers.push(obj);
								}
							}
						}
					}
				}
			}
			blockers = blockers.concat(fBlockers);
			if (fBlockers.length) {
				if (!stepX || !stepY) {
					var xOc, yOc;
					if (fBlockers.length > 1) {
						for (var i2 = fBlockers.length; i2 --;) {
							var obj = fBlockers[i2];
							if (!obj) continue;
							if (stepX && !(obj._vy_y + obj._vy_yOr + obj._vy_h < yO || obj._vy_y + obj._vy_yOr > yHO)) {
								if ((stepX > 0 && (!xOc || obj._vy_x + obj._vy_xOr < xOc._vy_x + xOc._vy_xOr)) || (stepX < 0 && (!xOc || obj._vy_x + obj._vy_xOr > xOc._vy_x + xOc._vy_xOr))) xOc = obj;
							} else if (stepY && !(obj._vy_x + obj._vy_xOr + obj._vy_w < xO || obj._vy_x + obj._vy_xOr > xWO)) {
								if ((stepY > 0 && (!yOc || obj._vy_y + obj._vy_yOr < yOc._vy_y + yOc._vy_yOr)) || (stepY < 0 && (!yOc || obj._vy_y + obj._vy_yOr > yOc._vy_y + yOc._vy_yOr))) yOc = obj;
							}
						}
					}
					if (!xOc) xOc = fBlockers[0];
					if (!yOc) yOc = xOc;
					if (dfM._stepPosFixBlockPos(pD, xOc, yOc, stepX, stepY)) {
						x = pD._vy_x + stepX;
						y = pD._vy_y + stepY;
					}
				}
				if (canGlide) {
					var set = false;
					for (var i2 = fBlockers.length; i2 --;) {
						var obj = fBlockers[i2];
						if (!obj) continue;
						if (((stepX > 0 && xWO + stepX > obj._vy_x + obj._vy_xOr) || (stepX < 0 && xO + stepX < obj._vy_x + obj._vy_xOr + obj._vy_w)) && !(yO >= obj._vy_y + obj._vy_yOr + obj._vy_h || obj._vy_y + obj._vy_yOr >= yHO)) {
							x = pD._vy_x;
							set = true;
						}
						if (((stepY > 0 && yHO + stepY > obj._vy_y + obj._vy_yOr) || (stepY < 0 && yO + stepY < obj._vy_y + obj._vy_yOr + obj._vy_h)) && !(xO >= obj._vy_x + obj._vy_xOr + obj._vy_w || obj._vy_x + obj._vy_xOr >= xWO)) {
							y = pD._vy_y;
							set = true;
						}
					}
					if (!set) break;
				} else break;
			}
			pD._vy_x = x;
			pD._vy_y = y;
		}
		return [blockers, noExit];
	};
	dfM._stepPosCheckCollide = function(pD, pO, pSx, pSy, pArr) {
		if (pArr && pArr.includes(pO)) return;
		var blocking = false;
		if (pSx && !(pO._vy_y + pO._vy_yOr + pO._vy_h <= pD._vy_y + pD._vy_yOr || pO._vy_y + pO._vy_yOr >= pD._vy_y + pD._vy_yOr + pD._vy_h)) {
			if (pSx > 0 && pD._vy_x + pD._vy_xOr + pD._vy_w + pSx > pO._vy_x + pO._vy_xOr && pD._vy_x + pD._vy_xOr + pD._vy_w + pSx < pO._vy_x + pO._vy_xOr + pO._vy_w) blocking = true;
			else if (pSx < 0 && pD._vy_x + pD._vy_xOr + pSx < pO._vy_x + pO._vy_xOr + pO._vy_w && pD._vy_x + pD._vy_xOr + pSx > pO._vy_x + pO._vy_xOr) blocking = true;
		}
		if (!blocking && pSy && !(pO._vy_x + pO._vy_xOr + pO._vy_w <= pD._vy_x + pD._vy_xOr || pO._vy_x + pO._vy_xOr >= pD._vy_x + pD._vy_xOr + pD._vy_w)) {
			if (pSy > 0 && pD._vy_y + pD._vy_yOr + pD._vy_h + pSy > pO._vy_y + pO._vy_yOr && pD._vy_y + pD._vy_yOr + pD._vy_h + pSy < pO._vy_y + pO._vy_yOr + pO._vy_h) blocking = true;
			else if (pSy < 0 && pD._vy_y + pD._vy_yOr + pSy < pO._vy_y + pO._vy_yOr + pO._vy_h && pD._vy_y + pD._vy_yOr + pSy > pO._vy_y + pO._vy_yOr) blocking = true;
		}
		if (!blocking && pSx && pSy) {
			blocking = true;
			if (pD._vy_x + pD._vy_xOr + pSx >= pO._vy_x + pO._vy_xOr + pO._vy_w || pO._vy_x + pO._vy_xOr >= pD._vy_x + pD._vy_xOr + pD._vy_w + pSx) blocking = false;
			else if (pD._vy_y + pD._vy_yOr + pSy >= pO._vy_y + pO._vy_yOr + pO._vy_h || pO._vy_y + pO._vy_yOr >= pD._vy_y + pD._vy_yOr + pD._vy_h + pSy) blocking = false;
		}
		return blocking;
	};
	dfM._stepPosFixBlockPos = function(pD, pOx, pOy, pSx, pSy) {
		var retVal;
		if (pSx && (pD._vy_x + pD._vy_xOr + pD._vy_w < pOx._vy_x + pOx._vy_xOr || pD._vy_x + pD._vy_xOr > pOx._vy_x + pOx._vy_xOr + pOx._vy_w)) {
			if ((pOx._vy_y + pOx._vy_yOr + pOx._vy_h > pD._vy_y + pD._vy_yOr && pOx._vy_y + pOx._vy_yOr + pOx._vy_h < pD._vy_y + pD._vy_yOr + pD._vy_h) || (pOx._vy_y + pOx._vy_yOr > pD._vy_y + pD._vy_yOr && pOx._vy_y + pOx._vy_yOr < pD._vy_y + pD._vy_yOr + pD._vy_h)) {
				if (pSx > 0 && pD._vy_x + pD._vy_xOr + pD._vy_w + pSx > pOx._vy_x + pOx._vy_xOr) {
					retVal = Math.floor(pD._vy_x + (pOx._vy_x + pOx._vy_xOr - (pD._vy_x + pD._vy_xOr + pD._vy_w)));
					if (retVal + pD._vy_w + pD._vy_xOr < pOx._vy_x + pOx._vy_xOr) retVal = Math.floor(retVal + (pOx._vy_x + pOx._vy_xOr - (retVal + pD._vy_w + pD._vy_xOr)));
					if ((pOx._vy_x + pOx._vy_xOr) % 1) retVal += pOx._vy_x + pOx._vy_xOr - Math.floor(pOx._vy_x + pOx._vy_xOr);
					//if (x % 1 && (x - Math.floor(x)) <= 0.05) x = Math.round(x);
					pD._vy_x = retVal;
				} else if (pSx < 0 && pD._vy_x + pD._vy_xOr + pSx < pOx._vy_x + pOx._vy_xOr + pOx._vy_w) {
					retVal = Math.floor(pD._vy_x + (pD._vy_x + pD._vy_xOr - (pOx._vy_x + pOx._vy_xOr + pOx._vy_w)));
					if (retVal + pD._vy_xOr > pOx._vy_x + pOx._vy_xOr + pOx._vy_w) retVal = Math.round(retVal - ((retVal + pD._vy_xOr) - (pOx._vy_x + pOx._vy_xOr + pOx._vy_w)));
					if ((pOx._vy_x + pOx._vy_xOr + pOx._vy_w) % 1) retVal = retVal - (1 - (pOx._vy_x + pOx._vy_xOr + pOx._vy_w - Math.floor(pOx._vy_x + pOx._vy_xOr + pOx._vy_w))) + 1;
					//if (x % 1 && (x - Math.floor(x)) <= 0.05) x = Math.round(x);
					pD._vy_x = retVal;
				}
			}
		} else if (pSy && (pD._vy_y + pD._vy_yOr + pD._vy_h < pOy._vy_y + pOy._vy_yOr || pD._vy_y + pD._vy_yOr > pOy._vy_y + pOy._vy_yOr + pOy._vy_h)) {
			if ((pOy._vy_x + pOy._vy_xOr + pOy._vy_w > pD._vy_x + pD._vy_xOr && pOy._vy_x + pOy._vy_xOr + pOy._vy_w < pD._vy_x + pD._vy_xOr + pD._vy_w) || (pOy._vy_x + pOy._vy_xOr > pD._vy_x + pD._vy_xOr && pOy._vy_x + pOy._vy_xOr < pD._vy_x + pD._vy_xOr + pD._vy_w)) {
				if (pSy > 0 && pD._vy_y + pD._vy_yOr + pD._vy_h + pSy > pOy._vy_y + pOy._vy_yOr) {
					retVal = Math.floor(pD._vy_y + (pOy._vy_y + pOy._vy_yOr - (pD._vy_y + pD._vy_yOr + pD._vy_h)));
					if (retVal + pD._vy_h + pD._vy_yOr < pOy._vy_y + pOy._vy_yOr) retVal = Math.floor(retVal + (pOy._vy_y + pOy._vy_yOr - (retVal + pD._vy_h + pD._vy_yOr)));
					if ((pOy._vy_y + pOy._vy_yOr) % 1) retVal += pOy._vy_y + pOy._vy_yOr - Math.floor(pOy._vy_y + pOy._vy_yOr);
					//if (y % 1 && (y - Math.floor(y)) <= 0.05) y = Math.round(y);
					pD._vy_y = retVal;
				} else if (pSy < 0 && pD._vy_y + pD._vy_yOr + pSy < pOy._vy_y + pOy._vy_yOr + pOy._vy_h) {
					retVal = Math.floor(pD._vy_y + (pD._vy_y + pD._vy_yOr - (pOy._vy_y + pOy._vy_yOr + pOy._vy_h)));
					if (retVal + pD._vy_yOr > pOy._vy_y + pOy._vy_yOr + pOy._vy_h) retVal = Math.round(retVal - ((retVal + pD._vy_yOr) - (pOy._vy_y + pOy._vy_yOr + pOy._vy_h)));
					if ((pOy._vy_y + pOy._vy_yOr + pOy._vy_h) % 1) retVal = retVal - (1 - (pOy._vy_y + pOy._vy_yOr + pOy._vy_h - Math.floor(pOy._vy_y + pOy._vy_yOr + pOy._vy_h))) + 1;
					//if (y % 1 && (y - Math.floor(y)) <= 0.05) y = Math.round(y);
					pD._vy_y = retVal;
				}
			}
		}
		return retVal;
	};
	dfM.stepGlideFunc = function(pD, pC, pDir, pSize) {
		if (pDir === 'north' || pDir === 'south') {
			var pos = pD._vy_x + pD._vy_xOr + pD._vy_wH;
			var diff = (!isNaN(pD.moveSettings.stepGlide))? pD.moveSettings.stepGlide : 0;
			if (pos - diff <= pC._vy_x + pC._vy_xOr) {
				if (!diff || pos + diff < pC._vy_x + pC._vy_xOr + pC._vy_w || (pC._vy_x + pC._vy_xOr - (pos - diff) >= pos + diff - (pC._vy_x + pC._vy_xOr + pC._vy_w))) {
					if (!pSize) {
						pSize = pD._vy_x + pD._vy_xOr + pD._vy_w - (pC._vy_x + pC._vy_xOr);
						if (pSize > pD.moveSettings.stepSize) pSize = pD.moveSettings.stepSize;
					}
					return dfM._stepPos(pD, -pSize, 0)[0];
				}
			}
			if (pos + diff >= pC._vy_x + pC._vy_xOr + pC._vy_w) {
				if (!pSize) {
					pSize = pC._vy_x + pC._vy_xOr + pC._vy_w - (pD._vy_x + pD._vy_xOr);
					if (pSize > pD.moveSettings.stepSize) pSize = pD.moveSettings.stepSize;
				}
				return dfM._stepPos(pD, pSize, 0)[0];
			}
		} else if (pDir === 'east' || pDir === 'west') {
			var pos = pD._vy_y + pD._vy_yOr + pD._vy_hH;
			var diff = (!isNaN(pD.moveSettings.stepGlide))? pD.moveSettings.stepGlide : 0;
			if (pos - diff <= pC._vy_y + pC._vy_yOr) {
				if (!diff || pos + diff < pC._vy_y + pC._vy_yOr + pC._vy_h || (pC._vy_y + pC._vy_yOr - (pos - diff) >= pos + diff - (pC._vy_y + pC._vy_yOr + pC._vy_h))) {
					if (!pSize) {
						pSize = pD._vy_y + pD._vy_yOr + pD._vy_h - (pC._vy_y + pC._vy_yOr);
						if (pSize > pD.moveSettings.stepSize) pSize = pD.moveSettings.stepSize;
					}
					return dfM._stepPos(pD, 0, -pSize)[0];
				}
			}
			if (pos + diff >= pC._vy_y + pC._vy_yOr + pC._vy_h) {
				if (!pSize) {
					pSize = pC._vy_y + pC._vy_yOr + pC._vy_h - (pD._vy_y + pD._vy_yOr);
					if (pSize > pD.moveSettings.stepSize) pSize = pD.moveSettings.stepSize;
				}
				return dfM._stepPos(pD, 0, pSize)[0];
			}
		}
	};
};

function ResourceManager() {
	resM = this;
	//onNew
	resM.iconCanvas = document.createElement('canvas');
	resM.iconCanvasBrush = resM.iconCanvas.getContext('2d');
	resM.loadedAtlases = [];
	resM.loadedSounds = [];
	resM.resImg = {};
	resM.vyrFiles = {};
	resM.loadingResources = [];
	resM.atlasRefreshQueue = {};
	resM.diobNewQueue = [];
	resM.fileText = {};
	resM.resources = [];
	resM.iconStates = ['', 'north', 'south', 'east', 'west', 'northeast', 'northwest', 'southeast', 'southwest', 'move_north', 'move_south', 'move_east', 'move_west', 'move_northeast', 'move_northwest', 'move_southwest', 'move_southeast'];
	resM.appearVars = ['_vy_atlas', '_vy_icoName', '_vy_icoState', '_vy_w', '_vy_h', '_vy_scale', '_vy_transform', '_vy_composite', '_vy_textSty', '_vy_xIcoOff', '_vy_yIcoOff', '_vy_anchor'];
	resM.maps = {'': {'name': '', 'tiles': [], 'objects': [], 'xMax': 0, 'yMax': 0, 'xMaxHeight': 0, 'yMaxHeight': 0}};
	resM.mapName = '';
	resM.map = resM.maps[''];
	resM.onLoaded = null;
	resM.blankPixiTex = PIXI.Texture.from(defM.blankIcon);
	resM.initiate = function() {
		mainM.setWindowSize();
		if (_vy_t_windowPar.game) {
			_vy_t_windowPar.game.child = window;
			_vy_t_windowPar.playerAcc = {'name': (_vy_t_windowPar.game.user || 'Guest')};
			if (_vy_t_windowPar.playerAcc.name === 'Guest') _vy_t_windowPar.playerAcc.guest = true;
		} else {
			_vy_t_windowPar.game = {'sound': true, 'child': window};
			_vy_t_windowPar.playerAcc = {'name': 'Guest', 'guest': true};
		}
		_vy_t_windowPar.locStorage = clientM.getAllLocalStorage();
		_vy_t_windowPar.webDomain = mainM.webDomain;
		_vy_t_windowPar.setLocalStorage = function(pKey, pData) {
			if (!pKey) {
				if (!pData) {
					var keys = [];
					for (var i = 0, len = _vy_t_windowPar.localStorage.length; i < len; i ++) {
						var s = _vy_t_windowPar.localStorage[i];
						if (s && s.indexOf(gameM.gameID + '_') === 0) keys.push(s);
					}
					for (var i = 0, len = keys.length; i < len; i ++) {
						_vy_t_windowPar.localStorage.removeItem(keys[i]);
					}
				}
				return;
			}
			var data = pKey + pData;
			for (var i = 0, len = _vy_t_windowPar.localStorage.length; i < len; i ++) {
				var s = _vy_t_windowPar.localStorage[i];
				if (s && s.indexOf(gameM.gameID + '_') === 0 && s != gameM.gameID + '_' + pKey) {
					data += s.slice(s.indexOf('_') + 1) + _vy_t_windowPar.localStorage.getItem(s);
				}
			}
			if (data.length > 3000) return;
			_vy_t_windowPar.localStorage.setItem(gameM.gameID + '_' + pKey, pData);
		};
		_vy_t_windowPar.authenticateGameAccount = function(pFunc) {
			var xmlReq = new _vy_t_windowPar.XMLHttpRequest();
			xmlReq.open('GET', 'https://' + _vy_t_windowPar.webDomain + '/incajax/?qd=gameAccountAuthenticate', true);
			xmlReq.onreadystatechange = function() {
				if (xmlReq.readyState == 4) {
					var l = xmlReq.responseText.split(';');
					if (l.length > 1) {
						_vy_t_windowPar.playerAcc.authID = l[0];
						_vy_t_windowPar.playerAcc.authIP = l[1];
						if (l[2]) {
							_vy_t_windowPar.playerAcc.name = l[2];
						}
						_vy_t_windowPar.playerAcc.guest = parseInt(l[3]);
					}
					if (pFunc) pFunc();
				}
			};
			xmlReq.send();
		};
		if (gameM.playerMode == 1 || (vyM.disableAPI && !gameM.mainServer)) {
			resM.finishInitialize();
		} else {
			if (gameM.mainServer) {
				var par = (urlPar)? ('?' + urlPar) : '';
				var server = gameM.mainServer;
				if (server.indexOf('http') !== 0) server = 'https://' + server;
				if (!vyM.disableAPI) {
					_vy_t_windowPar.authenticateGameAccount(function() {
						location.href = server + par;
					});
				} else {
					location.href = server + par;
				}
			} else {
				mainM.showServerList();
				var html = '';
				if (gameM.playerMode != 2) {
					html += '<div class="box_title"><div class="box_title_inner">Play Options</div></div><div class="list_entry_ser"></div>';
					html += '<div class="list_entry" onClick=\'return resM.finishInitialize();\'><img class="list_entry_img" src="' + defM.gameMedBanner + '" /><span class="solo_span">Play Solo</span></div>';
				}
				html += '<div class="box_title"><div class="box_title_inner">Servers</div></div><div class="list_entry_div"></div>';
				if (mainM.gamesList.clientHeight > gameM.gameHeight - 94) {
					var height = gameM.gameHeight - 94;
					mainM.gamesList.style.height = height + 'px';
					mainM.gamesList.style.marginTop = '14px';
					mainM.gamesList.style.top = '0px';
				} else {
					mainM.gamesList.style.marginTop = '-233px';
					mainM.gamesList.style.top = '50%';
				}
				mainM.gamesList.innerHTML = html + '<div id="server_list"><span class="server_list_mes">Searching for servers...</span></div>';
				var xmlReq2 = new XMLHttpRequest();
				xmlReq2.open("GET", 'https://' + mainM.webDomain + '/api?a=getServerList&gameID=' + encodeURIComponent(gameM.gameID) + '&trial=' + encodeURIComponent(gameM.trial), true);
				xmlReq2.onreadystatechange = function() {
					if (xmlReq2.readyState == 4) {
						var r = '';
						var l = xmlReq2.responseText.split(';');
						for (var i = 0, len = l.length; i < len; i ++) {
							var entry = l[i];
							if (!entry) continue;
							var s = entry.split('+');
							var players = parseInt(s[2]);
							var playerCount = players;
							var guests = parseInt(s[3]);
							if (guests) playerCount += guests;
							r += '<div class="list_entry list_entry_ser" onClick=\'return mainM.joinNewServer("' + s[0] + '", event);\'><img class="list_entry_img" src="' + defM.gameMedBanner + '" /><span class="server_name">' + decodeURIComponent(s[1]) + '</span><span class="player_count">' + playerCount + ((playerCount == 1)? ' player' : ' players') + '</span></div>';
						}
						if (xmlReq2.responseText) mainM.gamesList.innerHTML = html + r;
						else mainM.gamesList.innerHTML = html + '<div id="server_list"><span class="server_list_mes">No servers found.</span></div>';
					}
				};
				xmlReq2.send();
			}
		}
	};
	resM.finishInitialize = function() {
		if (mainM.inServerList) mainM.hideServerList();
		if (!vyM.disableLoad) {
			if (gameM.loadScreen) mainM.showCustomLoadScreen();
			else mainM.showLoadScreen();
		}
		resM.onLoaded = mainM.initialized;
		for (var i = 0, len = _vy_resources.length; i < len; i += 3) {
			resM.resources[_vy_resources[i]] = {'p': _vy_resources[i], 'v': _vy_resources[i + 1], 'f': _vy_resources[i + 2]};
		}
		delete _vy_resources;
		diobM.loadTypes();
	};
	resM.colorMatrix = {};
	resM.createColorMatrixFilter = function(pM, pC) {
		var filter = new PIXI.filters.ColorMatrixFilter();
		filter.matrix = pM;
		resM.colorMatrix[pC] = filter;
	};
	resM.setObjectIcon = function(pD) {
		if (pD._vy_atlas) {
			var atlas = resM.loadedAtlases[pD._vy_atlas];
			if (!atlas || atlas.loading) {
				if (!resM.atlasRefreshQueue[pD._vy_atlas]) resM.atlasRefreshQueue[pD._vy_atlas] = [];
				if (!resM.atlasRefreshQueue[pD._vy_atlas].includes(pD)) resM.atlasRefreshQueue[pD._vy_atlas].push(pD);
				if (!atlas) {
					resM.resImg[pD._vy_atlas] = {};
					resM.loadAtlas(pD._vy_atlas, true);
				}
			}
			if (!resM.resImg[pD._vy_atlas][pD._vy_icoName]) resM.resImg[pD._vy_atlas][pD._vy_icoName] = {};
			if (!pD._vy_icoState && !resM.resImg[pD._vy_atlas][pD._vy_icoName]['']) stM.Icon.newIcon(pD._vy_atlas, pD._vy_icoName);
			if (pD.isOverlay && pD._vy_appMask && !pD._vy_appMask.ownAnim) {
				dfM._setIconOverlay(pD.isOverlay, pD);
			} else {
				dfM.setIcon(pD, resM.resImg[pD._vy_atlas][pD._vy_icoName][pD._vy_icoState]);
			}
		} else dfM.setIcon(pD, null);
		if (pD._vy_firstOverApp || pD._vy_firstUnderApp) {
			for (var i = pD._vy_over.length; i --;) {
				var over = pD._vy_over[i];
				if (!over._vy_ico && over._vy_atlas) resM.setObjectIcon(over);
			}
		}
	};
	resM.getIconData = function(pIcon) {
		if (pIcon) {
			if (pIcon.imageData) return pIcon.imageData;
			if (pIcon.image) return pIcon.image.src;
		}
		return defM.blankIcon;
	};
	resM.alterIcon = function(pAtlas, pIcon, pState, pFrame, pFunc) {
		if (!pAtlas) return;
		if (!resM.resImg[pAtlas]) resM.loadAtlas(pAtlas);
		if (!resM.resImg[pAtlas]) return;
		if (pIcon || pIcon === '') {
			if (!resM.resImg[pAtlas][pIcon]) return;
			if (!pState && pState !== '') {
				var icon = resM.resImg[pAtlas][pIcon][''];
				if (pFrame) {
					if (!icon.frames || !icon.frames[pFrame - 1]) return;
					pFunc(icon.frames[pFrame - 1]);
				} else {
					if (icon.frames) {
						for (var i = 0, len = icon.frames.length; i < len; i ++) {
							pFunc(icon.frames[i]);
						}
					} else pFunc(icon);
					for (var i = 0, len = icon.states.length; i < len; i ++) {
						var s = icon.states[i];
						if (s.frames) {
							for (var f = 0, fLen = s.frames.length; f < fLen; f ++) {
								pFunc(s.frames[f]);
							}
						} else pFunc(s);
					}
				}
			} else {
				if (!resM.resImg[pAtlas][pIcon][pState]) return;
				var icon = resM.resImg[pAtlas][pIcon][pState];
				if (!pFrame) {
					if (icon.frames) {
						for (var i = 0, len = icon.frames.length; i < len; i ++) {
							pFunc(icon.frames[i]);
						}
					} else pFunc(icon);
				} else {
					if (!icon.frames || !icon.frames[pFrame - 1]) return;
					pFunc(icon.frames[pFrame - 1]);
				}
			}
		} else {
			for (var i in resM.resImg[pAtlas]) {
				for (var i2 in resM.resImg[pAtlas][i]) {
					var icon = resM.resImg[pAtlas][i][i2];
					if (icon.frames) {
						for (var f = 0, fLen = icon.frames.length; f < fLen; f ++) {
							pFunc(icon.frames[f]);
						}
					} else pFunc(icon);
				}
			}
		}
	};
	resM.typesLoaded = function() {
		mainM.createDefaultObjectTypes();
		clientM.initialize();
		resM.voidTile = newDiob(diobM.objectType['Tile'], 0, true);
		resM.voidTile._vy_name = 'void';
		resM.voidTile._vy_density = 1;
		stM.Map.void = resM.voidTile;
		for (var i in resM.resources) {
			var p = resM.resources[i].p.split('_');
			var type = p[0];
			p.shift();
			var name = p.join('_');
			if (type === 'int' || type === 'mac') {
				resM.loadingResources[type + '_' + name] = {'type': type, 'name': name};
			}
		}
		for (var i in _vy_global) {
			if (!_vy_global[i] || typeof(_vy_global[i]) !== 'string') continue;
			_vy_global[i] = eval('(' + decodeURIComponent(_vy_global[i]) + ')');
		}
		if (gameM.preloadResources) {
			if (typeof(gameM.preloadResources) !== 'string') {
				for (var i = 0, len = gameM.preloadResources.length; i < len; i ++) {
					var res = gameM.preloadResources[i];
					if (!res.name) {
						for (var iR in resM.resources) {
							var p = resM.resources[iR].p.split('_');
							var type = p.shift();
							var name = p.join('_');
							if (res.type.startsWith(type)) {
								resM.loadingResources[type + '_' + name] = {'type': type, 'name': name};
								if (res.type === 'map') resM.loadingResources[type + '_' + name].diobs = [];
							}
						}
					} else {
						if (Array.isArray(res.name)) {
							for (var n in res.name) {
								resM.loadingResources[res.type.substr(0, 3) + '_' + res.name[n]] = {'type': res.type.substr(0, 3), 'name': res.name[n]};
								if (res.type === 'map') resM.loadingResources[res.type.substr(0, 3) + '_' + res.name[n]].diobs = [];
							}
						} else {
							if (res.remote) stM.Resource.setResource(res.type, res.name, res.remote, true);
							res.type = res.type.substr(0, 3);
							resM.loadingResources[res.type + '_' + res.name] = res;
							if (res.type === 'map') resM.loadingResources[res.type + '_' + res.name].diobs = [];
						}
					}
				}
			} else if (gameM.preloadResources === '*') {
				for (var i in resM.resources) {
					var p = resM.resources[i].p.split('_');
					var type = p.shift();
					var name = p.join('_');
					resM.loadingResources[type + '_' + name] = {'type': type, 'name': name};
					if (type === 'map') resM.loadingResources[type + '_' + name].diobs = [];
				}
			}
		}
		if (gameM.mainMap && !resM.maps[gameM.mainMap] && !resM.loadingResources['map_' + gameM.mainMap]) {
			resM.loadingResources['map_' + gameM.mainMap] = {'type': 'map', 'name': gameM.mainMap, 'diobs': []};
		}
		for (var i in resM.loadingResources) {
			var res = resM.loadingResources[i];
			resM.loadResource(res.type, res.name);
		}
		resM.loadResCount = Object.keys(resM.loadingResources).length;
		resM.loadResPercent = '0.00';
		var c = 0;
		var loader = setInterval(function() {
			c ++;
			var len = Object.keys(resM.loadingResources).length;
			if (!len) {
				if (!gameM.loadScreen) {
					document.getElementById('load_screen_loader_text').style.display = 'none';
					document.getElementById('load_screen_loader_back').style.display = 'none';
					document.getElementById('load_screen_loader').style.display = 'none';
				} else if (gameM.loadScreen.onTick) {
					gameM.loadScreen.onTick(len, 100);
				}
				mainM.initialized();
				clearInterval(loader);
			} else {
				resM.loadResPercent = (100 - (len / resM.loadResCount * 100)).toFixed(2);
				if (!gameM.loadScreen) {
					document.getElementById('load_screen_loader_text').innerText = resM.loadResPercent + '%';
					document.getElementById('load_screen_loader').style.width = (192 * (resM.loadResPercent / 100)) + 'px';
					if (c >= 4) {
						document.getElementById('load_screen_loader_text').style.display = 'block';
						document.getElementById('load_screen_loader_back').style.display = 'block';
						document.getElementById('load_screen_loader').style.display = 'block';
					}
				} else if (gameM.loadScreen.onTick) {
					gameM.loadScreen.onTick(len, resM.loadResPercent);
				}
			}
		}, 25);
	};
	resM.loadResource = function(pType, pName, pFunc, pLoad) {
		if (pType === 'ico') resM.loadAtlas(pName, pLoad, pFunc);
		else if (pType === 'int') resM.loadInterface(pName, pFunc);
		else if (pType === 'sou') resM.loadSound(pName, 0, pFunc);
		else if (pType === 'mac') resM.loadMacro(pName, pFunc);
		else if (pType === 'map') resM.loadMap(pName, pFunc);
		else if (pType === 'fil') resM.loadFile(pName, pFunc);
	};
	resM.resourcesLoaded = function() {
		var loader = resM.onLoaded;
		resM.onLoaded = null;
		if (loader) loader();
	};
	resM.clearAtlasRefreshQueue = function(pAtlas) {
		if (!resM.atlasRefreshQueue[pAtlas]) return;
		for (var i = 0, len = resM.atlasRefreshQueue[pAtlas].length; i < len; i ++) {
			var a = resM.atlasRefreshQueue[pAtlas][i];
			if (a._vy_atlas !== pAtlas || !resM.resImg[pAtlas]) continue;
			if (!resM.resImg[a._vy_atlas][a._vy_icoName]) stM.Icon.newIcon(a._vy_atlas, a._vy_icoName);
			if (a.isOverlay && a._vy_appMask && !a._vy_appMask.ownAnim) {
				dfM._setIconOverlay(a.isOverlay, a);
			} else {
				dfM.setIcon(a, resM.resImg[a._vy_atlas][a._vy_icoName][a._vy_icoState]);
			}
			dfM._setIconSize(a, 1);
			for (var l in scrM.intBrush) {
				scrM.refreshInt[l] = true;
			}
		}
		delete resM.atlasRefreshQueue[pAtlas];
	};
	resM.loadIconImage = function(pIcon, pD, pFunc, pSkip, pImage) {
		if (pIcon.loading) {
			if (pD) {
				if (!pIcon.loadDiobs) pIcon.loadDiobs = [];
				if (!pIcon.loadDiobs.includes(pD)) pIcon.loadDiobs.push(pD);
			}
			if (pFunc) {
				if (!pIcon.loadFuncs) pIcon.loadFuncs = [];
				pIcon.loadFuncs.push(pFunc);
			}
			return;
		}
		pIcon.loading = 1;
		var par = pIcon.statePar || pIcon.parent || pIcon;
		if (par.statePar) par = par.statePar;
		if (pFunc) pIcon.loadFunc = pFunc;
		if (pD) pIcon.loadDiobs = [pD];
		if (pIcon.frames) {
			for (var i = pIcon.frames.length; i --;) {
				var f = pIcon.frames[i];
				if (!f.loaded) {
					if (!f.loading) par.loading ++;
					resM.loadIconImage(f, null, null, true, pImage);
				}
			}
		}
		if (!pSkip) {
			var icon = (pIcon.statePar)? pIcon.statePar : pIcon;
			if (icon.states) {
				for (var i = icon.states.length; i --;) {
					var s = icon.states[i];
					if (!s.loaded) {
						if (!s.loading) par.loading ++;
						resM.loadIconImage(s, null, null, true, pImage);
					}
				}
			}
		}
		pIcon.pixiTex = (pIcon.imageData)? PIXI.Texture.from(pIcon.imageData) : resM.blankPixiTex;
		if (pImage) {
			if (!pIcon.image) pIcon.image = new Image();
			if (pIcon.imageData) {
				pIcon.image.onload = function() {
					//pIcon.image.getContext('2d').drawImage(this, 0, 0);
					par.loading --;
					if (par !== pIcon) resM.finishLoadIconImage(pIcon);
					if (par.loading <= 0) resM.finishLoadIconImage(par);
					//delete pIcon.imageData;
				};
				pIcon.image.src = pIcon.imageData;
				return;
			}
		}
		par.loading --;
		if (par !== pIcon) resM.finishLoadIconImage(pIcon);
		if (par.loading <= 0) resM.finishLoadIconImage(par);
	};
	resM.finishLoadIconImage = function(pIcon) {
		delete pIcon.loading;
		pIcon.loaded = true;
		if (pIcon.loadDiobs) {
			for (var i = 0, len = pIcon.loadDiobs.length; i < len; i ++) {
				var d = pIcon.loadDiobs[i];
				if (!d || !d._vy_onScr) continue;
				if (d._vy_recheckState && resM.loadedAtlases[pIcon.atlas] && !resM.loadedAtlases[pIcon.atlas].loading) {
					dfM.setIconState(d, d._vy_recheckState, d._vy_recheckStateM);
				}
				if (d._vy_gui) scrM.refreshInt[d._vy_layer] = true;
				else if (d._vy_pixS) {
					scrM.updateScreenSpriteIcon(d);
					dfM._setIconSize(d);
				}
			}
			delete pIcon.loadDiobs;
		}
		if (pIcon.loadFuncs) {
			for (var f in pIcon.loadFuncs) {
				if (!pIcon.loadFuncs.hasOwnProperty(f)) continue;
				funcM._callback(pIcon.loadFuncs[f]);
			}
			delete pIcon.loadFuncs;
		}
		if (pIcon.loadFunc) {
			funcM._callback(pIcon.loadFunc);
			delete pIcon.loadFunc;
		}
	};
	resM.loadAtlasIcon = function(pName, pDelay, pData, pW, pH, pAtlas, pOld) {
		var r = pOld || {};
		r.atlas = pAtlas;
		r.name = decodeURIComponent(pName);
		r.delay = (pDelay)? pDelay : 100;
		r.loaded = false;
		r.width = pW;
		r.height = pH;
		r.parent = r;
		r.imageData = pData;
		return r;
	};
	resM.loadAtlas = function(pName, pAutoLoad, pFunc, pD) {
		if (resM.loadedAtlases[pName]) {
			if (resM.loadedAtlases[pName].loading) {
				if (pFunc) {
					if (!resM.loadedAtlases[pName].loadFuncs) resM.loadedAtlases[pName].loadFuncs = [];
					resM.loadedAtlases[pName].loadFuncs.push(pFunc);
				}
			} else {
				delete resM.loadingResources['ico_' + pName];
				if (pFunc) funcM._callback(pFunc, 'exists');
			}
			return;
		}
		var res = resM.resources['ico_' + pName];
		if (!res) {
			delete resM.loadingResources['ico_' + pName];
			if (pFunc) funcM._callback(pFunc);
			return;
		}
		if (resM.vyrFiles.hasOwnProperty(res.f)) {
			resM.resImg[pName] = resM.resImg[resM.vyrFiles[res.f]];
			if (!resM.loadedAtlases[pName] || !resM.loadedAtlases[pName].loading) delete resM.loadingResources['ico_' + pName];
			if (resM.loadedAtlases[resM.vyrFiles[res.f]].loading) resM.loadedAtlases[resM.vyrFiles[res.f]].loading.push(pName);
			else resM.clearAtlasRefreshQueue(pName);
			if (pFunc) funcM._callback(pFunc);
			return;
		}
		var atlasPath = ((res.r)? res.f : serM.resourceServer + '/resources/' + res.f) + '?v=' + res.v;
		var at = pName;
		resM.loadedAtlases[at] = {'loading': []};
		if (!resM.resImg[at]) resM.resImg[at] = {};
		resM.vyrFiles[res.f] = at;
		var xmlReq = new XMLHttpRequest();
		xmlReq.open('GET', atlasPath, true);
		xmlReq.overrideMimeType('text/plain; charset=x-user-defined');
		xmlReq.onreadystatechange = function() {
			if (xmlReq.readyState == 4) {
				if (xmlReq.status !== 404 && xmlReq.response) {
					var p = '';
					try {
						p = pako.inflate(xmlReq.response, {to: 'string'});
					} catch (pError) {
						p = xmlReq.response;
					}
					if (p) {
						var json = JSON.parse(p);
						var loadIcons = [], diobs = [];
						if (!json.v) {
							for (var i = 0, len = json.icons.length; i < len; i ++) {
								var icon = json.icons[i];
								if (!resM.resImg[at][icon.name]) resM.resImg[at][icon.name] = {};
								var old = resM.resImg[at][icon.name][''];
								var r = resM.loadAtlasIcon(icon.name, icon.delay, icon.data, icon.w, icon.h, at, old);
								r.states = [];
								if (icon.frames && icon.frames.length) {
									r.frames = [r];
									for (var f = 0, len2 = icon.frames.length; f < len2; f ++) {
										var frame = icon.frames[f];
										var fr = resM.loadAtlasIcon(null, frame.delay, frame.data, icon.w, icon.h, at);
										fr.parent = r;
										r.frames.push(fr);
									}
									if (old) {
										for (var o in diobM.objects) {
											var obj = diobM.objects[o];
											if (!obj || obj._vy_ico !== old) continue;
											diobs.push(obj);
										}
									}
								}
								if (!resM.resImg[at][r.name]) resM.resImg[at][r.name] = {};
								resM.resImg[at][r.name][''] = r;
								if (pAutoLoad || old) loadIcons.push(r);
								if (icon.states) {
									for (var s = 0, len2 = icon.states.length; s < len2; s ++) {
										var state = icon.states[s];
										var rS = resM.loadAtlasIcon(state.name, state.delay, state.data, icon.w, icon.h, at);
										resM.resImg[at][r.name][rS.name] = rS;
										rS.statePar = r;
										if (icon.states[s].frames && icon.states[s].frames.length) {
											rS.frames = [rS];
											for (var f = 0, len3 = icon.states[s].frames.length; f < len3; f ++) {
												var frame = icon.states[s].frames[f];
												var fr = resM.loadAtlasIcon(null, frame.delay, frame.data, icon.w, icon.h, at);
												fr.parent = rS;
												rS.frames.push(fr);
											}
										}
										r.states.push(rS);
									}
								}
							}
						} else if (json.v === 1) {
							var prefix = defM.imgPre;
							for (var i = 0, len = json.i.length; i < len; i ++) {
								var icon = json.i[i];
								if (!resM.resImg[at][icon[0]]) resM.resImg[at][icon[0]] = {};
								var old = resM.resImg[at][icon[0]][''];
								var r = resM.loadAtlasIcon(icon[0], icon[3], prefix + icon[4], icon[1], icon[2], at, old);
								var frameDelay = icon[3];
								r.states = [];
								if (icon[5].length) {
									r.frames = [r];
									for (var f = 0, len2 = icon[5].length; f < len2; f ++) {
										var frame = icon[5][f];
										var fr = resM.loadAtlasIcon(null, (frame[1] || frameDelay), prefix + frame[0], icon[1], icon[2], at);
										fr.parent = r;
										r.frames.push(fr);
										if (frame[1]) frameDelay = frame[1];
									}
									if (old) {
										for (var o in diobM.objects) {
											var obj = diobM.objects[o];
											if (!obj || obj._vy_ico !== old) continue;
											diobs.push(obj);
										}
									}
								}
								if (!resM.resImg[at][r.name]) resM.resImg[at][r.name] = {};
								resM.resImg[at][r.name][''] = r;
								if (pAutoLoad || old) loadIcons.push(r);
								if (icon[6]) {
									for (var s = 0, len2 = icon[6].length; s < len2; s ++) {
										var state = icon[6][s];
										var rS = resM.loadAtlasIcon(state[0], state[2], prefix + state[1], icon[1], icon[2], at);
										frameDelay = state[2];
										resM.resImg[at][r.name][rS.name] = rS;
										rS.statePar = r;
										if (state[3]) {
											rS.frames = [rS];
											for (var f = 0, len3 = state[3].length; f < len3; f ++) {
												var frame = state[3][f];
												var fr = resM.loadAtlasIcon(null, (frame[1] || frameDelay), prefix + frame[0], icon[1], icon[2], at);
												fr.parent = rS;
												rS.frames.push(fr);
												if (frame[1]) frameDelay = frame[1];
											}
										}
										r.states.push(rS);
									}
								}
							}
						}
						for (var i = loadIcons.length; i --;) {
							resM.loadIconImage(loadIcons[i], pD);
						}
						for (var i = diobs.length; i --;) {
							var obj = diobs[i];
							if (obj._vy_recheckState) {
								dfM.setIconState(obj, obj._vy_recheckState, obj._vy_recheckStateM);
							} else dfM.setIcon(obj, obj._vy_ico);
						}
					}
					for (var i = resM.loadedAtlases[at].loading.length; i --;) {
						resM.clearAtlasRefreshQueue(resM.loadedAtlases[at].loading[i]);
					}
					delete resM.loadedAtlases[at].loading;
					resM.clearAtlasRefreshQueue(pName);
					if (resM.loadedAtlases[at].loadFuncs) {
						for (var f in resM.loadedAtlases[at].loadFuncs) {
							if (!resM.loadedAtlases[at].loadFuncs.hasOwnProperty(f)) continue;
							funcM._callback(resM.loadedAtlases[at].loadFuncs[f], 'loaded');
						}
						delete resM.loadedAtlases[at].loadFuncs;
					}
					if (pFunc) funcM._callback(pFunc, 'loaded');
				} else {
					if (resM.loadedAtlases[at].loadFuncs) {
						for (var f in resM.loadedAtlases[at].loadFuncs) {
							if (!resM.loadedAtlases[at].loadFuncs.hasOwnProperty(f)) continue;
							funcM._callback(resM.loadedAtlases[at].loadFuncs[f]);
						}
						delete resM.loadedAtlases[at].loadFuncs;
					}
					if (pFunc) funcM._callback(pFunc, false);
				}
				delete resM.loadingResources['ico_' + pName];
			}
		}
		xmlReq.send();
	};
	resM.loadFile = function(pName, pFunc) {
		var res = resM.resources['fil_' + pName];
		if (!res) {
			delete resM.loadingResources['fil_' + pName];
			if (pFunc) pFunc();
			return;
		}
		if (resM.vyrFiles.hasOwnProperty(res.f)) {
			resM.fileText[pName] = resM.fileText[resM.vyrFiles[res.f]];
			delete resM.loadingResources['fil_' + pName];
			if (pFunc) pFunc();
			return;
		}
		resM.fileText[pName] = {'loading': []};
		resM.vyrFiles[res.f] = pName;
		var xmlReq = new XMLHttpRequest();
		xmlReq.open('GET', ((res.r)? res.f : serM.resourceServer + '/resources/' + res.f) + '?v=' + res.v, true);
		xmlReq.onreadystatechange = function() {
			if (xmlReq.readyState == 4) {
				if (xmlReq.status !== 404) {
					resM.fileText[pName].text = xmlReq.responseText;
					if (pFunc) pFunc('loaded');
				} else if (pFunc) pFunc(false);
				delete resM.loadingResources['fil_' + pName];
			}
		};
		xmlReq.send();
	};
	resM.loadIntSkipVars = ['type', 'x', 'y', 'xPos', 'yPos', 'hidden', 'isHidden', 'name', 'text'];
	resM.loadInterface = function(pName, pFunc) {
		if (clientM.interfaces[pName]) {
			delete resM.loadingResources['int_' + pName];
			if (pFunc) pFunc('exists');
			return;
		}
		var res = resM.resources['int_' + pName];
		if (!res) {
			delete resM.loadingResources['int_' + pName];
			if (pFunc) pFunc();
			return;
		}
		if (resM.vyrFiles.hasOwnProperty(res.f)) {
			if (clientM.interfaces[resM.vyrFiles[res.f]].loading) clientM.interfaces[resM.vyrFiles[res.f]].loading.push(pName);
			else clientM.interfaces[pName] = clientM.interfaces[resM.vyrFiles[res.f]];
			delete resM.loadingResources['int_' + pName];
			if (pFunc) pFunc();
			return;
		}
		clientM.interfaces[pName] = {'loading': []};
		resM.vyrFiles[res.f] = pName;
		var xmlReq = new XMLHttpRequest();
		xmlReq.open('GET', ((res.r)? res.f : serM.resourceServer + '/resources/' + res.f) + '?v=' + res.v, true);
		xmlReq.onreadystatechange = function() {
			if (xmlReq.readyState == 4) {
				if (xmlReq.status !== 404 && xmlReq.responseText) {
					var intPane = newDiob(diobM.objectType['Interface']);
					intPane._vy_conts = [];
					intPane._vy_name = pName;
					intPane._vy_aContents = {};
					/*if (intPane.onNew) {
						if (!mainM.isInitialized) resM.diobNewQueue.push(intPane);
						else diobM.diobOnNew(intPane);
					}*/
					var json = JSON.parse(xmlReq.responseText);
					for (var i = 0, len = json.elements.length; i < len; i ++) {
						var elObj = json.elements[i];
						var element = newDiob(diobM.objectType[elObj.type]);
						element._vy_conts = [];
						element._vy_x = (elObj.x || elObj.xPos || 0);
						element._vy_y = (elObj.y || elObj.yPos || 0);
						for (var v in elObj) {
							if (resM.loadIntSkipVars.includes(v)) continue;
							if (!isNaN(elObj[v])) {
								element[v] = elObj[v];
							} else {
								try {
									element[v] = JSON.parse(decodeURIComponent(elObj[v]));
								} catch (pE) {
									element[v] = decodeURIComponent(elObj[v]);
								}
							}
						}
						
						if (elObj.text !== undefined) element._vy_text = decodeURIComponent(elObj.text);
						element.isHidden = elObj.hidden || elObj.isHidden || element.isHidden || 0;
						element._vy_name = elObj.name;
						element._vy_parent = intPane;
						element._vy_clCon = clientM;
						if (intPane._vy_aContents[element._vy_name]) {
							var index = intPane._vy_conts.indexOf(intPane._vy_aContents[element._vy_name]);
							if (index !== -1) intPane._vy_conts.splice(index, 1);
						}
						intPane._vy_aContents[element._vy_name] = element;
						intPane._vy_conts.push(element);
						if (element.onNew) {
							if (!mainM.isInitialized) resM.diobNewQueue.push(element);
							else diobM.diobOnNew(element);
						}
					}
					var old = clientM.interfaces[pName];
					clientM.interfaces[pName] = intPane;
					if (old.loading.length) {
						for (var i in old.loading) {
							clientM.interfaces[old.loading[i]] = clientM.interfaces[pName];
						}
					}
					if (pFunc) pFunc('loaded');
				} else if (pFunc) pFunc(false);
				delete resM.loadingResources['int_' + pName];
			}
		};
		xmlReq.send();
	};
	resM.loadMacro = function(pName, pFunc) {
		var res = resM.resources['mac_' + pName];
		if (!res || eventM.macros[pName]) {
			delete resM.loadingResources['mac_' + pName];
			if (pFunc) pFunc();
			return;
		}
		if (resM.vyrFiles.hasOwnProperty(res.f)) {
			eventM.macros[pName] = eventM.macros[resM.vyrFiles[res.f]];
			delete resM.loadingResources['mac_' + pName];
			if (pFunc) pFunc();
			return;
		}
		eventM.macros[pName] = {};
		resM.vyrFiles[res.f] = pName;
		var xmlReq = new XMLHttpRequest();
		xmlReq.open('GET', ((res.r)? res.f : serM.resourceServer + '/resources/' + res.f) + '?v=' + res.v, true);
		xmlReq.onreadystatechange = function() {
			if (xmlReq.readyState == 4) {
				if (xmlReq.status !== 404 && xmlReq.responseText) {
					var json = JSON.parse(xmlReq.responseText);
					for (var i = 0, len = json.macros.length; i < len; i ++) {
						var macro = json.macros[i];
						eventM.macros[pName]['on' + macro.key] = {'name': decodeURIComponent(macro.name)};
						if (macro.keyDown) {
							var s = decodeURIComponent(macro.keyDown);
							if (clientM.clientType._vy_com[s.substr(0, s.indexOf('.'))]) eval("eventM.macros['" + pName + "']['on" + macro.key + "'].down = function() { clientM.clientType._vy_com." + s + "; };");
						}
						if (macro.keyUp) {
							var s = decodeURIComponent(macro.keyUp);
							if (clientM.clientType._vy_com[s.substr(0, s.indexOf('.'))]) eval("eventM.macros['" + pName + "']['on" + macro.key + "'].up = function() { clientM.clientType._vy_com." + s + "; };");
						}
					}
					if (pFunc) pFunc('loaded');
				} else if (pFunc) pFunc(false);
				delete resM.loadingResources['mac_' + pName];
			}
		};
		xmlReq.send();
	};
	resM.loadSound = function(pName, pPlay, pFunc) {
		if (!soundM.player) {
			delete resM.loadingResources['sou_' + pName];
			if (pFunc) pFunc('loaded');
			return;
		}
		var res = resM.resources['sou_' + pName];
		if (!res) {
			delete resM.loadingResources['sou_' + pName];
			if (pFunc) pFunc();
			return;
		}
		if (resM.vyrFiles.hasOwnProperty(res.f)) {
			resM.loadedSounds[pName] = resM.loadedSounds[resM.vyrFiles[res.f]];
			delete resM.loadingResources['sou_' + pName];
			if (pFunc) pFunc();
			return;
		}
		if (resM.loadedSounds[pName]) {
			delete resM.loadingResources['sou_' + pName];
			if (pFunc) pFunc('loaded');
			return;
		}
		resM.loadedSounds[pName] = {'loading': true};
		resM.vyrFiles[res.f] = pName;
		var xmlReq = new XMLHttpRequest();
		xmlReq.open('GET', ((res.r)? res.f : serM.resourceServer + '/resources/' + res.f) + '?v=' + res.v, true);
		xmlReq.responseType = 'arraybuffer';
		xmlReq.onreadystatechange = function() {
			if (xmlReq.readyState == 4) {
				if (xmlReq.status === 404) {
					delete resM.loadingResources['sou_' + pName];
					delete resM.loadedSounds[pName];
					if (pFunc) pFunc(false);
					return;
				}
				resM.loadedSounds[pName].data = xmlReq.response;
				delete resM.loadedSounds[pName].loading;
				delete resM.loadingResources['sou_' + pName];
				if (pPlay) {
					if (Array.isArray(pPlay)) {
						if (!pPlay[0]._vy_isStopped) soundM.playSound(pPlay[0], pPlay[1], pPlay[2]);
					} else {
						if (!pPlay._vy_isStopped) soundM.playSound(pPlay);
					}
				}
				if (pFunc) pFunc('loaded');
			}
		};
		xmlReq.send();
	};
	resM.loadMap = function(pName, pFunc) {
		var res = resM.resources['map_' + pName];
		if (!res) {
			delete resM.loadingResources['map_' + pName];
			resM.createMap(pName).isTemp = 1;
			if (pFunc) pFunc();
			return;
		}
		if (resM.vyrFiles.hasOwnProperty(res.f)) {
			resM.maps[pName] = resM.maps[resM.vyrFiles[res.f]];
			delete resM.loadingResources['map_' + pName];
			if (pFunc) pFunc();
			return;
		}
		if (resM.loadingResources['map_' + pName]) {
			if (resM.loadingResources['map_' + pName].loading) {
				if (pFunc) pFunc();
				return;
			}
		} else resM.loadingResources['map_' + pName] = {'type': 'map', 'name': pName, 'diobs': []};
		resM.loadingResources['map_' + pName].loading = true;
		resM.maps[pName] = {'tiles': []};
		resM.vyrFiles[res.f] = pName;
		var xmlReq = new XMLHttpRequest();
		xmlReq.open('GET', ((res.r)? res.f : serM.resourceServer + '/resources/' + res.f) + '?v=' + res.v, true);
		xmlReq.onreadystatechange = function() {
			if (xmlReq.readyState === 4) {
				if (xmlReq.status !== 404 && xmlReq.responseText) {
					var json = JSON.parse(xmlReq.responseText);
					if (pFunc) {
						resM.newMap(pName, json, 0, function(){ pFunc('loaded'); });
					} else {
						resM.newMap(pName, json);
					}
				} else {
					delete resM.loadingResources['map_' + pName];
					if (pFunc) pFunc(false);
				}
			}
		};
		xmlReq.send();
	};
	resM.newMapTile = function(pMap, pType, pX, pY) {
		var obj = funcM._newDiob(pType, 1);
		diobM.objects[dfM.setID(obj)] = obj;
		obj._vy_mapN = pMap.name;
		obj._vy_x = (pX - 1) * _vy_t_xTileSize;
		obj._vy_y = (pY - 1) * _vy_t_yTileSize;
		pMap.tiles[pX + pMap.xMax * pY] = obj;
		return obj;
	};
	resM.newMap = function(pName, pFile, pClone, pFunc) {
		if (!resM.maps[pName]) resM.maps[pName] = {};
		var map = resM.maps[pName];
		map.name = pName;
		if (pClone) map.isClone = pClone;
		var x = 0, y = 1, onNews = [];
		if (!pFile.v) {
			map.xMax = pFile.map.xMax;
			map.yMax = pFile.map.yMax;
			map.tiles = new Array(map.xMax + map.xMax * map.yMax);
			var tileTypes = {}, tiles = pFile.tiles, mLen = pFile.map.fCTLen;
			var objTypes = {}, objs = pFile.objects, oLen = pFile.map.fCOLen;
			for (var i = 0, len = pFile.tTypes.length; i < len; i ++) tileTypes[pFile.tTypes[i].fC] = i;
			for (var i = 0, len = pFile.oTypes.length; i < len; i ++) objTypes[pFile.oTypes[i].fC] = i;
			var i = 0;
			var interval = setInterval(function() {
				var c = Math.min(20000, tiles.length - i);
				for (var len = i + c; i < len; i += mLen) {
					x ++;
					if (x > map.xMax) {
						x = 1;
						y ++;
					}
					var tType = pFile.tTypes[tileTypes[tiles.substring(i, i + mLen)]];
					var type = tType.type, typeA;
					if (type.includes(',')) {
						typeA = type.split(',');
						type = typeA[0];
					}
					var obj = resM.newMapTile(map, type, x, y);
					if (typeA && typeA.length > 1) {
						for (var i2 = 1, len2 = typeA.length; i2 < len2; i2 ++) {
							var tO = typeA[i2];
							if (tO.includes('{')) tO = decodeURIComponent(tO);
							if (i2 === len2 - 1 && diobM.regions.hasOwnProperty(tO)) {
								if (tO !== 'Region' && diobM.regions[tO]) obj._vy_region = diobM.regions[tO];
							} else {
								var over = dfM.addOverlay(obj, tO, defM.appMaskS);
								if (over._vy_xCoOff) over._vy_xIcoOff += over._vy_xCoOff;
								if (over._vy_yCoOff) over._vy_yIcoOff += over._vy_yCoOff;
							}
						}
						typeA = 0;
					}
					if (obj.onNew) {
						if (!mainM.isInitialized) resM.diobNewQueue.push(obj);
						else onNews.push(obj);
					}
				}
				if (i >= tiles.length) {
					clearInterval(interval);
					fin();
				}
			}, 1);
			var fin = function() {
				x = 0; y = 1;
				for (var i = 0, len = objs.length; i < len; i += oLen) {
					x ++;
					if (x > map.xMax) {
						x = 1;
						y ++;
					}
					var index = objTypes[objs.substring(i, i + oLen)];
					if (index) {
						var oT = pFile.oTypes[index];
						var types = (oT.type.includes(','))? oT.type.split(',') : [oT.type];
						for (var t = 0, len2 = types.length; t < len2; t ++) {
							var d = funcM._newDiob(types[t]);
							d._vy_locs = [];
							d._vy_mapN = pName;
							dfM.setPos(d, ((x - 1) * _vy_t_xTileSize) + d._vy_xCoOff, ((y - 1) * _vy_t_yTileSize) + d._vy_yCoOff, false, true);
							if (d._vy_isOffGrid && (!d._vy_offGridLocs || !d._vy_offGridLocs.length)) dfM._setPosData(d);
							if (d.onNew) {
								if (!mainM.isInitialized) resM.diobNewQueue.push(d);
								else onNews.push(d);
							}
						}
					}
				}
				map.xMaxWidth = map.xMax * _vy_t_xTileSize;
				map.yMaxHeight = map.yMax * _vy_t_yTileSize;
				map.file = pFile;
				map.isLoaded = true;
				resM.maps[pName] = map;
				var res = resM.loadingResources['map_' + pName]
				if (res) {
					delete resM.loadingResources['map_' + pName];
					if (res.diobs) {
						for (var i = 0, len = res.diobs.length; i < len; i ++) {
							var diob = res.diobs[i];
							var dInfo = diob._vy_waitingMap;
							if (diob && diob._vy_type && dInfo && dInfo.map === pName) {
								dfM._setMap(diob, pName, dInfo.x, dInfo.y, dInfo.s);
								delete diob._vy_waitingMap;
							}
						}
					}
				}
				if (onNews.length) {
					for (var i = 0, len = onNews.length; i < len; i ++) {
						diobM.diobOnNew(onNews[i]);
					}
				}
				if (stM.World.onMapLoaded) stM.World.onMapLoaded(pName);
				if (pFunc) funcM._callback(pFunc);
				if (res && res.clones) {
					for (var i = 0, len = res.clones.length; i < len; i ++) {
						funcM._callback(res.clones[i]);
					}
				}
				if (resM.mapName === pName) {
					dfM._setMap(clientM.cOb._vy_playerMob, null, undefined, undefined, 1);
					dfM._setMap(clientM.cOb._vy_playerMob, pName, clientM.cOb._vy_playerMob._vy_x, clientM.cOb._vy_playerMob._vy_y, 1);
				}
			}
		} else {
			/*var tiles = pFile.t, tTiles = pFile.tT;
			map.xMax = pFile.m.x;
			map.yMax = pFile.m.y;
			map.tiles = new Array(map.xMax + map.xMax * map.yMax);
			//for (var i = 0, len = map.xMax + 1; i < len; i ++) map.tiles.push(new Array(map.yMax + 1));
			for (var i = 0, len = tiles.length; i < len; i ++) {
				x ++;
				if (x > map.xMax) {
					x = 1;
					y ++;
				}
				var tArr = tTiles[tiles[i]];
				var type = tArr[0];
				var obj = resM.newMapTile(map, type, x, y);
				if (tArr[1]) {
					var tOver = tArr[1];
					for (var i2 = 0, len2 = tOver.length; i2 < len2; i2 ++) {
						var tO = tOver[i2];
						if (tO.includes('{')) tO = decodeURIComponent(tO);
						var over = dfM.addOverlay(obj, tO, defM.appMaskS);
						if (over._vy_xCoOff) over._vy_xIcoOff += over._vy_xCoOff;
						if (over._vy_yCoOff) over._vy_yIcoOff += over._vy_yCoOff;
					}
				}
				if (tArr[2]) {
					var tO = tArr[2];
					if (tO !== 'Region' && diobM.regions[tO]) obj._vy_region = diobM.regions[tO];
				}
				if (obj.onNew) {
					if (!mainM.isInitialized) resM.diobNewQueue.push(obj);
					else onNews.push(obj);
				}
				if (tArr[3]) {
					var types = tArr[3];
					for (var t = 0, len2 = types.length; t < len2; t ++) {
						var d = funcM._newDiob(types[t]);
						if (d.moveSettings) {
							if (!d.moveSettings.stepSize) d.moveSettings.stepSize = 2;
							if (d.moveSettings.stepGlide === undefined) d.moveSettings.stepGlide = true;
						}
						dfM._setMap(d, pName, (x - 1) * _vy_t_xTileSize, (y - 1) * _vy_t_yTileSize);
						if (d._vy_isOffGrid && (!d._vy_offGridLocs || !d._vy_offGridLocs.length)) dfM._setPosData(d);
						if (d.onNew) {
							if (!mainM.isInitialized) resM.diobNewQueue.push(d);
							else onNews.push(d);
						}
					}
				}
			}*/
		}
	};
	resM.clearMap = function(pMap, pSkip) {
		var arr = [];
		for (var o in diobM.objects) {
			var obj = diobM.objects[o];
			if (!obj || obj._vy_mapN !== pMap || obj._vy_clCon) continue;
			arr.push(obj);
		}
		delete resM.maps[pMap];
		var res = resM.resources['map_' + pMap];
		if (res) delete resM.vyrFiles[res.f];
		if (!pSkip) {
			for (var o in arr) {
				funcM.delDiob(arr[o]);
			}
		} else {
			for (var o in arr) {
				arr[o]._vy_mapN = null;
			}
			return arr;
		}
	};
	resM.setMap = function(pMap) {
		if (resM.mapName === pMap) return;
		if (!pMap) pMap = '';
		resM.mapName = pMap;
		resM.map = resM.maps[resM.mapName];
		if (!resM.map) resM.map = resM.maps[''];
		if (!scrM.pauseDraw) {
			scrM.clearScreen();
			scrM.setViewFromObject(scrM.viewEye, true, true);
		}
	};
	resM.createMap = function(pName, pX, pY, pTile) {
		if (!pName) return;
		if (!pX) pX = 0;
		if (pY === undefined) pY = pX;
		if (!pTile) pTile = 'Tile';
		if (resM.maps[pName]) resM.clearMap(pName);
		var map = {'name': pName, 'xMax': pX, 'yMax': pY, 'xMaxWidth': pX * _vy_t_yTileSize, 'yMaxHeight': pY * _vy_t_yTileSize, 'tiles': []};
		if (pX && pY) {
			map.tiles = new Array(pX + pX * pY);
			//for (var i = 0, len = pX + 1; i < len; i ++) map.tiles.push(new Array(pY + 1));
			for (var x = 1; x <= pX; x ++) {
				for (var y = 1; y <= pY; y ++) {
					var obj = resM.newMapTile(map, pTile, x, y);
					if (obj.onNew) {
						if (!mainM.isInitialized) resM.diobNewQueue.push(obj);
						else diobM.diobOnNew(obj);
					}
				}
			}
		}
		map.isLoaded = true;
		resM.maps[pName] = map;
		if (stM.World.onMapLoaded) stM.World.onMapLoaded(pName);
		return map;
	};
	resM.cloneMap = function(pMap, pName, pFunc) {
		if (!resM.loadingResources['map_' + pName]) resM.loadingResources['map_' + pName] = {'type': 'map', 'name': pName, 'diobs': [], 'loading': true};
		if (resM.maps[pName]) {
			if (!resM.maps[pName].isClone && !resM.maps[pName].xMax) {
				resM.loadingResources['map_' + pName].diobs = resM.clearMap(pName, 1);
			} else {
				resM.clearMap(pName);
			}
		}
		if (!resM.maps[pMap]) resM.loadMap(pMap);
		if (resM.loadingResources['map_' + pMap] && resM.loadingResources['map_' + pMap].loading) {
			if (!resM.loadingResources['map_' + pMap].clones) resM.loadingResources['map_' + pMap].clones = [];
			resM.loadingResources['map_' + pMap].clones.push([resM.cloneMap, resM, [pMap, pName, pFunc]]);
		} else {
			if (pFunc) {
				resM.newMap(pName, resM.maps[pMap].file, pMap, function() { funcM._callback(pFunc, 'loaded'); });
			} else {
				resM.newMap(pName, resM.maps[pMap].file, pMap);
			}
		}
	};
	resM.deleteMap = function(pName) {
		resM.clearMap(pName);
	};
};

function SoundManager() {
	soundM = this;
	window.AudioContext = window.AudioContext || window.webkitAudioContext;
	if (window.AudioContext) soundM.player = new window.AudioContext();
	soundM.playSound = function(pSound, pStart, pDuration) {
		if (!soundM.player || !mainM.game.sound) return {};
		var soundName = pSound;
		var soundObj = 0;
		var t = typeof(pSound);
		if (t === 'string') {
			if (pSound === 'Sound' && diobM.objectType['Sound']) {
				soundObj = funcM.newObject('Sound');
			} else if (pSound.includes("/")) {
				var sT = pSound.substring(0, pSound.indexOf("/"));
				if (sT === 'Sound' && diobM.objectType[pSound]) soundObj = funcM.newObject(pSound);
			}
			if (!soundObj) {
				soundObj = funcM.newObject('Sound');
				soundObj.soundName = pSound;
			}
			soundName = soundObj.soundName;
		} else if (t === 'object') {
			if (!pSound._vy_type) {
				soundObj = funcM.newObject('Sound');
				diobM.copyObjectVars(soundObj, pSound);
			} else soundObj = pSound;
			soundName = soundObj.soundName;
		} else return {};
		if (!soundName) return {};
		var sFile = resM.loadedSounds[soundName];
		if (!sFile) {
			resM.loadSound(soundName, [soundObj, pStart, pDuration]);
			return soundObj;
		} else {
			if (sFile.loading) return soundObj;
			if (sFile.data) {
				soundM.player.decodeAudioData(sFile.data, function(pBuffer) {
					sFile.buffer = pBuffer;
					if (soundObj && !soundObj._vy_isStopped) soundM.playSound(soundObj, pStart, pDuration);
				}, function(pError) {
					console.log(pError);
				});
				delete sFile.data;
				return soundObj;
			}
			if (!sFile.buffer) return soundObj;
			var s = soundM.player.createBufferSource();
			soundObj._vy_source = s;
			s.buffer = sFile.buffer;
			soundM.createGain(soundObj);
			if (soundObj.onEnded) s.onended = soundObj.onEnded;
			if (soundObj.onStarted && !soundObj._vy_isStopped) soundObj.onStarted(clientM.cOb, pStart);
			if (soundObj.loop) s.loop = true;
			soundObj._vy_isStopped = false;
			if (soundObj.startTime && pStart === undefined) pStart = soundObj.startTime;
			if (soundObj.duration && pDuration === undefined) pDuration = soundObj.duration;
			s.startTime = s.context.currentTime;
			s.duration = (pDuration || s.buffer.duration);
			s.start(0, pStart, pDuration);
			return soundObj;
		}
	};
	soundM.createGain = function(pSound) {
		var gainNode = soundM.player.createGain();
		if (isFinite(pSound.volume)) gainNode.gain.value = pSound.volume / 100;
		pSound._vy_source.connect(gainNode);
		gainNode.connect(soundM.player.destination);
		pSound._vy_gain = gainNode;
	};
};

Sound.prototype.stop = function() {
	if (!this._vy_source) return;
	this._vy_source.onended = null;
	this._vy_isStopped = this._vy_source.context.currentTime - this._vy_source.startTime;
	this._vy_source.stop(0);
	if (this.onStopped) this.onStopped();
	//this._vy_source.disconnect();
};
Sound.prototype.resume = function() {
	if (!this._vy_source) return;
	var start = this._vy_source.startTime;
	var dur = this._vy_source.duration;
	soundM.playSound(this, this._vy_isStopped, this._vy_source.duration - this._vy_isStopped)
	this._vy_source.startTime = start;
	this._vy_source.duration = dur;
	if (this.onResumed) this.onResumed();
};
Sound.prototype.fade = function(pVol, pDur) {
	if (!this._vy_source) return;
	if (!this._vy_gain) soundM.createGain(this);
	if (this._vy_fader) clearInterval(this._vy_fader);
	this._vy_faderT = Math.abs(pVol - this.volume) / (pDur * 1000);
	if (pVol > this.volume) {
		this._vy_fader = setInterval(function() {
			if (this._vy_isStopped) return;
			this.volume += this._vy_faderT * 50;
			if (this.volume >= pVol) {
				this.volume = pVol;
				clearInterval(this._vy_fader);
				delete this._vy_fader;
			}
			this.setVolume(this.volume);
		}.bind(this), 50);
	} else {
		this._vy_fader = setInterval(function() {
			if (this._vy_isStopped) return;
			this.volume -= this._vy_faderT * 50;
			if (this.volume <= pVol) {
				this.volume = pVol;
				clearInterval(this._vy_fader);
				delete this._vy_fader;
			}
			this.setVolume(this.volume);
		}.bind(this), 50);
	}
};
Sound.prototype.setVolume = function(pVol) {
	if (!this._vy_source) return;
	if (!this._vy_gain) soundM.createGain(this);
	this._vy_gain.gain.value = pVol / 100;
	this.volume = pVol;
};
Sound.prototype.setLoop = function(pLoop) {
	if (!this._vy_source) return;
	if (pLoop === undefined) {
		if (this.loop) pLoop = false;
		else pLoop = true;
	}
	this.loop = pLoop;
	this._vy_source.loop = pLoop;
};
Sound.prototype.getRawData = function() {
	var sound = resM.loadedSounds[this.soundName];
	if (!sound) return;
	return sound.data;
};
Sound.prototype.getContext = function() {
	if (!this._vy_source) return;
	return this._vy_source.context;
}
Sound.prototype.getBuffer = function() {
	if (!this._vy_source) return;
	return this._vy_source.buffer;
}
Object.defineProperty(Sound.prototype, 'isStopped', {
	get: function() {
		return this._vy_isStopped;
	},
	set: function() {}
});
Object.defineProperty(Sound.prototype, 'currentTime', {
	get: function() {
		if (!this._vy_source) return 0;
		return this._vy_source.context.currentTime - this._vy_source.startTime;
	},
	set: function() {}
});

function ScreenManager() {
	scrM = this;
	//onNew
	scrM.topBrush = mainM.topCanvasControl.getContext('2d');
	scrM.intAnimations = [];
	scrM.screenTiles = [];
	scrM.interfaceElements = [];
	scrM.refreshInt = {};
	scrM.intCanvas = {};
	scrM.intBrush = {};
	scrM.topScreenBrush = {};
	scrM.topScreenCanvas = {};
	scrM.planesArr = [];
	scrM.planes = {};
	scrM.screenAnimations = [];
	scrM.syncAnimations = {};
	scrM.outputQueue = [];
	scrM.defaultText = {'fontFamily': 'Courier, monospace', 'fontSize': 12, 'textBaseline': 'alphabetic', 'fill': '#000', 'padding': 0, 'leading': 0, 'lineSpace': 0};
	scrM.screenView = {'scaleTo': 'normal', 'scaleNearest': false};
	scrM.mapView = {'width': 960, 'height': 540, 'xPos': 0, 'yPos': 0, 'scale': 0};
	scrM.xScr = 0;
	scrM.xScrRaw = 0;
	scrM.xScrDelay = 0;
	scrM.xScrOff = 0;
	scrM.xCoord = 1;
	scrM.yCoord = 1;
	scrM.yScr = 0;
	scrM.yScrRaw = 0;
	scrM.yScrDelay = 0;
	scrM.yScrOff = 0;
	scrM.xMap = 0;
	scrM.mapWidth = 0;
	scrM.yMap = 0;
	scrM.mapHeight = 0;
	scrM.xMapPos = 0;
	scrM.yMapPos = 0;
	scrM.xEdgeLimit = 0;
	scrM.yEdgeLimit = 0;
	scrM.scrDelayStep = 0;
	scrM.xScrDelayMax = _vy_t_xTileSize;
	scrM.xScrExtraTile = 1;
	scrM.xScrExtra = _vy_t_xTileSize * 2;
	scrM.yScrDelayMax = _vy_t_yTileSize;
	scrM.yScrExtraTile = 1;
	scrM.yScrExtra = _vy_t_yTileSize * 2;
	scrM.frames = 0;
	//scrM.renderDelay = 0;
	scrM.pauseDraw = false;
	scrM.disableImageSmoothing = false;
	scrM.composites = {'normal': PIXI.BLEND_MODES.NORMAL, 'add': PIXI.BLEND_MODES.ADD, 'multiply': PIXI.BLEND_MODES.MULTIPLY, 'screen': PIXI.BLEND_MODES.SCREEN};
	scrM.initiate = function() {
		if (gameM.mapMode) {
			if (gameM.mapMode === 'isometric') {
				scrM.updateScreenSpritePos = scrM.updateScreenSpritePosIso;
				scrM.setDisplayOrderAddDis = scrM.setDisplayOrderAddDisIso;
			}
		}
		if (mainM.canvasBackColor) scrM.pixiApp = new PIXI.Application({'width': gameM.gameWidth, 'height': gameM.gameHeight, 'transparent': true, 'view': mainM.gameCanvasControl});
		else scrM.pixiApp = new PIXI.Application({'width': gameM.gameWidth, 'height': gameM.gameHeight, 'transparent': true, 'view': mainM.gameCanvasControl});
		scrM.tileContainer = new PIXI.Container();
		scrM.pixiApp.stage.addChild(scrM.tileContainer);
		scrM.clientContainer = new PIXI.Container();
		scrM.pixiApp.stage.addChild(scrM.clientContainer);
		scrM.pixiApp.ticker.add(scrM.refreshScreen);
		dfM._setPlane(0);
		eventM.lastObjMove = Date.now();
		eventM.tickerDelay = 10;
		eventM.lastTick = Date.now();
		eventM.tickerInterval = setInterval(eventM.ticker, eventM.tickerDelay);
		scrM.setRenderDelay();
	};
	scrM.setRenderDelay = function() {
		if (!clientM.cOb.maxFPS) clientM.cOb.maxFPS = 0;
		//else if (clientM.cOb.maxFPS <= 0) clientM.cOb.maxFPS = 1;
		//if (clientM.cOb.maxFPS < 60) scrM.renderDelay = Math.round(1000 / clientM.cOb.maxFPS);
		//else scrM.renderDelay = 0;
		//scrM.pixiApp.ticker.speed = clientM.cOb.maxFPS / 60;
		scrM.pixiApp.ticker.maxFPS = clientM.cOb.maxFPS;
		/*if (scrM.renderLoop) clearInterval(scrM.renderLoop);
		if (scrM.renderDelay) {
			scrM.renderLoop = setInterval(function() {
				requestAnimationFrame(scrM.refreshScreen);
			}, scrM.renderDelay);
		} else {
			scrM.renderLoop = null;
			requestAnimationFrame(scrM.refreshScreen);
		}*/
	};
	scrM.setViewEye = function(pD) {
		if (scrM.viewEye) delete scrM.viewEye._vy_isViewEye;
		var old = scrM.viewEye;
		scrM.viewEye = pD;
		if (!pD) {
			scrM.clearScreen();
			return;
		}
		pD._vy_isViewEye = true;
		scrM.xViewEye = scrM.mapWidthHalf - pD._vy_wH - scrM.xScrOff;
		scrM.yViewEye = scrM.mapHeightHalf - pD._vy_hH - scrM.yScrOff;
		if (!old || pD._vy_mapN !== old._vy_mapN) resM.setMap(pD._vy_mapN);
		scrM.setViewFromObject(pD, true, true);
		scrM.setViewFromPos(pD._vy_x - scrM.xViewEye, pD._vy_y - scrM.yViewEye);
	};
	scrM.setViewFromObject = function(pD, pNewLoc, pReset) {
		scrM.setViewD = pD;
		if (pNewLoc) scrM.setViewNewLoc = pNewLoc;
		scrM.setViewReset = pReset;
	};
	scrM.setViewFromPos = function(pX, pY) {
		if (!scrM.setViewReset && scrM.scrDelayStep) {
			scrM.xScrDelay += -(scrM.xScrRaw - pX);
			if (scrM.xScrDelay) {
				if (scrM.xScrDelay > 0 && scrM.xScrDelay > scrM.xScrDelayMax) {
					scrM.xScr += scrM.xScrDelay - scrM.xScrDelayMax;
					scrM.xScrDelay = scrM.xScrDelayMax;
				} else if (-scrM.xScrDelay > scrM.xScrDelayMax) {
					scrM.xScr += scrM.xScrDelay + scrM.xScrDelayMax;
					scrM.xScrDelay = -scrM.xScrDelayMax;
				}
			}
			scrM.yScrDelay += -(scrM.yScrRaw - pY);
			if (scrM.yScrDelay) {
				if (scrM.yScrDelay > 0 && scrM.yScrDelay > scrM.yScrDelayMax) {
					scrM.yScr += scrM.yScrDelay - scrM.yScrDelayMax;
					scrM.yScrDelay = scrM.yScrDelayMax;
				} else if (-scrM.yScrDelay > scrM.yScrDelayMax) {
					scrM.yScr += scrM.yScrDelay + scrM.yScrDelayMax;
					scrM.yScrDelay = -scrM.yScrDelayMax;
				}
			}
			scrM.xScrRaw = pX;
			scrM.yScrRaw = pY;
			if (scrM.hasEdgeLimit) scrM.checkScreenLocRaw();
			scrM.scrDelay = scrM.scrDelayStep;
			if (!scrM.xScrDelay && !scrM.yScrDelay) scrM.clearViewEyeDelay();
			scrM.xCoord = Math.floor(scrM.xScrRaw / _vy_t_xTileSize) + 1;
			scrM.yCoord = Math.floor(scrM.yScrRaw / _vy_t_yTileSize) + 1;
			if (scrM.setViewNewLoc) {
				scrM.setViewNewLoc = 0;
				scrM.setMapViewDisplay();
			}
		} else {
			if (scrM.scrDelay) scrM.clearViewEyeDelay(true);
			var oX = scrM.xScr;
			var oY = scrM.yScr;
			scrM.xScr = pX;
			scrM.yScr = pY;
			if (scrM.hasEdgeLimit) scrM.checkScreenLoc();
			scrM.xScrRaw = scrM.xScr;
			scrM.yScrRaw = scrM.yScr;
			scrM.xCoord = Math.floor(scrM.xScrRaw / _vy_t_xTileSize) + 1;
			scrM.yCoord = Math.floor(scrM.yScrRaw / _vy_t_yTileSize) + 1;
			if (scrM.setViewNewLoc) {
				scrM.setViewNewLoc = 0;
				scrM.setMapViewDisplay();
			}
			if (scrM.xScr !== oX || scrM.yScr !== oY) scrM.scrMoved(oX, oY);
		}
	};
	scrM.updateViewEyeDelay = function(pSize, pTime) {
		var oX = scrM.xScr;
		var oY = scrM.yScr;
		pSize *= (pTime - scrM.scrDelayTime) / 16.6667;
		if (scrM.xScrDelay) {
			if (scrM.xScrDelay > 0) {
				if (pSize > scrM.xScrDelay) pSize = scrM.xScrDelay;
				scrM.xScr += pSize;
				scrM.xScrDelay -= pSize;
				if (scrM.xScr >= scrM.xScrRaw || scrM.xScrDelay <= 0) {
					scrM.xScrDelay = 0;
					scrM.xScr = scrM.xScrRaw;
				}
			} else {
				if (pSize > -scrM.xScrDelay) pSize = -scrM.xScrDelay;
				scrM.xScr -= pSize;
				scrM.xScrDelay += pSize;
				if (scrM.xScr <= scrM.xScrRaw || scrM.xScrDelay >= 0) {
					scrM.xScrDelay = 0;
					scrM.xScr = scrM.xScrRaw;
				}
			}
		}
		if (scrM.yScrDelay) {
			if (scrM.yScrDelay > 0) {
				if (pSize > scrM.yScrDelay) pSize = scrM.yScrDelay;
				scrM.yScr += pSize;
				scrM.yScrDelay -= pSize;
				if (scrM.yScr >= scrM.yScrRaw || scrM.yScrDelay <= 0) {
					scrM.yScrDelay = 0;
					scrM.yScr = scrM.yScrRaw;
				}
			} else {
				if (pSize > -scrM.yScrDelay) pSize = -scrM.yScrDelay;
				scrM.yScr -= pSize;
				scrM.yScrDelay += pSize;
				if (scrM.yScr <= scrM.yScrRaw || scrM.yScrDelay >= 0) {
					scrM.yScrDelay = 0;
					scrM.yScr = scrM.yScrRaw;
				}
			}
		}
		scrM.scrDelayTime = pTime;
		if (!scrM.xScrDelay && !scrM.yScrDelay) scrM.clearViewEyeDelay();
		else if (scrM.hasEdgeLimit) scrM.checkScreenLoc(true);
		if (scrM.xScr !== oX || scrM.yScr !== oY) scrM.scrMoved(oX, oY);
	};
	scrM.clearViewEyeDelay = function(pSkip) {
		scrM.xScrDelay = 0;
		scrM.yScrDelay = 0;
		scrM.xScr = scrM.xScrRaw;
		scrM.yScr = scrM.yScrRaw;
		if (!pSkip) {
			if (scrM.hasEdgeLimit) scrM.checkScreenLoc();
			scrM.xScrRaw = scrM.xScr;
			scrM.yScrRaw = scrM.yScr;
		}
		scrM.scrDelay = false;
	};
	scrM.scrMoved = function(pX, pY) {
		/*for (var i = scrM.screenTiles.length; i --;) {
			var t = scrM.screenTiles[i];
			if (t._vy_pixS) scrM.updateScreenSpritePos(t);
		}*/
		for (var i = 0, len = scrM.planesArr.length; i < len; i ++) {
			var plane = scrM.planesArr[i];
			for (var i2 = plane._vy_planeDis.length; i2 --;) {
				var d = plane._vy_planeDis[i2];
				if (!d || !d._vy_pixS || d._vy_client) continue;
				scrM.updateScreenSpritePos(d);
			}
		}
		if (clientM.cOb.onScreenMoved) clientM.cOb.onScreenMoved(scrM.xScr, scrM.yScr, pX, pY);
		scrM.moveTileScreen = true;
		//clientM.cOb._vy_x = scrM.xScr;
		//clientM.cOb._vy_y = scrM.yScr;
	};
	scrM.setMapView = function(pView) {
		if (pView) scrM.mapView = pView;
		else scrM.mapView = {'scale': 0};
		if (!scrM.mapView.width) scrM.mapView.width = gameM.gameWidth;
		if (!scrM.mapView.height) scrM.mapView.height = gameM.gameHeight;
		if (!scrM.mapView.xPos) scrM.mapView.xPos = 0;
		if (!scrM.mapView.yPos) scrM.mapView.yPos = 0;
		if (scrM.mapView.scale) {
			if (scrM.mapView.scale.width) scrM.mapView.scale.x = scrM.mapView.scale.width;
			if (scrM.mapView.scale.height) scrM.mapView.scale.y = scrM.mapView.scale.y;
		}
		scrM.setMapScreen(scrM.mapView.xPos, scrM.mapView.yPos, scrM.mapView.width, scrM.mapView.height);
		var set = (scrM.mapView.xTiles !== scrM.xMap || scrM.mapView.yTiles !== scrM.yMap)? true : false;
		if (scrM.mapView.xTiles) {
			scrM.xMap = Math.ceil(scrM.mapView.xTiles);
			scrM.xMapHalf = Math.round(scrM.xMap / 2);
			scrM.mapWidth = scrM.mapView.xTiles * _vy_t_xTileSize;
			scrM.mapWidthHalf = Math.round(scrM.mapWidth / 2);
		}
		if (scrM.mapView.yTiles) {
			scrM.yMap = Math.ceil(scrM.mapView.yTiles);
			scrM.yMapHalf = Math.round(scrM.yMap / 2);
			scrM.mapHeight = scrM.mapView.yTiles *_vy_t_yTileSize;
			scrM.mapHeightHalf = Math.round(scrM.mapHeight / 2);
		}
		if (scrM.viewEye) {
			scrM.xViewEye = scrM.mapWidthHalf - scrM.viewEye._vy_wH - scrM.xScrOff;
			scrM.yViewEye = scrM.mapHeightHalf - scrM.viewEye._vy_hH - scrM.yScrOff;
		}
		mainM.setWindowSize(true);
		if (set) scrM.setViewFromObject(clientM.cOb._vy_viewEye, true, true);
	};
	scrM.setScreenView = function(pView) {
		if (!pView) pView = {'scaleTo': 'normal', 'scaleNearest': false, 'disableImageSmoothing': false};
		scrM.screenView = pView;
		clientM.cOb.screenView = pView;
		if (pView.disableImageSmoothing || pView.scaleNearest) PIXI.settings.SCALE_MODE = PIXI.SCALE_MODES.NEAREST;
		else PIXI.settings.SCALE_MODE = PIXI.SCALE_MODES.LINEAR;
		scrM.disableImageSmoothing = (pView.disableImageSmoothing)? true : false;
		mainM.setWindowSize();
	};
	scrM.setMapViewDisplay = function() {
		var tiles = resM.map.tiles;
		for (var y = Math.max(scrM.yCoord - scrM.yScrExtraTile, 1), yLen = Math.min(scrM.yCoord + scrM.yMap + scrM.yScrExtraTile, resM.map.yMax); y <= yLen; y ++) {
			for (var x = Math.max(scrM.xCoord - scrM.xScrExtraTile, 1), xLen = Math.min(scrM.xCoord + scrM.xMap + scrM.xScrExtraTile, resM.map.xMax); x <= xLen; x ++) {
				scrM.addToScreen(tiles[x + resM.map.xMax * y]);
			}
		}
		scrM.refreshTileScreen = true;
		scrM.refreshScrEyeLoc = true;
	};
	scrM.checkScreenLoc = function(pSkip) {
		if (scrM.yScr - scrM.yScrOff < 0 - scrM.yEdgeLimit) {
			scrM.yScr = 0 - scrM.yEdgeLimit;
			if (!pSkip) {
				if (scrM.yScrOff > 0) scrM.yScr += scrM.yScrOff;
				scrM.yCoord = Math.ceil(scrM.yScr / _vy_t_yTileSize);
			}
		} else if (scrM.yScr - scrM.yScrOff + scrM.mapHeight > resM.map.yMaxHeight + scrM.yEdgeLimit) {
			scrM.yScr = resM.map.yMaxHeight + scrM.yEdgeLimit - scrM.mapHeight;
			if (!pSkip) {
				if (scrM.yScrOff < 0) scrM.yScr += scrM.yScrOff;
				scrM.yCoord = Math.ceil(scrM.yScr / _vy_t_yTileSize);
			}
		}
		if (scrM.xScr - scrM.xScrOff < 0 - scrM.xEdgeLimit) {
			scrM.xScr = 0 - scrM.xEdgeLimit;
			if (!pSkip) {
				if (scrM.xScrOff > 0) scrM.xScr += scrM.xScrOff;
				scrM.xCoord = Math.ceil(scrM.xScr / _vy_t_xTileSize);
			}
		} else if (scrM.xScr - scrM.xScrOff + scrM.mapWidth > resM.map.xMaxWidth + scrM.xEdgeLimit) {
			scrM.xScr = resM.map.xMaxWidth + scrM.xEdgeLimit - scrM.mapWidth;
			if (!pSkip) {
				if (scrM.xScrOff < 0) scrM.xScr += scrM.xScrOff;
				scrM.xCoord = Math.ceil(scrM.xScr / _vy_t_xTileSize);
			}
		}
	};
	scrM.checkScreenLocRaw = function(pSkip) {
		if (scrM.yScrRaw - scrM.yScrOff < 0 - scrM.yEdgeLimit) {
			scrM.yScrRaw = 0 - scrM.yEdgeLimit;
			if (!pSkip) {
				if (scrM.yScrOff > 0) scrM.yScrRaw += scrM.yScrOff;
				scrM.yCoord = Math.ceil(scrM.yScrRaw / _vy_t_yTileSize);
			}
		} else if (scrM.yScrRaw - scrM.yScrOff + scrM.mapHeight > resM.map.yMaxHeight + scrM.yEdgeLimit) {
			scrM.yScrRaw = resM.map.yMaxHeight + scrM.yEdgeLimit - scrM.mapHeight;
			if (!pSkip) {
				if (scrM.yScrOff < 0) scrM.yScrRaw += scrM.yScrOff;
				scrM.yCoord = Math.ceil(scrM.yScrRaw / _vy_t_yTileSize);
			}
		}
		if (scrM.xScrRaw - scrM.xScrOff < 0 - scrM.xEdgeLimit) {
			scrM.xScrRaw = 0 - scrM.xEdgeLimit;
			if (!pSkip) {
				if (scrM.xScrOff > 0) scrM.xScrRaw += scrM.xScrOff;
				scrM.xCoord = Math.ceil(scrM.xScrRaw / _vy_t_xTileSize);
			}
		} else if (scrM.xScrRaw - scrM.xScrOff + scrM.mapWidth > resM.map.xMaxWidth + scrM.xEdgeLimit) {
			scrM.xScrRaw = resM.map.xMaxWidth + scrM.xEdgeLimit - scrM.mapWidth;
			if (!pSkip) {
				if (scrM.xScrOff < 0) scrM.xScrRaw += scrM.xScrOff;
				scrM.xCoord = Math.ceil(scrM.xScrRaw / _vy_t_xTileSize);
			}
		}
	};
	scrM.clearScreen = function(pType, pSkip) {
		if (pType) {
			for (var i in clientM.interfaces) {
				var intPane = clientM.interfaces[i];
				if (!intPane._vy_shown) continue;
				intPane._vy_shown = false;
				scrM.removeFromInterface(intPane);
				for (var i = 0, len = intPane._vy_conts.length; i < len; i ++) {
					var e = intPane._vy_conts[i];
					if (!e.isHidden) dfM.onHide(e);
				}
			}
		} else {
			for (var i = scrM.planesArr.length; i --;) {
				var plane = scrM.planesArr[i];
				for (var i2 = plane._vy_planeDis.length; i2 --;) {
					var d = plane._vy_planeDis[i2];
					if (!d) {
						plane._vy_planeDis.splice(i2, 1);
						continue;
					}
					scrM.removeFromScreen(d, null, true);
				}
			}
			for (var c = scrM.screenTiles.length; c --;) scrM.removeFromScreen(scrM.screenTiles[c], true, true);
			scrM.screenTiles = [];
		}
		if (!pSkip && clientM.cOb._vy_over) {
			for (var o in clientM.cOb._vy_over) {
				scrM.addToScreen(clientM.cOb._vy_over[o]);
			}
		}
	};
	scrM.setScreenSpriteText = function(pD) {
		if (pD._vy_textSty) {
			pD._vy_pixT = new PIXI.Text(pD._vy_text, pD._vy_textSty);
			if (pD._vy_textSty.anchor) pD._vy_pixT.anchor.set(pD._vy_textSty.anchor.x, pD._vy_textSty.anchor.y);
			if (pD._vy_textSty.scale) {
				pD._vy_pixT.scale.x = pD._vy_textSty.scale.x;
				pD._vy_pixT.scale.y = pD._vy_textSty.scale.y;
			}
			pD._vy_pixT._vy_xPos = pD._vy_textSty.xPos || 0;
			pD._vy_pixT._vy_yPos = pD._vy_textSty.yPos || 0;
		} else {
			pD._vy_pixT = new PIXI.Text(pD._vy_text, scrM.defaultText);
			pD._vy_pixT._vy_xPos = 0;
			pD._vy_pixT._vy_yPos = 0;
		}
	};
	scrM.setScreenSpriteOverScreen = function(pD) {
		pD._vy_overScrSprite = new PIXI.Sprite(PIXI.Texture.from(pD._vy_overScr.canvas.toDataURL()));
	};
	scrM.setScreenSprite = function(pD) {
		if (!pD._vy_pixS) pD._vy_pixS = new PIXI.Sprite();
		if (pD._vy_pixT) pD._vy_pixT.text = pD._vy_text;
		else if (pD._vy_text) scrM.setScreenSpriteText(pD);
		if (pD._vy_overScr && !pD._vy_overScrSprite) scrM.setScreenSpriteOverScreen(pD);
		if (pD._vy_pixS.anchor) {
			if (pD._vy_anchor) pD._vy_pixS.anchor.set(pD._vy_anchor.x, pD._vy_anchor.y);
			else pD._vy_pixS.anchor.set(0.5, 0.5);
		}
		if (!scrM.composites[pD._vy_composite]) pD._vy_pixS.blendMode = scrM.composites.normal;
		else pD._vy_pixS.blendMode = scrM.composites[pD._vy_composite];
	};
	scrM.updateScreenSprite = function(pD, pSkip) {
		scrM.updateScreenSpriteIcon(pD, true);
		scrM.updateScreenSpritePos(pD, true);
		scrM.updateScreenSpriteTrans(pD, true);
		scrM.updateScreenSpriteText(pD, true);
		if (pD._vy_over && !pSkip) {
			for (var o in pD._vy_over) {
				var over = pD._vy_over[o];
				if (over._vy_pixS) scrM.updateScreenSprite(over, true);
			}
		}
	};
	scrM.updateScreenSpriteIcon = function(pD, pSkip) {
		if (!pD._vy_sprite) {
			if (pD._vy_ico && pD._vy_ico.pixiTex) pD._vy_pixS.texture = pD._vy_ico.pixiTex;
			else pD._vy_pixS.texture = resM.blankPixiTex;
		}
		if ((pD._vy_firstOverApp || pD._vy_firstUnderApp) && !pSkip) {
			for (var o in pD._vy_over) {
				var over = pD._vy_over[o];
				if (over._vy_appMask && !over._vy_appMask.ownAnim) {
					dfM._setIconOverlay(pD, over);
					dfM._setIconSize(over);
				}
			}
		}
	};
	scrM.updateScreenSpritePosDef = function(pD, pSkip) {
		var x = 0, y = 0;
		if (pD.isOverlay) {
			if (pD._vy_appMask) {
				x = pD.isOverlay._vy_x - scrM.xScr + pD._vy_xIcoOff + pD.isOverlay._vy_xIcoOff;
				y = pD.isOverlay._vy_y - scrM.yScr + pD._vy_yIcoOff + pD.isOverlay._vy_yIcoOff;
				/*if (pD.isOverlay._vy_isLoc) {
					x += scrM.xScr;
					y += scrM.yScr;
				}*/
			} else {
				if (pD.isOverlay._vy_isClient) {
					x = pD._vy_x + pD._vy_xIcoOff;
					y = pD._vy_y + pD._vy_yIcoOff;
				} else {
					x = pD.isOverlay._vy_x - scrM.xScr + pD._vy_x + pD._vy_xIcoOff;
					y = pD.isOverlay._vy_y - scrM.yScr + pD._vy_y + pD._vy_yIcoOff;
				}
			}
		} else {
			x = pD._vy_x - scrM.xScr + pD._vy_xIcoOff;
			y = pD._vy_y - scrM.yScr + pD._vy_yIcoOff;
		}
		if (pD._vy_pixT) pD._vy_pixT.position.set(x + pD._vy_pixT._vy_xPos, y + pD._vy_pixT._vy_yPos);
		if (pD._vy_overScrSprite) pD._vy_overScrSprite.position.set(x + pD._vy_overScr.x, y + pD._vy_overScr.y);
		pD._vy_pixS.position.set(x + (pD._vy_icoW * pD._vy_pixS.anchor.x), y + (pD._vy_icoH * pD._vy_pixS.anchor.y));
		if (pD._vy_over && !pSkip) {
			for (var o in pD._vy_over) {
				var over = pD._vy_over[o];
				if (over._vy_pixS) scrM.updateScreenSpritePos(over, true);
			}
		}
	};
	scrM.updateScreenSpritePosIso = function(pD, pSkip) {
		var sX = (scrM.xViewEye - scrM.yViewEye);
		var sY = (scrM.xViewEye + scrM.yViewEye) / 2;
		var x = (pD._vy_x - scrM.xScr);
		var y = (pD._vy_y - scrM.yScr);
		if (pD.isOverlay) {
			if (pD._vy_appMask) {
				x = pD.isOverlay._vy_x - scrM.xScr + pD._vy_xIcoOff + pD.isOverlay._vy_xIcoOff;
				y = pD.isOverlay._vy_y - scrM.yScr + pD._vy_yIcoOff + pD.isOverlay._vy_yIcoOff;
			} else {
				if (pD.isOverlay._vy_isClient) {
					x = pD._vy_x + pD._vy_xIcoOff + (scrM.mapWidthHalf / 2);
					y = pD._vy_y + pD._vy_yIcoOff + (scrM.mapHeightHalf / 2);
				} else {
					x = pD.isOverlay._vy_x - scrM.xScr + pD._vy_x + pD._vy_xIcoOff;
					y = pD.isOverlay._vy_y - scrM.yScr + pD._vy_y + pD._vy_yIcoOff;
				}
			}
		}
		x = (((x - y) - sX) + scrM.xViewEye) + pD._vy_xIcoOff;
		y = Math.round((((x + y) / 2) - sY) + scrM.yViewEye) + pD._vy_yIcoOff;
		if (pD._vy_pixT) pD._vy_pixT.position.set(x + pD._vy_pixT._vy_xPos, y + pD._vy_pixT._vy_yPos);
		if (pD._vy_overScrSprite) pD._vy_overScrSprite.position.set(x + pD._vy_overScr.x, y + pD._vy_overScr.y);
		pD._vy_pixS.position.set(x + (pD._vy_icoW * pD._vy_pixS.anchor.x), y + (pD._vy_icoH * pD._vy_pixS.anchor.y));
		if (pD._vy_over && !pSkip) {
			for (var o in pD._vy_over) {
				var over = pD._vy_over[o];
				if (over._vy_pixS) scrM.updateScreenSpritePos(over, true);
			}
		}
	};
	scrM.updateScreenSpritePos = scrM.updateScreenSpritePosDef;
	scrM.updateScreenSpriteTrans = function(pD, pSkip) {
		var r = (pD.isOverlay && pD._vy_appMask && !pD._vy_appMask.ownMod)? pD.isOverlay : pD;
		pD._vy_pixS.alpha = r._vy_alpha;
		//if (pD._vy_pixT) pD._vy_pixT = r._vy_alpha;
		pD._vy_pixS.rotation = -r._vy_angle;
		if (r._vy_scale) {
			pD._vy_pixS.scale.x = r._vy_scale.x;
			pD._vy_pixS.scale.y = r._vy_scale.y;
		} else {
			pD._vy_pixS.scale.x = 1;
			pD._vy_pixS.scale.y = 1;
		}
		if (r._vy_transform) {
			pD._vy_pixS.scale.x *= r._vy_transform[0];
			pD._vy_pixS.scale.y *= r._vy_transform[4];
			pD._vy_pixS.skew.set(r._vy_transform[3], r._vy_transform[1]);
			pD._vy_pixS.pivot.set(-r._vy_transform[6], -r._vy_transform[7]);
		}
		if (pD._vy_over && !pSkip) {
			for (var o in pD._vy_over) {
				var over = pD._vy_over[o];
				if (over._vy_appMask && over._vy_pixS) scrM.updateScreenSpriteTrans(over, true);
			}
		}
	};
	scrM.updateScreenSpriteText = function(pD, pSkip) {
		if (pD._vy_pixT) {
			pD._vy_pixT.text = pD._vy_text;
			pD._vy_pixT.style = (pD._vy_textSty || scrM.defaultText);
		}
		if (pD._vy_over && !pSkip) {
			for (var o in pD._vy_over) {
				var over = pD._vy_over[o];
				if (over._vy_appMask && over._vy_pixS) scrM.updateScreenSpriteText(over, true);
			}
		}
	};
	scrM.addScreenAnimation = function(pD) {
		pD._vy_onScrAnim = true;
		scrM.screenAnimations.push(pD);
		if (pD._vy_ico && pD._vy_animator && pD._vy_animator.sync) {
			if (!scrM.syncAnimations[pD._vy_animator.sync]) {
				scrM.syncAnimations[pD._vy_animator.sync] = pD._vy_anim;
				scrM.syncAnimations[pD._vy_animator.sync].sync = pD._vy_animator.sync;
			} else {
				pD._vy_anim = scrM.syncAnimations[pD._vy_animator.sync];
				dfM._setFrameIcon(pD, pD._vy_anim.frame);
			}
		}
	};
	scrM.addToScreen = function(pD, pSkip) {
		if (!pD || pD._vy_onScr) return;
		if (pD._vy_invisibility && clientM.cOb._vy_playerMob && clientM.cOb._vy_playerMob._vy_visibility < pD._vy_invisibility && !pD._vy_viewers.includes(clientM.cOb._vy_playerMob)) {
			if (pD._vy_isLoc) {
				if (pD._vy_conts) {
					for (var c = pD._vy_conts.length; c --;) {
						scrM.addToScreen(pD._vy_conts[c]);
					}
				}
				if (pD._vy_offGridDiobs) {
					for (var c = pD._vy_offGridDiobs.length; c --;) scrM.addToScreen(pD._vy_offGridDiobs[c]);
				}
			}
			return;
		}
		pD._vy_onScr = 1;
		if (pD._vy_ico) {
			if (!pD._vy_ico.loaded) resM.loadIconImage(pD._vy_ico, pD);
		} else if (pD._vy_atlas) {
			resM.setObjectIcon(pD);
			if (!pD._vy_ico && pD._vy_atlas && pD._vy_icoState === 'south') dfM.setIconState(pD, pD._vy_icoState, pD._vy_moving, 0, true);
			dfM._setIconSize(pD);
		}
		if (pD._vy_recheckState && resM.loadedAtlases[pD._vy_atlas] && !resM.loadedAtlases[pD._vy_atlas].loading) {
			dfM.setIconState(pD, pD._vy_recheckState, pD._vy_recheckStateM, 0, true);
		}
		scrM.setScreenSprite(pD);
		scrM.updateScreenSprite(pD);
		if (pD._vy_isLoc) {
			scrM.addScreenSprite(pD, scrM.tileContainer);
			pD._vy_pixS.position.set(pD._vy_x + (pD._vy_icoW * pD._vy_pixS.anchor.x), pD._vy_y + (pD._vy_icoH * pD._vy_pixS.anchor.y));
			scrM.screenTiles.push(pD);
			scrM.refreshTileScreen = true;
			if (pD._vy_conts) {
				for (var c = pD._vy_conts.length; c --;) {
					scrM.addToScreen(pD._vy_conts[c]);
				}
			}
			if (pD._vy_offGridDiobs) {
				for (var c = pD._vy_offGridDiobs.length; c --;) scrM.addToScreen(pD._vy_offGridDiobs[c]);
			}
			if (pD._vy_region && pD._vy_region._vy_ico) {
				if (!pD._vy_regionI) {
					pD._vy_regionI = funcM._newDiob('Diob', true);
					pD._vy_regionI._vy_mapN = pD._vy_mapN;
					pD._vy_regionI._vy_loc = pD;
					pD._vy_regionI._vy_x = pD._vy_x;
					pD._vy_regionI._vy_y = pD._vy_y;
				}
				pD._vy_regionI.setAppearance(pD._vy_region);
				scrM.addToScreen(pD._vy_regionI);
			}
		} else {
			scrM.setDisplayOrder(pD);
		}
		if (pD._vy_over) {
			for (var c = pD._vy_over.length; c --;) {
				var obj = pD._vy_over[c];
				if (!obj._vy_appMask) scrM.addToScreen(obj);
				else {
					obj._vy_onScr = 1;
					if (!obj._vy_ico && obj._vy_atlas) {
						resM.setObjectIcon(obj);
						if (!obj._vy_ico && obj._vy_atlas && obj._vy_icoState === 'south') dfM.setIconState(obj, obj._vy_icoState, pD._vy_moving, 0, true);
						dfM._setIconSize(obj);
					}
					scrM.setScreenSprite(obj);
					scrM.updateScreenSprite(obj);
					if (pD._vy_isLoc) obj._vy_pixS.position.set(pD._vy_x + obj._vy_x + (obj._vy_icoW * obj._vy_pixS.anchor.x) + obj._vy_xIcoOff, pD._vy_y + obj._vy_y + (obj._vy_icoH * obj._vy_pixS.anchor.y) + obj._vy_yIcoOff);
					if (obj._vy_appMask.ownAnim) {
						if (obj._vy_anim && ((obj._vy_ico && obj._vy_ico.parent.frames) || obj._vy_anim.playAnim)) {
							scrM.addScreenAnimation(obj);
						}
					} else if (pD._vy_onScrAnim) obj._vy_onScrAnim = true;
				}
			}
		}
		if (pD._vy_anim && ((pD._vy_ico && pD._vy_ico.parent.frames) || pD._vy_anim.playAnim)) {
			scrM.addScreenAnimation(pD);
		}
		if (pD.onScreenShow && !pSkip) pD.onScreenShow(clientM.cOb);
	};
	scrM.removeFromScreen = function(pD, pClipped, pSkip, pSkip2) {
		if (!pD._vy_onScr) return;
		scrM.clearDisplayOrder(pD);
		delete pD._vy_onScr;
		if (pD.onScreenHide && !pSkip2) pD.onScreenHide(clientM.cOb);
		if (pD._vy_isLoc) {
			if (!pClipped && pD._vy_conts) {
				for (var c = pD._vy_conts.length; c--;) {
					var obj = pD._vy_conts[c];
					if (!obj) continue;
					if (!pSkip) {
						if (obj._vy_locs.length > 1) {
							var found = false;
							for (var i = obj._vy_locs.length; i --;) {
								if (obj._vy_locs[i]._vy_onScr) {
									found = true;
									break;
								}
							}
							if (found) continue;
						}
					}
					scrM.removeFromScreen(obj, pClipped, pSkip, pSkip2);
				}
			}
			if (pD._vy_regionI) scrM.removeFromScreen(pD._vy_regionI, pClipped, pSkip, pSkip2);
		}
		if (pD._vy_over) {
			for (var c = pD._vy_over.length; c --;) {
				var obj = pD._vy_over[c];
				if (!obj._vy_appMask) scrM.removeFromScreen(obj, pClipped, pSkip, pSkip2);
				else {
					delete obj._vy_onScr;
					if (obj._vy_onScrAnim) {
						if (obj._vy_appMask.ownAnim) {
							var index = scrM.screenAnimations.indexOf(obj);
							if (index !== -1) scrM.screenAnimations.splice(index, 1);
						}
						delete obj._vy_onScrAnim;
					}
				}
			}
		}
		if (pD._vy_onScrAnim) {
			delete pD._vy_onScrAnim;
			var index = scrM.screenAnimations.indexOf(pD);
			if (index !== -1) scrM.screenAnimations.splice(index, 1);
		}
	};
	scrM.readdToScreen = function(pD, pSkip) {
		if (!pD._vy_onScr) return;
		scrM.clearDisplayOrder(pD);
		scrM.setDisplayOrder(pD, true);
		if (pD._vy_over && !pSkip) {
			for (var c = pD._vy_over.length; c --;) {
				var o = pD._vy_over[c];
				if (!o._vy_onScr || o._vy_appMask) continue;
				scrM.clearDisplayOrder(o);
				scrM.setDisplayOrder(o, true);
			}
		}
	};
	scrM.setDisplayOrder = function(pD, pReadd) {
		if (!pReadd) {
			if (pD._vy_anim && pD._vy_anim.lastCheck && !pD._vy_anim.sync) {
				var ms = performance.now() - pD._vy_anim.lastCheck;
				if (pD._vy_ico && pD._vy_ico.parent.frames && ms > pD._vy_ico.parent.frames.length * pD._vy_anim.delay) {
					ms -= Math.floor(ms / (pD._vy_ico.parent.frames.length * pD._vy_anim.delay)) * (pD._vy_ico.parent.frames.length * pD._vy_anim.delay);
				}
				pD._vy_anim.lastCheck = performance.now();
				pD._vy_anim.timer = ms;
			}
		}
		var plane = scrM.planes[pD._vy_plane];
		if (!plane) plane = dfM._setPlane(pD._vy_plane);
		scrM.setDisplayOrderAddDis(pD, ((pD.isOverlay) ? pD.isOverlay : pD), plane);
	};
	scrM.setDisplayOrderAddDisDef = function(pD, pO, pP) {
		if (!pD._vy_isParticle) {
			if (pD.isOverlay && pD._vy_layer === pD.isOverlay._vy_layer) {
				var index = pP._vy_planeDis.indexOf(pD.isOverlay);
				if (index !== -1) {
					if (index < pP._vy_planeDis.length - 1) pP._vy_planeDis.splice(index + 1, 0, pD);
					else pP._vy_planeDis.push(pD);
					index = pP._vy_pixS.children.indexOf(pD.isOverlay._vy_pixS);
					if (pD.isOverlay._vy_firstOverApp) {
						var a = pD._vy_firstOverApp;
						while (a) a = a._vy_nextOverApp;
						index = pP._vy_pixS.children.indexOf(a);
					}
					scrM.addScreenSprite(pD, pP._vy_pixS, index + 1);
					return;
				}
			}
			for (var i = 0, len = pP._vy_planeDis.length; i < len; i ++) {
				var d = pP._vy_planeDis[i];
				if (d._vy_layer >= pD._vy_layer) {
					if (d._vy_layer !== pD._vy_layer || (pO._vy_y + pO._vy_rrelayerH + pO._vy_yIcoOff <= d._vy_y + d._vy_rrelayerH + d._vy_yIcoOff)) {
						pP._vy_planeDis.splice(i, 0, pD);
						scrM.addScreenSprite(pD, pP._vy_pixS, (d._vy_firstUnderApp)? pP._vy_pixS.children.indexOf(d._vy_firstUnderApp._vy_pixS) : pP._vy_pixS.children.indexOf(d._vy_pixS));
						return;
					}
				}
			}
		}
		pP._vy_planeDis.push(pD);
		scrM.addScreenSprite(pD, pP._vy_pixS);
	};
	scrM.setDisplayOrderAddDisIso = function(pD, pO, pP) {
		if (!pD._vy_isParticle) {
			if (pD.isOverlay && pD._vy_layer === pD.isOverlay._vy_layer) {
				var index = pP._vy_planeDis.indexOf(pD.isOverlay);
				if (index !== -1) {
					if (index < pP._vy_planeDis.length - 1) pP._vy_planeDis.splice(index + 1, 0, pD);
					else pP._vy_planeDis.push(pD);
					index = pP._vy_pixS.children.indexOf(pD.isOverlay._vy_pixS);
					if (pD.isOverlay._vy_firstOverApp) {
						var a = pD._vy_firstOverApp;
						while (a) a = a._vy_nextOverApp;
						index = pP._vy_pixS.children.indexOf(a);
					}
					scrM.addScreenSprite(pD, pP._vy_pixS, index + 1);
					return;
				}
			}
			var y = ((pO._vy_x + pO._vy_y) / 2);
			for (var i = 0, len = pP._vy_planeDis.length; i < len; i ++) {
				var d = pP._vy_planeDis[i];
				if (d._vy_x === pO._vy_x && d._vy_y === pO._vy_y && d._vy_layer > pD._vy_layer) {
					pP._vy_planeDis.splice(i, 0, pD);
					scrM.addScreenSprite(pD, pP._vy_pixS, (d._vy_firstUnderApp)? pP._vy_pixS.children.indexOf(d._vy_firstUnderApp._vy_pixS) : pP._vy_pixS.children.indexOf(d._vy_pixS));
					return;
				} else {
					if (y <= ((d._vy_x + d._vy_y) / 2)) {
						pP._vy_planeDis.splice(i, 0, pD);
						scrM.addScreenSprite(pD, pP._vy_pixS, (d._vy_firstUnderApp)? pP._vy_pixS.children.indexOf(d._vy_firstUnderApp._vy_pixS) : pP._vy_pixS.children.indexOf(d._vy_pixS));
						return;
					}
				}
			}
		}
		pP._vy_planeDis.push(pD);
		scrM.addScreenSprite(pD, pP._vy_pixS);
	};
	scrM.setDisplayOrderAddDis = scrM.setDisplayOrderAddDisDef;
	scrM.addScreenSprite = function(pD, pC, pI) {
		if (pD._vy_firstUnderApp) {
			var a = pD._vy_firstUnderApp;
			while (a) {
				scrM.setScreenSprite(a);
				scrM.updateScreenSprite(a);
				pI = scrM.updateScreenSpriteOver(pC, a, pI);
				a = a._vy_nextUnderApp;
			}
		}
		pI = scrM.updateScreenSpriteOver(pC, pD, pI);
		if (pD._vy_firstOverApp) {
			var a = pD._vy_firstOverApp;
			while (a) {
				scrM.setScreenSprite(a);
				scrM.updateScreenSprite(a);
				pI = scrM.updateScreenSpriteOver(pC, a, pI);
				a = a._vy_nextOverApp;
			}
		}
	};
	scrM.updateScreenSpriteOver = function(pC, pO, pI) {
		if (pO._vy_overScr && !pO._vy_overScrSprite) pO._vy_overScrSprite = new PIXI.Sprite(PIXI.Texture.from(pO._vy_overScr.canvas.toDataURL()));
		if (pI > -1) {
			pC.addChildAt(pO._vy_pixS, pI);
			pI ++;
			if (pO._vy_pixT) {
				pC.addChildAt(pO._vy_pixT, pI);
				pI ++;
			}
			if (pO._vy_overScrSprite) {
				pC.addChildAt(pO._vy_overScrSprite, pI);
				pI ++;
			}
		} else {
			pC.addChild(pO._vy_pixS);
			if (pO._vy_pixT) pC.addChild(pO._vy_pixT);
			if (pO._vy_overScrSprite) pC.addChild(pO._vy_overScrSprite);
		}
		return pI;
	};
	scrM.clearDisplayOrder = function(pD) {
		if (pD._vy_isLoc) {
			scrM.removeScreenSprite(pD, scrM.tileContainer);
			scrM.screenTiles.splice(scrM.screenTiles.indexOf(pD), 1);
			return;
		}
		var plane = scrM.planes[pD._vy_plane];
		if (!plane) plane = dfM._setPlane(pD._vy_plane);
		var index = plane._vy_planeDis.indexOf(pD);
		if (index !== -1) plane._vy_planeDis.splice(index, 1);
		scrM.removeScreenSprite(pD, plane._vy_pixS);
	};
	scrM.removeScreenSprite = function(pD, pC) {
		if (pD._vy_firstUnderApp) {
			var a = pD._vy_firstUnderApp;
			while (a) {
				pC.removeChild(a._vy_pixS);
				if (a._vy_pixT) pC.removeChild(a._vy_pixT);
				if (a._vy_overScrSprite) pC.removeChild(a._vy_overScrSprite);
				a = a._vy_nextUnderApp;
			}
		}
		pC.removeChild(pD._vy_pixS);
		if (pD._vy_pixT) pC.removeChild(pD._vy_pixT);
		if (pD._vy_overScrSprite) pC.removeChild(pD._vy_overScrSprite);
		if (pD._vy_firstOverApp) {
			var a = pD._vy_firstOverApp;
			while (a) {
				pC.removeChild(a._vy_pixS);
				if (a._vy_pixT) pC.removeChild(a._vy_pixT);
				if (a._vy_overScrSprite) pC.removeChild(a._vy_overScrSprite);
				a = a._vy_nextOverApp;
			}
		}
	};
	scrM.setDisplayOrderInt = function(pD, pReadd) {
		if (!pReadd) {
			if (pD._vy_anim && pD._vy_anim.lastCheck) {
				var ms = performance.now() - pD._vy_anim.lastCheck;
				if (pD._vy_ico && pD._vy_ico.parent.frames && ms > pD._vy_ico.parent.frames.length * pD._vy_anim.delay) {
					ms -= Math.floor(ms / (pD._vy_ico.parent.frames.length * pD._vy_anim.delay)) * (pD._vy_ico.parent.frames.length * pD._vy_anim.delay);
				}
				pD._vy_anim.lastCheck = performance.now();
				pD._vy_anim.timer = ms;
			}
		}
		for (var i = 0, len = scrM.interfaceElements.length; i < len; i ++) {
			var d = scrM.interfaceElements[i];
			if (d._vy_layer > pD._vy_layer) {
				scrM.interfaceElements.splice(i, 0, pD);
				return;
			}
		}
		scrM.interfaceElements.push(pD);
	};
	scrM.pauseRender = function(pType, pClear) {
		if (!scrM.pauseDraw) {
			if (pClear) scrM.clearScreen(0, 1);
			scrM.pixiApp.render();
			scrM.pixiApp.stop();
			if (pType) requestAnimationFrame(scrM.refreshScreen);
		}
		scrM.pauseDraw = pType || true;
	};
	scrM.resumeRender = function() {
		scrM.pauseDraw = scrM.lastPauseDraw;
		if (!scrM.pauseDraw) {
			delete scrM.lastPauseDraw;
			scrM.pixiApp.start();
			scrM.setViewFromObject(scrM.viewEye, true, true);
			for (var o in clientM.cOb._vy_over) {
				scrM.addToScreen(clientM.cOb._vy_over[o]);
			}
		}
	};
	scrM.refreshScreenAnimations = function(pT) {
		for (var i = scrM.screenAnimations.length; i --;) {
			var d = scrM.screenAnimations[i];
			if (!d._vy_anim || d._vy_anim.isPaused) continue;
			if (d._vy_anim.sync) {
				if (d._vy_anim.lastFrame === pT) {
					dfM._setFrameIcon(d, d._vy_anim.frame);
				} else if (d._vy_anim.lastCheck !== pT) {
					var frame = d._vy_anim.frame;
					dfM._setFrame(d, pT);
					if (d._vy_anim.frame !== frame) {
						d._vy_anim.lastFrame = pT;
					}
				}
			} else dfM._setFrame(d, pT);
		}
	};
	scrM.refreshTileScreenFunc = function(pT) {
		/*if (!scrM.screenTiles.length) {
			scrM.moveTileScreen = false;
			scrM.refreshTileScreen = false;
			return;
		}*/
		scrM.moveTileScreen = false;
		if (scrM.refreshTileScreen) {
			scrM.refreshTileScreen = false;
			for (var i = scrM.screenTiles.length; i --;) {
				var d = scrM.screenTiles[i];
				if (scrM.refreshScrEyeLoc && (d._vy_x + _vy_t_xTileSize + scrM.xScrExtra < scrM.xScrRaw || d._vy_x > scrM.xScrRaw + scrM.mapWidth + scrM.xScrExtra || d._vy_y + _vy_t_yTileSize + scrM.yScrExtra < scrM.yScrRaw || d._vy_y > scrM.yScrRaw + scrM.mapHeight + scrM.yScrExtra)) {
					scrM.removeFromScreen(d, 1);
					continue;
				}
			}
		}
		//scrM.tileContainer.position.set(-(scrM.xScr - scrM.viewEye._vy_wH), -(scrM.yScr - scrM.viewEye._vy_hH));
		scrM.tileContainer.position.set(-scrM.xScr, -scrM.yScr);
	};
	scrM.nextFrame = performance.now();
	scrM.relayerRefresh = [];
	scrM.refreshScreen = function(pT) {
		var time = performance.now();
		scrM.lastTime = pT;
		eventM.refreshObjectMovement(time);
		diobM.refreshTransitions(time);
		scrM.refreshScreenAnimations(time);
		if (scrM.setViewD) {
			scrM.setViewFromPos(scrM.setViewD._vy_x - scrM.xViewEye, scrM.setViewD._vy_y - scrM.yViewEye);
			scrM.setViewD = 0;
		}
		if (scrM.scrDelay) scrM.updateViewEyeDelay(scrM.scrDelay, time);
		scrM.frames ++;
		if (scrM.nextFrame <= time) {
			clientM.fps = scrM.frames;
			if (!clientM.cOb.hideFPS) mainM.fpsLabel.textContent = scrM.frames + ' FPS';
			scrM.nextFrame = time + 1000;
			scrM.frames = 0;
		}
		if (clientM.cOb.onScreenRender) clientM.cOb.onScreenRender(time);
		if (!scrM.pauseDraw) {
			if (scrM.refreshTileScreen || scrM.moveTileScreen) {
				scrM.refreshTileScreenFunc(time);
				scrM.refreshAllScreen = true;
			} else scrM.refreshAllScreen = false;
			scrM.frameRefresh = !(scrM.frames % 10);
			if (scrM.refreshScrEyeLoc || scrM.frameRefresh) {
				for (var i = 0, len = scrM.planesArr.length; i < len; i ++) {
					var plane = scrM.planesArr[i];
					for (var i2 = plane._vy_planeDis.length; i2 --;) {
						var d = plane._vy_planeDis[i2];
						if (!d) {
							plane._vy_planeDis.splice(i2, 1);
							continue;
						}
						if (!scrM.checkDiobView(d) && (!d.loc || !d._vy_loc._vy_onScr)) {
							scrM.removeFromScreen(d, 1);
							continue;
						}
						if (d._vy_onScrRelayer && scrM.frameRefresh) {
							delete d._vy_onScrRelayer;
							scrM.relayerRefresh.push(d);
						}
					}
				}
				if (scrM.frameRefresh && scrM.relayerRefresh.length) {
					for (var i = scrM.relayerRefresh.length; i --;) {
						scrM.clearDisplayOrder(scrM.relayerRefresh[i]);
					}
					for (var i = scrM.relayerRefresh.length; i --;) {
						scrM.setDisplayOrder(scrM.relayerRefresh[i], true);
					}
					scrM.relayerRefresh = [];
				}
				scrM.refreshScrEyeLoc = false;
			}
		} else if (!scrM.frames) {
			for (var i = scrM.screenTiles.length; i --;) {
				var d = scrM.screenTiles[i];
				if (d._vy_x + _vy_t_xTileSize + scrM.xScrExtra < scrM.xScrRaw || d._vy_x > scrM.xScrRaw + scrM.mapWidth + scrM.xScrExtra || d._vy_y + _vy_t_yTileSize + scrM.yScrExtra < scrM.yScrRaw || d._vy_y > scrM.yScrRaw + scrM.mapHeight + scrM.yScrExtra) {
					scrM.removeFromScreen(d, 1);
				}
			}
			for (var i = scrM.planesArr.length; i --;) {
				var plane = scrM.planesArr[i];
				for (var i2 = plane._vy_planeDis.length; i2 --;) {
					var d = plane._vy_planeDis[i2];
					if (!scrM.checkDiobView(d) && (!d.loc || !d._vy_loc._vy_onScr)) {
						scrM.removeFromScreen(d, 1);
					}
				}
			}
		}
		if (!scrM.pauseDraw || scrM.pauseDraw === 'map') {
			for (var i in scrM.refreshInt) {
				if (!scrM.refreshInt[i] || !scrM.intBrush[i]) continue;
				scrM.refreshInt[i] = false;
				scrM.intBrush[i].clearRect(0, 0, scrM.intCanvas[i].width, scrM.intCanvas[i].height);
				if (!scrM.scrRefInt) scrM.scrRefInt = {};
				scrM.scrRefInt[i] = true;
			}
			if (scrM.scrRefInt) {
				for (var iI = 0, len = scrM.interfaceElements.length; iI < len; iI ++) {
					var d = scrM.interfaceElements[iI];
					var i = d._vy_layer;
					if (scrM.scrRefInt[i] && scrM.intBrush[i] && !d._vy_invisibility) {
						if (d._vy_firstUnderApp) {
							var a = d._vy_firstUnderApp;
							while (a) {
								scrM.drawScrIntImg(a, time, i);
								if (a._vy_text && !a._vy_webBox) scrM.refreshTextInt(scrM.intBrush[i], a, i);
								a = a._vy_nextUnderApp;
							}
						}
						scrM.drawScrIntImg(d, time, i);
						if (d._vy_firstOverApp) {
							var a = d._vy_firstOverApp;
							while (a) {
								scrM.drawScrIntImg(a, time, i);
								if (a._vy_text && !a._vy_webBox) scrM.refreshTextInt(scrM.intBrush[i], a, i);
								a = a._vy_nextOverApp;
							}
						}
						if (d._vy_text && !d._vy_webBox) scrM.refreshTextInt(scrM.intBrush[i], d, i);
					}
				}
				delete scrM.scrRefInt;
			}
		}
		if (scrM.outputQueue.length) {
			for (var i = scrM.outputQueue.length; i --;) {
				var d = scrM.outputQueue[i];
				if (d._vy_webBox.innerBox.scrollHeight - d._vy_webBox.innerBox.scrollTop - 50 <= d._vy_webBox.innerBox.clientHeight) {
					d._vy_webBox.innerBox.insertAdjacentHTML('beforeend', d._vy_outputQueue);
					d._vy_webBox.innerBox.scrollTop = d._vy_webBox.innerBox.scrollHeight;
				} else d._vy_webBox.innerBox.insertAdjacentHTML('beforeend', d._vy_outputQueue);
				d._vy_outputQueue = '';
			}
			scrM.outputQueue = [];
		}
		if (scrM.pauseDraw) requestAnimationFrame(scrM.refreshScreen);
	};
	scrM.checkDiobView = function(pD) {
		if (pD._vy_icoWS) {
			if (((pD._vy_x + pD._vy_xIcoOff + pD._vy_icoXS + pD._vy_icoWS) < scrM.xScr - _vy_t_xTileSize && pD._vy_x + pD._vy_xOr + pD._vy_w < scrM.xScrRaw - _vy_t_xTileSize) || ((pD._vy_x + pD._vy_xIcoOff + pD._vy_icoXS) > scrM.xScr + scrM.mapWidth + _vy_t_xTileSize && pD._vy_x > scrM.xScrRaw + scrM.mapWidth + _vy_t_xTileSize) || ((pD._vy_y + pD._vy_yIcoOff + pD._vy_icoYS + pD._vy_icoHS) < scrM.yScr - _vy_t_yTileSize && pD._vy_y + pD._vy_yOr + pD._vy_h < scrM.yScrRaw - _vy_t_yTileSize) || ((pD._vy_y + pD._vy_yIcoOff + pD._vy_icoYS) > scrM.yScr + scrM.mapHeight + _vy_t_yTileSize && pD._vy_y > scrM.yScrRaw + scrM.mapHeight + _vy_t_yTileSize)) {
				return;
			}
		} else if (((pD._vy_x + pD._vy_xIcoOff + pD._vy_icoW) < scrM.xScr - _vy_t_xTileSize && pD._vy_x + pD._vy_xOr + pD._vy_w < scrM.xScrRaw - _vy_t_xTileSize) || ((pD._vy_x + pD._vy_xIcoOff) > scrM.xScr + scrM.mapWidth + _vy_t_xTileSize && pD._vy_x > scrM.xScrRaw + scrM.mapWidth + _vy_t_xTileSize) || ((pD._vy_y + pD._vy_yIcoOff + pD._vy_icoH) < scrM.yScr - _vy_t_yTileSize && pD._vy_y + pD._vy_yOr + pD._vy_h < scrM.yScrRaw - _vy_t_yTileSize) || ((pD._vy_y + pD._vy_yIcoOff) > scrM.yScr + scrM.mapHeight + _vy_t_yTileSize && pD._vy_y > scrM.yScrRaw + scrM.mapHeight + _vy_t_yTileSize)) {
			return;
		}
		return true;
	};
	scrM.drawScrIntImg = function(pD, pTime, pInt) {
		var cO = (pD.isOverlay && pD._vy_appMask && !pD._vy_appMask.ownMod) ? pD.isOverlay : pD;
		if (pD.isOverlay) {
			if (pD._vy_appMask) {
				pD._vy_xDraw = pD.isOverlay._vy_x + pD._vy_xIcoOff + pD.isOverlay._vy_xIcoOff;
				pD._vy_yDraw = pD.isOverlay._vy_y + pD._vy_yIcoOff + pD.isOverlay._vy_yIcoOff;
			} else {
				pD._vy_xDraw = pD.isOverlay._vy_x + pD._vy_x + pD._vy_xIcoOff;
				pD._vy_yDraw = pD.isOverlay._vy_y + pD._vy_y + pD._vy_yIcoOff;
			}
		} else {
			pD._vy_xDraw = pD._vy_x + pD._vy_xIcoOff;
			pD._vy_yDraw = pD._vy_y + pD._vy_yIcoOff;
		}
		
		if (cO._vy_drawModified) {
			scrM.intBrush[pInt].save();
			if (mainM.scaled && !cO.preventAutoScale) scrM.intBrush[pInt].scale(mainM.scaleWidth, mainM.scaleHeight);
			scrM.scrDrawModBrush(scrM.intBrush[pInt], pD, cO);
			if (pD._vy_ico && pD._vy_ico.image) {
				scrM.intBrush[pInt].drawImage(pD._vy_ico.image, pD._vy_xDraw, pD._vy_yDraw);
			} else if (pD._vy_color) {
				scrM.intBrush[pInt].fillStyle = pD._vy_color;
				scrM.intBrush[pInt].fillRect(pD._vy_xDraw, pD._vy_yDraw, pD._vy_w, pD._vy_h);
			}
			if (pD._vy_overScr) scrM.drawScrOverScr(scrM.intBrush[pInt], pD, pD._vy_xDraw + pD._vy_overScr.x, pD._vy_yDraw + pD._vy_overScr.y, true);
			scrM.intBrush[pInt].restore();
		} else {
			if (mainM.scaled && !cO.preventAutoScale) {
				scrM.intBrush[pInt].save();
				scrM.intBrush[pInt].scale(mainM.scaleWidth, mainM.scaleHeight);
				if (pD._vy_ico && pD._vy_ico.image) scrM.intBrush[pInt].drawImage(pD._vy_ico.image, pD._vy_xDraw, pD._vy_yDraw);
				else if (pD._vy_color) {
					scrM.intBrush[pInt].fillStyle = pD._vy_color;
					scrM.intBrush[pInt].fillRect(pD._vy_xDraw, pD._vy_yDraw, pD._vy_w, pD._vy_h);
				}
				if (pD._vy_overScr) scrM.drawScrOverScr(scrM.intBrush[pInt], pD, pD._vy_xDraw + pD._vy_overScr.x, pD._vy_yDraw + pD._vy_overScr.y, true);
				scrM.intBrush[pInt].restore();
			} else {
				if (pD._vy_ico && pD._vy_ico.image) scrM.intBrush[pInt].drawImage(pD._vy_ico.image, pD._vy_xDraw, pD._vy_yDraw);
				else if (pD._vy_color) {
					scrM.intBrush[pInt].fillStyle = pD._vy_color;
					scrM.intBrush[pInt].fillRect(pD._vy_xDraw, pD._vy_yDraw, pD._vy_w, pD._vy_h);
				}
				if (pD._vy_overScr) scrM.drawScrOverScr(scrM.intBrush[pInt], pD, pD._vy_xDraw + pD._vy_overScr.x, pD._vy_yDraw + pD._vy_overScr.y, true);
			}
		}
	};
	scrM.scrDrawModBrush = function(pBrush, pD, pO) {
		if (pO._vy_composite) pBrush.globalCompositeOperation = pO._vy_composite;
		if (pO._vy_alpha !== undefined) pBrush.globalAlpha = pO._vy_alpha;
		if (pO._vy_angle || pO._vy_scale || pO._vy_transform) {
			var hW = pO._vy_icoW * ((pO._vy_anchor)? pO._vy_anchor.x : 0.5);
			var hH = pO._vy_icoH * ((pO._vy_anchor)? pO._vy_anchor.y : 0.5);
			pBrush.translate(pD._vy_xDraw + hW, pD._vy_yDraw + hH);
			if (pO._vy_transform) {
				var m = pO._vy_transform;
				pBrush.transform(m[0], m[1], m[3], m[4], m[6], m[7]);
			}
			if (pO._vy_scale) pBrush.scale(pO._vy_scale.x, pO._vy_scale.y);
			if (pO._vy_angle) pBrush.rotate((Math.PI * 2) - pO._vy_angle);
			pD._vy_xDraw = -hW;
			pD._vy_yDraw = -hH;
		}
	};
	scrM.drawScrOverScr = function(pBrush, pD, pX, pY) {
		var xScale = 1, yScale = 1;
		if (pD._vy_overScr.settings.scale) {
			if (typeof(pD._vy_overScr.settings) === 'object') {
				xScale = pD._vy_overScr.settings.scale.x;
				yScale = pD._vy_overScr.settings.scale.y;
			} else {
				xScale = pD._vy_overScr.settings.scale;
				yScale = pD._vy_overScr.settings.scale;
			}
		}
		if (pD._vy_overScr.settings.composite) {
			var comp = pBrush.globalCompositeOperation;
			pBrush.globalCompositeOperation = pD._vy_overScr.settings.composite;
			pBrush.drawImage(pD._vy_overScr.canvas, pX * xScale, pY * yScale, pD._vy_overScr.canvas.width * xScale, pD._vy_overScr.canvas.height * yScale);
			pBrush.globalCompositeOperation = comp;
		} else {
			pBrush.drawImage(pD._vy_overScr.canvas, pX * xScale, pY * yScale, pD._vy_overScr.canvas.width * xScale, pD._vy_overScr.canvas.height * yScale);
		}
	};
	scrM.addToInterface = function(pInt, pReadd) {
		if (pInt._vy_onScr) return;
		pInt._vy_onScr = 'interface';
		if (!pInt._vy_ico && pInt._vy_atlas) {
			resM.setObjectIcon(pInt);
			if (!pInt._vy_ico && pInt._vy_atlas && pInt._vy_icoState === 'south') dfM.setIconState(pInt, pInt._vy_icoState, pInt._vy_moving, 0, true);
			dfM._setIconSize(pInt);
		}
		if (pInt._vy_ico && (!pInt._vy_ico.image || !pInt._vy_ico.image.src)) resM.loadIconImage(pInt._vy_ico, pInt, false, true, true);
		scrM.setDisplayOrderInt(pInt, pReadd);
		if (pInt._vy_ico && pInt._vy_ico.parent.frames) scrM.intAnimations.push(pInt);
		if (!scrM.intBrush[pInt._vy_layer]) scrM.createInterfaceCanvas(pInt._vy_layer);
		if (mainM.scaled && pInt.edgeLock) scrM.setInterfaceElEdgeLock(pInt);
		if (pInt.interfaceType === 'WebBox') {
			if (!pInt._vy_webBox) scrM.createWebBox(pInt);
			else scrM.scaleWebBox(pInt);
			pInt._vy_webBox.style.display = 'block';
			pInt._vy_webBox.innerBox.scrollTop = pInt._vy_webBox.innerBox.scrollHeight;
		} else if (pInt.interfaceType === 'TextInput' || pInt.interfaceType === 'PassInput' || pInt.interfaceType === 'CommandInput' || pInt.interfaceType === 'TextArea') {
			pInt._vy_isIntInput = true;
			if (!pInt._vy_webBox) scrM.createWebBox(pInt, true);
			else scrM.scaleWebBox(pInt);
			pInt._vy_webBox.style.display = 'block';
		}
		if (pInt._vy_over) {
			for (var c = pInt._vy_over.length; c --;) {
				var over = pInt._vy_over[c];
				if (!over._vy_appMask) scrM.addToInterface(over, pReadd);
				else {
					over._vy_onScr = 'interface';
					if (over._vy_ico && (!over._vy_ico.image || !over._vy_ico.image.src)) resM.loadIconImage(over._vy_ico, pInt, false, true, true);
				}
			}
		}
		if (pInt._vy_conts) {
			for (var i = 0, len = pInt._vy_conts.length; i < len; i ++) {
				var cObj = pInt._vy_conts[i];
				if (!cObj.isHidden) scrM.addToInterface(cObj, pReadd);
				else if (cObj.interfaceType === 'WebBox' && !cObj._vy_webBox) {
					if (!scrM.intBrush[cObj._vy_layer]) scrM.createInterfaceCanvas(cObj._vy_layer);
					scrM.createWebBox(cObj);
				}
			}
		}
		scrM.refreshInt[pInt._vy_layer] = true;
		if (pInt._vy_anim && pInt._vy_ico && pInt._vy_ico.parent.frames) {
			scrM.addScreenAnimation(pInt);
		}
	};
	scrM.removeFromInterface = function(pInt) {
		if (!pInt._vy_onScr || pInt._vy_onScr !== 'interface') return;
		var index = scrM.interfaceElements.indexOf(pInt);
		if (index !== -1) scrM.interfaceElements.splice(index, 1);
		delete pInt._vy_onScr;
		if (pInt._vy_ico && pInt._vy_ico.parent.frames) scrM.intAnimations.splice(scrM.intAnimations.indexOf(pInt), 1);
		if (pInt._vy_conts) {
			for (var i = pInt._vy_conts.length; i --;) {
				scrM.removeFromInterface(pInt._vy_conts[i]);
			}
		}
		if (pInt._vy_over) {
			for (var c = pInt._vy_over.length; c --;) {
				var over = pInt._vy_over[c];
				if (!over._vy_appMask) scrM.removeFromInterface(over);
				else delete over._vy_onScr;
			}
		}
		if (pInt._vy_webBox) pInt._vy_webBox.style.display = 'none';
		scrM.refreshInt[pInt._vy_layer] = true;
		if (pInt._vy_onScrAnim) {
			delete pInt._vy_onScrAnim;
			scrM.screenAnimations.splice(scrM.screenAnimations.indexOf(pInt), 1);
		}
	};
	scrM.customScreenDraw = function(pBrush, pArgs, pFunc) {
		if (pArgs instanceof Array) {
			var callback = pFunc;
			var multiFunc = function() {
				if (pArgs.length) scrM._customScreenDraw(pArgs.shift(), pBrush, pFunc)
				else if (callback) callback()
			};
			pFunc = multiFunc;
			multiFunc();
		} else {
			scrM._customScreenDraw(pArgs, pBrush, pFunc);
		}
	};
	scrM._customScreenDraw = function(pD, pBrush, pFunc) {
		if (pD.composite) pBrush.globalCompositeOperation = pD.composite;
		else pBrush.globalCompositeOperation = 'source-over';
		if (pD.alpha) pBrush.globalAlpha = pD.alpha;
		else pBrush.globalAlpha = 1;
		if (pD.type === 'image') {
			if (!pD.image) return;
			if (pD.x === undefined) pD.x = 0;
			if (pD.y === undefined) pD.y = 0;
			var f2 = function(pImage, pD) {
				if (pD.angle) {
					var hW = ((pD.width)? pD.width : pImage.width) * ((pD.anchor !== undefined)? ((pD.anchor.x !== undefined)? pD.anchor.x : pD.anchor) : 0.5);
					var hH = ((pD.height)? pD.height : pImage.height) * ((pD.anchor !== undefined)? ((pD.anchor.y !== undefined)? pD.anchor.y : pD.anchor) : 0.5);
					pBrush.save();
					pBrush.translate(pD.x + hW, pD.y + hH);
					pBrush.rotate((Math.PI * 2) - pD.angle);
					pD.x = -hW;
					pD.y = -hH;
				}
				if (pD.clipX !== undefined && pD.clipY !== undefined && pD.clipW && pD.clipH) {
					pBrush.drawImage(pImage, pD.clipX, pD.clipY, pD.clipW, pD.clipH, pD.x, pD.y, ((pD.width)? pD.width : pD.clipW), ((pD.height)? pD.height : pD.clipH));
				} else {
					if (pD.width && pD.height) pBrush.drawImage(pImage, pD.x, pD.y, pD.width, pD.height);
					else pBrush.drawImage(pImage, pD.x, pD.y);
				}
				if (pFunc) pFunc();
				if (pD.angle) pBrush.restore();
			}
			var img = pD.image;
			if (typeof(img) === 'object') {
				if (img instanceof HTMLCanvasElement) {
					f2(img, pD);
				} else {
					var icon = img._vy_ico;
					if (!icon) {
						if (!img.atlasName) return;
						icon = stM.Icon._getIcon(img.atlasName, ((img.iconName)? img.iconName : ''), ((img.iconState)? img.iconState : ''), ((img.frame)? img.frame : undefined));
						if (!icon) return;
					}
					if (!icon.loaded || !icon.image || !icon.image.src) {
						var f3 = function() {
							f2(icon.image, pD);
						};
						resM.loadIconImage(icon, null, f3, false, true)
					} else f2(icon.image, pD);
				}
			} else if (typeof(img) === 'string') {
				var i = new Image();
				i.onload = function() {
					f2(this, pD);
				};
				i.src = img;
			} else {
				f2(img, pD);
			}
		} else {
			if (pD.angle) {
				pBrush.save();
				pBrush.rotate((Math.PI * 2) - pD.angle);
			}
			if (pD.type === 'fillRect' || pD.type === 'strokeRect') {
				if (pD.x === undefined || pD.y === undefined || pD.width === undefined || pD.height === undefined) return;
				if (pD.type === 'fillRect') {
					if (pD.color) pBrush.fillStyle = pD.color;
					else pBrush.fillStyle = '#000';
				} else {
					if (pD.color) pBrush.strokeStyle = pD.color;
					else pBrush.strokeStyle = '#000';
					pBrush.lineWidth = (pD.lineWidth)? pD.lineWidth : 1;
				}
				if (pD.type === 'fillRect') pBrush.fillRect(pD.x, pD.y, pD.width, pD.height);
				else if (pD.type === 'strokeRect') pBrush.strokeRect(pD.x, pD.y, pD.width, pD.height);
				if (pFunc) pFunc();
			} else if (pD.type === 'clearRect') {
				if (pD.x === undefined && pD.y === undefined && pD.width === undefined && pD.height === undefined) {
					pBrush.clearRect(0, 0, scrM.clearViewWidth, scrM.clearViewHeight);
				} else {
					if (pD.x === undefined || pD.y === undefined || pD.width === undefined || pD.height === undefined) return;
					pBrush.clearRect(pD.x, pD.y, pD.width, pD.height);
				}
				if (pFunc) pFunc();
			} else if (pD.type === 'text') {
				if (pD.x === undefined || pD.y === undefined) return;
				if (pD.color) pBrush.fillStyle = pD.color;
				else pBrush.fillStyle = '#000';
				if (pD.font) pBrush.font = pD.font;
				else pBrush.font = '12px Courier, monospace';
				if (pD.align) pBrush.textAlign = pD.align;
				pBrush.fillText(pD.text, pD.x, pD.y, pD.maxWidth);
				if (pFunc) pFunc();
			} else if (pD.type === 'fillPath' || pD.type === 'strokePath') {
				if (!pD.path || !pD.path.length) return;
				if (pD.type === 'fillPath') {
					if (pD.color) pBrush.fillStyle = pD.color;
					else pBrush.fillStyle = '#000';
				} else {
					if (pD.color) pBrush.strokeStyle = pD.color;
					else pBrush.strokeStyle = '#000';
					pBrush.lineWidth = (pD.lineWidth)? pD.lineWidth : 1;
				}
				pBrush.beginPath();
				var p = pD.path;
				for (var i = 0, len = p.length; i < len; i += 3) {
					var t = p[i];
					if (t === 'move') pBrush.moveTo(p[i + 1], p[i + 2]);
					else if (t === 'line') pBrush.lineTo(p[i + 1], p[i + 2]);
					else if (t === 'break') {
						i -= 2;
						if (pD.type === 'fillPath') pBrush.fill();
						else if (pD.type === 'strokePath') pBrush.stroke();
						pBrush.closePath();
						pBrush.beginPath();
					}
				}
				if (pD.type === 'fillPath') pBrush.fill();
				else if (pD.type === 'strokePath') pBrush.stroke();
				pBrush.closePath();
				if (pFunc) pFunc();
			}
			if (pD.angle) pBrush.restore();
		}
	};
	scrM.refreshTextInt = function(pB, pD, pInt) {
		if (!pD._vy_textSty) pD._vy_textSty = {};
		var lineSpace = (pD._vy_textSty.leading)? pD._vy_textSty.leading : scrM.defaultText.leading;
		var fontSize = (pD._vy_textSty.fontSize)? pD._vy_textSty.fontSize : scrM.defaultText.fontSize;
		var vPadding = (pD._vy_textSty.vPadding)? pD._vy_textSty.vPadding : (pD._vy_textSty.padding)? pD._vy_textSty.padding : scrM.defaultText.padding;
		var hPadding = (pD._vy_textSty.hPadding)? pD._vy_textSty.hPadding : (pD._vy_textSty.padding)? pD._vy_textSty.padding : scrM.defaultText.padding;
		var yP = vPadding;
		var xP = hPadding;
		var cO = (pD.isOverlay) ? pD.isOverlay : pD;
		var cO2 = (pD.isOverlay && pD._vy_appMask) ? pD.isOverlay : pD;
		var xOff = pD._vy_xIcoOff;
		if (pD._vy_textSty.xPos) xOff += pD._vy_textSty.xPos;
		var yOff = pD._vy_yIcoOff;
		if (pD._vy_textSty.yPos) yOff += pD._vy_textSty.yPos;
		if (pD.isOverlay) {
			if (pD._vy_appMask) {
				xOff += cO2._vy_xIcoOff;
				yOff += cO2._vy_yIcoOff;
			} else {
				xOff += pD._vy_x;
				yOff += pD._vy_y;
			}
		}
		if (pD._vy_textSty.bitmap) {
			var charSpace = (pD._vy_textSty.charSpace)? pD._vy_textSty.charSpace : 0;
			if (!resM.loadedAtlases[pD._vy_textSty.bitmap]) {
				resM.loadAtlas(pD._vy_textSty.bitmap, true, null, pD);
				scrM.refreshInt[pInt] = true;
				return;
			}
			if (resM.loadedAtlases[pD._vy_textSty.bitmap].loading) {
				scrM.refreshInt[pInt] = true;
				return;
			}
			var align = ((pD._vy_textSty.align && pD._vy_textSty.align !== 'left')? 'right' : null);
			var x = ((align)? pD._vy_w : 0);
			if (align) xP *= -1;
			for (var i = 0, len = pD._vy_text.length; i < len; i ++) {
				var c = pD._vy_text[i];
				if (align) c = pD._vy_text[len - i - 1];
				if (c === "\n") {
					yP += fontSize + lineSpace;
					x = ((align)? pD._vy_w : 0);
					continue;
				}
				var icon = resM.resImg[pD._vy_textSty.bitmap][c];
				if (!icon) continue;
				icon = icon[''];
				if (!icon) icon = resM.resImg[pD._vy_textSty.bitmap][''];
				if (!icon) continue;
				if (!icon.loaded || !icon.image || !icon.image.src) resM.loadIconImage(icon, pD, false, true, true);
				if (align) x -= icon.width;
				if (pD._vy_textSty.bitMask && cO2._vy_drawModified) {
					cO2._vy_xDraw = cO._vy_x + xOff + x + xP;
					cO2._vy_yDraw = cO._vy_y + yOff + yP;
					scrM.intBrush[pInt].save();
					if (mainM.scaled && !cO2.preventAutoScale) scrM.intBrush[pInt].scale(mainM.scaleWidth, mainM.scaleHeight);
					scrM.scrDrawModBrush(scrM.intBrush[pInt], pD, cO2);
					scrM.intBrush[pInt].drawImage(icon.image, cO2._vy_xDraw, cO2._vy_yDraw);
					scrM.intBrush[pInt].restore();
					if (align) {
						if (cO2._vy_scale) x -= charSpace + (icon.width * cO2._vy_scale.x) - icon.width;
						else x -= charSpace;
					} else {
						if (cO2._vy_scale) x += icon.width + charSpace + (icon.width * cO2._vy_scale.x) - icon.width;
						else x += icon.width + charSpace;
					}
				} else {
					if (mainM.scaled && !cO2.preventAutoScale) {
						scrM.intBrush[pInt].save();
						scrM.intBrush[pInt].scale(mainM.scaleWidth, mainM.scaleHeight);
						scrM.intBrush[pInt].drawImage(icon.image, cO._vy_x + xOff + x + xP, cO._vy_y + yOff + yP);
						scrM.intBrush[pInt].restore();
					} else scrM.intBrush[pInt].drawImage(icon.image, cO._vy_x + xOff + x + xP, cO._vy_y + yOff + yP);
					if (align) x -= charSpace;
					else x += icon.width + charSpace;
				}
			}
		} else {
			pB.font = fontSize + 'px ' + ((pD._vy_textSty.fontFamily)? pD._vy_textSty.fontFamily : scrM.defaultText.fontFamily);
			pB.textBaseline = (pD._vy_textSty.textBaseline)? pD._vy_textSty.textBaseline : scrM.defaultText.textBaseline;
			pB.fillStyle = (pD._vy_textSty.fill)? pD._vy_textSty.fill : scrM.defaultText.fill;
			var topLine = (pD._vy_textSty.topLine)? pD._vy_textSty.topLine : 0;
			var maxWidth = (pD.interfaceType === 'TextBox' || pD._vy_isIntInput)? (pD._vy_w - (hPadding * 2)) : 0;
			var maxHeight = (pD.interfaceType === 'TextBox' || pD._vy_isIntInput)? (pD._vy_h - (vPadding * 2)) : 0;
			var horScroll = (pD._vy_isIntInput)? 1 : 0;
			var lines = [];
			var line = '';
			var lineHeight = fontSize + lineSpace;
			var word = '';
			var lineSize;
			if (horScroll) {
				for (var i = 0, len = pD._vy_text.length; i < len; i ++) {
					var c = pD._vy_text[i];
					lineSize = scrM.intBrush[pInt].measureText(line + c);
					if (lineSize.width > maxWidth) {
						line = line.substring(1, line.length) + c;
						lineSize = scrM.intBrush[pInt].measureText(line);
						if (lineSize.width > maxWidth) line = line.substring(1, line.length);
					} else line += c;
				}
			} else {
				for (var i = 0, len = pD._vy_text.length; i < len; i ++) {
					var c = pD._vy_text[i];
					if (maxWidth && (c === " " || i === len - 1)) {
						lineSize = scrM.intBrush[pInt].measureText(line + word + c);
						if (lineSize.width > maxWidth) {
							lines.push(line);
							line = '';
						}
						line += word + c;
						word = '';
					} else if (c === "\n") {
						lineSize = scrM.intBrush[pInt].measureText(line + word);
						if (maxWidth && lineSize.width > maxWidth) {
							lines.push(line);
							lines.push(word);
						} else {
							lines.push(line + word);
						}
						line = '';
						word = '';
					} else {
						word += c;
					}
				}
				if (word) line += word;
			}
			if (line) lines.push(line);
			if (pD._vy_scrollToBot) topLine = lines.length;
			var viewableLines = Math.floor(maxHeight / lineHeight);
			if (lines.length > viewableLines && lines.length < topLine + viewableLines) topLine = lines.length - viewableLines;
			else if (lines.length <= viewableLines) topLine = 0;
			pD._vy_textSty.topLine = topLine;
			if (pD._vy_textSty.align) {
				scrM.intBrush[pInt].textAlign = pD._vy_textSty.align;
				if (pD._vy_textSty.align === 'center') xP += pD._vy_wH;
				else if (pD._vy_textSty.align === 'right') xP += pD._vy_w;
			}
			for (var i = topLine, len = lines.length; i < len; i ++) {
				line = lines[i];
				if (maxHeight && yP + vPadding > maxHeight) break;
				if (pD._vy_textSty.stroke) {
					scrM.intBrush[pInt].strokeStyle = pD._vy_textSty.stroke;
					scrM.intBrush[pInt].lineWidth = (pD._vy_textSty.strokeThickness || 1);
					if (mainM.scaled && !cO2.preventAutoScale) {
						scrM.intBrush[pInt].save();
						scrM.intBrush[pInt].scale(mainM.scaleWidth, mainM.scaleHeight);
						scrM.intBrush[pInt].strokeText(line, cO._vy_x + xOff + xP, cO._vy_y + yOff + yP);
						scrM.intBrush[pInt].restore();
					} else scrM.intBrush[pInt].strokeText(line, cO._vy_x + xOff + xP, cO._vy_y + yOff + yP);
				}
				if (mainM.scaled && !cO2.preventAutoScale) {
					scrM.intBrush[pInt].save();
					scrM.intBrush[pInt].scale(mainM.scaleWidth, mainM.scaleHeight);
					scrM.intBrush[pInt].fillText(line, cO._vy_x + xOff + xP, cO._vy_y + yOff + yP);
					scrM.intBrush[pInt].restore();
				} else scrM.intBrush[pInt].fillText(line, cO._vy_x + xOff + xP, cO._vy_y + yOff + yP);
				yP += lineHeight;
			}
		}
	};
	scrM.setMapScreen = function(pPosX, pPosY, pW, pH) {
		if (pPosX) scrM.xMapPos = pPosX;
		else scrM.xMapPos = 0;
		if (pPosY) scrM.yMapPos = pPosY;
		else scrM.yMapPos = 0;
		if (pW) scrM.mapWidth = pW;
		else scrM.mapWidth = scrM.mapView.width;
		if (pH) scrM.mapHeight = pH;
		else scrM.mapHeight = scrM.mapView.height;
		if (scrM.mapView.scale && scrM.mapView.scale.x < 1) scrM.mapWidth /= scrM.mapView.scale.x;
		if (scrM.mapView.scale && scrM.mapView.scale.y < 1) scrM.mapHeight /= scrM.mapView.scale.y;
		scrM.mapWidthHalf = Math.round(scrM.mapWidth / 2);
		scrM.mapHeightHalf = Math.round(scrM.mapHeight / 2);
		scrM.xMap = Math.ceil(scrM.mapWidth / _vy_t_xTileSize);
		scrM.yMap = Math.ceil(scrM.mapHeight / _vy_t_yTileSize);
		scrM.xMapHalf = Math.round(scrM.xMap / 2);
		scrM.yMapHalf = Math.round(scrM.yMap / 2);
		if (scrM.viewEye) {
			scrM.xViewEye = scrM.mapWidthHalf - scrM.viewEye._vy_wH - scrM.xScrOff;
			scrM.yViewEye = scrM.mapHeightHalf - scrM.viewEye._vy_hH - scrM.yScrOff;
		}
		if (gameM.mapMode === 'isometric') {
			scrM.xScrExtraTile = Math.ceil(scrM.xScrDelayMax / _vy_t_xTileSize) + (scrM.xMapHalf / 2);
			scrM.yScrExtraTile = Math.ceil(scrM.yScrDelayMax / _vy_t_yTileSize) + (scrM.yMapHalf / 2);
			scrM.xScrExtra = (scrM.xScrExtraTile + 1) * _vy_t_xTileSize;
			scrM.yScrExtra = (scrM.yScrExtraTile + 1) * _vy_t_yTileSize;
		}
	};
	scrM.setInterfaceElEdgeLock = function(pInt) {
		if (!pInt._vy_xPoL) pInt._vy_xPoL = pInt._vy_x;
		if (!pInt._vy_yPoL) pInt._vy_yPoL = pInt._vy_y;
		if (pInt.edgeLock.indexOf('bottom') === 0) {
			pInt._vy_y = pInt._vy_yPoL + (scrM.clearViewHeight - ((!pInt.preventAutoScale)? (gameM.gameHeight * mainM.scaleHeight) : gameM.gameHeight));
		}
		if (pInt.edgeLock.indexOf('right') !== -1) {
			pInt._vy_x = pInt._vy_xPoL + (scrM.clearViewWidth - ((!pInt.preventAutoScale)? (gameM.gameWidth * mainM.scaleWidth) : gameM.gameWidth));
		}
	};
	scrM.setEdgeLimit = function(pX, pY) {
		scrM.xEdgeLimit = pX * _vy_t_xTileSize;
		scrM.yEdgeLimit = pY * _vy_t_yTileSize;
		if ((scrM.xEdgeLimit || scrM.xEdgeLimit === 0) && (scrM.yEdgeLimit || scrM.yEdgeLimit === 0)) scrM.hasEdgeLimit = true;
		else scrM.hasEdgeLimit = false;
	};
	scrM.createTopScreenCanvas = function(pName, pLayer, pSet) {
		if (!pName || scrM.topScreenCanvas[pName]) return;
		var canvas = document.createElement('canvas');
		canvas.className = 'top_canvas';
		canvas.width = window.innerWidth;
		canvas.height = window.innerHeight;
		if (pLayer === undefined) pLayer = 99999;
		canvas.style.zIndex = 90000 + pLayer;
		if (!scrM.intCanvas[pLayer]) scrM.createInterfaceCanvas(pLayer);
		mainM.gameBody.appendChild(canvas);
		var brush = canvas.getContext('2d');
		if (pSet) {
			scrM._setTopScreenSet(brush, pSet);
			if (pSet.autoScale) {
				canvas.width = gameM.gameWidth;
				canvas.height = gameM.gameHeight;
			}
		}
		scrM.topScreenBrush[pName] = brush;
		scrM.topScreenCanvas[pName] = canvas;
	};
	scrM.setTopScreen = function(pName, pNewName, pNewLayer, pNewData, pNewSet) {
		if (!pName || !pNewName || !scrM.topScreenCanvas[pName] || scrM.topScreenCanvas[pNewName]) return;
		scrM.topScreenCanvas[pNewName] = scrM.topScreenCanvas[pName];
		scrM.topScreenCanvas[pNewName].name = pNewName;
		scrM.topScreenBrush[pNewName] = scrM.topScreenBrush[pName];
		delete scrM.topScreenCanvas[pName];
		if (!pNewLayer) pNewLayer = 99999;
		else if (!scrM.intCanvas[pNewLayer]) scrM.createInterfaceCanvas(pNewLayer);
		if (pNewSet) scrM._setTopScreenSet(scrM.topScreenBrush[pNewName], pNewSet);
		scrM.topScreenCanvas[pNewName].style.zIndex = 90000 + pNewLayer;
		if (pNewData) {
			if (!pName) {
				if (typeof pNewData === 'string') {
					var img = new Image();
					img.onload = function() {
						scrM.topBrush.drawImage(img, 0, 0);
					};
					img.src = pNewData;
				} else scrM.topBrush.putImageData(pNewData, 0, 0);
			} else if (scrM.topScreenBrush[pName]) {
				if (typeof pNewData === 'string') {
					var img = new Image();
					img.onload = function() {
						scrM.topScreenBrush[pName].drawImage(img, 0, 0);
					};
					img.src = pNewData;
				} else scrM.topScreenBrush[pName].putImageData(pNewData, 0, 0);
			}
		}
	};
	scrM._setTopScreenSet = function(pBrush, pSet) {
		pBrush.topSet = pSet;
		if (pSet.scaleType === 'nearest') pBrush.imageSmoothingEnabled = false;
		else if (pSet.scaleType === 'smooth' && !scrM.disableImageSmoothing) pBrush.imageSmoothingEnabled = true;
		else pBrush.imageSmoothingEnabled = !scrM.disableImageSmoothing;
	};
	scrM.getTopScreen = function(pName, pType) {
		if (!pType) pType = 'pixels';
		var o = {'name': pName, 'layer': scrM.topScreenCanvas[pName].style.zIndex - 90000, 'settings': {}};
		if (!pName) {
			if (pType === 'url') o.data = mainM.topCanvasControl.toDataURL();
			else if (pType === 'pixels') o.data = scrM.topBrush.getImageData(0, 0, gameM.gameWidth, gameM.gameHeight);
			else if (pType === 'canvas') o.canvas = mainM.topCanvasControl;
		} else if (scrM.topScreenBrush[pName]) {
			var brush = scrM.topScreenBrush[pName];
			if (pType === 'url') o.data = scrM.topScreenCanvas[pName].toDataURL();
			else if (pType === 'pixels') o.data = brush.getImageData(0, 0, gameM.gameWidth, gameM.gameHeight);
			else if (pType === 'canvas') o.canvas = scrM.topScreenCanvas[pName];
			if (brush.imageSmoothingEnabled) o.settings.scaleType = 'smooth';
			else o.settings.scaleType = 'smooth';
		}
		return o;
	};
	scrM.createInterfaceCanvas = function(pLayer) {
		var canvas = document.createElement('canvas');
		canvas.className = 'interface_canvas';
		canvas.width = gameM.gameWidth;
		canvas.height = gameM.gameHeight;
		canvas.style.zIndex = 90000 + pLayer;
		mainM.gameBody.appendChild(canvas);
		scrM.intBrush[pLayer] = canvas.getContext('2d');
		scrM.intCanvas[pLayer] = canvas;
		var size = mainM.getWindowSize();
		mainM.setInterfaceCanvasSize(pLayer, size.width, size.height);
	};
	scrM.scaleWebBox = function(pInt) {
		var d = pInt._vy_webBox;
		if (pInt.preventAutoScale) {
			d.style.top = pInt._vy_y + 'px';
			d.style.left = pInt._vy_x + 'px';
			return;
		}
		if (mainM.scaleWidth !== 1 || mainM.scaleHeight !== 1) {
			d.style.top = (pInt._vy_y * mainM.scaleHeight) + 'px';
			d.style.left = (pInt._vy_x * mainM.scaleWidth) + 'px';
		} else {
			d.style.top = pInt._vy_y + 'px';
			d.style.left = pInt._vy_x + 'px';
		}
		d.style.transformOrigin = 'top left';
		d.style.transform = 'scale(' + mainM.scaleWidth + ',' + mainM.scaleHeight + ')';
	};
	scrM.createWebBox = function(pInt, pText) {
		var d = document.createElement('div');
		d.className = 'web_box';
		d.style.zIndex = 90000 + pInt._vy_layer;
		if (!pInt._vy_textSty) pInt._vy_textSty = {};
		var i;
		if (pText) {
			if (pInt.interfaceType === 'TextArea') {
				i = document.createElement('textarea');
				i.style.resize = 'none';
			} else {
				i = document.createElement('input');
				if (pInt.interfaceType === 'PassInput') {
					i.type = 'password';
					i.autocomplete = 'new-password';
				}
			}
			i.className = 'text_input';
			if (pInt._vy_parent) i.id = 'ti_' + pInt._vy_parent._vy_name.replace(/ /g, '') + '_' + pInt._vy_name;
			i.style.tabIndex = -1;
			if (pInt._vy_text) i.value = pInt._vy_text;
			i.inputChange = function(pEvent) {
				this.parent._vy_text = this.value;
			};
			i.onkeydown = function(pEvent) { this.inputChange(pEvent); };
			i.onkeyup = function(pEvent) { this.inputChange(pEvent); };
			d.style.pointerEvents = 'none';
		} else {
			i = document.createElement('div');
			i.className = 'web_box_inner';
			if (pInt._vy_parent) i.id = 'wb_' + pInt._vy_parent._vy_name + '_' + pInt._vy_name;
			if (pInt._vy_text) {
				var lines = pInt._vy_text.split('\n');
				if (lines.length > 1) {
					var text = ''
					for (var i2 = 0, len = lines.length; i2 < len; i2 ++) {
						text += '<div class="web_box_div" style="margin-bottom: ' + (((pInt._vy_textSty && pInt._vy_textSty.lineSpace)? pInt._vy_textSty.lineSpace : scrM.defaultText.lineSpace) + 'px') + '">' + mainM.getWebText(lines[i2]) + '</div>';
					}
					i.innerHTML = text;
				} else {
					i.innerHTML = pInt._vy_text;
				}
			}
		}
		pInt._vy_webBox = d;
		d.innerBox = i;
		scrM.setWebBoxStyle(pInt);
		if (pInt.isHidden) d.style.display = 'none';
		d.appendChild(i);
		mainM.gameBody.appendChild(d);
		i.parent = pInt;
		d.parent = pInt;
		scrM.scaleWebBox(pInt);
		scrM.setWebBoxSize(pInt);
	};
	scrM.setWebBoxStyle = function(pInt) {
		var d = pInt._vy_webBox;
		d.style.verticalAlign = (pInt._vy_textSty.textBaseline)? pInt._vy_textSty.textBaseline : scrM.defaultText.textBaseline;
		d.innerBox.style.top = ((pInt._vy_textSty.vPadding)? pInt._vy_textSty.vPadding : (pInt._vy_textSty.padding)? pInt._vy_textSty.padding : scrM.defaultText.padding) + 'px';
		d.innerBox.style.left = ((pInt._vy_textSty.hPadding)? pInt._vy_textSty.hPadding : (pInt._vy_textSty.padding)? pInt._vy_textSty.padding : scrM.defaultText.padding) + 'px';
		if (pInt._vy_textSty.fontFamily) d.innerBox.style.fontFamily = pInt._vy_textSty.fontFamily;
		if (pInt._vy_textSty.fill) d.innerBox.style.color = pInt._vy_textSty.fill;
		if (pInt._vy_textSty.fontSize) d.innerBox.style.fontSize = pInt._vy_textSty.fontSize + 'px';
		if (pInt._vy_textSty.align) d.innerBox.style.textAlign = pInt._vy_textSty.align;
	};
	scrM.setWebBoxSize = function(pInt, pV, pH) {
		if (!pV) pV = (pInt._vy_textSty.vPadding)? pInt._vy_textSty.vPadding : (pInt._vy_textSty.padding)? pInt._vy_textSty.padding : scrM.defaultText.padding;
		if (!pH) pH = (pInt._vy_textSty.hPadding)? pInt._vy_textSty.hPadding : (pInt._vy_textSty.padding)? pInt._vy_textSty.padding : scrM.defaultText.padding;
		pInt._vy_webBox.style.width = pInt._vy_w + 'px';
		pInt._vy_webBox.style.height = pInt._vy_h + 'px';
		pInt._vy_webBox.innerBox.style.height = (pInt._vy_h - (pV * 2)) + 'px';
		pInt._vy_webBox.innerBox.style.width = (pInt._vy_w - (pH * 2)) + 'px';
	};
};
var WORKER
var WORKER2
function prepareExport() {
	VS.global.reset = true
	document.getElementById('export').setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(JSON.stringify(VS.global.vyi)));
	document.getElementById('export').setAttribute('download', VS.global.fileName + '.vyi');
	document.getElementById('export_vys').setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(VS.global.vys));
	document.getElementById('export_vys').setAttribute('download', VS.global.fileName + '_type_defines.vs');
}
function blobToDataURL(blob, array, count, type, stateCount) {
	var reader = new FileReader();
	reader.onload = function() {
		array[array.indexOf(null)] = reader.result.replace('data:image/png;base64,', '');
		if (type) {
			switch (type) {
				case 'state':
					VS.global.vyi['i'][count][6].push(array);
					break;
				case 'frame':
					VS.global.vyi['i'][count][5].push(array);
					break;
				case 'state_frame':
					VS.global.vyi['i'][count][6][stateCount][3].push(array);
					break;
			}
			prepareExport();
		} else {
			VS.global.vyi['i'].push(array);
			prepareExport();
		}
   }
   reader.readAsDataURL(blob);
}
function makeWorker(json) {
	var canvas = document.getElementById('preview_canvas');
	var offscreen = canvas.transferControlToOffscreen();
	var canvas2 = document.getElementById('preview_canvas2');
	var offscreen2 = canvas2.transferControlToOffscreen();
	WORKER = new Worker(/*VS.Resource.getResourcePath('file', 'worker.js')*/'worker.js');
	WORKER.postMessage({ 'canvas': offscreen, 'msg': 'setup', 'json': json }, [offscreen]);
	WORKER.onmessage = function(e) {
		switch (e.data.msg) {
			case 'blob':
				if (e.data.type) {
					if (typeof e.data.state_count === 'number') {
						blobToDataURL(e.data.blob, e.data.array, e.data.count, e.data.type, e.data.state_count);
					} else {
						blobToDataURL(e.data.blob, e.data.array, e.data.count, e.data.type);
					}
				} else {
					blobToDataURL(e.data.blob, e.data.array);
				}
				break;
		}
	}
	WORKER2 = new Worker(/*VS.Resource.getResourcePath('file', 'worker2.js')*/'worker2.js');
	WORKER2.postMessage({ 'canvas': offscreen2, 'msg': 'setup2', 'json': json }, [offscreen2]);
}
function handleFileSelect(event) {
	var selectedFile = event.target.files[0];
	var reader = new FileReader();
	var img = document.getElementById('image');
	if (VS.global.reset) {
		VS.global.vyi = { 'v': 1, 'i': [] };
		VS.global.vys = '';
		VS.global.fileName = null;
		VS.global.type = null;
		VS.global.rideAlong = null;
		VS.global.firstTypeAdded = false;
		VS.global.name = null;
		VS.global.width = null;
		VS.global.height = null;
		VS.global.rideAlong = VS.global.client.confirm('Would you like to witness each sprite cut and determine if its a frame or icon state, as well as define its type? \n\n OK: Yes\n\n Cancel: No (all sprites will be its own icon and all diobs will be of ' + VS.global.defaultType + ' baseType)');
		VS.global.width = VS.global.client.prompt('Width of sprites in tileset?', 24);
		VS.global.height = VS.global.client.prompt('Height of sprites in tileset?', 24);
		VS.global.width = Number(VS.global.width);
		VS.global.height = Number(VS.global.height);
		if (!VS.global.width || !VS.global.height) {
			return VS.World.kickClient(VS.global.client, 'A number was not inputted for the width or height of the sprites');
		}
		VS.global.preview_canvas.text = VS.global.preview_canvas.defaultText;
		VS.global.preview_canvas2.text = VS.global.preview_canvas2.defaultText;
		VS.global.preview_canvas.width = VS.global.width * 2;
		VS.global.preview_canvas.height = VS.global.height * 2;
		VS.global.preview_canvas2.width = VS.global.width * 2;
		VS.global.preview_canvas2.height = VS.global.height * 2;
		makeWorker({'w': VS.global.width, 'h': VS.global.height});
		if (!VS.Util.isNumber(VS.global.width) || !VS.Util.isNumber(VS.global.height) ) {
			return VS.World.kickClient(VS.global.client, 'A number was not inputted for the width or height of the sprites')
		}
		if (!VS.global.rideAlong) {
			VS.global.name = VS.global.client.prompt('Name to be used for all diobs with a variable counter appended to the end: ', 'NamelessDiob')
			if (!VS.global.name) {
				VS.global.name = 'NamelessDiob'
			}
		}
	}
	if (selectedFile) {
		VS.global.vyi = {'v': 1,'i': []}
		var extension = event.target.files[0].name.split('.').pop();
		VS.global.fileName = event.target.files[0].name.replace('.' + extension, '');
	}
	if (event.target.files.length === 1) {
		if (extension !== 'jpg' && extension !== 'jpeg' && extension !== 'png') { /* If one of the files extension is not = to the supported types */
			return
		} else if (extension === 'png' || extension === 'jpg' || extension === 'jpeg') {
			img.title = 'Uploaded image: ' + selectedFile.name;
			reader.onload = function(event) {
				img.src = event.target.result;
			}
			reader.readAsDataURL(selectedFile);
		}
	}
}
function drawImgToCanvas() {
	var image = document.getElementById('image');
	var canvas = document.getElementById('canvas');
	var ctx = canvas.getContext('2d');
	canvas.width = image.width;
	canvas.height = image.height;
	VS.global.canvas.width = canvas.width + 40;
	VS.global.canvas.height = canvas.height + 40;
	ctx.drawImage(image, 0, 0, canvas.width, canvas.height);
	setTimeout(function() {
		var bitmap = createImageBitmap(canvas, 0, 0, canvas.width, canvas.height);
		bitmap.then(function(result) {
			WORKER.postMessage({ 'msg': 'image', 'bitmap': result });
			WORKER2.postMessage({ 'msg': 'image', 'bitmap': result });
			VS.global.makeVyi();
		});		
	}, 500);
}

var vyM={};function GameManager(){gameM=this;this.gameWidth=1280;this.gameHeight=720;gameM.gameID=1078;gameM.trial=0;gameM.buildNum=925;gameM.preloadAtlases=[];gameM.preloadAtlasPaths=[];mainM.setGameSettings();mainM.codeFiles=['png2vyi/main','png2vyi/style'];funcM.oF['Interface']={};funcM.oF['Interface']['onMouseDown']=function(client,x,y,button){try{if(this.draggable&&button===1){try{client.dragging={'element':this,'xOff':x,'yOff':y};}catch(e){dE(35,0,e);};}}catch(e){mainM.dE('onMouseDown',this,arguments,e);};};
funcM.oF['Interface/png2vyi/Canvas']={};funcM.oF['Interface/png2vyi/Canvas']['onNew']=function(){try{try{this.defaultPos={'x':this.xPos,'y':this.yPos};}catch(e){dE(46,0,e);};try{this.text='<div class="container"><canvas id="canvas">Your browser doesn\'t support canvas tag</canvas></div>';}catch(e){dE(47,0,e);};}catch(e){mainM.dE('onNew',this,arguments,e);};};
funcM.oF['Interface/png2vyi/Canvas']['onMouseClick']=function(client,x,y,button){try{if(button===3){try{this.setPos(this.defaultPos['x'],this.defaultPos['y']);}catch(e){dE(51,0,e);};}}catch(e){mainM.dE('onMouseClick',this,arguments,e);};};
funcM.oF['Interface/png2vyi/Text_Label']={};funcM.oF['Interface/png2vyi/Text_Label']['onNew']=function(){try{try{this.text='<div class="preview">Current</div>';}catch(e){dE(59,0,e);};}catch(e){mainM.dE('onNew',this,arguments,e);};};
funcM.oF['Interface/png2vyi/Text_Label2']={};funcM.oF['Interface/png2vyi/Text_Label2']['onNew']=function(){try{try{this.text='<div class="preview">Previous</div>';}catch(e){dE(67,0,e);};}catch(e){mainM.dE('onNew',this,arguments,e);};};
funcM.oF['Interface/png2vyi/Preview_Canvas']={};funcM.oF['Interface/png2vyi/Preview_Canvas']['onNew']=function(){try{try{this.text='<div class="container"><canvas id="preview_canvas">Your browser doesn\'t support canvas tag</canvas></div>';}catch(e){dE(73,0,e);};try{this.defaultText=this.text;}catch(e){dE(74,0,e);};}catch(e){mainM.dE('onNew',this,arguments,e);};};
funcM.oF['Interface/png2vyi/Preview_Canvas2']={};funcM.oF['Interface/png2vyi/Preview_Canvas2']['onNew']=function(){try{try{this.text='<div class="container"><canvas id="preview_canvas2">Your browser doesn\'t support canvas tag</canvas></div>';}catch(e){dE(79,0,e);};try{this.defaultText=this.text;}catch(e){dE(80,0,e);};}catch(e){mainM.dE('onNew',this,arguments,e);};};
funcM.oF['Interface/png2vyi/Upload']={};funcM.oF['Interface/png2vyi/Upload']['onNew']=function(){try{try{this.text='<label class="fake-button"><input type="file" onchange="handleFileSelect(event)" style="display: none; id="upload" accept="image/*"><div>Import</div></label>';}catch(e){dE(91,0,e);};}catch(e){mainM.dE('onNew',this,arguments,e);};};
funcM.oF['Interface/png2vyi/Export']={};funcM.oF['Interface/png2vyi/Export']['onNew']=function(){try{try{this.text='<label class="fake-button"><a id="export">Export</a></label>';}catch(e){dE(100,0,e);};}catch(e){mainM.dE('onNew',this,arguments,e);};};
funcM.oF['Interface/png2vyi/Export_Vys']={};funcM.oF['Interface/png2vyi/Export_Vys']['onNew']=function(){try{try{this.text='<label class="fake-button"><a id="export_vys">Export Vs</a></label>';}catch(e){dE(110,0,e);};}catch(e){mainM.dE('onNew',this,arguments,e);};};
funcM.oF['Interface/png2vyi/Img']={};funcM.oF['Interface/png2vyi/Img']['onShow']=function(){try{try{this.text='<div><img id="image" onload="drawImgToCanvas()" draggable="false"></div>';}catch(e){dE(122,0,e);};}catch(e){mainM.dE('onShow',this,arguments,e);};};
funcM.oF['Client']={};funcM.oF['Client']['onMouseMove']=function(diob,x,y){try{if(this.dragging){try{this.dragging['element'].setPos(x-this.dragging['xOff'],y-this.dragging['yOff']);}catch(e){dE(131,0,e);};}}catch(e){mainM.dE('onMouseMove',this,arguments,e);};};
funcM.oF['Client']['onMouseUp']=function(diob,x,y,button){try{if(this.dragging&&button===1){try{this.dragging=null;}catch(e){dE(135,0,e);};}}catch(e){mainM.dE('onMouseUp',this,arguments,e);};};
funcM.oF['Client']['onConnect']=function(){try{try{this.showInterface('interface');}catch(e){dE(138,0,e);};try{_vy_global.client=this;}catch(e){dE(139,0,e);};try{_vy_global.canvas=this.getInterfaceElement('interface','canvas');}catch(e){dE(140,0,e);};try{_vy_global.preview_canvas=this.getInterfaceElement('interface','preview_canvas');}catch(e){dE(141,0,e);};try{_vy_global.preview_canvas2=this.getInterfaceElement('interface','preview_canvas2');}catch(e){dE(142,0,e);};try{_vy_global.rideAlong=this.confirm('Would you like to witness each sprite cut and determine if its a frame or icon state, as well as define its type? \n\n OK: Yes\n\n Cancel: No (all sprites will be its own icon and all diobs will be of '+'Tile'+' baseType)');}catch(e){dE(144,0,e);};try{_vy_global.width=this.prompt('Width of sprites in tileset?',24);}catch(e){dE(145,0,e);};try{_vy_global.height=this.prompt('Height of sprites in tileset?',24);}catch(e){dE(146,0,e);};try{_vy_global.width=stM.Util.toNumber(_vy_global.width);}catch(e){dE(148,0,e);};try{_vy_global.height=stM.Util.toNumber(_vy_global.height);}catch(e){dE(149,0,e);};if(!_vy_global.width||!_vy_global.height){return (stM.World.kickClient(this,'A number was not inputted for the width or height of the sprites'));}try{_vy_global.preview_canvas.width=_vy_global.width*2;}catch(e){dE(154,0,e);};try{_vy_global.preview_canvas.height=_vy_global.height*2;}catch(e){dE(155,0,e);};try{_vy_global.preview_canvas2.width=_vy_global.width*2;}catch(e){dE(157,0,e);};try{_vy_global.preview_canvas2.height=_vy_global.height*2;}catch(e){dE(158,0,e);};try{stM.JS.makeWorker({'w':_vy_global.width,'h':_vy_global.height});}catch(e){dE(160,0,e);};if(!stM.Util.isNumber(_vy_global.width)||!stM.Util.isNumber(_vy_global.height)){return (stM.World.kickClient(this,'A number was not inputted for the width or height of the sprites'));}if(!_vy_global.rideAlong){try{_vy_global.name=this.prompt('Name to be used for all diobs with a variable counter appended to the end: ','NamelessDiob');}catch(e){dE(166,0,e);};if(!_vy_global.name)_vy_global.name='NamelessDiob';}}catch(e){mainM.dE('onConnect',this,arguments,e);};};
_vy_global.vyi="%7B'v'%3A1%2C'i'%3A%5B%5D%7D";_vy_global.vys="''";_vy_global.defaultType="'Tile'";_vy_global.frameDelay="100";_vy_global.reset="false";_vy_global.newLine="'%5Cn'";_vy_global.tab="'%5Ct'";
_vy_global.makeVyi=function(){try{try{var canvas=stM.JS.document.getElementById('canvas');}catch(e){dE(170,0,e);};try{var context=canvas.getContext('2d');}catch(e){dE(171,0,e);};try{var img=stM.JS.document.getElementById('image');}catch(e){dE(172,0,e);};try{var count=0;}catch(e){dE(173,0,e);};try{var iconVector={'x':0,'y':0};}catch(e){dE(174,0,e);};try{var stateCount=0;}catch(e){dE(175,0,e);};try{var vyiIconIndex;}catch(e){dE(176,0,e);};try{var wasState;}catch(e){dE(177,0,e);};try{var wasFrame;}catch(e){dE(178,0,e);};try{var previousDraw;}catch(e){dE(179,0,e);};try{var tiles=stM.Math.round((img.width/_vy_global.width)*(img.height/_vy_global.height))/*+100*/;}catch(e){dE(180,0,e);};try{var x=0;}catch(e){dE(181,0,e);};try{var y=0;}catch(e){dE(182,0,e);};for(var i=0;i<tiles;i++){if(x>stM.Math.round((img.width/_vy_global.width))){try{x=0;}catch(e){dE(186,0,e);};try{y++;}catch(e){dE(187,0,e);};}try{var blank;}catch(e){dE(188,0,e);};try{var data=context.getImageData(x*_vy_global.width,y*_vy_global.width,_vy_global.width,_vy_global.height).data;}catch(e){dE(189,0,e);};for(var v=0;v<data.length;v+=4){if(data[v+3]!==0){try{blank=false;}catch(e){dE(193,0,e);};break;}else{try{blank=true;}catch(e){dE(196,0,e);};}}if(!blank){if(_vy_global.rideAlong){if(previousDraw&&wasState&&!wasFrame||previousDraw&&!wasState&&!wasFrame){try{stM.JS.WORKER2.postMessage({'msg':'drawPrevious','previous':previousDraw});}catch(e){dE(201,0,e);};}try{stM.JS.WORKER.postMessage({'msg':'drawPreview','x':x*_vy_global.width,'y':y*_vy_global.height});}catch(e){dE(202,0,e);};try{previousDraw={'x':x*_vy_global.width,'y':y*_vy_global.height};}catch(e){dE(203,0,e);};if(wasState){try{var isStateFrame=_vy_global.client.confirm('Is this a frame of the last ICON STATE? \nOk: Yes\nCancel: No');}catch(e){dE(206,0,e);};if(isStateFrame){try{stM.JS.WORKER.postMessage({'msg':'getBlob','state_count':stateCount-1,'state_frame':true,'array':[null],'count':vyiIconIndex});}catch(e){dE(209,0,e);};try{x++;}catch(e){dE(210,0,e);};try{wasState=true;}catch(e){dE(211,0,e);};try{wasFrame=true;}catch(e){dE(212,0,e);};try{_vy_global.stateFrame++;}catch(e){dE(213,0,e);};continue;}else{try{wasState=null;}catch(e){dE(216,0,e);};try{wasFrame=null;}catch(e){dE(217,0,e);};}}if(!count){try{_vy_global.name=_vy_global.client.prompt('Name of icon?','NamelessDiob'+count);}catch(e){dE(220,0,e);};try{_vy_global.type=_vy_global.client.prompt('This diob\'s baseType is? : ','Tile');}catch(e){dE(221,0,e);};if(!_vy_global.name)_vy_global.name='NamelessDiob'+count;if(!_vy_global.type)_vy_global.type='Tile';try{stM.JS.WORKER.postMessage({'msg':'getBlob','array':[_vy_global.name.toLowerCase(),_vy_global.width,_vy_global.height,_vy_global.frameDelay,null,[],[]]});}catch(e){dE(224,0,e);};if(_vy_global.type==='Tile'){try{_vy_global.vys+=_vy_global.makeTypeString(_vy_global.type,_vy_global.name,_vy_global.fileName);}catch(e){dE(226,0,e);};}else{try{_vy_global.vys+=_vy_global.makeTypeString(_vy_global.type,_vy_global.name,_vy_global.fileName);}catch(e){dE(228,0,e);};}try{count++;}catch(e){dE(230,0,e);};try{x++;}catch(e){dE(231,0,e);};continue;}else{if(_vy_global.stateFrame){try{stM.JS.WORKER2.postMessage({'msg':'drawPrevious','previous':{'x':iconVector['x'],'y':iconVector['y']}});}catch(e){dE(237,0,e);};}try{var isFrame=_vy_global.client.confirm('Is this a frame of the last ICON? \nOk: Yes\nCancel: No');}catch(e){dE(238,0,e);};if(isFrame){if(!vyiIconIndex){try{vyiIconIndex=count-1;}catch(e){dE(241,0,e);};}try{wasFrame=true;}catch(e){dE(242,0,e);};try{wasState=null;}catch(e){dE(243,0,e);};try{stM.JS.WORKER.postMessage({'msg':'getBlob','frame':true,'array':[null],'count':vyiIconIndex});}catch(e){dE(244,0,e);};try{x++;}catch(e){dE(245,0,e);};continue;}try{var isState=_vy_global.client.confirm('Is this a iconState of the last ICON?\nOk: Yes\nCancel: No');}catch(e){dE(248,0,e);};if(isState){if(!vyiIconIndex){try{vyiIconIndex=count-1;}catch(e){dE(251,0,e);};}try{var stateName=_vy_global.client.prompt('Name to be used for this ICON STATE: ','state'+stateCount);}catch(e){dE(252,0,e);};if(!stateName){try{stateName='state'+stateCount;}catch(e){dE(254,0,e);};}try{stM.JS.WORKER.postMessage({'msg':'getBlob','state':true,'array':[stateName.toLowerCase(),null,_vy_global.frameDelay,[]],'count':vyiIconIndex});}catch(e){dE(255,0,e);};try{x++;}catch(e){dE(256,0,e);};try{stateCount++;}catch(e){dE(257,0,e);};try{wasFrame=null;}catch(e){dE(258,0,e);};try{wasState=true;}catch(e){dE(259,0,e);};try{_vy_global.stateFrame=0;}catch(e){dE(260,0,e);};continue;}}try{_vy_global.name=_vy_global.client.prompt('Name of Type? *will also be the iconName*','NamelessDiob'+count);}catch(e){dE(263,0,e);};try{_vy_global.type=_vy_global.client.prompt('This diob\'s baseType is? : ','Tile');}catch(e){dE(264,0,e);};if(!_vy_global.name)_vy_global.name='NamelessDiob'+count;if(!_vy_global.type)_vy_global.type='Tile';try{stM.JS.WORKER.postMessage({'msg':'getBlob','array':[_vy_global.name.toLowerCase(),_vy_global.width,_vy_global.height,_vy_global.frameDelay,null,[],[]]});}catch(e){dE(267,0,e);};if(_vy_global.type==='Tile'){try{_vy_global.vys+=_vy_global.makeTypeString(_vy_global.type,_vy_global.name,_vy_global.fileName);}catch(e){dE(269,0,e);};}else{try{_vy_global.vys+=_vy_global.makeTypeString(_vy_global.type,_vy_global.name,_vy_global.fileName);}catch(e){dE(271,0,e);};}try{vyiIconIndex=null;}catch(e){dE(272,0,e);};try{wasState=null;}catch(e){dE(273,0,e);};try{wasFrame=null;}catch(e){dE(274,0,e);};try{stateCount=0;}catch(e){dE(275,0,e);};try{iconVector={'x':x*_vy_global.width,'y':y*_vy_global.height};}catch(e){dE(276,0,e);};}else{try{stM.JS.WORKER.postMessage({'msg':'drawPreview','x':x*_vy_global.width,'y':y*_vy_global.height});}catch(e){dE(279,0,e);};try{stM.JS.WORKER.postMessage({'msg':'getBlob','array':[(_vy_global.name+count).toLowerCase(),_vy_global.width,_vy_global.height,_vy_global.frameDelay,null,[],[]]});}catch(e){dE(280,0,e);};if(_vy_global.firstTypeAdded){try{_vy_global.vys+=_vy_global.makeTypeString(null,_vy_global.name,_vy_global.fileName,{'firstType':false,'count':count});}catch(e){dE(282,0,e);};}else{try{_vy_global.vys+=_vy_global.makeTypeString(null,_vy_global.name,_vy_global.fileName,{'firstType':true,'count':count});}catch(e){dE(284,0,e);};try{_vy_global.firstTypeAdded=true;}catch(e){dE(285,0,e);};}}try{count++;}catch(e){dE(287,0,e);};}try{x++;}catch(e){dE(288,0,e);};}if(!_vy_global.rideAlong){try{stM.JS.document.getElementById('export').setAttribute('href','data:text/plain;charset=utf-8,'+stM.Util.encodeURIComponent(stM.Util.toString(_vy_global.vyi)));}catch(e){dE(291,0,e);};try{stM.JS.document.getElementById('export').setAttribute('download',_vy_global.fileName+'.vyi');}catch(e){dE(292,0,e);};try{stM.JS.document.getElementById('export_vys').setAttribute('href','data:text/plain;charset=utf-8,'+stM.Util.encodeURIComponent(_vy_global.vys));}catch(e){dE(294,0,e);};try{stM.JS.document.getElementById('export_vys').setAttribute('download',_vy_global.fileName+'_type_defines.vs');}catch(e){dE(295,0,e);};}}catch(e){mainM.dE('makeVyi',this,arguments,e);};};
_vy_global.makeTypeString=function(type,name,fileName,info){try{try{var nT=_vy_global.newLine+_vy_global.tab;}catch(e){dE(298,0,e);};if(info){try{var string='';}catch(e){dE(300,0,e);};if(info['firstType']){try{string+='Tile'+nT+(name+info['count'])+nT+_vy_global.tab+'atlasName = \''+fileName+'\''+nT+_vy_global.tab+'iconName = \''+(name+info['count']).toLowerCase()+'\''+_vy_global.newLine+'\r';}catch(e){dE(302,0,e);};}else{try{string+=_vy_global.tab+(name+info['count'])+nT+_vy_global.tab+'atlasName = \''+fileName+'\''+nT+_vy_global.tab+'iconName = \''+(name+info['count']).toLowerCase()+'\''+_vy_global.newLine+'\r';}catch(e){dE(304,0,e);};}return (string);}try{var tempCount=1;}catch(e){dE(307,0,e);};for(var i=0;i<type.length;i++){if(type[i]==='/'){try{type=type.replace('/',nT);}catch(e){dE(311,0,e);};try{tempCount++;}catch(e){dE(312,0,e);};try{nT=_vy_global.newLine+_vy_global.tab.repeat(tempCount);}catch(e){dE(313,0,e);};}}try{type+=(_vy_global.newLine+_vy_global.tab.repeat(tempCount))+name+(_vy_global.newLine+_vy_global.tab.repeat(tempCount+1))+'atlasName = \''+fileName+'\''+(_vy_global.newLine+_vy_global.tab.repeat(tempCount+1))+'iconName = \''+name.toLowerCase()+'\''+_vy_global.newLine+'\r';}catch(e){dE(315,0,e);};return (type);}catch(e){mainM.dE('makeTypeString',this,arguments,e);};};
mainM.setDefaultObjectTypes();resM.initiate();};
_vy_resources=["int_interface","534","18406a16.vyr","int_png2vyi/interface","534","18406a16.vyr","fil_worker.js","940","b8bbf7c3.js","fil_png2vyi/worker.js","940","b8bbf7c3.js","fil_worker2.js","633","b081096c.js","fil_png2vyi/worker2.js","633","b081096c.js"];
_vy_types={"v":1,"t":["Interface","",0,"Client","o.screenView%3D%7B%27scaleNearest%27%3Atrue%2C%27disableImageSmoothing%27%3Afalse%2C%27scaleTo%27%3A%27ratio%27%7D%3Bo.screenBackground%3D%27%2323272A%27%3Bo.hideFPS%3Dtrue%3B",0,"Interface/png2vyi","o.interfaceType%3D%27WebBox%27%3Bo._vy_mouseOp%3D0%3Bo.draggable%3Dtrue%3B",0,"Interface/png2vyi/Canvas","o._vy_mouseOp%3D2%3B",0,"Interface/png2vyi/Text_Label","o._vy_w%3D100%3Bo._vy_h%3D75%3Bo._vy_layer%3D101%3Bo._vy_textSty%3D%7B%27fill%27%3A%27%23fff%27%7D%3B",0,"Interface/png2vyi/Text_Label2","o._vy_w%3D100%3Bo._vy_h%3D75%3Bo._vy_layer%3D101%3Bo._vy_textSty%3D%7B%27fill%27%3A%27%23fff%27%7D%3B",0,"Interface/png2vyi/Preview_Canvas","o._vy_layer%3D100%3B",0,"Interface/png2vyi/Preview_Canvas2","o._vy_layer%3D100%3B",0,"Interface/png2vyi/Upload","o._vy_w%3D120%3Bo._vy_h%3D18%3B",0,"Interface/png2vyi/Export","o._vy_w%3D120%3Bo._vy_h%3D18%3B",0,"Interface/png2vyi/Export_Vys","o._vy_w%3D120%3Bo._vy_h%3D18%3B",0,"Interface/png2vyi/Img","o.interfaceType%3D%27WebBox%27%3Bo._vy_w%3D1%3Bo._vy_h%3D1%3B",0]};</script>
						<link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAHdJREFUeNpiNLDy/c8wgICFgYGBQVBYakAsf//2GQMTwwCDUQeMOmDAHcBCjKKZRZwo/PS+7xSpG42CUQeMOmDUAaMOGFQOYDSw8v0/kE0yFnI1k1PxjKYBstsD2AC5QT4aBaMOGHUA1mz4/u2zAXMAAAAA//8DAP3mF2MGU/irAAAAAElFTkSuQmCC" type="image/x-icon">
					</head>
					<body>
						<div id="game_body">
							<div id="web_background"></div>
							<canvas id="game_canvas"></canvas>
							<canvas id="top_canvas"></canvas>
							<div id="error_message"></div>
							<div id="fps_label"></div>
							<div id="load_screen">
								<div id="load_screen_loader_back"></div>
								<div id="load_screen_loader"></div>
								<div id="load_screen_loader_text">0%</div>
				
								<div id="load_screen_logo"></div>
							</div>
					
							<div class="box" id="games_list"></div>
							<div id="logo_box"></div>
					
						</div>
					</body>
				</html>
				
